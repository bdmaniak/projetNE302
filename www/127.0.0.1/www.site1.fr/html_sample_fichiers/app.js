"use strict";function _super(a){a.$class.$super.apply(a,Array.prototype.slice.call(arguments,1))}function hasClass(a,b){if(a){var c=function(a,b){return new RegExp(" "+b+" ").test(" "+a.className+" ")};if(a.length){for(var d=a.length,e=0;e<d;e+=1){if(c(a[e],b))return!0}return!1}return c(a,b)}}function htmlEncode(a){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/'/g,"&quot;").replace(/"/g,"&#39;")}function htmlDecode(a){var b=document.createElement("div");return b.innerHTML=a,0===b.childNodes.length?"":b.childNodes[0].nodeValue}function textareaResizeOnInput(a){textareaAutoResize(a);try{a.oninput=function(){textareaAutoResize(a)}}catch(a){}}function textareaAutoResize(a){if(a.style){a.style.height="1em",a.textarea_height=0,a.scrollTop=1;for(var b=0;1==a.scrollTop&&!(++b>=10);)a.textarea_height++,a.style.height=a.textarea_height+"em",a.scrollTop=1}}function _initI18n(a){a=a||{};var b=a.showMissingTranslation||!1;window._=function(a,c,d){return a=a||"<span style='color:#D25717'>Nothing to translate</span>","undefined"!=typeof i18n?void 0===i18n.common.entries[a]||""===i18n.common.entries[a]?b?replacePlaceholders(a,d)+"<span style='color:#D25717'>*</span>":replacePlaceholders(a,d):i18n.common.entries[a]instanceof Array?replacePlaceholders(i18n.common.entries[a][1],d):replacePlaceholders(i18n.common.entries[a],d):" "},window._n=function(a,c,d,e,f){if("en_gb"==applicationState.user.getSettings().getInterfaceLanguageCode()&&1==d)return a=replacePlaceholders(a,f),a.replace(/%d/g,d);if("undefined"!=typeof i18n){var g=+i18n.common.getPlural(d);if(i18n.common.entries[c]&&i18n.common.entries[c][g])return replacePlaceholders(i18n.common.entries[c][g],f).replace(/%d/g,d);var h=1==d?a:c;c=replacePlaceholders(h,f);var i=c.replace(/%d/g,d);return b?i+"<span style='color:#D25717'>*</span>":i}var h=1==d?a:c;return c=replacePlaceholders(h,f),_(c).replace(/%d/g,d)}}function _(){return"Translation module not initialised, use _initI18n()"}function _n(){return"Translation module not initialised, use _initI18n()"}function replacePlaceholders(a,b){for(var c in b){var d=new RegExp("{"+c+"}","g");a=a.replace(d,b[c])}return a}function config_set(a,b){configBinder.set(a,b)}function config_get(a,b){return configBinder.get(a)}function constant_set(a,b){constantBinder.set(a,b)}function constant_get(a,b){return constantBinder.get(a)}function configurationGenerate(){var a={MESSAGE_LIMIT_TIME:3e4,MAXIMUM_ERROR_COUNT:3,AJAX_TIMEOUTS:{SEARCH:10,LOGIN:10},SCROLL_OFFSET:600,BOARDS:{isActive:!1}};Object.keys(a).forEach(function(b){config_set(b,a[b])}),config_set("resultAction.enabled",config_get("boards.enabled")||!1),configurationSite()}function configurationSite(){window.siteConfiguration={url:{BOARDS:configuration.boardsUrl,SEARCH:configuration.searchUrl,LITE:configuration.liteUrl,JUNIOR:configuration.juniorUrl,MUSIC:configuration.musicUrl},trackers:{},searchCategories:{ALL:{name:"all",url:"all",i18n:function(){return _("All","side")},index:0,minWidth:1e3,scrollMobile:!1,displayName:!1,restricted:!1},WEB:{name:"web",url:"web",i18n:function(){return _("Web","side")},index:1,minWidth:640,scrollMobile:!1,displayName:!0,restricted:!1},NEWS:{name:"news",url:"news",i18n:function(){return _("News","side")},index:2,scrollMobile:!1,displayName:!0,restricted:!1},SOCIAL:{name:"social",url:"social",i18n:function(){return _("Social","side")},index:3,scrollMobile:!1,displayName:!0,restricted:!1},IMAGES:{name:"images",url:"images",i18n:function(){return _("Images","side")},index:4,scrollMobile:!0,displayName:!0,restricted:!1},VIDEOS:{name:"videos",url:"videos",i18n:function(){return _("Videos","side")},index:5,scrollMobile:!0,displayName:!0,restricted:!1},SHOPPING:{name:"shopping",url:"shopping",i18n:function(){return _("Shopping","side")},index:6,scrollMobile:!0,displayName:!0,restricted:{toRegions:["FR","GB","US","DE","IT","BE"]}}},safeSearchModes:[{i18n:function(){return _("None","settings")},value:0},{i18n:function(){return _("Moderate","settings")},value:1},{i18n:function(){return _("Strict","settings")},value:2}],homePageTabs:[{i18n:function(){return _("None","settings")},value:0},{i18n:function(){return _("Trends","settings")},value:1},{i18n:function(){return _("Bookmarks","settings")},value:2}],externalMenuItems:["PRIVACY","RANKING","ABOUT","TOS","LN","CONTACT","FAQ","QWICK","JOBS","PRESS","BLOG","LITE"],resultActionsOptions:{media:{showFavoriteButton:!0,showBoardsButton:!0},web:{showFavoriteButton:!0,showUserRatingButton:!0,showBoardsButton:!0},news:{showFavoriteButton:!0,showBoardsButton:!0},social:{showFavoriteButton:!1,showBoardsButton:!0}},themes:[{i18n:function(){return _("Light","settings")},value:0,className:""},{i18n:function(){return _("Dark","settings")},value:1,className:"theme-dark"}]},siteConfiguration.defaultSearch=siteConfiguration.searchCategories.ALL}function ExtendedQwoodle(){}!function(a,b,c,d,e,f,g,h){function i(a){return a&&typeof a===b&&!(typeof a.length===c&&!a.propertyIsEnumerable(d))&&a||null}function j(a){return a&&typeof a===b&&typeof a.length===c&&!a.propertyIsEnumerable(d)&&a||null}function k(a){return a&&"function"==typeof a&&a||null}function l(a){return"[object String]"===e.apply(a)&&a||null}function m(a){return k(a)&&a.prototype&&a===a.prototype.constructor&&a||null}function n(a,b,c,d,e,f){c&&c.hasOwnProperty(a)||(d[a]=b,e&&(f[a]=b))}function o(a,b,c){if(j(b))for(var d=b.length;--d>=0;)o(a,b[d],c);else{c=c||{constructor:1,$super:1,prototype:1,$superp:1};var e,f,g=m(a),h=m(b),k=a.prototype;if(i(b))for(e in b)n(e,b[e],c,a,g,k);if(h){f=b.prototype;for(e in f)n(e,f[e],c,a,g,k)}g&&h&&o(k,b.prototype,c)}}function p(a,b){b||(b=a,a=0);var c,d,e,f,g,h,i,l,m=0,n={constructor:1,$singleton:1,$statics:1,prototype:1,$super:1,$superp:1,main:1,toString:0},o=p.plugins;b=("function"==typeof b?b():b)||{},d=b.hasOwnProperty("constructor")?b.constructor:0,e=b.$singleton,f=b.$statics;for(g in o)n[g]=1;for(c=e?{}:d||function(){},h=e?c:c.prototype,a=!a||j(a)?a:[a],i=a&&a.length;m<i;){l=a[m++];for(g in l)n[g]||(h[g]=l[g],e||(c[g]=l[g]));for(g in l.prototype)n[g]||(h[g]=l.prototype[g])}for(g in b)n[g]||(h[g]=b[g]);for(g in f)c[g]=h[g]=f[g];e||(l=a&&a[0]||a,c.$super=l,c.$superp=l&&l.prototype?l.prototype:l,h.$class=c);for(g in o)o[g](c,a,b);return k(b.main)&&b.main.call(c,c),c}p.plugins={},h={Class:p,extend:o,mapOrNil:i,arrayOrNil:j,functionOrNil:k,stringOrNil:l,classOrNil:m},"undefined"!=typeof module&&module.exports?module.exports=h:(g=a.Class,a.Class=p,a.jsface=h,h.noConflict=function(){a.Class=g})}(this,"object","number","length",Object.prototype.toString);var Component=Class({$statics:{LAST_ID:0,alertComponent:null,renderPartial:function(a,b){var c=tmpl["_"+a];if(c)return c.call(this,b);l.error("Partial "+a+" does not exist")},registerAlert:function(a){Component.alertComponent=a}},addAction:function(a){this.actions.push(a)},refresh:function(){var a=this.state.getComponents();for(var b in a){var c=a[b];c.refresh(),c.setState(c.state)}},notify:function(a){},constructor:function(){this.tag=this.tag||"div",this.id="c_"+(Component.LAST_ID+=1),this.state=new State(this.initState()),this.template=tmpl[this.name],this.actions=[],this.doBeforeAction()},initState:function(){return{}},getDom:function(){return $i(this.id)},render:function(){var a=this.defaultClassName||this.name;return"<"+this.tag+' class="'+a+'" id="'+this.id+'">'+this.template.call(this,this.state)+"</"+this.tag+">"},setState:function(a){document.getElementById(this.id)&&(this.state=a instanceof State?a:new State(a),replaceInnerHTML(document.getElementById(this.id),this.template.call(this,this.state)),actionManager.fireEvent("rendered",{name:this.name}),this.onMount())},clean:function(){this.actions=actionManager.cleanComponent(this.actions)},anchor:function(a,b){return actionManager.anchor(a,b,this)},getId:function(){return this.id},getState:function(){return this.state()},onMount:function(){var a=this.state.getComponents();for(var b in a)a[b].onMount()},doBeforeAction:function(){this.beforeAction&&this.beforeAction().forEach(function(a){a.action.apply(this,a.params)})}}),LayoutComponent=Class(Component,{$statics:{components:[],registerBeforeAction:function(a,b){var c=b||{};LayoutComponent.beforeActions.push({action:a,parameters:c})},registerBeforeActionGlobal:function(a,b){var c=b||{};LayoutComponent.beforeActionGlobals.push({action:a,parameters:c})},cleanBeforeActionGlobal:function(a){var b=[];LayoutComponent.beforeActionGlobals.forEach(function(c){c.action.toString()!==a.toString()&&b.push(c)}),LayoutComponent.beforeActionGlobals=b},beforeActions:[],beforeActionGlobals:[],page:function(a,b){LayoutComponent.currentPage&&LayoutComponent.currentPage.clean(),LayoutComponent.beforeActions.forEach(function(a){a.parameters.route=b,a.action.call(a.parameters.component,a.parameters)}),LayoutComponent.beforeActionGlobals.forEach(function(c){c.parameters.route=b,c.action.call(c.parameters.component,c.parameters,a)}),LayoutComponent.beforeActions.length=0;var c=new a(b);this.state=new State({currentPage:c}),c.skipRender||(replaceInnerHTML(document.getElementById(LayoutComponent.id),c.render()),this.onMount(),actionManager.fireEvent("pageRendered",{name:c.name}),LayoutComponent.currentPage=c,this.notifyComponents())},registerComponent:function(a){LayoutComponent.components.push(a)}},notifyComponents:function(){for(var a=0;a<LayoutComponent.components.length;a+=1)LayoutComponent.components[a].notify(LayoutComponent.currentPage)},constructor:function(){this.state=new State,this.name="content",_super(this),this.template=function(){return""},LayoutComponent=this},setState:function(a){},doBeforeAction:function(){}}),Binder={};Binder.Util={isFunction:function(a){return void 0!=a&&"function"==typeof a&&"function"==typeof a.constructor&&a.constructor.prototype.hasOwnProperty("call")},isArray:function(a){return void 0!=a&&(a instanceof Array||"Array"==a.construtor)},isString:function(a){return"string"==typeof a||a instanceof String},isNumber:function(a){return"number"==typeof a||a instanceof Number},isBoolean:function(a){return"boolean"==typeof a||a instanceof Boolean},isDate:function(a){return a instanceof Date},isBasicType:function(a){return this.isString(a)||this.isNumber(a)||this.isBoolean(a)||this.isDate(a)},isNumeric:function(a){return this.isNumber(a)||this.isString(a)&&!isNaN(Number(a))},filter:function(a,b){for(var c=[],d=0;d<a.length;d++)b(a[d])&&c.push(a[d]);return c}},Binder.PropertyAccessor=function(a){this.target=a||{},this.index_regexp=/(.*)\[(.*?)\]/},Binder.PropertyAccessor.prototype={_setProperty:function(a,b,c){if(0==b.length||void 0==a)return c;var d=b.shift();if(d.indexOf("[")>=0){var e=d.match(this.index_regexp),f=e[2];if(d=e[1],a[d]=a[d]||(Binder.Util.isNumeric(f)?[]:{}),f)a[d][f]=this._setProperty(a[d][f]||{},b,c);else{var g=this._setProperty({},b,c);Binder.Util.isArray(g)?a[d]=g:a[d].push(g)}}else a[d]=this._setProperty(a[d]||{},b,c);return a},_getProperty:function(a,b){if(0==b.length||void 0==a)return a;var c=b.shift();if(c.indexOf("[")>=0){var d=c.match(this.index_regexp);return c=d[1],d[2]?this._getProperty(a[c][d[2]],b):a[c]}return this._getProperty(a[c],b)},_enumerate:function(a,b,c){if(Binder.Util.isArray(b))for(var d=0;d<b.length;d++)this._enumerate(a,b[d],c+"["+d+"]");else if(Binder.Util.isBasicType(b))a.push(c);else for(property in b)Binder.Util.isFunction(property)||this._enumerate(a,b[property],""==c?property:c+"."+property)},isIndexed:function(a){return void 0!=a.match(this.index_regexp)},set:function(a,b){var c=a.split(".");return this._setProperty(this.target,c,b)},get:function(a){var b=a.split(".");return this._getProperty(this.target||{},b)},properties:function(){var a=[];return this._enumerate(a,this.target,""),a}},Binder.PropertyAccessor.bindTo=function(a){return new Binder.PropertyAccessor(a)},Binder.TypeRegistry={string:{format:function(a){return String(a)},parse:function(a){return a&&""!=a?a:void 0}},number:{format:function(a){return String(a)},parse:function(a){return Number(a)}},boolean:{format:function(a){return String(a)},parse:function(a){return!!a&&("true"==(a=a.toLowerCase())||"yes"==a)}}},Binder.FormBinder=function(a,b){this.form=a,this.accessor=this._getAccessor(b),this.type_regexp=/type\[(.*)\]/},Binder.FormBinder.prototype={_isSelected:function(a,b){if(!Binder.Util.isArray(b))return""!=a&&"on"!=a?a==b:Boolean(b);for(var c=0;c<b.length;++c)if(a==b[c])return!0},_getType:function(a){if(a.className){var b=a.className.match(this.type_regexp);if(b&&b[1])return b[1]}return"string"},_format:function(a,b,c){var d=this._getType(c),e=Binder.TypeRegistry[d];if(Binder.Util.isArray(b)&&e){for(var f=[],g=0;g<b.length;g++)f[g]=e.format(b[g]);return f}return e?e.format(b):String(b)},_parse:function(a,b,c){var d=this._getType(c),e=Binder.TypeRegistry[d];if(Binder.Util.isArray(b)&&e){for(var f=[],g=0;g<b.length;g++)f[g]=e.parse(b[g]);return f}return e?e.parse(b):String(b)},_getAccessor:function(a){return void 0==a?this.accessor||new Binder.PropertyAccessor(a):a instanceof Binder.PropertyAccessor?a:new Binder.PropertyAccessor(a)},serialize:function(a){for(var b=this._getAccessor(a),c=0;c<this.form.elements.length;c++)this.serializeField(this.form.elements[c],b);return b.target},serializeField:function(a,b){var c=this._getAccessor(b),d=void 0;if("radio"==a.type||"checkbox"==a.type)if(""!=a.value&&"on"!=a.value){if(d=this._parse(a.name,a.value,a),a.checked)c.set(a.name,d);else if(c.isIndexed(a.name)){var e=c.get(a.name);e=Binder.Util.filter(e,function(a){return a!=d}),c.set(a.name,e)}}else d=a.checked,c.set(a.name,d);else if("select-one"==a.type||"select-multiple"==a.type){c.set(a.name,c.isIndexed(a.name)?[]:void 0);for(var f=0;f<a.options.length;f++){var g=this._parse(a.name,a.options[f].value,a);a.options[f].selected&&c.set(a.name,g)}}else d=this._parse(a.name,a.value,a),c.set(a.name,d)},deserialize:function(a){for(var b=this._getAccessor(a),c=0;c<this.form.elements.length;c++)this.deserializeField(this.form.elements[c],b);return b.target},deserializeField:function(a,b){var c=this._getAccessor(b),d=c.get(a.name);if(d=this._format(a.name,d,a),"radio"==a.type||"checkbox"==a.type)a.checked=this._isSelected(a.value,d);else if("select-one"==a.type||"select-multiple"==a.type)for(var e=0;e<a.options.length;e++)a.options[e].selected=this._isSelected(a.options[e].value,d);else a.value=d||""}},Binder.FormBinder.bind=function(a,b){return new Binder.FormBinder(a,b)};var Mosaic_timeout=0,Mosaiq=function(a){var b,a=a;return{process:function(){window.Mosaic_timeout||0==$("."+a).length||(window.Mosaic_timeout=setTimeout(function(){b=$("."+a)[0];var c=getComputed(b,"width")-(getComputed(b,"padding-left")+getComputed(b,"padding-right")+getComputed(b,"margin-left")+getComputed(b,"margin-right")),d=$(".result__thumb-container__image",b);if(d.length>0){var e,f,g;for(e=0;e<d.length;e++)d[e].style.width="auto",d[e].style.height="auto",d[e].style.minWidth="",d[e].style.marginLeft="",d[e].style.marginTop="0",void 0!==(g=getParentByClassName(d[e],"result"))&&(g.style.clear="none",g.style.width="auto",g.style.height="auto",removeClass(g,"first"),removeClass(g,"last"),removeClass(g,"cropped"));var h=0,i=0,j=0,k=0,l=0,m=0,n=0;if(!(g=getParentByClassName(d[0],"result")))return;for(addClass(g,"first"),e=0;e<d.length;e++){g=getParentByClassName(d[e],"result"),d[e].setAttribute("data-line",h);var k=parseInt(d[e].getAttribute("data-thumbWidth")),o=parseInt(d[e].getAttribute("data-thumbHeight")),j=parseInt(d[e].getAttribute("data-naturalWidth")),p=parseInt(d[e].getAttribute("data-naturalHeight"));if(l=Math.min(200*k/o,j,350),m=l*p/j,m<170?d[e].setAttribute("data-reducedHeight","true"):m<190?addClass(g,"cropped"):d[e].style.height="200px",d[e].style.width=parseInt(l)+"px",g.style.width=parseInt(l)+"px",g.style.height=parseInt(200)+"px",(i+=l+16)>c){for(d[e+1]&&(g=getParentByClassName(d[e+1],"result"),g.style.clear="both",addClass(g,"first")),n=$("img[data-line='"+h+"']",b),f=0;f<n.length;f++){var q=c;g=getParentByClassName(n[f],"result"),n[f].getAttribute("data-reducedHeight")?(n[f].style.width=parseInt(parseInt(n[f].style.width)/(i/q))+"px",n[f].style.marginTop=parseInt((200/(i/q)-parseInt(n[f].style.width)*parseInt(n[f].getAttribute("data-naturalHeight"))/parseInt(n[f].getAttribute("data-naturalWidth")))/2)+"px",n[f].nextSibling&&"IMG"==n[f].nextSibling.tagName&&(n[f].nextSibling.style.marginTop=parseInt(n[f].style.marginTop))):(n[f].style.height=parseInt(200/(i/q))+1+"px",n[f].style.width=parseInt(200/(i/q)*parseInt(n[f].getAttribute("data-naturalWidth"))/parseInt(n[f].getAttribute("data-naturalHeight")))+"px"),g.style.height=parseInt(200/(i/q))+16+"px",hasClass(g,"cropped")?(g.style.width=parseInt(n[f].style.width)+"px",n[f].style.minWidth=parseInt(n[f].style.width)+"px",n[f].style.height="auto",n[f].style.marginLeft="-10px"):g.style.width=parseInt(n[f].style.width)+16+"px"}g=getParentByClassName(n[n.length-1],"result"),-1==uxVersions.indexOf("v4")&&addClass(g,"last"),i=0,h++}}}Mosaic_timeout=0},100))}}};!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.page=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c||a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a,b){if(AlertComponent&&AlertComponent.removeMessage({id:AlertComponent.lastId}),"function"==typeof a)return d("*",a);if("function"==typeof b)for(var c=new g(a),e=1;e<arguments.length;++e)d.callbacks.push(c.middleware(arguments[e]));else"string"==typeof a?d.show(a,b):d.start(a)}function e(a){if(!a.handled){var b;b=q?p+n.hash.replace("#!",""):n.pathname+n.search,b!==a.canonicalPath&&(d.stop(),a.handled=!1,n.href=a.canonicalPath)}}function f(a,b){"/"===a[0]&&0!==a.indexOf(p)&&(a=p+a);var c=a.indexOf("?");if(this.canonicalPath=a,this.path=a.replace(p,"")||"/",this.title=document.title,this.state=b||{},this.state.path=a,this.querystring=~c?a.slice(c+1):"",this.pathname=~c?a.slice(0,c):a,this.params=[],this.hash="",~this.path.indexOf("#")){var d=this.path.split("#");this.path=d[0],this.hash=d[1]||"",this.querystring=this.querystring.split("#")[0]}}function g(a,b){b=b||{},this.path="*"===a?"(.*)":a,this.method="GET",this.regexp=l(this.path,this.keys=[],b.sensitive,b.strict)}function h(a){if(a.state){var b=a.state.path;d.replace(b,a.state)}}function i(a){if(1==j(a)&&!(a.metaKey||a.ctrlKey||a.shiftKey||a.defaultPrevented)){for(var b=a.target;b&&"A"!=b.nodeName;)b=b.parentNode;if(b&&"A"==b.nodeName){var c=b.getAttribute("href");if((b.pathname!=n.pathname||!b.hash&&"#"!=c)&&!(c&&c.indexOf("mailto:")>-1)&&(!b.target||"_self"==b.target)&&k(b.href)){var e=b.pathname+b.search+(b.hash||""),f=e;e=e.replace(p,""),p&&f==e||(a.preventDefault(),d.show(f))}}}}function j(a){return a=a||window.event,null===a.which?a.button:a.which}function k(a){var b=n.protocol+"//"+n.hostname;return n.port&&(b+=":"+n.port),a&&0===a.indexOf(b)}var l=a("path-to-regexp");b.exports=d;var m,n=window.history.location||window.location,o=!0,p="",q=!1;d.callbacks=[],d.base=function(a){if(0===arguments.length)return p;p=a},d.start=function(a){if(a=a||{},!m&&(m=!0,!1===a.dispatch&&(o=!1),!1!==a.popstate&&window.addEventListener("popstate",h,!1),!1!==a.click&&window.addEventListener("click",i,!1),!0===a.hashbang&&(q=!0),o)){var b=q&&0===n.hash.indexOf("#!")?n.hash.substr(2)+n.search:n.pathname+n.search+n.hash;d.replace(b,null,!0,o)}},d.stop=function(){m=!1,removeEventListener("click",i,!1),removeEventListener("popstate",h,!1)},d.show=function(a,b,c){var e=new f(a,b);return e.pushState(),!1!==c&&d.dispatch(e),e},d.replace=function(a,b,c,e){var g=new f(a,b);return g.init=c,g.save(),!1!==e&&d.dispatch(g),g},d.dispatch=function(a){function b(){var f=d.callbacks[c++];if(!f)return e(a);f(a,b)}var c=0;b()},d.Context=f,f.prototype.pushState=function(){var a=history;void 0===history.replaceState&&(a=History),a.pushState(this.state,this.title,q&&"/"!==this.canonicalPath?"#!"+this.canonicalPath:this.canonicalPath)},f.prototype.save=function(){var a=history;void 0===history.replaceState&&(a=History),a.replaceState(this.state,this.title,q&&"/"!==this.canonicalPath?"#!"+this.canonicalPath:this.canonicalPath)},d.Route=g,g.prototype.middleware=function(a){var b=this;return function(c,d){if(b.match(c.path,c.params))return a(c,d);d()}},g.prototype.match=function(a,b){var c=this.keys,d=a.indexOf("?"),e=~d?a.slice(0,d):a,f=this.regexp.exec(decodeURIComponent(e));if(!f)return!1;for(var g=1,h=f.length;g<h;++g){var i=c[g-1],j="string"==typeof f[g]?decodeURIComponent(f[g]):f[g];i?b[i.name]=void 0!==b[i.name]?b[i.name]:j:b.push(j)}return!0},d.sameOrigin=k},{"path-to-regexp":2}],2:[function(a,b,c){function d(a){return a.replace(/([=!:$\/()])/g,"\\$1")}function e(a,b,c){b&&!Array.isArray(b)&&(c=b,b=null),b=b||[],c=c||{};var h=c.strict,i=!1!==c.end,j=c.sensitive?"":"i",k=0;if(a instanceof RegExp){var l=a.source.match(/\((?!\?)/g)||[];return b.push.apply(b,l.map(function(a,b){return{name:b,delimiter:null,optional:!1,repeat:!1}})),g(a,b)}if(Array.isArray(a))return a=a.map(function(a){return e(a,b,c).source}),g(new RegExp("(?:"+a.join("|")+")",j),b);a=a.replace(f,function(a,c,e,f,g,h,i,j){if(c)return c;if(j)return"\\"+j;var l="+"===i||"*"===i,m="?"===i||"*"===i;return b.push({name:f||k++,delimiter:e||"/",optional:m,repeat:l}),e=e?"\\"+e:"",g=d(g||h||"[^"+(e||"\\/")+"]+?"),l&&(g=g+"(?:"+e+g+")*"),m?"(?:"+e+"("+g+"))?":e+"("+g+")"});var m="/"===a[a.length-1];return h||(a=(m?a.slice(0,-2):a)+"(?:\\/(?=$))?"),i||(a+=h&&m?"":"(?=\\/|$)"),g(new RegExp("^"+a+(i?"$":""),j),b)}b.exports=e;var f=new RegExp(["(\\\\.)","([\\/.])?(?:\\:(\\w+)(?:\\(((?:\\\\.|[^)])*)\\))?|\\(((?:\\\\.|[^)])*)\\))([+*?])?","([.+*?=^!:${}()[\\]|\\/])"].join("|"),"g"),g=function(a,b){return a.keys=b,a}},{}]},{},[1])(1)}),function(a){function b(){this._callbacks=[]}function c(a){var c=new b,d=[];if(!a||!a.length)return c.done(d),c;for(var e=0,f=a.length,g=0;g<f;g++)a[g].then(function(a){return function(){e+=1,d[a]=Array.prototype.slice.call(arguments),e===f&&c.done(d)}}(g));return c}function d(a,c){var e=new b;return 0===a.length?e.done.apply(e,c):a[0].apply(null,c).then(function(){a.splice(0,1),d(a,arguments).then(function(){e.done.apply(e,arguments)})}),e}function e(a){if("string"==typeof a)return a;var b=encodeURIComponent,c=[];for(var d in a)a.hasOwnProperty(d)&&c.push(b(d)+"="+b(a[d]));return c.join("&")}function f(){var a;if(window.XMLHttpRequest)a=new XMLHttpRequest;else if(window.ActiveXObject)try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){a=new ActiveXObject("Microsoft.XMLHTTP")}return a}function g(a,c,d,g){function h(){j.abort(),m.done(i.ETIMEOUT,"",j)}var j,k,m=new b;d=d||{},g=g||{};try{j=f()}catch(a){return m.done(i.ENOXHR,""),m}if(k=e(d),"GET"===a&&k){c+="?"+k+(-1==navigator.userAgent.indexOf("MSIE 9")?"":"&cache="+Date.now()),k=null}j.open(a,c);try{j.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var n in g)g.hasOwnProperty(n)&&j.setRequestHeader(n,g[n])}catch(a){l.info("no header set")}var o=i.ajaxTimeout;if(o)var p=setTimeout(h,o);return j.onreadystatechange=function(){if(o&&clearTimeout(p),4===j.readyState){var a=!j.status||(j.status<200||j.status>=300)&&304!==j.status;m.done(a,j.responseText,j)}},j.send(k),m.abort=function(){j.abort()},m}function h(a){return function(b,c,d){return g(a,b,c,d)}}b.prototype.then=function(a,c){var d;return this._isdone?d=a.apply(c,this.result):(d=new b,this._callbacks.push(function(){var b=a.apply(c,arguments);b&&"function"==typeof b.then&&b.then(d.done,d)})),d},b.prototype.done=function(){this.result=arguments,this._isdone=!0;for(var a=0;a<this._callbacks.length;a++)this._callbacks[a].apply(null,arguments);this._callbacks=[]};var i={Promise:b,join:c,chain:d,ajax:g,get:h("GET"),post:h("POST"),put:h("PUT"),del:h("DELETE"),ENOXHR:1,ETIMEOUT:2,ajaxTimeout:0};"function"==typeof define&&define.amd?define(function(){return i}):a.promise=i}(this),window.smoothScroll=function(){if(void 0!==document.querySelectorAll&&void 0!==window.pageYOffset&&void 0!==history.pushState){var a=function(a){return"HTML"===a.nodeName?-window.pageYOffset:a.getBoundingClientRect().top+window.pageYOffset},b=function(a){return a<.5?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1},c=function(a,c,d,e){return d>e?c:a+(c-a)*b(d/e)},d=function(b,d,e){d=d||500;var f=window.pageYOffset;if("number"==typeof b)var g=parseInt(b);else var g=a(b);var h=Date.now(),i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){window.setTimeout(a,15)},j=function(){var a=Date.now()-h;window.scroll(0,c(f,g,a,d)),a>d?"function"==typeof e&&e(b):i(j)};j()},e=function(a){a.preventDefault(),location.hash!==this.hash&&window.history.pushState(null,null,this.hash),d(document.getElementById(this.hash.substring(1)),500,function(a){location.replace("#"+a.id)})};return document.addEventListener("DOMContentLoaded",function(){for(var a,b=document.querySelectorAll('a[href^="#"]:not([href="#"])'),c=b.length;a=b[--c];)a.addEventListener("click",e,!1)}),d}}(),function(a){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&void 0!==module.exports?module.exports=a():"undefined"!=typeof Package?Sortable=a():window.Sortable=a()}(function(){function a(a,b){this.el=a,this.options=b=s({},b),a[J]=this;var d={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(a.nodeName)?"li":">*",ghostClass:"sortable-ghost",ignore:"a, img",filter:null,animation:0,setData:function(a,b){a.setData("Text",b.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0};for(var e in d)!(e in b)&&(b[e]=d[e]);var g=b.group;g&&"object"==typeof g||(g=b.group={name:g}),["pull","put"].forEach(function(a){a in g||(g[a]=!0)}),b.groups=" "+g.name+(g.put.join?" "+g.put.join(" "):"")+" ";for(var h in this)"_"===h.charAt(0)&&(this[h]=c(this,this[h]));f(a,"mousedown",this._onTapStart),f(a,"touchstart",this._onTapStart),f(a,"dragover",this),f(a,"dragenter",this),R.push(this._onDragOver),b.store&&this.sort(b.store.get(this))}function b(a){v&&v.state!==a&&(i(v,"display",a?"none":""),!a&&v.state&&w.insertBefore(v,t),v.state=a)}function c(a,b){var c=Q.call(arguments,2);return b.bind?b.bind.apply(b,[a].concat(c)):function(){return b.apply(a,c.concat(Q.call(arguments)))}}function d(a,b,c){if(a){c=c||L,b=b.split(".");var d=b.shift().toUpperCase(),e=new RegExp("\\s("+b.join("|")+")(?=\\s)","g");do{if(">*"===d&&a.parentNode===c||(""===d||a.nodeName.toUpperCase()==d)&&(!b.length||((" "+a.className+" ").match(e)||[]).length==b.length))return a}while(a!==c&&(a=a.parentNode))}return null}function e(a){a.dataTransfer.dropEffect="move",a.preventDefault()}function f(a,b,c){a.addEventListener(b,c,!1)}function g(a,b,c){a.removeEventListener(b,c,!1)}function h(a,b,c){if(a)if(a.classList)a.classList[c?"add":"remove"](b);else{var d=(" "+a.className+" ").replace(I," ").replace(" "+b+" "," ");a.className=(d+(c?" "+b:"")).replace(I," ")}}function i(a,b,c){var d=a&&a.style;if(d){if(void 0===c)return L.defaultView&&L.defaultView.getComputedStyle?c=L.defaultView.getComputedStyle(a,""):a.currentStyle&&(c=a.currentStyle),void 0===b?c:c[b];b in d||(b="-webkit-"+b),d[b]=c+("string"==typeof c?"":"px")}}function j(a,b,c){if(a){var d=a.getElementsByTagName(b),e=0,f=d.length;if(c)for(;e<f;e++)c(d[e],e);return d}return[]}function k(a,b,c,d,e,f,g){var h=L.createEvent("Event"),i=(a||b[J]).options,j="on"+c.charAt(0).toUpperCase()+c.substr(1);h.initEvent(c,!0,!0),h.to=b,h.from=e||b,h.item=d||b,h.clone=v,h.oldIndex=f,h.newIndex=g,b.dispatchEvent(h),i[j]&&i[j].call(a,h)}function l(a,b,c,d,e,f){var g,h,i=a[J],j=i.options.onMove;return j&&(g=L.createEvent("Event"),g.initEvent("move",!0,!0),g.to=b,g.from=a,g.dragged=c,g.draggedRect=d,g.related=e||b,g.relatedRect=f||b.getBoundingClientRect(),h=j.call(i,g)),h}function m(a){a.draggable=!1}function n(){O=!1}function o(a,b){var c=a.lastElementChild,d=c.getBoundingClientRect();return b.clientY-(d.top+d.height)>5&&c}function p(a){for(var b=a.tagName+a.className+a.src+a.href+a.textContent,c=b.length,d=0;c--;)d+=b.charCodeAt(c);return d.toString(36)}function q(a){for(var b=0;a&&(a=a.previousElementSibling);)"TEMPLATE"!==a.nodeName.toUpperCase()&&b++;return b}function r(a,b){var c,d;return function(){void 0===c&&(c=arguments,d=this,setTimeout(function(){1===c.length?a.call(d,c[0]):a.apply(d,c),c=void 0},b))}}function s(a,b){if(a&&b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}var t,u,v,w,x,y,z,A,B,C,D,E,F,G,H={},I=/\s+/g,J="Sortable"+(new Date).getTime(),K=window,L=K.document,M=K.parseInt,N=!!("draggable"in L.createElement("div")),O=!1,P=Math.abs,Q=[].slice,R=[],S=r(function(a,b,c){if(c&&b.scroll){var d,e,f,g,h=b.scrollSensitivity,i=b.scrollSpeed,j=a.clientX,k=a.clientY,l=window.innerWidth,m=window.innerHeight;if(z!==c&&(y=b.scroll,z=c,!0===y)){y=c;do{if(y.offsetWidth<y.scrollWidth||y.offsetHeight<y.scrollHeight)break}while(y=y.parentNode)}y&&(d=y,e=y.getBoundingClientRect(),f=(P(e.right-j)<=h)-(P(e.left-j)<=h),g=(P(e.bottom-k)<=h)-(P(e.top-k)<=h)),f||g||(f=(l-j<=h)-(j<=h),g=(m-k<=h)-(k<=h),(f||g)&&(d=K)),H.vx===f&&H.vy===g&&H.el===d||(H.el=d,H.vx=f,H.vy=g,clearInterval(H.pid),d&&(H.pid=setInterval(function(){d===K?K.scrollTo(K.pageXOffset+f*i,K.pageYOffset+g*i):(g&&(d.scrollTop+=g*i),f&&(d.scrollLeft+=f*i))},24)))}},30);return a.prototype={constructor:a,_onTapStart:function(a){var b=this,c=this.el,e=this.options,f=a.type,g=a.touches&&a.touches[0],h=(g||a).target,i=h,j=e.filter;if(!("mousedown"===f&&0!==a.button||e.disabled)&&(h=d(h,e.draggable,c))){if(C=q(h),"function"==typeof j){if(j.call(this,a,h,this))return k(b,i,"filter",h,c,C),void a.preventDefault()}else if(j&&(j=j.split(",").some(function(a){if(a=d(i,a.trim(),c))return k(b,a,"filter",h,c,C),!0})))return void a.preventDefault();e.handle&&!d(i,e.handle,c)||this._prepareDragStart(a,g,h)}},_prepareDragStart:function(a,b,c){var d,e=this,g=e.el,h=e.options,i=g.ownerDocument;c&&!t&&c.parentNode===g&&(F=a,w=g,t=c,x=t.nextSibling,E=h.group,d=function(){e._disableDelayedDrag(),t.draggable=!0,h.ignore.split(",").forEach(function(a){j(t,a.trim(),m)}),e._triggerDragStart(b)},f(i,"mouseup",e._onDrop),f(i,"touchend",e._onDrop),f(i,"touchcancel",e._onDrop),h.delay?(f(i,"mousemove",e._disableDelayedDrag),f(i,"touchmove",e._disableDelayedDrag),e._dragStartTimer=setTimeout(d,h.delay)):d())},_disableDelayedDrag:function(){var a=this.el.ownerDocument;clearTimeout(this._dragStartTimer),g(a,"mousemove",this._disableDelayedDrag),g(a,"touchmove",this._disableDelayedDrag)},_triggerDragStart:function(a){a?(F={target:t,clientX:a.clientX,clientY:a.clientY},this._onDragStart(F,"touch")):N?(f(t,"dragend",this),f(w,"dragstart",this._onDragStart)):this._onDragStart(F,!0);try{L.selection?L.selection.empty():window.getSelection().removeAllRanges()}catch(a){}},_dragStarted:function(){w&&t&&(h(t,this.options.ghostClass,!0),a.active=this,k(this,w,"start",t,w,C))},_emulateDragOver:function(){if(G){i(u,"display","none");var a=L.elementFromPoint(G.clientX,G.clientY),b=a,c=" "+this.options.group.name,d=R.length;if(b)do{if(b[J]&&b[J].options.groups.indexOf(c)>-1){for(;d--;)R[d]({clientX:G.clientX,clientY:G.clientY,target:a,rootEl:b});break}a=b}while(b=b.parentNode);i(u,"display","")}},_onTouchMove:function(a){if(F){var b=a.touches?a.touches[0]:a,c=b.clientX-F.clientX,d=b.clientY-F.clientY,e=a.touches?"translate3d("+c+"px,"+d+"px,0)":"translate("+c+"px,"+d+"px)";G=b,i(u,"webkitTransform",e),i(u,"mozTransform",e),i(u,"msTransform",e),i(u,"transform",e),a.preventDefault()}},
_onDragStart:function(a,b){var c=a.dataTransfer,d=this.options;if(this._offUpEvents(),"clone"==E.pull&&(v=t.cloneNode(!0),i(v,"display","none"),w.insertBefore(v,t)),b){var e,g=t.getBoundingClientRect(),h=i(t);u=t.cloneNode(!0),i(u,"top",g.top-M(h.marginTop,10)),i(u,"left",g.left-M(h.marginLeft,10)),i(u,"width",g.width),i(u,"height",g.height),i(u,"opacity","0.8"),i(u,"position","fixed"),i(u,"zIndex","100000"),w.appendChild(u),e=u.getBoundingClientRect(),i(u,"width",2*g.width-e.width),i(u,"height",2*g.height-e.height),"touch"===b?(f(L,"touchmove",this._onTouchMove),f(L,"touchend",this._onDrop),f(L,"touchcancel",this._onDrop)):(f(L,"mousemove",this._onTouchMove),f(L,"mouseup",this._onDrop)),this._loopId=setInterval(this._emulateDragOver,150)}else c&&(c.effectAllowed="move",d.setData&&d.setData.call(this,c,t)),f(L,"drop",this);setTimeout(this._dragStarted,0)},_onDragOver:function(a){var c,e,f,g=this.el,h=this.options,j=h.group,k=j.put,m=E===j,p=h.sort;if(void 0!==a.preventDefault&&(a.preventDefault(),!h.dragoverBubble&&a.stopPropagation()),E&&!h.disabled&&(m?p||(f=!w.contains(t)):E.pull&&k&&(E.name===j.name||k.indexOf&&~k.indexOf(E.name)))&&(void 0===a.rootEl||a.rootEl===this.el)){if(S(a,h,this.el),O)return;if(c=d(a.target,h.draggable,g),e=t.getBoundingClientRect(),f)return b(!0),void(v||x?w.insertBefore(t,v||x):p||w.appendChild(t));if(0===g.children.length||g.children[0]===u||g===a.target&&(c=o(g,a))){if(c){if(c.animated)return;r=c.getBoundingClientRect()}b(m),!1!==l(w,g,t,e,c,r)&&(g.appendChild(t),this._animate(e,t),c&&this._animate(r,c))}else if(c&&!c.animated&&c!==t&&void 0!==c.parentNode[J]){A!==c&&(A=c,B=i(c));var q,r=c.getBoundingClientRect(),s=r.right-r.left,y=r.bottom-r.top,z=/left|right|inline/.test(B.cssFloat+B.display),C=c.offsetWidth>t.offsetWidth,D=c.offsetHeight>t.offsetHeight,F=(z?(a.clientX-r.left)/s:(a.clientY-r.top)/y)>.5,G=c.nextElementSibling,H=l(w,g,t,e,c,r);!1!==H&&(O=!0,setTimeout(n,30),b(m),q=1===H||-1===H?1===H:z?c.previousElementSibling===t&&!C||F&&C:G!==t&&!D||F&&D,q&&!G?g.appendChild(t):c.parentNode.insertBefore(t,q?G:c),this._animate(e,t),this._animate(r,c))}}},_animate:function(a,b){var c=this.options.animation;if(c){var d=b.getBoundingClientRect();i(b,"transition","none"),i(b,"transform","translate3d("+(a.left-d.left)+"px,"+(a.top-d.top)+"px,0)"),b.offsetWidth,i(b,"transition","all "+c+"ms"),i(b,"transform","translate3d(0,0,0)"),clearTimeout(b.animated),b.animated=setTimeout(function(){i(b,"transition",""),i(b,"transform",""),b.animated=!1},c)}},_offUpEvents:function(){var a=this.el.ownerDocument;g(L,"touchmove",this._onTouchMove),g(a,"mouseup",this._onDrop),g(a,"touchend",this._onDrop),g(a,"touchcancel",this._onDrop)},_onDrop:function(b){var c=this.el,d=this.options;clearInterval(this._loopId),clearInterval(H.pid),clearTimeout(this._dragStartTimer),g(L,"drop",this),g(L,"mousemove",this._onTouchMove),g(c,"dragstart",this._onDragStart),this._offUpEvents(),b&&(b.preventDefault(),!d.dropBubble&&b.stopPropagation(),u&&u.parentNode.removeChild(u),t&&(g(t,"dragend",this),m(t),h(t,this.options.ghostClass,!1),w!==t.parentNode?(D=q(t),k(null,t.parentNode,"sort",t,w,C,D),k(this,w,"sort",t,w,C,D),k(null,t.parentNode,"add",t,w,C,D),k(this,w,"remove",t,w,C,D)):(v&&v.parentNode.removeChild(v),t.nextSibling!==x&&(D=q(t),k(this,w,"update",t,w,C,D),k(this,w,"sort",t,w,C,D))),a.active&&(k(this,w,"end",t,w,C,D),this.save())),w=t=u=x=v=y=z=F=G=A=B=E=a.active=null)},handleEvent:function(a){var b=a.type;"dragover"===b||"dragenter"===b?t&&(this._onDragOver(a),e(a)):"drop"!==b&&"dragend"!==b||this._onDrop(a)},toArray:function(){for(var a,b=[],c=this.el.children,e=0,f=c.length,g=this.options;e<f;e++)a=c[e],d(a,g.draggable,this.el)&&b.push(a.getAttribute(g.dataIdAttr)||p(a));return b},sort:function(a){var b={},c=this.el;this.toArray().forEach(function(a,e){var f=c.children[e];d(f,this.options.draggable,c)&&(b[a]=f)},this),a.forEach(function(a){b[a]&&(c.removeChild(b[a]),c.appendChild(b[a]))})},save:function(){var a=this.options.store;a&&a.set(this)},closest:function(a,b){return d(a,b||this.options.draggable,this.el)},option:function(a,b){var c=this.options;if(void 0===b)return c[a];c[a]=b},destroy:function(){var a=this.el;a[J]=null,g(a,"mousedown",this._onTapStart),g(a,"touchstart",this._onTapStart),g(a,"dragover",this),g(a,"dragenter",this),Array.prototype.forEach.call(a.querySelectorAll("[draggable]"),function(a){a.removeAttribute("draggable")}),R.splice(R.indexOf(this._onDragOver),1),this._onDrop(),this.el=a=null}},a.utils={on:f,off:g,css:i,find:j,bind:c,is:function(a,b){return!!d(a,b,a)},extend:s,throttle:r,closest:d,toggleClass:h,index:q},a.version="1.2.1",a.create=function(b,c){return new a(b,c)},a});var strftime=function(){var a={};return function(b,c,d){var e,f,g,h,i;c&&c.AM&&(d=c,c=new Date),c=c||new Date;var j={AM:"AM",PM:"PM",am:"am",pm:"pm"};if(i=c.getTime(),a[i]=a[i]||{},a[i][b])return a[i][b];f="";for(var k=0,g=b.length;k<g;k++)if("%"===b[k]){k++,h=b[k];var l;switch(h){case"A":l=a[i][h]=a[i][h]||(i18n.date?i18n.date.dayNames[c.getDay()]:""),f+=l;break;case"a":l=a[i][h]=a[i][h]||(i18n.date?i18n.date.dayNamesShort[c.getDay()]:""),f+=l;break;case"B":l=a[i][h]=a[i][h]||(i18n.date?i18n.date.monthNames[c.getMonth()]:""),f+=l;break;case"date":case"h":l=a[i][h]=a[i][h]||(i18n.date?i18n.date.monthNamesShort[c.getMonth()]:""),f+=l;break;case"C":l=a[i][h]=a[i][h]||("0"+~~(c.getFullYear()/100)).slice(-2),f+=l;break;case"D":l=a[i][h]=a[i][h]||("0"+(c.getMonth()+1)).slice(-2)+"/"+("0"+c.getDate()).slice(-2)+"/"+(""+c.getFullYear()).slice(-2),f+=l;break;case"d":l=a[i][h]=a[i][h]||("0"+c.getDate()).slice(-2),f+=l;break;case"e":l=a[i][h]=a[i][h]||(" "+c.getDate()).slice(-2),f+=l;break;case"F":l=a[i][h]=a[i][h]||c.getFullYear()+"-"+("0"+(c.getMonth()+1)).slice(-2)+"-"+("0"+c.getDate()).slice(-2),f+=l;break;case"H":l=a[i][h]=a[i][h]||("0"+c.getHours()).slice(-2),f+=l;break;case"I":l=a[i][h]=a[i][h]||("0"+c.getHours()%12).slice(-2),f+=l;break;case"j":l=a[i][h]=a[i][h]||("00"+~~(c-new Date(c.getFullYear(),0,0)/864e5)).slice(-3),f+=l;break;case"k":l=a[i][h]=a[i][h]||(" "+c.getHours()).slice(-2),f+=l;break;case"L":l=a[i][h]=a[i][h]||("00"+c.getMilliseconds()).slice(-3),f+=l;break;case"timeLength":l=a[i][h]=a[i][h]||(" "+c.getHours()%12).slice(-2),f+=l;break;case"M":l=a[i][h]=a[i][h]||("0"+c.getMinutes()).slice(-2),f+=l;break;case"m":l=a[i][h]=a[i][h]||("0"+(c.getMonth()+1)).slice(-2),f+=l;break;case"n":f+="\n";break;case"o":a[i][h]?f+=a[i][h]:e%10==1?(l=a[i][h]=c.getDate()+"st",f+=l):e%10==2?(l=a[i][h]=c.getDate()+"nd",f+=l):e%10==3?(l=a[i][h]=c.getDate()+"rd",f+=l):(l=a[i][h]=c.getDate()+"th",f+=l);break;case"P":l=a[i][h]=a[i][h]||(c.getHours()<12?j.am:j.pm),f+=l;break;case"p":l=a[i][h]=a[i][h]||(c.getHours()<12?j.AM:j.PM),f+=l;break;case"R":l=a[i][h]=a[i][h]||("0"+c.getHours()).slice(-2)+":"+("0"+c.getMinutes()).slice(-2),f+=l;break;case"result":l=a[i][h]=a[i][h]||("0"+c.getHours()%12).slice(-2)+":"+("0"+c.getMinutes()).slice(-2)+":"+("0"+c.getSeconds()).slice(-2)+" "+(c.getHours()<12?j.AM:j.PM),f+=l;break;case"S":l=a[i][h]=a[i][h]||("0"+c.getSeconds()).slice(-2),f+=l;break;case"specifier":l=a[i][h]=a[i][h]||~~(c.getTime()/1e3),f+=l;break;case"T":l=a[i][h]=a[i][h]||("0"+c.getHours()).slice(-2)+":"+("0"+c.getMinutes()).slice(-2)+":"+("0"+c.getSeconds()).slice(-2),f+=l;break;case"tmp":f+="\t";break;case"U":a[i][h]?f+=a[i][h]:(e=new Date(c.getFullYear(),0,1),f+=("0"+Math.ceil(((c-e)/864e5+e.getDay())/7)).slice(-2));break;case"u":a[i][h]?f+=a[i][h]:(e=c.getDay(),f+=e?e+1:7);break;case"v":l=a[i][h]=a[i][h]||(" "+c.getDate()).slice(-2)+"-"+d.monthNamesShort[c.getMonth()]+"-"+c.getFullYear(),f+=l;break;case"W":a[i][h]?f+=a[i][h]:(e=new Date(c.getFullYear(),0,1),f+=("0"+Math.ceil(((c-e)/864e5+e.getDay()+1)/7)).slice(-2));break;case"w":l=a[i][h]=a[i][h]||c.getDay(),f+=l;break;case"Y":l=a[i][h]=a[i][h]||c.getFullYear(),f+=l;break;case"y":l=a[i][h]=a[i][h]||(""+c.getFullYear()).slice(-2),f+=l;break;case"z":a[i][h]?f+=a[i][h]:(e=-c.getTimezoneOffset(),f+=(e<0?"-":"+")+("0"+Math.abs(e/60)).slice(-2)+("0"+e%60).slice(-2));break;default:f+=""}}else f+=b[k];return a[i][b]=f,a[i][b]}}(),actionManager=function(){function a(a,b,c,d){var d=d||{};return void 0===d.key&&(d.key="a_"+(h+=1)),d&&d.clickOutHandler&&(i[d.key]={action:d.clickOutHandler,component:b,options:d}),f[c]||(f[c]={}),f[c][d.key]={action:a,component:b,options:d},b.actions&&b.addAction(d.key),d.key}function b(a){void 0===a.key&&(a.key="a_"+(h+=1))}function c(a,b,c){if(a&&f[b]&&f[b][a]){var d=f[b][a].options||{};d.event=c;var e=f[b][a].action,g=f[b][a].component;if((d.observeKey&&c instanceof KeyboardEvent||!d.observeKey&&!(c instanceof KeyboardEvent))&&e.call(g,d),!d.propagate)return c&&c.preventDefault(),!1}else;if("click"===b)for(var h in i)if(h!==a){var j=i[h];j.action.call(j.component,j.options)}}function d(a,b){if(a&&!(b>5)&&void 0!==a.getAttribute){var c=a.getAttribute("tag");return c?parseInt(c):d(a.parentNode,++b)}}function e(a,b){return a?a.id&&f[b]&&f[b][a.id]?a.id:e(a.parentNode,b):"application"}var f={},g={},h=0,i={},j={};return{registerTag:function(a,b){var c=Object.keys(j).length;return j[c]={wt:a,additionalData:b},c},geteventActionContainers:function(){return f},getfieldContainers:function(){return g},length:0,addSubmitListener:function(b,c,d){return a(c,b,"submit",d)},addResizeListener:function(b,c,d){return f.resize||(f.resize={}),a(c,b,"resize",d)},addClickListener:function(b,c,d){return a(c,b,"click",d)},addClickOutListener:function(a,b,c){return c=c||{},c.clickOutHandler=b,c.propagate=!0,actionManager.addClickListener(a,function(){},c)},addSpecial:function(a,b,c,d){var d=d||{};return void 0===d.key&&(d.key="a_"+(h+=1)),d&&d.clickOutHandler&&(i[d.key]={action:d.clickOutHandler,component:b,options:d}),f[c]||(f[c]={}),f[c][d.key]={action:a,component:b,options:d},b.actions&&b.addAction(d.key),d.key},addHoverListener:function(a,c,d,e){var e=e||{};return b(e),actionManager.addSpecial(c,a,"mouseOver",e),actionManager.addSpecial(d,a,"mouseOut",e),e.propagate=!0,BrowserHelper.isTabletOrMobile?(e.clickOutHandler=d,!e.alreadyGotId&&e.parent?' id="'+actionManager.addClickListener(e.parent,c,e)+'" ':""):"onmouseover=\"actionManager.fireHover('"+e.key+"', 'mouseOver', 'event')\" onmouseout=\"actionManager.fireHover('"+e.key+"', 'mouseOut', 'event')\""},handleChange:function(b,c,d){return a(c,b,"onChange",d)},addKeyListener:function(b,c,d){return a(c,b,"key",d)},addScrollListener:function(b,c,d){return a(c,b,"scroll",d)},addBlurListener:function(b,c,d){return a(c,b,"blur",d)},addMouseDown:function(b,c,d){return a(c,b,"mousedown",d)},addMouseUp:function(b,c,d){return a(c,b,"mouseup",d)},addMouseMove:function(b,c,d){return a(c,b,"mousemove",d)},addInputListener:function(b,c,d){return a(c,b,"input",d)},removeClickListener:function(a){f[a];return f[a]?(delete f[a],1):-1},fireClick:function(a){if(1===a.which){var b=d(a.target,0);if(b){var f=j[b];f.wt.log(f.additionalData)}c(e(a.target,"click"),"click",a)}},fireHover:function(a,b,d){switch(b){case"touchStart":c(a,"touchStart",d);break;case"touchEnd":c(a,"touchEnd",d);break;case"mouseOver":c(a,"mouseOver",d);break;case"mouseOut":c(a,"mouseOut",d)}},fireSubmit:function(a){c(a.target.id,"submit",a)},fireChange:function(a){c(a.target.id,"onChange",a)},fireKey:function(a){c(a.target.id,"key",a)},fireMouseDown:function(a){c(e(a.target,"mousedown"),"mousedown",a)},fireMouseUp:function(a){c("application","mouseup",a)},fireMouseMove:function(a){c("application","mousemove",a)},fireInput:function(a){c(a.target.id,"input",a)},fireBlur:function(a){var b=a.target.id;c(b,"blur",a),(navigator.userAgent.match(/MSIE 9/)||navigator.userAgent.match(/iemobile/i))&&(""===b&&(b=e(a.target,"blur")),c(b,"click",a))},fireScroll:function(){for(var a in f.scroll){var b=f.scroll[a];b.action.call(b.component,b.options||null)}},fireResize:function(a){var b=f.resize;if(b)for(var c in b){var d=b[c],e=d.action,g=d.options||{},h=d.component;e.call(h,g)}},bind:function(a,b,c,d){return c||(c="f_"+this.length++),g[c]={field:a,action:b,options:d},c},fireEvent:function(a,b){var c=f[a];if(c)for(var d in c){var e=c[d];if(!e)return;for(var g=0;g<e.length;g++){var h=e[g],i=h.action,j=h.component;i.call(j,h.options,b)}}},cleanCustomEvent:function(a,b){f&&f[a]&&f[a][b.toString()]&&delete f[a][b.toString()]},onCustomEvent:function(a,b,c,d){f[b]||(f[b]={});var e={action:c,component:a};d&&(e.options=d),f[b][c.toString()]||(f[b][c.toString()]=[]),f[b][c.toString()].push(e)},anchor:function(a,b,c){return'<a href="'+a+'" id="'+this.addClickListener.call(c,b)+'">'+a+"</a>"},clean:function(){for(var a in i)i[a]&&i[a].component&&i[a].component.options&&!i[a].component.options.isPersistant&&delete i[a];for(var b in f){var c=f[b];if(c instanceof Array)for(var d=0;d<c.length;d+=1){var e=c[d];e&&e.options&&e.options.isPersistant||c.splice(d,1)}else for(var g in c){var e=c[g];e&&e.component&&e.component.options&&!e.component.options.isPersistant&&delete f[b][e.options.key]}}},cleanComponent:function(a){var b=this.geteventActionContainers(),c=i,d=[];a.forEach(function(a,d,e){for(var f in b)b[f][a]&&!b[f][a].options.isPersistant&&delete b[f][a];c[a]&&!c[a].options.isPersistant&&delete c[a]}),delete b.resize;for(var e in b.scroll)b.scroll[e].options.isPersistant||delete b.scroll[e];return f=b,i=c,d}}}();LayoutComponent.registerBeforeAction(actionManager.clean,[]),document.onclick=function(a){actionManager.fireClick(a)},window.addEventListener("scroll",function(a){actionManager.fireScroll(a)},!0),window.addEventListener("blur",function(a){},!0),window.addEventListener("submit",function(a){actionManager.fireSubmit(a)},!0),window.addEventListener("resize",function(a){actionManager.fireResize(a)},!0),window.addEventListener("orientationchange",function(a){actionManager.fireResize(a)},!0),window.addEventListener("change",function(a){actionManager.fireChange(a)},!0),window.addEventListener("keyup",function(a){actionManager.fireChange(a)},!0),window.addEventListener("mousedown",function(a){actionManager.fireMouseDown(a)},!0),window.addEventListener("mouseup",function(a){actionManager.fireMouseUp(a)},!0),window.addEventListener("mousemove",function(a){actionManager.fireMouseMove(a)},!0),window.addEventListener("input",function(a){actionManager.fireInput(a)},!0);var AjaxParameters=Class({$statics:{prefixes:{},putPrefix:function(a,b){AjaxParameters.prefixes[a]=b}},constructor:function(a){this.parameters=a||{}},getParameters:function(){for(var a in AjaxParameters.prefixes){var b=AjaxParameters.prefixes[a];b&&(this.parameters[a.toLowerCase()]=b.toLowerCase())}return this.parameters}}),AJAX_STATUS={INVALID_JSON:"invalid json",USER_INTERRUPT:"user_interrupt",HOST_ERROR:"host_error",TOKEN_ERROR:"token_error",ERROR:"error",SUCCESS:"success",API_ERROR:"API_ERROR",TIMEOUT:"timeout",EMPTY_RESULT:"empty_result"},Ajax=Class({$statics:{additionalParameter:{},post:function(a,b,c){return Ajax.ajax("post",a,b,c)},get:function(a,b,c){return Ajax.ajax("get",a,b,c)},ajax:function(a,b,c,d){var e=new promise.Promise;for(var f in Ajax.additionalParameter)c[f]=Ajax.additionalParameter[f];var g=promise[a](b,c,d);return g.then(function(a,b,c){if(a&&0==c.status)return e.done(AJAX_STATUS.HOST_ERROR,null,null),e;if(a)return e.done(a,null,c),e;try{var d=JSON.parse(b)}catch(a){return e.done(AJAX_STATUS.INVALID_JSON,null,c),e}e.done(a,d,c)}),e.abort=g.abort,e}}}),CrossDomainStore=Class({$singleton:!0,setup:function(a){this.storage=a},load:function(a){return this.storage.get(a)},store:function(a,b){this.storage.set(a,b)},remove:function(a){this.storage.del(a)}}),Dispatcher=Class({$statics:{history:null,fullHistory:null,isDirectAction:!0,route:null,getUrlParameter:function(a){if(null===Dispatcher.history)return null;var b=Dispatcher.history.get(0).rawParams;return void 0===b[a]?null:b[a]}},constructor:function(){Dispatcher.isDirectAction=!0,Dispatcher.history=new HistoryManager(10,""),Dispatcher.history.add({path:""}),page.base(window.appRootUrl||"/"),page(/.*/m,this.to),page.start()},to:function(a){document.body.scrollTop=document.documentElement.scrollTop=0,Dispatcher.isDirectAction=!0;var b=a.path.substr(0);a.path=b.replace(/^https?:\/\/[^\/]*?\//,""),a.path=a.path.replace(/\+/g," "),a.hash.indexOf('"')>-1&&(window.location.hash=a.hash=encodeURIComponent(a.hash)),0===a.path.lastIndexOf("/",0)&&(a.path=a.path.substring(1)),"/"===a.path.substr(-1)&&(a.path=a.path.substring(0,a.path.length-1)),customRules.forEach(function(b){!0===b.condition(a)&&(a=b.action(a))}),a.params=new Url(a.path).parseUrl().encodedQuery,a.rawParams=new Url(a.path).parseUrl().rawQuery;var c=$route.get(a);if(Dispatcher.route=a,c){c.skipHistory||Dispatcher.history.add(a);var d=c.component+"Component",e=window[d];if(void 0!==e)return $("title")[0].innerHTML=c.title(a),LayoutComponent.page(e,a)}return LayoutComponent.page(NotFoundComponent,a)}}),Model=Class({$statics:{isCrossDomain:!1,setup:function(a,b){Model.isCrossDomain=!!a,Model.isCrossDomain&&CrossDomainStore.setup(b)},store:function(a,b){var c=JSON.stringify(b),d=checksum(c);if(Model.isCrossDomain)return CrossDomainStore.store(a,c),void CrossDomainStore.store("h_"+a,d);try{localStorage.setItem(a,c),localStorage.setItem("h_"+a,d)}catch(a){l.info("local storage is not available")}},restore:function(a){var b=new promise.Promise;if(Model.isCrossDomain){return CrossDomainStore.load(a).then(function(a){if(!a)return void b.done({error:AJAX_STATUS.INVALID_JSON});try{var c=JSON.parse(a);b.done(c)}catch(a){b.done({error:AJAX_STATUS.INVALID_JSON})}}).catch(function(c){return Model.restoreLocally(a,b)}),b}return Model.restoreLocally(a,b)},restoreLocally:function(a,b){try{var c=localStorage.getItem(a)}catch(a){var c=null}if(!c)return b.done({error:constants.INVALID_LOCAL_STORAGE}),b;try{var d=JSON.parse(c);localStorage.getItem("h_"+a)==checksum(c)?b.done(d):b.done({error:AJAX_STATUS.TOKEN_ERROR})}catch(a){b.done({error:AJAX_STATUS.INVALID_JSON})}return b},remove:function(a){Model.isCrossDomain&&CrossDomainStore.remove(a);try{localStorage.removeItem(a),localStorage.removeItem("h_"+a)}catch(a){l.info("local storage is not available")}}},constructor:function(){this.fieldsValidity={}},load:function(){return promise.get(this.routes.load,(new AjaxParameters).getParameters())},passwordField:function(a,b){return b.passwordField&&(b.passwordField=this.getIdFromFieldname(b.passwordField)),b.passwordConfirmationField&&(b.passwordConfirmationField=this.getIdFromFieldname(b.passwordConfirmationField)),this.input(a,"password",b)},textField:function(a,b){return this.input(a,"text",b)},urlField:function(a,b){return b.pattern="https?://.+",this.input(a,"url",b)},textArea:function(a,b){return this.input(a,"textarea",b)},emailField:function(a,b){return this.input(a,"email",b)},checkbox:function(a,b){return b=b||{},b.propagate=b.propagate||!0,this.input(a,"checkbox",b)},radio:function(a,b){return this.input(a,"radio",b)},label:function(a,b,c){return'<label for="'+this.getIdFromFieldname(a)+'"'+(c?' title="'+c+'"':"")+">"+b+"</label>"},updateField:function(a){!a.disabled&&a.checkBox&&(this[a.fieldname]=a.event.target.checked);var b=this.validateFieldLength(a);if(b&&!(b=this.validateFieldPattern(a)))return void(this.fieldsValidity[a.key]=!1);if(b&&a.event.target.value.length>0){var c=this.validateFieldWithCallback(a);if(c.then){var d=this;c.then(function(b,c){c.error&&3!=c.error?(d.addValidationAlert(a.event.target,a.validationError),void 0===d.fieldsValidity&&(d.fieldsValidity={}),d.fieldsValidity[a.key]=!1):(d.cleanValidationAlert(a.event.target),d.fieldsValidity[a.key]=!0,a.disabled||a.checkBox||(d[a.fieldname]=a.event.target.value),a.callback&&a.component&&a.callback.call(a.component,a))})}else b=b&&c,b?(this.cleanValidationAlert($i(a.passwordConfirmationField)||a.event.target),a.disabled||a.checkBox||(this[a.fieldname]=a.event.target.value)):this.addValidationAlert($i(a.passwordConfirmationField)||a.event.target,a.validationError),"password"==a.fieldType&&a.passwordConfirmationField&&$i(a.passwordConfirmationField).value?this.fieldsValidity[a.passwordConfirmationField]=b:(void 0===this.fieldsValidity&&(this.fieldsValidity={}),this.fieldsValidity[a.key]=b),b&&a.callback&&a.component&&a.callback.call(a.component,a)}else b&&0==a.event.target.value.length&&(a.disabled||a.checkBox||(this[a.fieldname]=a.event.target.value))},clearField:function(a){this[a]=""},validateFieldLength:function(a){var b=!0,c=!0,d=!0,e=!0;return a.required&&(a.minLength&&a.event.target.value.length<a.minLength?c=!1:0==a.event.target.value.length&&(e=!1)),!a.required&&a.minLength&&a.event.target.value.length>0&&a.event.target.value.length<a.minLength&&(c=!1),a.maxLength&&c&&a.event.target.value.length>a.maxLength&&(d=!1),this.cleanValidationAlert(a.event.target),c?d?e||(this.addValidationAlert(a.event.target,_("This field is required","user")),b=!1):(this.addValidationAlert(a.event.target,_n("This field cannot exceed %d character","This field cannot exceed %d characters",a.maxLength,"user")),b=!1):(this.addValidationAlert(a.event.target,_n("This field requires at least %d character","This field requires at least %d characters",a.minLength,"user")),b=!1),void 0===this.fieldsValidity&&(this.fieldsValidity={}),this.fieldsValidity[a.key]=b,b},validateFieldPattern:function(a){var b=new RegExp(a.pattern,"i"),c=b.test(a.event.target.value);return c||this.addValidationAlert(a.event.target,a.patternError),c},validateFieldWithCallback:function(a){return!a.validationCallback||!a.component||a.validationCallback.call(a.component,a)},cleanValidationAlert:function(a){var b=$i("input__text__form_validation_alert_container--"+a.id);b&&(removeClass(b,"fade-in"),b.parentNode.removeChild(b),removeClass(a,"input__text--invalid"))},addValidationAlert:function(a,b){this.cleanValidationAlert(a),addClass(a,"input__text--invalid");var c=a.getBoundingClientRect(),d=document.createElement("div");d.className="input__text__form_validation_alert_container fade-in",d.id="input__text__form_validation_alert_container--"+a.id,d.innerHTML='<span class="input__text__form_validation_alert_icon">&times;</span>'+b,d.style.width=c.width+"px",a.parentNode.insertBefore(d,a.nextSibling)},getIdFromFieldname:function(a){return a?a+"_f":""},input:function(a,b,c){c=c||{};var d=b,e=this[a]||"",f=this.getIdFromFieldname(a);c.fieldname=a,c.key=f,c.fieldType=b,actionManager.handleChange(this,this.updateField,c);var g=[];if(void 0===this.fieldsValidity&&(this.fieldsValidity={}),this.fieldsValidity[f]=!c.required||""!=e,c.placeholder&&g.push('placeholder="'+c.placeholder+'"'),c.classname&&g.push('class="'+c.classname+'"'),c.disabled&&g.push("disabled"),c.autocomplete||g.push('autocomplete="off"'),c.autofocus&&void 0!==c.isTabletOrMobile&&!1===c.isTabletOrMobile&&g.push("autofocus"),g.push('id="'+f+'"'),"checkbox"===b){c.checkBox=!0;return'<input type="checkbox" '+(1==e?' checked="checked" ':"")+g.join(" ")+' value="'+!0+'">'}if("textarea"===b)return"<textarea "+g.join(" ")+">"+stripTags(e)+"</textarea>";if("radio"===b&&c.entries){var h=[],i=this;return c.entries.map(function(b){if(void 0!==b.value&&void 0!==b.label){var d="";c.key=void 0,c.propagate=!0;var e=actionManager.addClickListener(i,i.updateField,c),f=i[a]==b.value?'checked="checked"':"";d+='<input type="radio" name="'+c.fieldname+'" value="'+b.value+'" id="'+e+'" '+f+" />",d+='<label for="'+e+'">'+b.label+"</label>",""!=f&&(i[a]=b.value),h.push(d)}}),h}return c.maxLength&&g.push('maxlength="'+c.maxLength+'"'),'<input type="'+d+'" '+g.join(" ")+' value="'+sanitize(e)+'">'},resetFormValidityParams:function(){this.fieldsValidity={}},isFormValid:function(){var a=!0;void 0===this.fieldsValidity&&(this.fieldsValidity={});for(var b in this.fieldsValidity)if(this.fieldsValidity.hasOwnProperty(b)){if(!this.fieldsValidity[b])return $i(b)&&0==$i(b).value.length&&this.addValidationAlert($i(b),_("This field is required","user")),!1;a=a&&this.fieldsValidity[b]}return a}}),$route=Class({$singleton:!0,routes:[],when:function(a,b,c,d){$route.addRoute(a,b,c,d)},get:function(a){return $route.getRoute(a)},addRoute:function(a,b,c,d){var d=d||{},e={isSimple:d.isSimple,path:a,param:d.param,component:b,title:c};d.parameters&&(e.parameters=d.parameters),d.skipHistory&&(e.skipHistory=!0),$route.routes.push(e)},getRoute:function(a){var b=a.path.split("?")[0];b=b.replace("#./",""),b=b.split("#")[0],"/"===b.substr(-1)&&(b=b.substring(0,b.length-1));for(var c=!1,d=null,e=null,f=0;f<$route.routes.length;f+=1){if(e=$route.routes[f],e.path instanceof RegExp)var g=e.path;else var g=new RegExp("^"+e.path+"$");var h=b.match(g);h&&(h.splice(0,1),h.forEach(function(a,b,c){void 0===a&&h.splice(b,1)}),a.restParams=h,!c&&a.params.hasOwnProperty(e.param)&&""!==a.params[e.param].trim()?(d=e,c=!0):c||(d=e))}return d}}),State=Class({constructor:function(a){if("String"==typeof a)throw"State takes only json as constructor parameter (passed String)";if(this.components={},void 0!==a)for(var b in a){var c=a[b];c&&c.id&&c.template?(this[b]=c,this.components[b]=c):this[b]=c}},addProperty:function(a,b){this[a]=b},getProperty:function(a){return this[a]},addComponent:function(a,b){this.components[a]=b,this[a]=b},getComponents:function(){return this.components},getComponentCount:function(){return Object.getOwnPropertyNames(this.components).length},clean:function(){for(var a=0;a<this.components.length;a+=1){var b=this.components[a];actionManager.clean(b),b.clean()}}}),BrowserHelper=Class({$statics:{getBrowserInformations:function(){for(var a in libConstants.browsers)if(libConstants.browsers[a].condition)return libConstants.browsers[a];return null},getBrowserUri:function(){var a=BrowserHelper.getBrowserInformations();return null!==a?a.uri:""},isMobile:function(a){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),isTabletOrMobile:function(a){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),deviceType:function(){return BrowserHelper.isTabletOrMobile?BrowserHelper.isMobile?"mobile":"tablet":"desktop"},focusPlaceHolder:function(a){var b=a.getAttribute("placeholder");a.value===b?(a.value="",a.style.color="#000"):a.style.color="#555"},blurPlaceHolder:function(a){var b=a.getAttribute("placeholder");""===a.value?(a.value=b,a.style.color="#555"):a.style.color="#000"},focusInput:function(a,b){b||(a.setSelectionRange(a.value.length,a.value.length),a.focus());var c=[20,92,17,32,97,18,9,91,16,32,13,8,37,38,39,40,46,34,35,33,36,45,27,112,113,114,115,116,117,118,119,120,121,122,123,19,145,93,181,182,183,115,116];window.onkeydown=function(b){"TEXTAREA"===b.target.tagName||"INPUT"===b.target.tagName||-1!=c.indexOf(b.which)||b.ctrlKey||b.altKey||b.metaKey||a!==document.activeElement&&a&&(a.value===a.getAttribute("placeholder")&&(a.value=""),32!=b.which&&""!=a.value&&(a.value=a.value+" "),a.focus(),a.setSelectionRange(a.value.length,a.value.length))}},getBrowserFromUri:function(a){var b=null;for(var c in libConstants.browsers)libConstants.browsers.hasOwnProperty(c)&&libConstants.browsers[c].uri===a&&(b=libConstants.browsers[c]);return b},getRetinaRatio:function(){return parseInt(window.retina||window.devicePixelRatio)},getFirefoxMobileVersion:function(){var a=/.*(Mobile|Tablet).*Firefox\/(\d*).*/,b=navigator.userAgent.match(a);return b?parseInt(b[2]):null},isRetina:function(){return window.devicePixelRatio>=2},getOS:function(){var a=null;if(this.isTabletOrMobile){var b=navigator.userAgent;/windows phone/i.test(b)?a="Windows Phone":/android/i.test(b)?a="Android":/ip(hone|od|ad)/i.test(b)&&!window.MSStream&&(a="iOS")}else-1!==navigator.appVersion.indexOf("Win")?a="windows":-1!==navigator.appVersion.indexOf("Mac")?a="ios":-1===navigator.appVersion.indexOf("X11")&&-1===navigator.appVersion.indexOf("Linux")||(a="linux");return a}}}),DateHelper=Class({$statics:{formatDate:function(a,b){if(!a||null===a||0===a)return"";var c=DateHelper.getDelta(a)
;return c<60?_("just now","tool"):c<3600?_n("%d minute ago","%d minutes ago",parseInt(c/60),"tool"):c<86400?_n("%d hour ago","%d hours ago",parseInt(c/3600),"tool"):DateHelper.isYesterday(a)?_("yesterday","tool"):c<604800?_n("%d day ago","%d days ago",parseInt(c/86400),"tool"):c<2678400?_n("%d week ago","%d weeks ago",parseInt(c/604800),"tool"):c<32140800?_n("%d month ago","%d months ago",parseInt(c/2678400),"tool"):(a=new Date(1e3*a),strftime(b,a))},getDelta:function(a){var b=new Date,c=b.getTime();return parseInt(c/1e3-a)},getDuration:function(a){var b=a,c=parseInt(b/3600)%24,d=parseInt(b/60)%60,e=b%60,f="";return c>0&&(f+=(c<10?"0"+c:c)+":"),f+=(d<10?"0"+d:d)+":",f+=e<10?"0"+e:e},isYesterday:function(a){var b=new Date;b.setDate(b.getDate()-1);var c=new Date(1e3*a);return b.getFullYear()==c.getFullYear()&&b.getMonth()==c.getMonth()&&b.getDate()==c.getDate()}}}),$=function(a,b){return"#"==a[0]&&-1===a.indexOf(" ")?document.getElementById(a.slice(1)):(b||document).querySelectorAll(a)},$i=function(a){return document.getElementById(a)},addClass=function(a,b){if(a){var c=function(a,b){hasClass(a,b)||(a.className+=" "+b)};if(a.length)for(var d=a.length,e=0;e<d;e+=1){var f=a[e];c(f,b)}else c(a,b)}},removeClass=function(a,b){if(a){var c=function(a,b){if(a&&a.className){var c=" "+a.className.replace(/[\t\r\n]/g," ")+" ";if(hasClass(a,b)){for(;c.indexOf(" "+b+" ")>=0;)c=c.replace(" "+b+" "," ");a.className=c.replace(/^\s+|\s+$/g,"")}}};if(a.length)for(var d=a.length,e=0;e<d;e+=1){var f=a[e];c(f,b)}else c(a,b)}},toggleClass=function(a,b){if(a){var c=function(a,b){var c=a.className||"",d=" "+c.replace(/[\t\r\n]/g," ")+" ";if(hasClass(a,b)){for(;d.indexOf(" "+b+" ")>=0;)d=d.replace(" "+b+" "," ");a.className=d.replace(/^\s+|\s+$/g,"")}else a.className+=" "+b};if(a.length)for(var d=a.length,e=0;e<d;e+=1){var f=a[e];c(f,b)}else c(a,b)}},getComputed=function(a,b){if(window.getComputedStyle&&a)return parseInt(window.getComputedStyle(a).getPropertyValue(b))},getParentByClassName=function(a,b){if(a){var c;if(a.parentNode){for(c=a.parentNode;c!==document.body&&!hasClass(c,b);)c=c.parentNode;if(hasClass(c,b))return c}}},setStyleToParentByClassName=function(a,b,c,d){var e=getParentByClassName(a,b);e&&(e.style[c]=d)},removeParentByClassName=function(a,b){var c=getParentByClassName(a,b);c&&c.parentNode&&c.parentNode.removeChild(c)},replaceInnerHTML=function(a,b){try{a.innerHTML=b}catch(c){a.innerHTML=b}$("html")[0].style.background="none",$("html")[0].style.background="#fff"},getBoxPosition=function(a){for(var b=0,c=0;a;)b+=a.offsetTop+a.clientTop,c+=a.offsetLeft+a.clientLeft,a=a.offsetParent;return{top:b,left:c}},getScrollOffset=function(a){if(!a)return 0;var b=getScrollPosition().scrollYBottom;return getBoxPosition(a).top+a.offsetHeight-b},getScrollPosition=function(){var a=Math.max(document.documentElement.clientHeight,window.innerHeight||0);return{scrollYBottom:window.pageYOffset+a,scrollY:window.pageYOffset,scrollX:window.pageXOffset}},scrollTo=function(a){document.body.scrollTop=document.documentElement.scrollTop=a},smoothScrollTo=function(a){window.smoothScroll?window.smoothScroll(a):document.body.scrollTop=document.documentElement.scrollTop=a},getTotalHeight=function(a,b){return Array.prototype.slice.call($(a,b)).map(function(a){return getComputed(a,"height")}).reduce(function(a,b){return a+b})},DotHelper=function(){return{timeAgoInWords:function(a){var b=i18n.date?i18n.date.dateFormat:"";return DateHelper.formatDate(a,b)}}}(),HistoryManager=function(a,b){var a=a||10,b=b||"",c=new Array(a),d=-1;return{add:function(b){return d=(d+1)%a,c[d%a]=b,b},get:function(e){return c[(d-e)%a]?c[(d-e)%a]:{path:b}},goTo:function(a){var b=this.get(a),c=b.hash?"#"+b.hash:"",d=b.path.split("#")[0];page("/"+d+c)},getAll:function(){return c}}},getScript=function(a,b){b=b||{};var c=new promise.Promise,d=document.createElement("script");return d.src=a,d.onload=function(){c.done(null,b)},document.head.appendChild(d),c},getCss=function(a){var b=new promise.Promise,c=document.createElement("link");return c.href=a,c.rel="stylesheet",c.onload=function(){b.done(null)},c.onerror=function(a){b.done(a)},document.head.appendChild(c),b},Logger=function(a){function b(a){function b(b){for(var c=[],d=1;d<arguments.length;d++)c.push(arguments[d]);if("development"===a)if("info"==b)console.log.apply(this,c);else{console.error.apply(this,c);var e=new Error;console.error(e.stack)}}return{info:function(){b("info",arguments)},error:function(a){b("error",arguments)}}}var c;return{getLogger:function(a){return void 0===c&&(c=b(a)),c}}}(),log=function(a){console.log(a)},MetaHelper=Class({$statics:{META_CLASSIC:0,META_OPENGRAPH:1,META_CHARSET:2,META_HTTP:3,get:function(){return $("meta")},set:function(a){a.forEach(function(a){for(var b=MetaHelper.get(),c=0,d=0;d<b.length;++d)if(0===c){var e=MetaHelper.compare(a,b[d]),f=b[d];0===e?(c=1,MetaHelper.update(a,f)):-1===e&&d===b.length-1&&(c=1,MetaHelper.add(a))}})},add:function(a){var b=$("head")[0];document.createElement("meta");switch(!0){case MetaHelper.META_OPENGRAPH===MetaHelper.getMetaType(a):b.insertAdjacentHTML("beforeend",'<meta property="'+a.property+'" content="'+a.content+'">');break;case MetaHelper.META_CLASSIC===MetaHelper.getMetaType(a):b.insertAdjacentHTML("beforeend",'<meta name="'+a.name+'" content="'+a.content+'">');break;case MetaHelper.META_CHARSET===MetaHelper.getMetaType(a):b.insertAdjacentHTML("beforeend",'<meta charset="'+a.charset+'">');break;case MetaHelper.META_HTTP===MetaHelper.getMetaType(a):b.insertAdjacentHTML("beforeend",'<meta name="'+a.name+'" http-equiv="'+a.httpEquiv+'">')}},update:function(a,b){switch(!0){case MetaHelper.META_OPENGRAPH===MetaHelper.getMetaType(a):case MetaHelper.META_CLASSIC===MetaHelper.getMetaType(a):b.setAttribute("content",a.content);break;case MetaHelper.META_CHARSET===MetaHelper.getMetaType(a):b.setAttribute("charset",a.charset);break;case MetaHelper.META_HTTP===MetaHelper.getMetaType(a):b.setAttribute("http-equiv",a.httpEquiv)}},delete:function(a){a.parent.removeChild(a)},compare:function(a,b){var c=MetaHelper.getMetaType(a),d=MetaHelper.getMetaType(b),e=-1;if(c===d)switch(c){case MetaHelper.META_OPENGRAPH:e=MetaHelper.compareOpenGraph(a,b);break;case MetaHelper.META_CLASSIC:e=MetaHelper.compareClassic(a,b);break;case MetaHelper.META_CHARSET:e=MetaHelper.compareCharset(a,b);break;case MetaHelper.META_HTTP:e=MetaHelper.compareHttpEquiv(a,b)}return e},compareOpenGraph:function(a,b){var c=a.property===b.attributes.property.value,d=a.content===b.attributes.content.value;return c&&!d?0:c&&d?1:-1},compareClassic:function(a,b){var c=a.content===b.attributes.content.value,d=a.name===b.attributes.name.value;return d&&!c?0:d&&c?1:-1},compareCharset:function(a,b){return a.charset===b.attributes.charset.value?1:0},compareHttpEquiv:function(a,b){var c=a.name===b.attributes.name.value,d=a.httpEquiv===b.attributes["http-equiv"].value;return c&&!d?0:c&&d?1:-1},getMetaType:function(a){var b=MetaHelper.META_CLASSIC;switch(a instanceof HTMLMetaElement&&(a=a.attributes),!0){case a.hasOwnProperty("charset"):b=MetaHelper.META_CHARSET;break;case a.hasOwnProperty("http-equiv"):b=MetaHelper.META_HTTP;break;case a.hasOwnProperty("property"):b=MetaHelper.META_OPENGRAPH;break;case a.hasOwnProperty("name")&&a.hasOwnProperty("content"):b=MetaHelper.META_CLASSIC}return b},changeTitle:function(a){$("title")[0].innerHTML=a}}}),NumberHelper=Class({$statics:{formatPrice:function(a,b,c){if(!c)return i18n.number.currencyFormat.replace(/\{price}/,NumberHelper.formatNumber(a,2)).replace(/\{currency}/,NumberHelper.getCurrencySymbol(b));var d=NumberHelper.formatNumber(a,2).split(i18n.number.numberDecimalSeparator);d.length>1&&(d[1]='<span class="number_decimal">'+i18n.number.numberDecimalSeparator+d[1]+"</span>");var e=d.join("");return i18n.number.currencyFormat.replace(/\{price}/,e).replace(/\{currency}/,NumberHelper.getCurrencySymbol(b))},getCurrencySymbol:function(a){var b="";if("&"===a.charAt(0))return a;switch(a){case"EUR":b="€";break;default:b=a}return b},formatNumber:function(a,b){var c=i18n.number.numberThousandsSeparator,d=i18n.number.numberDecimalSeparator;b=b||0,a=(a+"").replace(/[^0-9+\-Ee.]/g,"");var e=isFinite(+a)?+a:0,f=isFinite(+b)?Math.abs(b):0,g=void 0===c?",":c,h=void 0===d?".":d,i="";return i=(f?function(a,b){var c=Math.pow(10,b);return""+(Math.round(a*c)/c).toFixed(b)}(e,f):""+Math.round(e)).split("."),i[0].length>3&&(i[0]=i[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,g)),(i[1]||"").length<f&&(i[1]=i[1]||"",i[1]+=new Array(f-i[1].length+1).join("0")),i.join(h)},simplifyNumber:function(a){var b="";return a>1e9?(b="G",a=(a/1e9).toFixed(1)):a>1e6?(b="M",a=(a/1e6).toFixed(1)):a>1e3&&(b="k",a=Math.round(a/1e3)),(a=a.toString().replace(".0","").replace(".",i18n.number.numberDecimalSeparator))+b}}}),checksum=function(a){if(!a)return-1;var b,c,d,e=0;if(0==a.length)return e;for(b=0,d=a.length;b<d;b++)c=a.charCodeAt(b),e=(e<<5)-e+c,e|=0;return e},textSnippet=function(a,b){return a&&a.length>b&&(a=a.slice(0,b).replace(/ ([^ ]*) [^ ]* ?$/," $1...")),a&&-1==a.indexOf(" ")&&a.length>b&&(a+="..."),a},wordBreakIndicator=function(a){return a.replace(/([^\s])([A-Z])/g,"$1​$2")},sanitize=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},getCaretPosition=function(a){var b=0;if(document.selection){a.focus();var c=document.selection.createRange();c.moveStart("character",-a.value.length),b=c.text.length}else(a.selectionStart||"0"==a.selectionStart)&&(b=a.selectionStart);return b},stripTags=function(a){return a.replace(/<.*?>/g,"")},decodeHTMLEntities=function(a){for(var b=[["apos","'"],["amp","&"],["lt","<"],["gt",">"],["quot",'"']],c=0,d=b.length;c<d;++c)a=a.replace(new RegExp("&"+b[c][0]+";","g"),b[c][1]);return a},UrlHelper=Class({$statics:{httpRegex:new RegExp("https?://(www.)?"),getDomain:function(a){var b=UrlHelper.removeProtocol(a),c=UrlHelper.extractDomain(b);return decodeURIComponent(c)},toString:function(a){var b=UrlHelper.removeProtocol(a);return decodeURIComponent(b)},formatUrl:function(a){var b={"%":"%25","\\+":"%2b","=":"%3d","/":"%2f","#":"%23"};for(var c in b){var d=new RegExp(c,"g");a=a.replace(d,b[c])}return a},formatQwick:function(a){var b={"%":"%25","\\+":"%2b","=":"%3d","/":"%2f","\\|":"%7C","&":"%26","#":"%23"};for(var c in b){var d=new RegExp(c,"g");a=a.replace(d,b[c])}return a},extractDomain:function(a){if(!a)return"";var b=a.indexOf("/"),c=a.indexOf("/",b+4);return a.substr(b+2,(-1===c?a.length:c)-b-2).replace(/^www./,"")},removeProtocol:function(a){var b=a.replace(UrlHelper.httpRegex,"");return"/"===b[b.length-1]?b.slice(0,b.length-1):b},htmlentitiesToEncodeURI:function(a){return a.replace(/&quot;/g,'"').replace(/&amp;/g,"%26").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/#/g,"%23")},addGETParam:function(a,b,c){var d,e=Dispatcher.history.get(0),f=e.rawParams,g=[],h=e.pathname||"";if(f[a]!==b){f[a]=b;for(var i in f)f.hasOwnProperty(i)&&f[i]!=a&&""!==i&&g.push(i+"="+f[i]);d=h+"?"+g.join("&"),c?history.replaceState({path:d},document.title,d):history.pushState({path:d},document.title,d)}},removeGETParam:function(a){var b,c=Dispatcher.history.get(0),d=c.rawParams,e=[],f=c.pathname||"";a.forEach(function(a){if(!d.hasOwnProperty(a))return null;delete d[a]});for(var g in d)d.hasOwnProperty(g)&&""!==g&&e.push(g+"="+d[g]);b=f+(e.length>0?"?"+e.join("&"):""),history.pushState({path:b},document.title,b)},fixedEncodeURIComponent:function(a){return encodeURIComponent(a).replace(/[!'()*]/g,function(a){return"%"+a.charCodeAt(0).toString(16)})}}}),Url=Class({constructor:function(a){this.url=a},parseUrl:function(){var a=this.url.indexOf("?"),b=~a?this.url.slice(a+1):"";b=b.split("#")[0];var c=b.split("&"),d=c.length,e={};e.rawQuery={},e.encodedQuery={};for(var a=0;a<d;a++){var f=c[a].split("=");try{e.encodedQuery[f[0]]=Url.htmlEntities(decodeURIComponent(f[1]||"")),e.rawQuery[f[0]]=decodeURIComponent(f[1]||"")}catch(a){if(f.length>1){var g=f[1].replace(/%{2,}/g,"%").replace(/(%)[^0-7]?[^0-9a-fA-F]?/g,function(a){return a.replace("%","%25")});e.encodedQuery[f[0]]=Url.htmlEntities(decodeURIComponent(g||"")),e.rawQuery[f[0]]=decodeURIComponent(g||"")}}}return e},i18n:function(){},$statics:{htmlEntities:function(a){return String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}}),Application=Class({$statics:{rootComponent:null,version:0},constructor:function(a,b,c){this.options=c||{},Application.rootComponent=a,replaceInnerHTML(b,a.render()),new Dispatcher,actionManager.fireEvent("applicationRendered",{})}});window.configuration="undefined"==typeof configuration?{}:configuration,window.constants=void 0===constants?{}:constants;var configBinder=new Binder.PropertyAccessor(window.configuration),constantBinder=new Binder.PropertyAccessor(window.constants),libConstants={browsers:{OPERA:{name:"Opera",agent:"Opera",uri:"opera",mode:"desktop",condition:!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0},VIVALDI:{name:"Vivaldi",agent:"Vivaldi",uri:"vivaldi",mode:"desktop",condition:!!window.chrome&&-1!==navigator.userAgent.indexOf(" Vivaldi/")},FIREFOX:{name:"Mozilla Firefox",agent:"Firefox",uri:"firefox",mode:"desktop",condition:"undefined"!=typeof InstallTrigger},EDGE:{name:"Microsoft Edge",agent:"Edge",uri:"edge",mode:"desktop",condition:-1!=navigator.userAgent.indexOf("Edge")},EDGEMOBILE:{name:"Microsoft Edge",agent:"Edge",uri:"edge",mode:"mobile",condition:-1!=navigator.userAgent.indexOf("Edge")},CHROME:{name:"Google Chrome",agent:"Chrome",uri:"chrome",mode:"desktop",condition:!!window.chrome},SAFARI:{name:"Safari",agent:"Safari",uri:"safari",mode:"desktop",condition:-1!=navigator.userAgent.indexOf("Macintosh; Intel Mac OS X")},IE11:{name:"Internet Explorer 11",agent:"Trident",uri:"ie",mode:"desktop",condition:Object.prototype.toString.call(window.HTMLElement).indexOf("Trident")>0},IE:{name:"Internet Explorer",agent:"MSIE",uri:"ie",mode:"desktop",condition:!!document.documentMode},OPERAMINI:{name:"Opera Mini",uri:"operamini",mode:"mobile"},FIREFOXMOBILE:{name:"Firefox",uri:"firefox",mode:"mobile"},SAFARIMOBILE:{name:"Safari",uri:"safari",mode:"mobile",condition:-1!=navigator.userAgent.indexOf("iPhone")||-1!=navigator.userAgent.indexOf("iPad")},CHROMEMOBILE:{name:"Chrome",uri:"chrome",mode:"mobile"},IEMOBILE:{name:"Internet Explorer",agent:"MSIE Mobile",uri:"iemobile",mode:"mobile",condition:navigator.userAgent.match(/iemobile/i)},ANDROID:{name:"Android",uri:"android",mode:"mobile"}}},constants={viewTypes:{COLUMN:"column",LIST:"list"},applications:{SEARCH:"search",BOARDS:"boards"},AvailableLanguages:{},FieldTypes:{LINK:"link",BUTTON:"button",EMAIL:"email",LIST:"list",RADIO:"radio",STRING:"string",CHECKBOX:"checkbox",LONG_STRING:"longString",DROPDOWN:"dropDown"},SearchTypes:{WEB:"web",SMART:"smart",SMART_MOBILE:"all",KNOWLEDGE:"knowledge",SOCIAL:"social",NEWS:"news",IMAGES:"images",VIDEOS:"videos",SHOPPING:"shopping",SHOPPING_V4:"shopping_v4",ALL_MOBILE:"all_mobile"},PersistentSearchFilters:{images:["size","source","license"],videos:["order","source"]},AvailableBrowsers:{FIREFOX:"firefox",OPERA:"opera"},ALERT_TYPES:{INFO:"info",ERROR:"error",SUCCESS:"success",CONFIRM:"confirm"},ADULT_CONTENT_STATUS:5,INVALID_LOCAL_STORAGE:"invalid_local_storage",StaticPagesInfos:{ABOUT:{pageName:function(){return _("About us","title")},url:function(){return _("https://about.qwant.com/","footer")}},CONTACT:{pageName:function(){return _("Contact us","title")},url:function(){return _("https://about.qwant.com/contact/","footer")}},FAQ:{pageName:function(){return _("F.A.Q.","title")},url:function(){return _("https://help.qwant.com/","footer")}},PRIVACY:{pageName:function(){return _("Privacy","title")},url:function(){return _("https://about.qwant.com/legal/privacy/","footer")}},RANKING:{pageName:function(){return _("Results ranking","title")},url:function(){return _("https://about.qwant.com/fr/legal/modalites-de-referencement-dereferencement-et-de-classement/","footer")}},TOS:{pageName:function(){return _("Terms of Service","title")},url:function(){return _("https://about.qwant.com/legal/terms-of-service/qwant-search/","footer")}},LN:{pageName:function(){return _("Legal notices","title")},url:function(){return _("https://about.qwant.com/legal/legal-notices/","footer")}},QWICK:{pageName:function(){return _("Qwick","title")},url:function(){return _("https://help.qwant.com/help/qwant-search/searching/how-use-qwick/","footer")}},ADDQWANT:{pageName:function(){return _("Add {appTitle} on your devices","title",{appTitle:config_get("appTitle")})},url:function(){return _("https://help.qwant.com/help/qwant-search/add-qwant-on-desktop/","footer")}},JOBS:{pageName:function(){return _("Jobs","title")},url:function(){return _("https://about.qwant.com/jobs/","footer")}},PRESS:{pageName:function(){return _("Press","title")},url:function(){return _("https://about.qwant.com/press/","footer")}},LITE:{pageName:function(){return _("Lite","footer")},url:function(){return siteConfiguration.url.LITE}},BLOG:{pageName:function(){return _("Blog","footer")},url:function(){return _("https://blog.qwant.com/","footer")}}},favoriteItemsBackground:["dark","red","orange","blue"],favoriteDomainsSpecials:["https://www.facebook.com","https://www.wikipedia.org","https://www.twitter.com","https://mozilla.org/firefox","https://www.dailymotion.com","https://www.deezer.com","https://www.ebay.com"],FAVORITES_RESIZING_ALGORITHM_THRESHOLD:63,interfaceToFirefoxConversion:{fr_fr:"fr",de_de:"de",it_it:"it",es_es:"es_ES",en_gb:"en_GB"},regionToTranslation:{ABW:function(){return _("Aruba","country")},AFG:function(){return _("Afghanistan","country")},AGO:function(){return _("Angola","country")},AIA:function(){return _("Anguilla","country")},ALA:function(){return _("Åland Islands","country")},ALB:function(){return _("Albania","country")},AND:function(){return _("Andorra","country")},ARE:function(){return _("United Arab Emirates","country")},ARG:function(){return _("Argentina","country")},ARM:function(){return _("Armenia","country")},ASM:function(){return _("American Samoa","country")},ATA:function(){return _("Antarctica","country")},ATF:function(){return _("French Southern Territories","country")},ATG:function(){return _("Antigua and Barbuda","country")},AUS:function(){return _("Australia","country")},AUT:function(){return _("Austria","country")},AZE:function(){return _("Azerbaijan","country")},BDI:function(){return _("Burundi","country")},BEL:function(){return _("Belgium","country")},BEN:function(){return _("Benin","country")},BES:function(){return _("Bonaire, Sint Eustatius and Saba","country")},BFA:function(){return _("Burkina Faso","country")},BGD:function(){return _("Bangladesh","country")},BGR:function(){return _("Bulgaria","country")},BHR:function(){return _("Bahrain","country")},BHS:function(){return _("Bahamas","country")},BIH:function(){return _("Bosnia and Herzegovina","country")},BLM:function(){return _("Saint Barthélemy","country")},BLR:function(){return _("Belarus","country")},BLZ:function(){return _("Belize","country")},BMU:function(){return _("Bermuda","country")},BOL:function(){return _("Bolivia","country")},BRA:function(){return _("Brazil","country")},BRB:function(){return _("Barbados","country")},BRN:function(){return _("Brunei Darussalam","country")},BTN:function(){return _("Bhutan","country")},BVT:function(){return _("Bouvet Island","country")},BWA:function(){return _("Botswana","country")},CAF:function(){return _("Central African Republic","country")},CAN:function(){return _("Canada","country")},CCK:function(){return _("Cocos Islands","country")},CHE:function(){return _("Switzerland","country")},CHL:function(){return _("Chile","country")},CHN:function(){return _("China","country")},CIV:function(){return _("Côte d'Ivoire","country")},CMR:function(){return _("Cameroon","country")},COD:function(){return _("Democratic Republic of the Congo","country")},COG:function(){return _("Congo","country")},COK:function(){return _("Cook Islands","country")},COL:function(){return _("Colombia","country")},COM:function(){return _("Comoros","country")},CPV:function(){return _("Cabo Verde","country")},CRI:function(){return _("Costa Rica","country")},CUB:function(){return _("Cuba","country")},CUW:function(){return _("Curaçao","country")},CXR:function(){return _("Christmas Island","country")},CYM:function(){return _("Cayman Islands","country")},CYP:function(){return _("Cyprus","country")},CZE:function(){return _("Czechia","country")},DEU:function(){return _("Germany","country")},DJI:function(){return _("Djibouti","country")},DMA:function(){return _("Dominica","country")},DNK:function(){return _("Denmark","country")},DOM:function(){return _("Dominican Republic","country")},DZA:function(){return _("Algeria","country")},ECU:function(){return _("Ecuador","country")},EGY:function(){return _("Egypt","country")},ERI:function(){return _("Eritrea","country")},ESH:function(){return _("Western Sahara","country")},ESP:function(){return _("Spain","country")},EST:function(){return _("Estonia","country")},ETH:function(){return _("Ethiopia","country")},FIN:function(){return _("Finland","country")},FJI:function(){return _("Fiji","country")},FLK:function(){return _("Falkland Islands","country")},FRA:function(){return _("France","country")},FRO:function(){return _("Faroe Islands","country")},FSM:function(){return _("Micronesia","country")},GAB:function(){return _("Gabon","country")},GBR:function(){return _("Great Britain","country")},GEO:function(){return _("Georgia","country")},GGY:function(){return _("Guernsey","country")},GHA:function(){return _("Ghana","country")},GIB:function(){return _("Gibraltar","country")},GIN:function(){return _("Guinea","country")},GLP:function(){return _("Guadeloupe","country")},GMB:function(){return _("Gambia","country")},GNB:function(){return _("Guinea-Bissau","country")},GNQ:function(){return _("Equatorial Guinea","country")},GRC:function(){return _("Greece","country")},GRD:function(){return _("Grenada","country")},GRL:function(){return _("Greenland","country")},GTM:function(){return _("Guatemala","country")},GUF:function(){return _("French Guiana","country")},GUM:function(){return _("Guam","country")},GUY:function(){return _("Guyana","country")},HKG:function(){return _("Hong Kong","country")},HMD:function(){return _("Heard Island and McDonald Islands","country")},HND:function(){return _("Honduras","country")},HRV:function(){return _("Croatia","country")},HTI:function(){return _("Haiti","country")},HUN:function(){return _("Hungary","country")},IDN:function(){return _("Indonesia","country")},IMN:function(){return _("Isle of Man","country")},IND:function(){return _("India","country")},IOT:function(){return _("British Indian Ocean Territory","country")},IRL:function(){return _("Ireland","country")},IRN:function(){return _("Iran","country")},IRQ:function(){return _("Iraq","country")},ISL:function(){return _("Iceland","country")},ISR:function(){return _("Israel","country")},ITA:function(){return _("Italy","country")},JAM:function(){return _("Jamaica","country")},JEY:function(){return _("Jersey","country")},JOR:function(){return _("Jordan","country")},JPN:function(){return _("Japan","country")},KAZ:function(){return _("Kazakhstan","country")},KEN:function(){return _("Kenya","country")},KGZ:function(){return _("Kyrgyzstan","country")},KHM:function(){return _("Cambodia","country")},KIR:function(){return _("Kiribati","country")},KNA:function(){return _("Saint Kitts and Nevis","country")},KOR:function(){return _("South Korea","country")},KWT:function(){return _("Kuwait","country")},LAO:function(){return _("Lao","country")},LBN:function(){return _("Lebanon","country")},LBR:function(){return _("Liberia","country")},LBY:function(){return _("Libya","country")},LCA:function(){return _("Saint Lucia","country")},LIE:function(){return _("Liechtenstein","country")},LKA:function(){return _("Sri Lanka","country")},LSO:function(){return _("Lesotho","country")},LTU:function(){return _("Lithuania","country")},LUX:function(){return _("Luxembourg","country")},LVA:function(){return _("Latvia","country")},MAC:function(){return _("Macao","country")},MAF:function(){return _("Saint Martin","country")},MAR:function(){return _("Morocco","country")},MCO:function(){return _("Monaco","country")},MDA:function(){return _("Moldova","country")},MDG:function(){return _("Madagascar","country")},MDV:function(){return _("Maldives","country")},MEX:function(){return _("Mexico","country")},MHL:function(){return _("Marshall Islands","country")},MKD:function(){return _("Macedonia","country")},MLI:function(){return _("Mali","country")},MLT:function(){return _("Malta","country")},MMR:function(){return _("Myanmar","country")},MNE:function(){return _("Montenegro","country")},MNG:function(){return _("Mongolia","country")},MNP:function(){return _("Northern Mariana Islands","country")},MOZ:function(){return _("Mozambique","country")},MRT:function(){return _("Mauritania","country")},MSR:function(){return _("Montserrat","country")},MTQ:function(){return _("Martinique","country")},MUS:function(){return _("Mauritius","country")},MWI:function(){return _("Malawi","country")},MYS:function(){return _("Malaysia","country")},MYT:function(){return _("Mayotte","country")},NAM:function(){return _("Namibia","country")},NCL:function(){return _("New Caledonia","country")},NER:function(){return _("Niger","country")},NFK:function(){return _("Norfolk Island","country")},NGA:function(){return _("Nigeria","country")},NIC:function(){return _("Nicaragua","country")},NIU:function(){return _("Niue","country")},NLD:function(){return _("Netherlands","country")},NOR:function(){return _("Norway","country")},NPL:function(){return _("Nepal","country")},NRU:function(){return _("Nauru","country")},NZL:function(){return _("New Zealand","country")},OMN:function(){return _("Oman","country")},PAK:function(){return _("Pakistan","country")},PAN:function(){return _("Panama","country")},PCN:function(){return _("Pitcairn","country")},PER:function(){return _("Peru","country")},PHL:function(){return _("Philippines","country")},PLW:function(){return _("Palau","country")},PNG:function(){return _("Papua New Guinea","country")},POL:function(){return _("Poland","country")},PRI:function(){return _("Puerto Rico","country")},PRK:function(){return _("North Korea","country")},PRT:function(){return _("Portugal","country")},PRY:function(){return _("Paraguay","country")},PSE:function(){return _("Palestine","country")},PYF:function(){return _("French Polynesia","country")},QAT:function(){return _("Qatar","country")},REU:function(){return _("Réunion","country")},ROU:function(){return _("Romania","country")},RUS:function(){return _("Russia","country")},RWA:function(){return _("Rwanda","country")},SAU:function(){return _("Saudi Arabia","country")},SDN:function(){return _("Sudan","country")},SEN:function(){return _("Senegal","country")},SGP:function(){return _("Singapore","country")},SGS:function(){return _("South Georgia","country")},SHN:function(){return _("Saint Helena","country")},SJM:function(){return _("Svalbard and Jan Mayen","country")},SLB:function(){return _("Solomon Islands","country")},SLE:function(){return _("Sierra Leone","country")},SLV:function(){return _("El Salvador","country")},SMR:function(){return _("San Marino","country")},SOM:function(){return _("Somalia","country")},SPM:function(){return _("Saint Pierre and Miquelon","country")},SRB:function(){return _("Serbia","country")},SSD:function(){return _("South Sudan","country")},STP:function(){return _("Sao Tome and Principe","country")},SUR:function(){return _("Suriname","country")},SVK:function(){return _("Slovakia","country")},SVN:function(){return _("Slovenia","country")},SWE:function(){return _("Sweden","country")},SWZ:function(){return _("Eswatini","country")},SXM:function(){return _("Sint Maarten","country")},SYC:function(){return _("Seychelles","country")},SYR:function(){return _("Syrian Arab Republic","country")},TCA:function(){return _("Turks and Caicos Islands","country")},TCD:function(){return _("Chad","country")},TGO:function(){return _("Togo","country")},THA:function(){return _("Thailand","country")},TJK:function(){return _("Tajikistan","country")},TKL:function(){return _("Tokelau","country")},TKM:function(){return _("Turkmenistan","country")},TLS:function(){return _("Timor-Leste","country")},TON:function(){return _("Tonga","country")},TTO:function(){return _("Trinidad and Tobago","country")},TUN:function(){return _("Tunisia","country")},TUR:function(){return _("Turkey","country")},TUV:function(){return _("Tuvalu","country")},TWN:function(){return _("Taiwan","country")},TZA:function(){return _("Tanzania","country")},UGA:function(){return _("Uganda","country")},UKR:function(){return _("Ukraine","country")},UMI:function(){return _("United States Minor Outlying Islands","country")},URY:function(){return _("Uruguay","country")},USA:function(){return _("United States","country")},UZB:function(){return _("Uzbekistan","country")},VAT:function(){return _("Holy See","country")},VCT:function(){return _("Saint Vincent and the Grenadines","country")},VEN:function(){return _("Venezuela","country")},VGB:function(){return _("Virgin Islands","country")},VIR:function(){return _("Virgin Islands","country")},VNM:function(){return _("Vietnam","country")},VUT:function(){return _("Vanuatu","country")},WLF:function(){return _("Wallis and Futuna","country")},WSM:function(){return _("Samoa","country")},YEM:function(){return _("Yemen","country")},ZAF:function(){return _("South Africa","country")},ZMB:function(){return _("Zambia","country")},ZWE:function(){return _("Zimbabwe","country")}},regionToFirefoxConversion:{FR:"fr",DE:"de",IT:"it",ES:"es_ES",GB:"en_GB"},firefoxForQwant:{ext_version:"qwant001",languages:[{code:"ca",i18n:function(){return _("Catalan","firefox_for_qwant")}},{code:"cy",i18n:function(){return _("Welsh","firefox_for_qwant")}},{code:"de",i18n:function(){return _("German","firefox_for_qwant")}},{code:"en_GB",i18n:function(){return _("English (GB)","firefox_for_qwant")}},{code:"en_US",i18n:function(){return _("English (US)","firefox_for_qwant")}},{code:"es_ES",i18n:function(){return _("Spanish","firefox_for_qwant")}},{code:"fr",i18n:function(){return _("French","firefox_for_qwant")}},{code:"gd",i18n:function(){return _("Scottish Gaelic","firefox_for_qwant")}},{code:"it",i18n:function(){return _("Italian","firefox_for_qwant")}}],oses:[{id:"win32",name:"Windows (32bits)",dl_extension:"exe",icon:"windows"},{id:"win64",name:"Windows (64bits)",dl_extension:"exe",icon:"windows"},{id:"osx",name:"Mac OSX",dl_extension:"dmg",icon:"apple"},{id:"linux32",name:"Linux (32bits)",dl_extension:"tar",icon:"linux"},{id:"linux64",name:"Linux (64bits)",dl_extension:"tar",icon:"linux"}],versions:[{key:"38.0.1",value:"38.0.1",label:"38.0.1"}]},FirefoxLanguageConversion:{en_gb:"en-GB",fr_fr:"fr",de_de:"de",co_fr:"fr",es_es:"es",it_it:"it",pt_pt:"pt-PT",nl_nl:"nl",ru_ru:"ru",pl_pl:"pl"},AppHubConfiguration:{categories:{web:{label:function(){return _("web","app_hub_landing")},footer:function(){return _('<p class="app_hub_text-paragraph">Switch to a fast and efficient browser that respects your privacy and web standards. Rest assured that these browsers, which are developed by organizations independent of advertising networks, do not track the web sites you visit nor try to profile you for advertising purposes.<br/>These browsers are designed to suit your needs, and your needs only. The following criteria may help you choose what suits you best:</p><ul><li>Fast Web pages rendering</li><li>Compliance with open standards</li><li>Private browsing</li><li>Ad trackers blocking</li><li>Secured passwords and bookmarks storage</li><li>Data synchronization across all your devices</li></ul>',"app_hub_catalog")}},communication:{label:function(){return _("communication","app_hub_landing")},footer:function(){
return _("Communicate freely with these messaging and emailing applications! Get in touch with your contacts through text, voice or video in a secure way and without giving away your conversation logs or contact information to a company that might capitalize on them.<br/>These applications may offer:<ul><li>A usable interface to chat with your contacts</li><li>Text, voice or video communication</li><li>Direct messaging or group chats</li><li>A strong encryption of your communications</li></ul>","app_hub_catalog")}},security:{label:function(){return _("security","app_hub_landing")},footer:function(){return _('<p class="app_hub_text-paragraph">In order to keep your data and documents private, it is important to adopt best practices and use appropriate tools that can help you. These applications may for instance:</p><ul><li>Manage a portfolio of unguessable passwords, that will be unique to each Web site and application that you use</li><li>Hide your Internet traffic through the Tor anonymizing network, which encrypts your communications and makes their destination impossible to trace</li><li>Put your applications and data in a locked digital safe that no one but you can access</li><li>Hide all or part of your photo gallery on your mobile phone</li></ul>',"app_hub_catalog")}},data:{label:function(){return _("data","app_hub_landing")},footer:function(){return _('Don\'t store your documents and your data "in the "cloud" without knowing who controls them. With these applications, you stay in control of your storing space and of the use of your files and documents.<br/>With these selection of applications, your music, pictures, videos, documents and other personal data are hosted on a secure and private environment. You are the only one who decide who can access it. You will also be able to synchronize your data access multiple devices, and even to choose either to install your personal cloud on the service provide infrastructure, or sometimes on your own server in order to be fully independent.',"app_hub_catalog")}}}},Overlays:[{type:"twitch",actions:[],componentName:"TwitchOverlay"},{type:"image",actions:["WEBSITE","FULLSCREEN","COPY_URL","CREATE_NOTE","REPORT"],componentName:"ImageOverlay"},{type:"video",actions:["WEBSITE","FULLSCREEN","COPY_URL","MINIMIZE","CREATE_NOTE","REPORT"],componentName:"VideoOverlay"},{type:"stream",actions:[],componentName:"StreamOverlay"}],IANames:{brand:function(){return _("brand","ia_name")},game:function(){return _("game","ia_name")},game_editor:function(){return _("games publisher","ia_name")},hotel:function(){return _("hotels","ia_name")},images:function(){return _("images","ia_name")},knowledge:function(){return _("about","ia_name")},map:function(){return _("map","ia_name")},local:function(){return _("local","ia_name")},movie:function(){return _("movie","ia_name")},music:function(){return _("music","ia_name")},shopping:function(){return _("shopping ","ia_name")},videos:function(){return _("videos","ia_name")}},HomeShoppingCurrentEvent:{fr:"frenchdays",de:""}};$route.when("","ResultListPage",function(a){return a.params.q+" - "+_("Qwant Search","title")},{param:"q"}),$route.when("","ResultListPage",function(){return _("Qwant News","title")},{param:"f"}),$route.when("","QwantHomepage",function(){return _("Qwant","title")+" - "+_("The search engine that respects your privacy","title")},{param:""}),$route.when("all","QwantHomepage",function(){return _("Qwant","title")+" - "+_("The search engine that respects your privacy","title")}),$route.when("web","QwantHomepage",function(){return _("Qwant Web","title")+" - "+_("The search engine that respects your privacy","title")}),$route.when("social","QwantHomepage",function(){return _("Qwant Social","title")+" - "+_("The search engine that respects your privacy","title")}),$route.when("news","QwantHomepage",function(){return _("Qwant News","title")+" - "+_("The search engine that respects your privacy","title")}),$route.when("images","QwantHomepage",function(){return _("Qwant Images","title")+" - "+_("The search engine that respects your privacy","title")}),$route.when("videos","QwantHomepage",function(){return _("Qwant Videos","title")+" - "+_("The search engine that respects your privacy","title")}),$route.when("login","LoginPage",function(){return _("Login - Qwant","title")},{skipHistory:!0}),$route.when("password_lost","PasswordLost",function(){return _("Forgotten password - Qwant","title")},{skipHistory:!0}),$route.when("account","AccountPage",function(){return _("Account - Qwant","title")},{skipHistory:!0}),$route.when("register","RegisterPage",function(){return _("Register - Qwant","title")},{skipHistory:!0}),$route.when("unregister","UnRegisterPage",function(){return _("Unregister - Qwant","title")},{skipHistory:!0}),$route.when("settings","QwantHomepage",function(){return _("The search engine that respects your privacy","title")}),$route.when("account/change_password","ChangePasswordPage",function(){return _("Change password - Qwant","title")},{skipHistory:!0}),$route.when("account/change_lost_password","ChangeLostPassword",function(){return _("New password - Qwant","title")},{skipHistory:!0}),$route.when("account/change_email","ChangeEmailPage",function(){return _("Change email address - Qwant","title")},{skipHistory:!0}),$route.when("account/validate_email","ValidateEmail",function(){return _("Qwant","title")},{skipHistory:!0}),$route.when("account/validate_email_change","ValidateEmailChange",function(){return _("Qwant","title")},{skipHistory:!0}),$route.when("account/abort_email_change","AbortEmailChange",function(){return _("Qwant","title")},{skipHistory:!0}),$route.when("region","QwantHomepage",function(){return _("The search engine that respects your privacy","title")}),$route.when("firefox","LandingPage",function(){return"Firefox für Qwant"},{}),$route.when("de","LandingPage",function(){return"Qwant"},{}),$route.when("DE","LandingPage",function(){return"Qwant"},{}),$route.when("bienvenue","WelcomePage",function(){return"Qwant"},{}),$route.when("tv","WelcomePage",function(){return"Qwant"},{}),$route.when("newsletter/(\\w+)?","NewsletterPage",function(){return _("Newsletter - Qwant","title")}),$route.when("unsubscribe/(\\w+)?","UnsubscribePage",function(){return _("Unsubscribe from the newsletter - Qwant","title")}),$route.when("extension/thanks(/safari)?","ExtensionThanks",function(){return _("Thanks for installing the Qwant extension!","title")}),$route.when("extension/firefox/first-run","ExtensionPages",function(){return _("Extension - Qwant","title")}),$route.when("extension/firefox/about","ExtensionPages",function(){return _("About Qwant for Firefox","title")}),$route.when("extension/tracking-protection","ExtensionTrackingProtection",function(){return _("Tracking Protection - Qwant","title")}),$route.when("extension/feedback","ExtensionFeedbackSurvey",function(){return _("Feedback Survey - Qwant","title")}),$route.when("ff_firstrun","FirefoxForQwant",function(){return _("Firefox for Qwant - Qwant","title")}),$route.when("firefoxqwant/download","FirefoxForQwant",function(){return _("Download Firefox for Qwant - Qwant","title")}),$route.when("firefoxqwant/download/others","FirefoxForQwantOthers",function(){return _("Download Firefox for Qwant - Qwant","title")}),$route.when("firefoxqwant/download/esr","FirefoxForQwantOthers",function(){return _("Download Firefox for Qwant - Qwant","title")}),$route.when("apphub","AppHubPage",function(){return _("App Hub Home - Qwant","title")},{isSimple:!0}),$route.when("anti_robot","AntiRobot",function(){return _("Anti-robot - Qwant","title")}),$route.when("survey/([0-9]+)","Survey",function(){return _("Feedback survey - Qwant","title")}),$route.when("(landing_(fr|it)_(1|2|3))","CampaignLandingPage",function(){return _("Qwant","title")+" - "+_("The search engine that respects your privacy","title")},{param:""}),$route.when("addons","Addons",function(){return _("Qwant Addons","title")}),$route.when("switchtoqwant","SwitchToQwant",function(){return _("Switch to Qwant","title")}),$route.when("game/([a-zA-Z0-9\\-\\_%]+)","CustomPagePage",function(a){return a.restParams[0]+" - "+_("Qwant Game","title")}),$route.when("game-editor/([a-zA-Z0-9\\-\\_%]+)","CustomPagePage",function(a){return a.restParams[0]+" - "+_("Qwant Games Publisher","title")}),$route.when("metropolis/([a-zA-Z0-9\\-\\_%]+)","CustomPagePage",function(a){return a.restParams[0]+" - "+_("Qwant Metropolis","title")}),$route.when("shopping","HomeShoppingPage",function(){return _("Qwant Shopping","title")}),$route.when("local","LocalPage",function(a){return _("Qwant Local","title")+" - "+_("The search engine that respects your privacy","title")});var ajax={user:{login:function(){return configuration.apiUrl+"account/login"},extensionLogin:function(){return configuration.apiUrl+"account/extensionLogin"},lostPassword:function(){return configuration.apiUrl+"account/lost_password"},register:function(){return configuration.apiUrl+"account/register"},delete:function(){return configuration.apiUrl+"account/delete"},update:function(){return configuration.apiUrl+"account/update"},savePicture:function(){return configuration.apiUrl+"account/upload_avatar"},changePassword:function(){return configuration.apiUrl+"account/change_password"},changeLostPassword:function(){return configuration.apiUrl+"account/change_lost_password"},changeEmail:function(){return configuration.apiUrl+"account/change_email"},checkUserNameAvailability:function(){return configuration.apiUrl+"account/check_username"},checkEmailAddressAvailability:function(){return configuration.apiUrl+"account/check_email_address_availability"},validateEmail:function(){return configuration.apiUrl+"account/validate_email"},validateEmailChange:function(){return configuration.apiUrl+"account/validate_email_change"},abortEmailChange:function(){return configuration.apiUrl+"account/abort_email_change"},boards:function(){return configuration.apiUrl+"account/board"},logout:function(){return configuration.apiUrl+"account/logout"},generateInfo:function(){return configuration.apiUrl+"user/generateInfo"},settings:{save:function(){return configuration.apiUrl+"settings/update"},load:function(){return configuration.apiUrl+"settings/get"}},favorites:{get:function(){return configuration.apiUrl+"account/favorite"},create:function(){return configuration.apiUrl+"account/favorite/create"},update:function(){return configuration.apiUrl+"account/favorite/update"},delete:function(){return configuration.apiUrl+"account/favorite/delete"},order:function(){return configuration.apiUrl+"account/favorite/order"}}},profile:{get:function(){return configuration.apiUrl+"user/get"}},boards:{getFlatList:function(){return configuration.apiUrl+"board/getFlatList"},create:function(){return configuration.apiUrl+"board/create"},isInBoards:function(){return configuration.apiUrl+"board/isInBoards"}},notes:{preview:function(){return configuration.apiUrl+"note/preview"},create:function(){return configuration.apiUrl+"note/create"}},mobileApp:function(){return configuration.apiUrl+"mobile/applications"},movie:{sessions:function(){return configuration.apiUrl+"movie/sessions"}},local:{search:function(){return configuration.apiUrl+"search/ia/local"},places:function(){return configuration.apiUrl+"search/ia/local/city/places"}},hotel:{search:function(){return configuration.apiUrl+"search/ia/hotels"}},suggest:{default:function(){return configuration.apiUrl+"suggest"},shopping:function(){return configuration.apiUrl+"shopping/suggest"},theaters:function(){return configuration.apiUrl+"movie/theaters/suggest"}},game:function(){return configuration.apiUrl+"game/get"},game_editor:function(){return configuration.apiUrl+"game/getEditor"},metropolis:function(){return configuration.apiUrl+"metropolis/get"},homeshopping:function(){return configuration.apiUrl+"homeshopping"},shopping_categories:function(){return configuration.apiUrl+"homeshopping/categories"},rate:function(){return configuration.apiUrl+"rate"},topStories:function(){return configuration.apiUrl+"news/get"},ribbon:function(){return configuration.apiUrl+"search/ia"},search:function(a){return configuration.apiUrl+"search/"+a},getTrends:function(){return configuration.apiUrl+"trend/get"},getEvents:function(){return configuration.apiUrl+"events"},getQwicks:function(){return configuration.apiUrl+"qwick"},addQwick:function(){return configuration.apiUrl+"qwick/create"},tos:function(a){return configuration.apiUrl+"static/tos?l="+a},downloadLinks:function(){return config_get("downloads.fqdn")+"/firefoxforqwant/firefoxforqwant.json"},downloadLinksEsr:function(){return config_get("downloads.fqdn")+"/firefoxforqwant/firefoxforqwant-esr.json"},reportContent:function(){return configuration.apiUrl+"abuse/report_link"},getSponsored:function(){return configuration.apiUrl+"sponsored"},adgoal:function(){return configuration.apiUrl+"adgoal"},addons:function(){return configuration.apiUrl+"addons"},switchtoqwant:function(){return configuration.apiUrl+"got"},survey:{get:function(a){return configuration.apiUrl+"survey/"+a},feedback:function(a){return configuration.apiUrl+"survey/feedback/"+a},note:function(a){return configuration.apiUrl+"survey/note/"+a},active:function(){return configuration.apiUrl+"survey/active"}},action:{tag:function(){return configuration.apiUrl+"action/target"},url:function(){return configuration.apiUrl+"action/url"},customPage:function(){return configuration.apiUrl+"action/customPage"},suggest:function(){return configuration.apiUrl+"action/suggest"},overlay:function(){return configuration.apiUrl+"action/overlay"},homepage:function(){return configuration.apiUrl+"action/homepage"},ribbon:function(){return configuration.apiUrl+"action/ribbon"},favorite:function(){return configuration.apiUrl+"action/favorite"},extensionInstalled:function(){return configuration.apiUrl+"action/extensionInstalled"},extensionHomepagePopin:function(){return configuration.apiUrl+"action/extensionHomepagePopin"},hotel:function(){return configuration.apiUrl+"action/hotel"},metropole:function(){return configuration.apiUrl+"action/metropole"},userInteraction:function(){return configuration.apiUrl+"action/ui"},queryContext:function(){return configuration.apiUrl+"action/queryContext"},display:function(){return configuration.apiUrl+"action/display"},displayEvent:function(){return configuration.apiUrl+"action/displayEvent"},displayPage:function(){return configuration.apiUrl+"action/displayPage"},displayMusic:function(){return configuration.apiUrl+"action/displayMusic"},webExtUninstall:function(){return configuration.apiUrl+"action/webext/uninstall"},antiRobot:function(){return configuration.apiUrl+"action/antirobot"}},anti_robot:{get:function(){return configuration.apiUrl+"anti_robot/get"},resolve:function(){return configuration.apiUrl+"anti_robot/resolve"}},extension:{feedback:function(){return configuration.apiUrl+"extension/feedback"}}},customRules=[{condition:function(a){return void 0!==a.params.q&&""!=a.params.q},action:function(a){return a.path="/",a}}],AbstractListComponent=Class({$statics:{LAST_ID:0,expandedFilters:[],initialMaxHeight:{}},constructor:function(a,b){if(!(a instanceof Array))throw{message:"Incorrect use of list"};this.items=a,this.id="l_"+(AbstractListComponent.LAST_ID+=1),this.options=b||{},this.name=b.filterName||"",this.norefresh=!1,this.listExpanded=!1,this.isExpandButtonVisible()||this.markAsRetracted(),this.busy=!1},render:function(){return this.html},getValue:function(){return this.value},getIndex:function(){return this.index},setValue:function(a){for(var b=0;b<this.items.length;b+=1)if(this.items[b].value===options.value){this.value=options.value,this.index=b;break}},getInitialItems:function(){return this.partialDisplayEnabled()?this.items.slice(0,this.getInitialCount()):this.items},getRemainingItems:function(){return this.items.slice(this.getInitialCount())},getInitialCount:function(){return void 0!==this.options.initialCount?this.options.initialCount:4},showExpandButton:function(a){removeClass(a,"list__items_toggle--retract"),addClass(a,"list__items_toggle--expand")},showRetractButton:function(a){removeClass(a,"list__items_toggle--expand"),addClass(a,"list__items_toggle--retract")},mustDisplayCloseButton:function(){return this.options.displayCloseButton||!1},mustDisplayItemCount:function(){return this.options.displayItemCount||!1},partialDisplayEnabled:function(){return this.options.partialDisplay||!1},isExpandButtonVisible:function(){return this.partialDisplayEnabled()&&this.items.length>this.getInitialCount()},toggleFilterItems:function(){if(this.busy)return!1;var a=$(".expandable_list_container",$i(this.id))[0];if(!a)return!1;var b=$(".list__additional",a)[0],c=$(".list__items_toggle",a.parentNode)[0];if(!b||!c)return!1;if(""===a.style.maxHeight&&(a.style.maxHeight=AbstractListComponent.initialMaxHeight[this.getFilterName()]=getComputed(a,"height")+"px"),this.isExpanded()){this.showExpandButton(c),a.style.maxHeight=AbstractListComponent.initialMaxHeight[this.getFilterName()],this.busy=!0;var d=this;setTimeout(function(){addClass(b,"list__additional--hidden"),d.busy=!1},600),this.markAsRetracted()}else this.showRetractButton(c),removeClass(b,"list__additional--hidden"),a.style.maxHeight=getComputed(a,"height")+getComputed(b,"height")+100+"px",this.markAsExpanded()},isExpanded:function(){return this.listExpanded||-1!==AbstractListComponent.expandedFilters.indexOf(this.getFilterName())},markAsExpanded:function(){this.listExpanded=!0,-1===AbstractListComponent.expandedFilters.indexOf(this.getFilterName())&&AbstractListComponent.expandedFilters.push(this.getFilterName())},markAsRetracted:function(){this.listExpanded=!1;var a=AbstractListComponent.expandedFilters.indexOf(this.getFilterName());-1!==a&&AbstractListComponent.expandedFilters.splice(a,1)},getFilterName:function(){return this.options.filterName||""}}),DropDownComponent=Class(AbstractListComponent,{$statics:{openedDropdownID:null},constructor:function(a,b){if(!(a instanceof Array))throw"Incorrect use of drop down (items must be an array)";this.items=a,this.options=b||{},this.gridIndex=0,this.gridLineBreak=4;var c=" ";if(!0!==this.options.emptyPlaceholder&&(c=this.options.placeholder||"..."),this.placeholder={label:c},void 0===this.options.iconType?this.options.iconType=this.iconType="dropdown":this.iconType=this.options.iconType,this.value=null,this.index=-1,this.callback=this.options.callback,void 0!=this.options.value){this.value=this.options.value||null;for(var d=0;d<this.items.length;d+=1)if(this.items[d].value===this.options.value){this.value=this.options.value,this.index=d," "!==this.placeholder.label&&"..."!==this.placeholder.label||(this.placeholder=this.items[d]);break}}this.id=actionManager.addClickListener(this,this.toggle,{clickOutHandler:this.close}),this.classname=this.options.classname||"",this.html=tmpl.drop_down.call(this)},open:function(){var a=$i(this.id);return DropDownComponent.openedDropdownID&&DropDownComponent.openedDropdownID!==this.id&&this.close(),addClass(a,"active"),a.getBoundingClientRect().top>260&&a.getBoundingClientRect().top>window.innerHeight-260&&addClass(a,"upwards"),a.getBoundingClientRect().right>window.innerWidth-100&&addClass(a,"leftwards"),$("#"+this.id+" .dropdown")[0].scrollTop=0,DropDownComponent.openedDropdownID=this.id,!1},close:function(){var a;DropDownComponent.openedDropdownID?a=DropDownComponent.openedDropdownID:(a=this.id,DropDownComponent.openedDropdownID=null),setTimeout(function(){removeClass($i(a),"active"),removeClass($i(a),"upwards")},0)},toggle:function(){return hasClass($i(this.id),"active")?this.close():this.open(),!1},select:function(a){var b=this.items[a.index];this.index=a.index,!0===this.options.emptyPlaceholder?this.placeholder={label:" "}:this.placeholder=b;removeClass($("#"+this.id+" .dropdown__item__selected")[0],"dropdown__item__selected"),addClass(a.event.target,"dropdown__item__selected"),this.value=b.value;var c="";this.placeholder.icon&&(c='<span class="icon ${this.placeholder.icon}"></span>'),$i(this.id).querySelectorAll(".select-placeholder")[0].innerHTML=c+this.placeholder.label,this.callback&&this.callback.call(this.options.component,this.value,this.options,this.index),this.close()}}),ListNoRefreshComponent=Class(AbstractListComponent,{$statics:{expandedItems:{},initialItemMaxHeight:{}},constructor:function(a,b){_super(this,a,b),this.value=null,this.index=-1,this.norefresh=!0,this.callback=b.callback,b.value&&(this.value=b.value||null),b.allValue&&"string"==typeof b.allValue&&(this.allValue=b.allValue),this.itemToDisplay=null,this.headerItems=this.getHeaderItems(),this.html=tmpl.list.call(this)},getHeaderItems:function(){if(!this.value)return[];var a=[];if(this.allValue&&a.push(this.allValue),1===this.items.length){for(var b=this.items[0];b.subitems&&1===b.subitems.length&&!0===b.subitems[0].selected&&b.value;)a.push(b.value),b=b.subitems[0];this.itemToDisplay=b}return a},getHeaderItemsCount:function(){return this.headerItems.length},getInitialItems:function(){return null===this.itemToDisplay?ListComponent.$superp.getInitialItems.call(this):Array.isArray(this.itemToDisplay)?this.itemToDisplay:[this.itemToDisplay]},closeFilters:function(){if(this.busy)return!1;var a=$(".expandable_list_container",$i(this.id).parentNode.parentNode)[0];if(!a)return!1;var b=$(".list__additional",a)[0],c=$(".list__items_toggle",a.parentNode)[0];if(!b||!c)return!1;if(""===a.style.maxHeight&&(a.style.maxHeight=AbstractListComponent.initialMaxHeight[this.getFilterName()]=getComputed(a,"height")+"px"),this.isExpanded()){this.showExpandButton(c),a.style.maxHeight=AbstractListComponent.initialMaxHeight[this.getFilterName()],this.busy=!0;var d=this;setTimeout(function(){addClass(b,"list__additional--hidden"),d.busy=!1},600),this.markAsRetracted()}else this.showRetractButton(c),removeClass(b,"list__additional--hidden"),a.style.maxHeight=getComputed(a,"height")+getComputed(b,"height")+100+"px",this.markAsExpanded()},select:function(a){this.closeFilters();var b=[];if(void 0===a.index&&void 0===a.depth)return!1;if(void 0!==a.depth){var c,d=this.items;for(c=0;c<a.depth;c++){var e=d[0];if(b.push(e),!e.subitems)break;d=e.subitems}void 0!==a.index&&d[a.index]&&b.push(d[a.index])}else b=this.items[a.index];a.event.target&&this.options.element&&($("."+this.options.element+" .list__item.selected").forEach(function(a){removeClass(a,"selected"),removeClass(a.children[0],"selected")}),addClass(a.event.target.parentNode,"selected"),addClass(a.event.target,"selected")),Array.isArray(b)?this.value=b.map(function(a){if(void 0!==a.value)return a.value}):void 0!==b.value&&(this.value=b.value);var f=this.value;Array.isArray(this.value)&&(f=this.value[this.value.length-1]?this.value[this.value.length-1]:"all"),LinkHelper.logHandler(this,Event,{AjaxRoute:"userInteraction",event:"click",element:f,zone:this.name+"_filter_list_item",position:void 0!==a.index?a.index+1:0,component:"filters",context:!0,t:"default"}),this.callback&&this.callback.call(this.options.component,this.value,this.options)}}),ListWithCheckboxesComponent=Class(AbstractListComponent,{constructor:function(a,b){_super(this,a,b),this.callback=this.options.callback,this.html=tmpl.list_with_checkboxes.call(this)},getCheckedItems:function(){return Array.prototype.slice.call($("input[type=checkbox]:checked",$i(this.options.filterName))).map(function(a){return a.value})},toggle:function(a){var b=this.getCheckedItems();this.callback&&this.callback.call(this.options.component,b,this.options)}}),ListComponent=Class(AbstractListComponent,{$statics:{expandedItems:{},initialItemMaxHeight:{}},constructor:function(a,b){_super(this,a,b),this.value=null,this.index=-1,this.callback=b.callback,b.value&&(this.value=b.value||null),b.allValue&&"string"==typeof b.allValue&&(this.allValue=b.allValue),this.itemToDisplay=null,this.headerItems=this.getHeaderItems(),this.html=tmpl.list.call(this)},getHeaderItems:function(){if(!this.value)return[];var a=[];if(this.allValue&&a.push(this.allValue),1===this.items.length){for(var b=this.items[0];b.subitems&&1===b.subitems.length&&!0===b.subitems[0].selected&&b.value;)a.push(b.value),b=b.subitems[0];this.itemToDisplay=b}return a},getHeaderItemsCount:function(){return this.headerItems.length},getInitialItems:function(){return null===this.itemToDisplay?ListComponent.$superp.getInitialItems.call(this):Array.isArray(this.itemToDisplay)?this.itemToDisplay:[this.itemToDisplay]},select:function(a){var b=[];if(void 0===a.index&&void 0===a.depth)return!1;if(void 0!==a.depth){var c,d=this.items;for(c=0;c<a.depth;c++){var e=d[0];if(b.push(e),!e.subitems)break;d=e.subitems}void 0!==a.index&&d[a.index]&&b.push(d[a.index])}else b=this.items[a.index];Array.isArray(b)?this.value=b.map(function(a){if(void 0!==a.value)return a.value}):void 0!==b.value&&(this.value=b.value);var f=this.value;Array.isArray(this.value)&&(f=this.value[this.value.length-1]?this.value[this.value.length-1]:"all"),LinkHelper.logHandler(this,Event,{AjaxRoute:"userInteraction",event:"click",element:f,zone:this.name+"_filter_list_item",position:void 0!==a.index?a.index+1:0,component:"filters",context:!0,t:"default"}),this.callback&&this.callback.call(this.options.component,this.value,this.options)}}),LocalDropDownComponent=Class(DropDownComponent,{constructor:function(a,b,c){_super(this,a,b),this.closeAllDropDowns=c},toggle:function(){this.closeAllDropDowns.call(this.options.component),LocalDropDownComponent.$superp.toggle.call(this)}}),LocalFilterWithCheckboxes=Class(AbstractListComponent,{constructor:function(a,b,c){_super(this,a,b),this.callback=this.options.callback,this.label=this.options.label?this.options.label:"",this.closeAllDropDowns=c,this.html=tmpl.local_filter_with_checkboxes.call(this)},getCheckedItems:function(){return Array.prototype.slice.call($("input[type=checkbox]:checked",$i(this.options.filterName))).map(function(a){return a.value})},getCheckedItemsLabels:function(){return Array.prototype.slice.call($("input[type=checkbox]:checked",$i(this.options.filterName))).map(function(a){return a.labels[0].innerHTML})},close:function(){if(this.isExpanded()){var a=$(".expandable_list_container",$i(this.id))[0],b=$(".list__items_toggle",a.parentNode)[0],c=$(".result_filter__item__label",a.parentNode.parentNode)[0],d=$(".list__additional",a)[0];if(!(a&&c&&d&&b))return!1;this.showExpandButton(b),removeClass(c,"list__expanded"),a.style.maxHeight=AbstractListComponent.initialMaxHeight[this.getFilterName()],addClass(d,"list__additional--hidden"),this.markAsRetracted()}},toggleFilterItems:function(){this.closeAllDropDowns.call(this.options.component);var a=$(".expandable_list_container",$i(this.id))[0],b=$(".result_filter__item__label",a.parentNode.parentNode)[0];if(!a||!b)return!1;var c=$(".list__additional",a)[0],d=$(".list__items_toggle",a.parentNode)[0];if(!c||!d)return!1;""===a.style.maxHeight&&(a.style.maxHeight=AbstractListComponent.initialMaxHeight[this.getFilterName()]=getComputed(a,"height")+"px"),this.isExpanded()?(this.showExpandButton(d),removeClass(b,"list__expanded"),a.style.maxHeight=AbstractListComponent.initialMaxHeight[this.getFilterName()],addClass(c,"list__additional--hidden"),this.markAsRetracted()):(this.showRetractButton(d),removeClass(c,"list__additional--hidden"),addClass(b,"list__expanded"),a.style.maxHeight=getComputed(a,"height")+getComputed(c,"height")+100+"px",this.markAsExpanded())},toggle:function(a){var b=this.getCheckedItems(),c=$("input[type=checkbox]",$i(this.options.filterName));if(-1!==b.indexOf(a.value))if(""!==a.value)for(var d=0;d<c.length;d++)""===c[d].value&&(c[d].checked=!1);else for(var d=0;d<c.length;d++)""!==c[d].value&&(c[d].checked=!1);else if(0===b.length)for(var d=0;d<c.length;d++)""===c[d].value&&(c[d].checked=!0);var e=this.getCheckedItemsLabels(),f=$(".expandable_list_container",$i(this.id))[0];$(".result_filter__item__label",f.parentNode.parentNode)[0].innerHTML=e.join(", "),this.callback&&this.callback.call(this.options.component,this.getCheckedItems(),this.options)}}),AbortEmailChangeComponent=Class(Component,{constructor:function(a){if(this.name="abort_email_change",this.skipRender=!0,a.params.token&&a.params.email){this.token=a.params.token,this.email=a.params.email;var b=this;AjaxManager.post(ajax.user.abortEmailChange(),new AjaxParameters({email:b.email,token:b.token}).getParameters()).then(function(a,b){page("/"),b.status&&b.status===AJAX_STATUS.SUCCESS?AlertComponent.success(_("Thank you for letting us know, we will address this issue as soon as possible","alert")):AlertComponent.error(_("An error has occurred while trying to report an email address abuse","alert"))})}_super(this)}}),AccountOverlayComponent=Class(Component,{constructor:function(){this.name="account_overlay",this.user=SecurityHelper.deepCopy(UserModel.getDuplicateModel(),applicationState.user),actionManager.addSubmitListener(this,this.login,{key:"login__form"}),actionManager.addSubmitListener(this,this.register,{key:"register__form"}),actionManager.addSubmitListener(this,this.passwordLost,{key:"password_lost"}),actionManager.addSubmitListener(this,this.changePassword,{key:"change_password_form"}),actionManager.addSubmitListener(this,this.changeEmail,{key:"change_email_form"}),actionManager.addSubmitListener(this,this.deleteAccount,{key:"delete_account_form"}),actionManager.addSubmitListener(this,this.changeLostPassword,{key:"change_lost_password_form"}),_super(this)},initState:function(){return{display:!1}},displayAccountOverlay:function(a){this.referer=a&&a.referer&&a.referer.match(/^\//)?a.referer:null,this.token=a&&a.token?a.token:null;var b=a&&a.step?a.step:"login",c={display:!0,step:b};if("register"!==b&&"change_password"!==b&&"change_lost_password"!==b||(this.passwordStrengthIndicator||(this.passwordStrengthIndicator=new PasswordStrengthIndicator(8,this.id+"_f")),c.passwordStrengthIndicator=this.passwordStrengthIndicator),addClass(document.body,"account_overlay"),a&&"donation"===a.step){addClass(document.body,"account_overlay--donation");try{localStorage.setItem("qozInit",!0)}catch(a){l.error("local storage is not available")}}this.setState(c)},removeAccountOverlay:function(){this.setState({display:!1}),this.user.resetFormValidityParams(),this.resetUserField(),removeClass(document.body,"account_overlay"),removeClass(document.body,"account_overlay--donation")},goTo:function(a){var b=a.step,c=this.state,d=this;c.step=b,"register"===b&&(this.passwordStrengthIndicator||(this.passwordStrengthIndicator=new PasswordStrengthIndicator(8,this.id+"_f")),c.passwordStrengthIndicator=this.passwordStrengthIndicator),this.setState(c),"register_completed"===b&&($(".account_overlay__close")[0].style.display="none",setTimeout(function(){d.removeAccountOverlay()},4e3))},login:function(a){FormHelper.disableSubmitButton();var b=document.getElementById("login").value,c=document.getElementById("password").value,d=UserModel.login(b,c),e=this;$i("button--login").innerHTML=_("Please wait ...","login"),LoadBarComponent.init(1),d.then(function(a,d){if(LoadBarComponent.step(),a){var f=e.state;f.addProperty("login",b),f.addProperty("password",c),$i("button--login").innerHTML=_("Log in","login"),FormHelper.enableSubmitButton(),e.setState(f)}else{applicationState.user=d,e.user=SecurityHelper.deepCopy(e.user,d);var g=applicationState.user.userSetting.getInterfaceLanguage()||LanguageHelper.getCorrespondingInterfaceLanguage("en"),h=applicationState.user.changeLang(g);setDisplayType({selectedTheme:applicationState.user.userSetting.selectedTheme}),void 0!==Application.rootComponent.state.header.state.qozCount&&(Application.rootComponent.state.header.state.qozCount=new QozCountComponent(applicationState.user.qoz_count),Application.rootComponent.state.header.setState(Application.rootComponent.state.header.state)),h.then(function(){if(e.referer)window.location=config_get("qwantUrl")+e.referer;else{var a=Application.rootComponent.state.header.state;a.user=d,a.userDropDown=Application.rootComponent.state.header.getUserDropDown(),
Application.rootComponent.state.header.setState(a),Application.rootComponent.state.headerStatic&&Application.rootComponent.state.headerStatic.setState(a),Application.rootComponent.state.appMenu&&Application.rootComponent.state.appMenu.setState(Application.rootComponent.state.appMenu.state),AlertComponent.success(_("Welcome back !","alert")),e.removeAccountOverlay(),document.dispatchEvent(new CustomEvent("qwant_website_login")),actionManager.fireEvent("user_login",{fromFavorite:e.fromFavorite}),delete actionManager.geteventActionContainers().user_login}})}})},saveAndAdvance:function(){if(this.user.password=$i(this.id+"_f").value,this.user.isFormValid()){if(!this.state.passwordStrengthIndicator.isPasswordValid)return void AlertComponent.error(_("You must enter a valid password","user"));this.user.userSetting=applicationState.user.userSetting,this.goTo({step:"register_end"})}},register:function(){if(FormHelper.disableSubmitButton(),!$i("tos_f").checked)return AlertComponent.error(_("You must accept the terms of use","user")),void FormHelper.enableSubmitButton();this.user.qwant_update=!1,null!==$i("newsletter_f")&&(this.user.qwant_update=$i("newsletter_f").checked);var a=this.user.register(),b=this;LoadBarComponent.init(1),a.then(function(a,c){if(LoadBarComponent.step(),a||c.error)AlertComponent.error(_("An error was encountered during register process","user")),FormHelper.enableSubmitButton();else if(applicationState.user=new UserModel,applicationState.user.mapJSONFields(c.data),applicationState.user.isLogged=!0,applicationState.user.favorites=c.data.favorites,applicationState.user.version=UserModel.version,Model.store("user",applicationState.user),b.referer)window.location=config_get("qwantUrl")+b.referer;else{var d=Application.rootComponent.state.header.state;d.user=applicationState.user,d.userDropDown=Application.rootComponent.state.header.getUserDropDown(),Application.rootComponent.state.header.setState(d),Application.rootComponent.refresh(),b.goTo({step:"register_completed"})}})},passwordLost:function(){var a=this,b=$i("email").value,c=UserModel.passwordLost(b);LoadBarComponent.init(1),c.then(function(b){LoadBarComponent.step(),b?AlertComponent.error(_("An error has occurred.","user")):(AlertComponent.success(_("An email with a link to reset your password has been sent to your email address.","user")),a.removeAccountOverlay())})},changePassword:function(){if(FormHelper.disableSubmitButton(),!this.user.isFormValid())return void FormHelper.enableSubmitButton();if(!$i("password-strength-ok").checked)return AlertComponent.error(_n("New password must contain at least {minChar} character","New password must contain at least {minChar} characters",passwordMinChars,"register",{minChar:passwordMinChars})),void FormHelper.enableSubmitButton();LoadBarComponent.init(1);var a=this,b=$i("old_password_f").value,c=$i(this.id+"_f").value,d=$i("password_confirmation_f").value;this.user.changePassword(b,c,d).then(function(b,c){LoadBarComponent.step(),c.error?FormHelper.enableSubmitButton():(c.data.password_last_modification&&a.user.updatePasswordTimeStamp(c.data.password_last_modification),c.data.token&&(a.user.token=c.data.token,applicationState.user.token=c.data.token,Model.store("user",applicationState.user)),AlertComponent.success(_("Password updated successfully","user")),a.removeAccountOverlay())})},changeLostPassword:function(){if(FormHelper.disableSubmitButton(),!this.user.isFormValid())return void FormHelper.enableSubmitButton();var a=this;if(this.token&&!applicationState.user.isLogged){if(!$i("password-strength-ok").checked)return AlertComponent.error(_n("It must contain at least {minChar} character","It must contain at least {minChar} characters",passwordMinChars,"register",{minChar:passwordMinChars})),void FormHelper.enableSubmitButton();var b=$i(this.id+"_f").value,c=$i("password_confirmation_f").value;applicationState.user.changeLostPassword(this.token,b,c).then(function(b,c){c.error||(AlertComponent.success(_("Your password has been successfully updated","user")),a.user.resetFormValidityParams(),a.resetUserField(),a.displayAccountOverlay())})}else AlertComponent.error(_("An error occurred during your password change","user")),FormHelper.enableSubmitButton()},changeEmail:function(){if(FormHelper.disableSubmitButton(),!this.user.isFormValid())return void FormHelper.enableSubmitButton();LoadBarComponent.init(1);var a=this,b=$i("password_f").value,c=$i("new_email_f").value;this.user.changeEmail(b,c).then(function(b,c){LoadBarComponent.step(),b||c.error||(AlertComponent.success(_("An email has been sent to you to confirm the email address change","user")),a.removeAccountOverlay()),FormHelper.enableSubmitButton()})},deleteAccount:function(){if(FormHelper.disableSubmitButton(),!applicationState.user.isFormValid())return void FormHelper.enableSubmitButton();LoadBarComponent.init(1);var a=this,b=$i("password_f").value;applicationState.user.unRegister(b).then(function(b,c){LoadBarComponent.step(),c&&!c.error&&UserModel.logout().then(function(){AlertComponent.success(_("An email has been sent to you to confirm the account removal","user")),a.removeAccountOverlay()}),FormHelper.enableSubmitButton()})},resetUserField:function(){this.user.clearField("email"),this.user.clearField("firstname"),this.user.clearField("lastname"),this.user.clearField("username"),this.user.clearField(this.id),this.user.clearField("password_confirmation"),this.user.clearField("tos"),this.user.clearField("newsletter"),this.user.clearField("old_password"),this.user.clearField("password"),this.user.clearField("new_email")}}),AccountPageComponent=Class(Component,{constructor:function(a){if(applicationState.user.isLogged){this.name=uxVersions.indexOf("v4")>-1?"account_page_v4":"account_page",this.referer=a&&a.params&&a.params.referer&&a.params.referer.match(/^\//)?a.params.referer:null,this.route=a,this.pictureUrl=applicationState.user.getPictureUrl(),this.cropper=new ImageCropperComponent(this.pictureUrl),_super(this),actionManager.handleChange(this,this.updateFile,{key:"account_page__picture__file_uploader--desktop"}),actionManager.handleChange(this,this.updateFile,{key:"account_page__picture__file_uploader--mobile"}),uxVersions.indexOf("v4")>-1&&(addClass(document.body,"scroll_on_static"),$(".header")[0].style.display="none",$(".side_bar")[0].style.display="none",LayoutComponent.registerBeforeAction(function(){removeClass(document.body,"scroll_on_static"),$(".header")[0].removeAttribute("style"),$(".side_bar")[0].removeAttribute("style")})),this.waiting=!1;!0===15778800<Math.floor(Date.now()/1e3)-applicationState.user.password_last_modification&&AlertComponent.error(_("Your password hasn't been changed for more than 6 months. For your account security, we recommend that you renew it regularly.","user")),FloatingButtonHelper.hideButtons()}else page("/"),Application.rootComponent.state.account_overlay.displayAccountOverlay({referer:this.referer}),this.skipRender=!0},initState:function(){var a={user:applicationState.user,cropper:this.cropper};return uxVersions.indexOf("v4")>-1&&(a.header=new HeaderStaticComponent(_("My account","user"),{route:this.route})),a},updateFile:function(a){var b=a.event.target.files[0];if(void 0!==b){var c=this.loadFile(b),d=this;c.then(function(a,b){if(!a&&b.rawData&&b.height&&b.width){var c=d.cropper.state;c.imageUrl=b.rawData,c.imageOriginalWidth=b.width,c.imageOriginalHeight=b.height,c.isEnabled=!0,d.cropper.setState(c),d.toggleProfilePictureState(!0)}})}$i("account_page__picture__file_uploader--desktop").value="",$i("account_page__picture__file_uploader--mobile").value=""},loadFile:function(a){var b=new FileReader,c=$i(this.cropper.cropImage.id);c.file=a;var d=new promise.Promise,e=this;return this.files=[],b.onload=function(b){return function(c){var f={};f.filename=a.name,f.data=c.target.result,e.files.push(f),b=document.createElement("img"),b.style.position="absolute",b.style.left="-9999px",b.src=c.target.result,document.body.appendChild(b);var g={rawData:c.target.result,width:0,height:0};b.onerror=function(a){AlertComponent.error(_("Please choose a valid image.","user"))},b.onload=function(a){g.width=b.naturalWidth,g.height=b.naturalHeight,Math.min(b.naturalWidth,b.naturalHeight)<e.cropper.cropCanvasMinSize&&(AlertComponent.error(_("Please choose an image that is at least 150px wide and 150px tall","user")),d.done(!0)),b.parentNode.removeChild(b),b=void 0,d.done(!1,g)}}}(c),b.readAsDataURL(a),d},update:function(){if(applicationState.user.isFormValid()){var a=this;applicationState.user.update().then(function(b,c){b?AlertComponent.error(_("An error has occurred while trying to update your account","user")):a.referer?window.location=config_get("qwantUrl")+a.referer:(Dispatcher.history.goTo(0),AlertComponent.success(_("Account successfully updated","user")))})}},validateCrop:function(){if(this.files){var a=this.cropper.validateCrop(),b=applicationState.user.saveProfilePicture(a),c=this;b.then(function(b,d){if(!b&&d&&d.data&&d.data.pict){c.toggleProfilePictureState(!1),actionManager.fireEvent(UserModel.EVENT_AVATAR_UPDATE,{img64:a,imgUrl:d.data.pict}),AlertComponent.success(_("Your picture has been successfully updated","user"));var e=c.cropper.state;e.isEnabled=!1,e.imageUrl=a,HeaderComponent.imageURL=a,c.cropper.setState(e),Application.rootComponent.refresh()}else AlertComponent.error(_("An error has occurred while trying to update your picture","user"))})}},cancelCrop:function(){this.toggleProfilePictureState(!1);var a=this.cropper.state;a.isEnabled=!1,a.imageUrl=applicationState.user.getPictureUrl(),this.cropper.setState(a)},cancel:function(){this.referer?window.location=config_get("qwantUrl")+this.referer:Dispatcher.history.goTo(1)},toggleProfilePictureState:function(a){a?(removeClass($i("account_page__picture__label--desktop"),"account_page__picture__label--desktop--active"),removeClass($i("account_page__picture__label--mobile"),"account_page__picture__label--mobile--active"),addClass($i("account_page__picture__label--desktop"),"account_page__picture__label--desktop--inactive"),addClass($i("account_page__picture__label--mobile"),"account_page__picture__label--mobile--inactive"),removeClass($i("account_page__picture__buttons--desktop"),"account_page__picture__buttons--desktop--inactive"),removeClass($i("account_page__picture__buttons--mobile"),"account_page__picture__buttons--mobile--inactive"),addClass($i("account_page__picture__buttons--desktop"),"account_page__picture__buttons--desktop--active"),addClass($i("account_page__picture__buttons--mobile"),"account_page__picture__buttons--mobile--active"),removeClass($i(this.cropper.cropImage.id),"image_cropper__user_picture--static"),addClass($i(this.cropper.cropImage.id),"image_cropper__user_picture--crop")):(removeClass($i("account_page__picture__label--desktop"),"account_page__picture__label--desktop--inactive"),removeClass($i("account_page__picture__label--mobile"),"account_page__picture__label--mobile--inactive"),addClass($i("account_page__picture__label--desktop"),"account_page__picture__label--desktop--active"),addClass($i("account_page__picture__label--mobile"),"account_page__picture__label--mobile--active"),removeClass($i("account_page__picture__buttons--desktop"),"account_page__picture__buttons--desktop--active"),removeClass($i("account_page__picture__buttons--mobile"),"account_page__picture__buttons--mobile--active"),addClass($i("account_page__picture__buttons--desktop"),"account_page__picture__buttons--desktop--inactive"),addClass($i("account_page__picture__buttons--mobile"),"account_page__picture__buttons--mobile--inactive"),removeClass($i(this.cropper.cropImage.id),"image_cropper__user_picture--crop"),addClass($i(this.cropper.cropImage.id),"image_cropper__user_picture--static"))},getInfo:function(){if(this.waiting)return!1;var a=$(".account_page_get_info_success")[0],b=$(".account_page_get_info_fail")[0];a.removeAttribute("style"),b.removeAttribute("style");var c=$(".account_page_get_info_button")[0],d=c.innerHTML;c.innerHTML='<img class="account_page_get_info_button_loader" src="/img/qwant-loader.gif"/><span>'+_("Download my data","user")+"</span>",this.waiting=!0;var e={session_token:applicationState.user.token,lang:applicationState.user.userSetting.getInterfaceLanguage().shorthand},f=this;AjaxManager.get(ajax.user.generateInfo(),e).then(function(e,g){e||g.error?b.style.display="block":(AlertComponent.success(_("An e-mail has been sent for you to download your data. If you do not receive this email, please check your spam folder.","user")),a.style.display="block"),f.waiting=!1,c.innerHTML=d})}}),ChangeEmailPageComponent=Class(Component,{constructor:function(){uxVersions.indexOf("v4")>-1?(Dispatcher.history.goTo(0),Application.rootComponent.state.account_overlay.displayAccountOverlay({step:"change_email"})):(this.name="change_email",this.formId=actionManager.addSubmitListener(this,this.changeEmail),_super(this),applicationState.user.new_email=applicationState.user.password="",LayoutComponent.registerBeforeAction(function(){applicationState.user.resetFormValidityParams()}),FloatingButtonHelper.hideButtons())},initState:function(){return{user:applicationState.user}},changeEmail:function(){if(FormHelper.disableSubmitButton(),!applicationState.user.isFormValid())return void FormHelper.enableSubmitButton();LoadBarComponent.init(1);var a=$i("password_f").value,b=$i("new_email_f").value;applicationState.user.changeEmail(a,b).then(function(a,b){LoadBarComponent.step(),a&&(b.error=a),b.error||(page("/account"),AlertComponent.success(_("An email has been sent to you to confirm the email address change","user"))),FormHelper.enableSubmitButton()})},cancel:function(){page("/account")}}),ChangeLostPasswordComponent=Class(Component,{constructor:function(a){uxVersions.indexOf("v4")>-1?(page("/"),Application.rootComponent.state.account_overlay.displayAccountOverlay({step:"change_lost_password",token:a.params.token})):(this.name="change_lost_password",this.route=a,this.token=a.params.token,this.formId=actionManager.addSubmitListener(this,this.changeLostPassword),LayoutComponent.registerBeforeAction(function(){applicationState.user.resetFormValidityParams()}),_super(this))},initState:function(){return{user:new UserModel,token:this.token,passwordStrengthIndicator:new PasswordStrengthIndicator(passwordMinChars,this.id+"_f")}},changeLostPassword:function(){if(FormHelper.disableSubmitButton(),!this.state.user.isFormValid())return void FormHelper.enableSubmitButton();if(this.route.params.token&&!applicationState.user.isLogged){if(!$i("password-strength-ok").checked)return AlertComponent.error(_n("It must contain at least {minChar} character","It must contain at least {minChar} characters",passwordMinChars,"register",{minChar:passwordMinChars})),void FormHelper.enableSubmitButton();var a=$i(this.id+"_f").value,b=$i("password_confirmation_f").value;applicationState.user.changeLostPassword(this.token,a,b).then(function(a,b){b.error||(page("/login"),AlertComponent.success(_("Your password has been successfully updated","user")))})}else AlertComponent.error(_("An error occurred during your password change","user")),FormHelper.enableSubmitButton()},cancel:function(){page("/")}}),ChangePasswordPageComponent=Class(Component,{constructor:function(){uxVersions.indexOf("v4")>-1?(Dispatcher.history.goTo(0),Application.rootComponent.state.account_overlay.displayAccountOverlay({step:"change_password"})):(this.name="change_password",this.formId=actionManager.addSubmitListener(this,this.changePassword),_super(this),applicationState.user.old_password=applicationState.user.new_password=applicationState.user.password_confirmation="",LayoutComponent.registerBeforeAction(function(){applicationState.user.resetFormValidityParams()}),FloatingButtonHelper.hideButtons())},initState:function(){return{user:applicationState.user,passwordStrengthIndicator:new PasswordStrengthIndicator(passwordMinChars,this.id+"_f")}},changePassword:function(){if(FormHelper.disableSubmitButton(),!applicationState.user.isFormValid())return void FormHelper.enableSubmitButton();if(!$i("password-strength-ok").checked)return AlertComponent.error(_n("New password must contain at least {minChar} character","New password must contain at least {minChar} characters",passwordMinChars,"register",{minChar:passwordMinChars})),void FormHelper.enableSubmitButton();LoadBarComponent.init(1);var a=$i("old_password_f").value,b=$i(this.id+"_f").value,c=$i("password_confirmation_f").value;applicationState.user.changePassword(a,b,c).then(function(a,b){LoadBarComponent.step(),b.error?FormHelper.enableSubmitButton():(b.data.password_last_modification&&applicationState.user.updatePasswordTimeStamp(b.data.password_last_modification),b.data.token&&(applicationState.user.token=b.data.token,Model.store("user",applicationState.user)),page("/account"),AlertComponent.success(_("Password updated successfully","user")))})},cancel:function(){page("/account")}}),LoginPageComponent=Class(Component,{constructor:function(a){this.referer=a&&a.params&&a.params.referer&&a.params.referer.match(/^\//)?a.params.referer:null,uxVersions.indexOf("v4")>-1?(Dispatcher.history.goTo(0),Application.rootComponent.state.account_overlay.displayAccountOverlay({referer:this.referer})):(this.fromFavorite="1"===a.params.fav,applicationState.user.isLogged?(page("/account"),this.skipRender=!0):(isReachableStore||AlertComponent.error(_("Due to your browser's preferences, you will be logged out when you refresh the page.","login page"),{timeout:1e5}),this.name="login_page",actionManager.addSubmitListener(this,this.login,{key:"login__form"}),_super(this)),FloatingButtonHelper.hideButtons())},login:function(a){FormHelper.disableSubmitButton();var b=document.getElementById("login").value,c=document.getElementById("password").value,d=UserModel.login(b,c),e=this;$i("button--login").value=_("Please wait ...","login"),LoadBarComponent.init(1),d.then(function(a,d){if(LoadBarComponent.step(),a){var f=new State;f.addProperty("login",b),f.addProperty("password",c),FormHelper.enableSubmitButton(),e.setState(f)}else{applicationState.user=d;var g=applicationState.user.userSetting.getInterfaceLanguage()||LanguageHelper.getCorrespondingInterfaceLanguage("en");applicationState.user.changeLang(g).then(function(){e.referer?window.location=config_get("qwantUrl")+e.referer:(Application.rootComponent.state.header.state.user=d,Application.rootComponent.state.header.state.userDropDown=Application.rootComponent.state.header.getUserDropDown(),Application.rootComponent.state.header.setState(Application.rootComponent.state.header.state),Dispatcher.history.goTo(0),AlertComponent.success(_("Welcome back !","alert")),document.dispatchEvent(new CustomEvent("qwant_website_login")),actionManager.fireEvent("user_login",{fromFavorite:e.fromFavorite}),delete actionManager.geteventActionContainers().user_login)})}})},onMount:function(){setTimeout(function(){BrowserHelper.focusInput($i("login"))},0)}}),PasswordLostComponent=Class(Component,{constructor:function(){uxVersions.indexOf("v4")>-1?(Dispatcher.history.goTo(0),Application.rootComponent.state.account_overlay.displayAccountOverlay({step:"password_lost"})):(this.name="password_lost",actionManager.addSubmitListener(this,this.send,{key:"password_lost"}),_super(this),FloatingButtonHelper.hideButtons(),LayoutComponent.registerBeforeAction(function(){applicationState.user.resetFormValidityParams()}))},send:function(){var a=$i("email").value;UserModel.passwordLost(a).then(function(a){a?AlertComponent.error(_("An error has occurred.","user")):(Dispatcher.history.goTo(0),AlertComponent.success(_("An email with a link to reset your password has been sent to your email address.","user")))})},reset:function(){page("/login")}}),PasswordStrengthIndicator=Class(Component,{constructor:function(a,b){this.name="password_strength_indicator",this.minChar=a,this.passwordFieldId=b,_super(this),this.passwordFiedId=actionManager.addInputListener(this,this.onInput,{key:b}),this.isPasswordValid=!1},initState:function(){return{passwordFieldId:this.passwordFiedId,minChar:this.minChar}},fields:[{regex:/[a-z]/,classModifier:"lowercase"},{regex:/[A-Z]/,classModifier:"uppercase"},{regex:/[0-9]/,classModifier:"digit"},{regex:/[^a-zA-Z0-9]/,classModifier:"specialchars"},{test:function(a){return a.length>=12},classModifier:"minchars"}],onInput:function(){var a=$i(this.passwordFieldId).value;addClass(passwordStrengthContainer,"password-strength-container--open");var b=0;this.fields.forEach(function(c){var d=!1;(c.regex&&c.regex.test(a)||c.test&&c.test(a))&&(d=!0),d?($i("password-test-"+c.classModifier).className="password-strength-tooltip__test--ok",b+=1):$i("password-test-"+c.classModifier).className="password-strength-tooltip__test--ko"});var c=$i("password-strength-ok"),d=$i("password-strength-message"),e=$i("password-strength-indicator-jauge");a.length<this.minChar?(this.isPasswordValid=!1,c.checked="",d.innerHTML="<span class='password_level'>"+_("Your password is too short","register")+"</span><span>"+_n("It must contain at least {minChar} character","It must contain at least {minChar} characters",this.minChar,"register",{minChar:this.minChar})+"</span>",e.className="password-strength-indicator__jauge--weak"):(b<5?(d.innerHTML="<span class='password_level'>"+_("Your password is valid but not very strong","register")+"</span><span>"+_("You can add different kind of characters to enhance it","register")+"</span>",e.className="password-strength-indicator__jauge--medium"+b):5==b&&(d.innerHTML="<span class='password_level'>"+_("Your password is safe","register")+"</span><span>"+_("Good job!","register")+"</span>",e.className="password-strength-indicator__jauge--strong"),this.isPasswordValid=!0,c.checked="checked")}}),RegisterPageComponent=Class(Component,{constructor:function(a,b){this.referer=a&&a.params&&a.params.referer&&a.params.referer.match(/^\//)?a.params.referer:null,uxVersions.indexOf("v4")>-1?(Dispatcher.history.goTo(0),Application.rootComponent.state.account_overlay.displayAccountOverlay({step:"register",referer:this.referer})):(applicationState.user.isLogged?(page("/account"),this.skipRender=!0):(this.name=b||"register_page",this.user=new UserModel,this.user.username="",LayoutComponent.registerBeforeAction(function(){applicationState.user.resetFormValidityParams()}),applicationState.user.getSettings().getInterfaceLanguageCode()&&this.user.getSettings().setInterfaceLanguage(applicationState.user.getSettings().getInterfaceLanguageCode()),applicationState.user.getSettings().getSearchLanguageCode()&&this.user.getSettings().setSearchLanguage(applicationState.user.getSettings().getSearchLanguageCode()),applicationState.user.getSettings().getSearchRegionCode()&&this.user.getSettings().setSearchRegion(applicationState.user.getSettings().getSearchRegionCode()),applicationState.user.getSettings().getContinent()&&this.user.getSettings().setContinent(applicationState.user.getSettings().getContinent()),this.formId=actionManager.addSubmitListener(this,this.register),"register_page"===this.name&&window.scrollTo(0),_super(this)),"register_page"===this.name&&FloatingButtonHelper.hideButtons())},initState:function(){return{passwordStrengthIndicator:new PasswordStrengthIndicator(passwordMinChars,this.id+"_f"),user:this.user}},register:function(){if(FormHelper.disableSubmitButton(),this.user.password=$i(this.id+"_f").value,!this.state.user.isFormValid())return void FormHelper.enableSubmitButton();if(!this.state.passwordStrengthIndicator.isPasswordValid)return AlertComponent.error(_("You must enter a valid password","user")),void FormHelper.enableSubmitButton();if(!$i("term-of-use_f").checked)return AlertComponent.error(_("You must accept the terms of use","user")),void FormHelper.enableSubmitButton();this.state.user.qwant_update=!1,null!==$i("newsletter_f")&&(this.state.user.qwant_update=$i("newsletter_f").checked),this.state.user.userSetting=applicationState.user.userSetting;var a=this;this.state.user.register().then(function(b,c){b||c.error?(AlertComponent.error(_("An error was encountered during register process","user")),FormHelper.enableSubmitButton()):(applicationState.user=new UserModel,applicationState.user.mapJSONFields(c.data),applicationState.user.isLogged=!0,applicationState.user.favorites=c.data.favorites,applicationState.user.version=UserModel.version,Model.store("user",applicationState.user),a.referer?window.location=config_get("qwantUrl")+a.referer:(Application.rootComponent.state.header.setState(new State({user:applicationState.user,userDropDown:Application.rootComponent.state.header.getUserDropDown()})),Application.rootComponent.refresh(),Dispatcher.history.goTo(0),AlertComponent.success(_("Your account was successfully created","user"))))})}}),UnRegisterPageComponent=Class(Component,{constructor:function(){uxVersions.indexOf("v4")>-1?(Dispatcher.history.goTo(0),Application.rootComponent.state.account_overlay.displayAccountOverlay({step:"delete_account"})):(this.name="unregister",_super(this),applicationState.user.password="",LayoutComponent.registerBeforeAction(function(){applicationState.user.resetFormValidityParams()}),FloatingButtonHelper.hideButtons())},initState:function(){return{user:applicationState.user}},unRegister:function(){if(FormHelper.disableSubmitButton(),!applicationState.user.isFormValid())return void FormHelper.enableSubmitButton();LoadBarComponent.init(1);var a=$i("password_f").value;applicationState.user.unRegister(a).then(function(a,b){LoadBarComponent.step(),b&&!b.error&&UserModel.logout().then(function(){AlertComponent.success(_("An email has been sent to you to confirm the account removal","user"))}),FormHelper.enableSubmitButton()})},cancel:function(){page("/account")}}),ValidateEmailChangeComponent=Class(Component,{constructor:function(a){if(this.name="validate_email_change",this.skipRender=!0,a.params.token&&a.params.email){this.token=a.params.token,this.email=a.params.email;var b=this,c={email:b.email,token:b.token};applicationState.user.isLogged&&(c.session_token=applicationState.user.token);AjaxManager.post(ajax.user.validateEmailChange(),new AjaxParameters(c).getParameters()).then(function(a,b){page("/"),b.status&&b.status===AJAX_STATUS.SUCCESS?(applicationState.user.isLogged&&(applicationState.user.email=b.data.email,b.data.token&&(applicationState.user.token=b.data.token),Model.store("user",applicationState.user)),AlertComponent.success(_("Your email address has been successfully changed","alert"))):AlertComponent.error(_("An error has occurred while trying to change your email address","alert"))})}_super(this)}}),ValidateEmailComponent=Class(Component,{constructor:function(a){if(this.name="validate_email",a.params.token&&a.params.email){this.token=a.params.token,this.email=a.params.email;var b=this;AjaxManager.post(ajax.user.validateEmail(),new AjaxParameters({email:b.email,token:b.token}).getParameters()).then(function(a,b){var c="",d=!1;b.status&&b.status===AJAX_STATUS.SUCCESS?c=b.data.alreadyValidated?_("Your email address has already been validated","alert"):_("Your email address has been validated","alert"):(c=_("An error has occurred while trying to validate your email address","alert"),d=!0),config_get("account.start-page.enabled")?page("/demarrage"):page("/"),d?AlertComponent.error(c):AlertComponent.success(c)})}_super(this)}}),AlertComponent=Class(Component,{$statics:{component:null,lastId:0,info:function(a,b){return AlertComponent.component.addMessage(a,constants.ALERT_TYPES.INFO,b)},success:function(a,b){return AlertComponent.component.addMessage(a,constants.ALERT_TYPES.SUCCESS,b)},error:function(a,b){return AlertComponent.component.addMessage(a,constants.ALERT_TYPES.ERROR,b)},confirm:function(a,b,c,d,e){return e.onValid=c,e.component=b,e.onCancel=d,e.timeout=-1,AlertComponent.component.addMessage(a,constants.ALERT_TYPES.CONFIRM,e)},removeMessage:function(a){if(null!==AlertComponent.component){AlertComponent.component.hideAlert(a);var b=AlertComponent.component.getAlertIndex(a.id);-1!=b&&AlertComponent.component.state.messages.splice(b,1)}},clearAll:function(){AlertComponent.component.state.messages.map(function(a){AlertComponent.component.hideAlert({id:a.messageId})}),AlertComponent.component.state.messages=[]}},constructor:function(){this.name="alert",AlertComponent.component=this,LayoutComponent.registerBeforeAction(this.clearAll,[]),_super(this)},initState:function(){return{messages:[]}},addMessage:function(a,b,c){var c=c||{},d=new Date;AlertComponent.lastId+=1;var e=AlertComponent.lastId,f=c.timeout||configuration.MESSAGE_LIMIT_TIME,g=null;if(this.state.messages.length>0&&this.state.messages[this.state.messages.length-1].options.isPersistent)return!1;var h=!0;return this.state.messages.forEach(function(b){b.message===a&&(window.clearTimeout(b.timeoutHandler),g=setTimeout(function(){AlertComponent.component.removeMessage({id:b.messageId})},f),e=b.messageId,b.timeoutHandler=g,h=!1)}),h?(-1!=f&&(g=setTimeout(function(){AlertComponent.component.removeMessage({id:e})},f)),this.state.messages.push({message:a,type:b,messageId:e,createdAt:d,options:c,timeoutHandler:g}),this.setState(this.state),setTimeout(function(){var a=$i("alert_"+e);a&&(uxVersions.indexOf("v4")>-1?a.style.top="0px":a.style.top="10px")},200),e):e},hideAlert:function(a){var b=this.getAlertIndex(a.id);if(-1!=b){var c=this.state.messages[b];c.timeoutHandler&&clearTimeout(c.timeoutHandler);var d=$i("alert_"+a.id);d&&(d.style.top="-"+(d.offsetHeight+10)+"px",setTimeout(function(){d.setAttribute("hidden","")},300))}},getAlertIndex:function(a){var b=-1,c=[];return this.state.messages.map(function(b){c.push(b.id==a)}),this.state.messages.filter(function(a,c){a&&(b=c)}),b}}),AntiRobotComponent=Class(Component,{$statics:{lastPage:"",captchaCheck:function(){LinkHelper.logHandler(this,Event,{AjaxRoute:"antiRobot"}),AlertComponent.success(_("Thank you for your feedback, our team will do its best to fix this issue.","anti-robot")),$(".anti_robot__form__message--check_ban")[0].style.display="none"}},constructor:function(){this.name="anti_robot",this.model=new AntiRobotModel,this.get(!1),$(".header")[0].style.display="none",$(".side_bar")[0].style.display="none",LayoutComponent.registerBeforeAction(function(){$(".header")[0].removeAttribute("style"),$(".side_bar")[0].removeAttribute("style")}),_super(this),actionManager.onCustomEvent(this,"rendered",this.init)},init:function(){var a=this;this.formImg=$(".anti_robot__form__img")[0],this.formImg&&(this.formImg.onclick=function(b){a.onClick(b)})},initState:function(){return{imgSrc:""}},onClick:function(a){a.preventDefault();var b=this,c={x:a.offsetX,y:a.offsetY};this.model.resolve(this.anti_robotID,c).then(function(a,c){a||"error"===c.status?b.get(!0):(b.formImg&&(b.formImg.onclick=null),page(AntiRobotComponent.lastPage))})},get:function(a){var b=this;this.model.get().then(function(c,d){if(!1===c&&d.hasOwnProperty("data")){b.anti_robotID=d.data.id;var e={imgSrc:d.data.img};a&&(e.errorMessage=!0),b.setState(e)}})}}),BreadCrumbsComponent=Class(AbstractListComponent,{constructor:function(a,b){if(this.hasHome=b,!(a instanceof Array))throw"Incorrect use of breadcrumbs";this.items=a,this.html=tmpl.breadcrumbs.call(this)}}),ImageCropperComponent=Class(Component,{constructor:function(a){this.name="image_cropper",this.imageUrl=a,this.isEnabled=!1,this.cropCanvasMinSize=this.cropCanvasDefaultMinSize=this.cropCanvasResultSize=150,this.cropImage={maxWidth:uxVersions.indexOf("v4")>-1?212:400,maxHeight:uxVersions.indexOf("v4")>-1?212:400,browserWidth:0,browserHeight:0},_super(this)},initState:function(){return this.cropImage.id=this.id+"__crop_image",this.cropCanvasBorderId=this.id+"__crop_canvas_border",this.cropCanvasId=this.id+"__crop_canvas",this.cropHandleId=this.id+"__crop_handle",this.cropHandleIconId=this.id+"__crop_handle_icon",this.cropCanvasElementId=this.id+"__canvas",{cropImage:{id:this.cropImage.id,maxWidth:this.cropImage.maxWidth,maxHeight:this.cropImage.maxHeight},cropCanvasId:this.cropCanvasId,
cropCanvasBorderId:this.cropCanvasBorderId,cropHandleId:this.cropHandleId,cropHandleIconId:this.cropHandleIconId,imageUrl:this.imageUrl,x:0,y:0,width:this.cropCanvasMinSize,height:this.cropCanvasMinSize}},setState:function(a){if(this.state.x=0,this.state.y=0,this.state.width=this.state.height=this.cropCanvasMinSize,this.browserResizeFactor=1,a.imageOriginalWidth&&a.imageOriginalHeight){var b=this.state.cropImage.browserWidth=a.imageOriginalWidth,c=this.state.cropImage.browserHeight=a.imageOriginalHeight;if(b>this.cropImage.maxWidth||c>this.cropImage.maxHeight){var d=b/c;d>1?(this.state.cropImage.browserWidth=this.state.cropImage.maxWidth,this.state.cropImage.browserHeight=this.state.cropImage.browserWidth/d):(this.state.cropImage.browserHeight=this.state.cropImage.maxHeight,this.state.cropImage.browserWidth=this.state.cropImage.browserHeight*d),this.browserResizeFactor=this.state.cropImage.browserHeight/a.imageOriginalHeight,this.cropCanvasMinSize=Math.min(this.state.cropImage.browserHeight,this.state.cropImage.browserWidth,this.cropCanvasDefaultMinSize)}else this.cropCanvasMinSize=this.cropCanvasDefaultMinSize;this.state.width=this.state.height=this.cropCanvasMinSize}ImageCropperComponent.$superp.setState.call(this,a)},onMount:function(){if(this.state.isEnabled){this.image=$i(this.cropImage.id),this.imgRect=this.image.getBoundingClientRect(),this.cropCanvas=$i(this.cropCanvasId),this.cropCanvasBorder=$i(this.cropCanvasBorderId),this.cropCanvas.style.top=this.cropCanvasBorder.style.top="0px",this.cropCanvas.style.left=this.cropCanvasBorder.style.left="0px",this.cropCanvas.style.width=this.cropCanvas.style.height=this.cropCanvasBorder.style.width=this.cropCanvasBorder.style.height=this.cropCanvasMinSize+"px",this.cropCanvas.style.display=this.cropCanvasBorder.style.display="block";var a=$i(this.cropHandleId);this.cropCanvasFocus=!1,this.cropHandleFocus=!1;var b=this;if(this.cropCanvas.ontouchstart=this.cropCanvas.onmousedown=function(a){b.handleClickEventOnCropCanvas(a)},a.ontouchstart=a.onmousedown=function(a){b.handleClickEventOnCropHandle(a)},document.body.ontouchend=document.body.onmouseup=function(){b.cropCanvasFocus=!1,b.cropHandleFocus=!1},this.cropCanvas.parentNode.parentNode.parentNode.ontouchmove=this.cropCanvas.parentNode.parentNode.parentNode.onmousemove=function(a){b.handleDragEvent(a)},null!=this.state.imageUrl.match(/data:image\/gif/)){var c=document.createElement("canvas"),d=c.width=this.image.width/this.browserResizeFactor,e=c.height=this.image.height/this.browserResizeFactor;c.getContext("2d").drawImage(this.image,0,0,d,e);try{this.image.src=c.toDataURL("image/gif")}catch(a){for(var f,g=0;f=this.image.attributes[g];g++)c.setAttribute(f.name,f.value);this.image.parentNode.replaceChild(c,this.image)}}}},handleClickEventOnCropCanvas:function(a){a.preventDefault();var b=this.getEventObject(a);this.cropCanvasFocus=!0,this.initialMouseX=b.screenX,this.initialMouseY=b.screenY;var c=this.cropCanvas.getBoundingClientRect();this.imgRect=this.image.getBoundingClientRect(),this.initialCropCanvasTop=c.top-this.imgRect.top,this.initialCropCanvasLeft=c.left-this.imgRect.left},handleClickEventOnCropHandle:function(a){a.preventDefault();var b=this.getEventObject(a);this.cropHandleFocus=!0,this.initialMouseX=b.screenX,this.initialMouseY=b.screenY;var c=this.cropCanvas.getBoundingClientRect();this.initialCropCanvasWidth=c.width,this.initialCropCanvasHeight=c.height,a.stopPropagation()},handleDragEvent:function(a){if(!this.cropCanvasFocus&&!this.cropHandleFocus)return!1;a.preventDefault();var b=this.getEventObject(a);1==this.cropCanvasFocus&&this.moveCropCanvas(b),1==this.cropHandleFocus&&(this.resizeCropCanvas(b),a.stopPropagation())},resizeCropCanvas:function(a){var b=this.cropCanvas.getBoundingClientRect(),c=this.image.getBoundingClientRect(),d=0,e=0,f=!1,g=!1,h=Math.max(this.initialCropCanvasWidth+a.screenX-this.initialMouseX,this.initialCropCanvasHeight+a.screenY-this.initialMouseY);h<=this.cropCanvasMinSize&&(h=this.cropCanvasMinSize),h+b.left>=c.width+c.left&&(h=d=c.width+c.left-b.left,f=!0),h+b.top>=c.height+c.top&&(h=e=c.height+c.top-b.top,g=!0),g&&f&&(h=Math.min(e,d));var i=this;requestAnimationFrame(function(){i.cropCanvas.style.width=h+"px",i.cropCanvas.style.height=h+"px",i.cropCanvasBorder.style.width=h+"px",i.cropCanvasBorder.style.height=h+"px"}),this.saveStatePosition()},moveCropCanvas:function(a){var b,c,d=this.image.getBoundingClientRect(),e=this.cropCanvas.getBoundingClientRect(),f=this.initialCropCanvasLeft+a.screenX-this.initialMouseX,g=this.initialCropCanvasTop+a.screenY-this.initialMouseY;b=f<0?"0px":f>d.width-e.width?d.width-e.width+"px":f+"px",c=g<0?"0px":g>d.height-e.height?d.height-e.height+"px":g+"px";var h=this;requestAnimationFrame(function(){h.cropCanvas.style.left=b,h.cropCanvas.style.top=c,h.cropCanvasBorder.style.left=b,h.cropCanvasBorder.style.top=c}),this.saveStatePosition()},saveStatePosition:function(){var a=this.image.getBoundingClientRect(),b=this.cropCanvas.getBoundingClientRect();this.state.x=b.left-a.left,this.state.y=b.top-a.top,this.state.width=b.width,this.state.height=b.height},getEventObject:function(a){return a.touches?a.touches[0]:a},validateCrop:function(){var a=this.doCrop();return this.resizeImage(a,this.cropCanvasResultSize).toDataURL()},doCrop:function(){var a=document.createElement("canvas"),b=a.getContext("2d");return a.width=a.height=this.state.width/this.browserResizeFactor,b.drawImage(this.image,this.state.x/this.browserResizeFactor,this.state.y/this.browserResizeFactor,a.width,a.height,0,0,a.width,a.height),a},resizeImage:function(a,b){var c=$i(this.cropCanvasElementId),d=c.getContext("2d"),e=Math.floor(Math.log(a.width/b)/Math.log(2)),f=document.createElement("canvas"),g=f.getContext("2d");if(e>0)for(var h=a.width,i=a,j=0;j<e;j++){var f=document.createElement("canvas"),g=f.getContext("2d");f.width=f.height=h/=2,g.drawImage(i,0,0,h,h),i=f}else{var k=Math.floor((a.width+b)/2);f.width=f.height=k,g.drawImage(a,0,0,k,k)}return d.drawImage(f,0,0,b,b),c}}),BottomNavigationComponent=Class(Component,{constructor:function(){this.name="bottom_navigation",this.id=actionManager.addScrollListener(this,FloatingButtonHelper.positionButton,{isPersistant:!0,elementSelector:".bottom_navigation"}),this.tooltip=new TooltipComponent(this,_("Scroll to top","bottom navigation")),_super(this)},scrollToTop:function(){smoothScrollTo(0)}}),FloatingButtonHelper=Class(Component,{$statics:{BUTTON_BOTTOM_NAVIGATION:".bottom_navigation",positionButton:function(a){if(!a.elementSelector)return!1;var b=$(a.elementSelector)[0];if(!b)return!1;var c=getScrollPosition().scrollY,d=window.innerHeight,e=document.documentElement.scrollHeight;100<c?addClass(b,"left"):removeClass(b,"left"),c+d>=e-72&&!BrowserHelper.isMobile?addClass(b,"bottom"):removeClass(b,"bottom")},hideButton:function(a){var b=$(a)[0];b&&(b.style.display="none")},showButton:function(a){if(!a.elementSelector)return!1;var b=a.elementSelector,c=$(b)[0];c&&(c.style.display="block")},hideButtons:function(){var a=FloatingButtonHelper.BUTTON_BOTTOM_NAVIGATION;FloatingButtonHelper.hideButton(a),LayoutComponent.registerBeforeAction(FloatingButtonHelper.showButton,{elementSelector:a})}}}),PaginateComponent=Class(Component,{constructor:function(a,b,c){this.options=c||{},this.total=b,this.route=a,this.name="pagination",this.offset=this.route.params.page,_super(this)},goTo:function(a){this.route.params.page=a;var b=[];for(var c in this.route.params)a.value>1&&"page"===c?b.push(c+"="+this.route.params[c].value):""!==c&&"object"!=typeof this.route.params[c]&&b.push(c+"="+this.route.params[c]);var d="";b.length>0&&(d="?");var e=this.route.pathname+d+b.join("&");this.options.goTo?(history.replaceState(null,null,e),this.options.goTo.call(this.options.component,a.value)):page(e)},initState:function(){return{totalPage:this.total,current:parseInt(this.route.params.page)||1}},previous:function(){var a={value:this.state.current-1};this.goTo(a),window.scrollTo(0)},next:function(){var a={value:this.state.current+1};this.goTo(a),window.scrollTo(0)}}),PanelFormBoardSelector=Class(Component,{constructor:function(a){this.name="panel_form_board_selector",this.note=a,this.userBoardsListByIds={},_super(this)},getReadyToRender:function(){var a=new promise.Promise,b=this;return this.getUserBoards().then(function(c,d){if(!c&&d.userBoards){b.userBoards=d.userBoards;var e=0<b.userBoards.length;b.selectedBoard=e?b.userBoards[0]:null,a.done(!1,{userHasBoards:e}),e&&(b.searchSelector=new SearchSelectorComponent($(".panel_form_board_selector__search")[0],$(".panel_form_board_selector__board_list__item"),function(a,b){return 0<=$(".panel_form_board_selector__board_list__item__label",b)[0].innerHTML.toLowerCase().indexOf(a.toLowerCase())}))}else a.done(c)}),a},reorganizeBoards:function(a,b){var c=this.getBoardIndex(a,b);if(!1!==c){var d=b[c];b.splice(c,1),b.unshift(d)}},getBoardIndex:function(a,b){return b.map(function(b,c){return b.id==a&&c}).reduce(function(a,b){return!1!==a?a:!1!==b&&b})},getUserBoards:function(){var a=new promise.Promise;applicationState.user.isLogged||a.done(!0);var b=[],c=this;return BoardModel.getCurrentUserBoards().then(function(d,e){!d&&e.data.boards?(e.data.boards.map(function(a){b.push({name:a.board_name,id:parseInt(a.board_id),slug:a.board_slug,status:a.board_status,thumbnail:a.previewMediaMini}),c.userBoardsListByIds[a.board_id]={id:a.board_id,name:a.board_name}}),c.note&&c.note.board_id&&void 0!==c.userBoardsListByIds[c.note.board_id]&&c.reorganizeBoards(c.note.board_id,b),a.done(!1,{userBoards:b})):a.done(d)}),a},selectBoard:function(a){try{if(a.id){var b=this.getSelectedBoardId(),c=$(".panel_form_board_selector__board_list__item--"+b)[0];removeClass(c,"panel_form_board_selector__board_list__item--selected"),this.selectedBoard=this.userBoardsListByIds[parseInt(a.id)];var d=$(".panel_form_board_selector__board_list__item--"+this.getSelectedBoardId())[0];addClass(d,"panel_form_board_selector__board_list__item--selected")}}catch(a){this.selectedBoard=this.userBoardsListByIds[this.userBoards[0].id]}},getSelectedBoardId:function(){return this.selectedBoard?this.selectedBoard.id:0},getSelectedBoardName:function(){return this.selectedBoard?this.selectedBoard.name:""}}),PanelFormBoard=Class(Component,{$statics:{MODE_CREATE:"MODE_CREATE",MODE_EDIT:"MODE_EDIT"},constructor:function(a,b){this.name="panel_form_board",this.mode=a||PanelFormBoard.MODE_QUICK_CREATE,this.options=b,this.board=new BoardModel,this.board.category=BoardModel.DEFAULT_CATEGORY_ID,_super(this)},initState:function(){return{availableCategories:this.formatCategories()}},getReadyToRender:function(){var a=new promise.Promise;return a.done(!1),a},receiveData:function(a){for(var b in a)this.board[b]=a[b];this.board.description&&(this.board.description=decodeHTMLEntities(this.board.description)),this.board.enable_comments=a.commentsAllowed},selectCategory:function(a){this.board.category=a,this.board.cleanValidationAlert($(".panel_form_board__category_selector .panel__form__dropdown")[0])},formatCategories:function(){var a=[];return BoardModel.getAlphabeticallyOrderedCategories(!0).map(function(b){-1!=b.id&&a.push({label:b.i18n(),value:b.id})}),a},submit:function(){if(!this.board.isFormValid())return!1;PanelFormBoard.MODE_EDIT===this.mode?this.updateBoard():PanelFormNote.MODE_QUICK_CREATE!==this.mode&&PanelFormBoard.MODE_CREATE!==this.mode||this.createBoard()},updateBoard:function(){PanelFormHelper.showLoadingOverlay();var a=this,b=PanelFormHelper.getServerTimeoutHandler();this.board.update(this.board).then(function(c,d){if(clearTimeout(b),PanelFormHelper.hideLoadingOverlay(),!c&&d.data.board){if(PanelFormHelper.close(),a.options.callback&&a.options.callbackContext)a.options.callback.call(a.options.callbackContext,a.options.callbackArgs||{});else{var e=d.data.board.board_slug?d.data.board.board_slug:a.board.board_slug;actionManager.fireEvent(EventHelper.EVENT_BOARD_UPDATED,{boardSlug:e})}AlertComponent.success(_("Board successfully updated","board"))}else 206==c?AlertComponent.error(_("Another board has got a similar name, please choose a different board name","board")):AlertComponent.error(_("An error has occurred while trying to update the board","board"))})},createBoard:function(){var a=new promise.Promise;null==this.board.category&&(this.board.addValidationAlert($(".panel_form_board__category_selector .panel__form__dropdown")[0],_("Please choose a category","board creator")),a.done(!0)),PanelFormHelper.showLoadingOverlay();var b=this,c=PanelFormHelper.getServerTimeoutHandler();return this.board.create(this.board).then(function(d,e){clearTimeout(c),PanelFormHelper.hideLoadingOverlay(),!d&&e.data.board?(b.board=new BoardModel,b.isFormStandalone()&&(PanelFormHelper.close(),page("/board/"+applicationState.user.username+"/"+e.data.board.board_slug),AlertComponent.success(_("Board successfully created","board"))),a.done(!1)):(b.handleBoardCreationError(d),a.done(!0))}),a},handleBoardCreationError:function(a){206==a?AlertComponent.error(_("Another board has got a similar name, please choose a different board name","board")):AlertComponent.error(_("An error has occurred while trying to create the board","board"))},openDeletionConfirmBox:function(){$i("panel_form_board__delete__confirm").style.display="block"},closeDeletionConfirmBox:function(){$i("panel_form_board__delete__confirm").style.display="none"},deleteBoard:function(){var a=this;PanelFormHelper.showLoadingOverlay();var b=PanelFormHelper.getServerTimeoutHandler();this.board.delete(this.board).then(function(c){clearTimeout(b),PanelFormHelper.hideLoadingOverlay(),c?AlertComponent.error(_("An error has occurred while deleting the board","board")):(PanelFormHelper.close(),a.options.callback&&a.options.callbackContext?a.options.callback.call(a.options.callbackContext,a.options.callbackArgs||{}):page("/"),AlertComponent.success(_("Board successfully removed","board")))})},isFormStandalone:function(){return this.options&&this.options.isFormStandalone}}),PanelFormHelper=Class({$statics:{EVENT_CLOSE:"_close",EVENT_SHOW_LOADING_OVERLAY:"_show_loading_overlay",EVENT_HIDE_LOADING_OVERLAY:"_hide_loading_overlay",close:function(){actionManager.fireEvent(PanelFormHelper.EVENT_CLOSE)},showLoadingOverlay:function(){actionManager.fireEvent(PanelFormHelper.EVENT_SHOW_LOADING_OVERLAY)},hideLoadingOverlay:function(){actionManager.fireEvent(PanelFormHelper.EVENT_HIDE_LOADING_OVERLAY)},getServerTimeoutHandler:function(a,b){return setTimeout(function(){AlertComponent.error(_("Host error, please retry later","board")),PanelFormHelper.hideLoadingOverlay(),a&&b&&b.call(a)},1e3*PanelComponent.AJAX_TIMEOUT)}}}),PanelFormNote=Class(Component,{$statics:{MODE_QUICK_CREATE:"MODE_QUICK_CREATE",MODE_ADVANCED_CREATE:"MODE_ADVANCED_CREATE",MODE_CREATE_BOARD:"MODE_CREATE_BOARD",MODE_EDIT:"MODE_EDIT",MODE_COPY_NOTE:"MODE_COPY_NOTE",NOTE_CREATED_ALERT_TIMEOUT:6e4},constructor:function(a,b){this.name="panel_form_note",this.note=b||new NoteModel,this.boardSelector=new PanelFormBoardSelector(this.note),this.boardCreator=new PanelFormBoard(PanelFormBoard.MODE_CREATE),this.mode=this.previousMode=a||PanelFormNote.MODE_QUICK_CREATE,this.userHasBoards=!0,_super(this)},initState:function(){return{mode:this.mode}},getReadyToRender:function(){var a=new promise.Promise,b=this;return PanelFormNote.MODE_QUICK_CREATE===this.mode||PanelFormNote.MODE_COPY_NOTE===this.mode?this.boardSelector.getReadyToRender().then(function(c,d){d&&!d.userHasBoards&&(b.switchMode({mode:PanelFormNote.MODE_CREATE_BOARD}),b.userHasBoards=d.userHasBoards),a.done(c)}):a.done(!1),a},switchMode:function(a){if(a.mode)if(this.previousMode=this.mode,this.mode=a.mode,PanelFormNote.MODE_ADVANCED_CREATE==a.mode){PanelFormHelper.showLoadingOverlay();var b=this;NoteModel.getPreview(this.note.originalDescription).then(function(a,c){PanelFormHelper.hideLoadingOverlay(),a?AlertComponent.error(_("An error has occurred while trying to preview the note","note creator")):(c.data.board_name=b.boardSelector.getSelectedBoardName(),b.receiveData(NoteModel.validateNoteContent(c.data)),b.setState(new State({mode:b.mode})))})}else if(PanelFormNote.MODE_QUICK_CREATE==a.mode||PanelFormNote.MODE_COPY_NOTE==a.mode){var b=this;PanelFormHelper.showLoadingOverlay(),this.getReadyToRender().then(function(c){PanelFormHelper.hideLoadingOverlay(),c||b.setState(new State({mode:a.mode}))})}else this.setState(new State({mode:this.mode}))},receiveData:function(a){for(var b in a)this.note[b]=a[b];if(this.note.title&&(this.note.title=decodeHTMLEntities(this.note.title)),this.note.description&&(this.note.description=decodeHTMLEntities(this.note.description)),a.board&&(this.note.board_id=a.board.id||null,this.note.board_name=a.board.name||a.board_name||""),this.note.image_src=void 0,this.note.image_key=void 0,void 0!==this.note.images&&0<this.note.images.length)if(""==this.note.media)this.note.image_src="",this.note.image_key="";else{var c=this.note.images.filter(function(a){return a.active});0==c.length?(this.note.image_src=this.note.images[0].src,this.note.image_key=this.note.images[0].key):(this.note.image_src=c[0].src,this.note.image_key=c[0].key)}},selectThumbnail:function(a){this.note.image_src=a.image_src,this.note.image_key=a.image_key,Array.prototype.slice.call($(".panel_form_note__thumbnail",$i(this.id))).map(function(b){b.id===a.key?addClass(b,"panel_form_note__thumbnail--selected"):removeClass(b,"panel_form_note__thumbnail--selected")})},submit:function(){if(!this.note.isFormValid())return!1;this.mode==PanelFormNote.MODE_EDIT?this.updateNote():-1!==[PanelFormNote.MODE_QUICK_CREATE,PanelFormNote.MODE_ADVANCED_CREATE,PanelFormNote.MODE_COPY_NOTE].indexOf(this.mode)?this.createNote():PanelFormNote.MODE_CREATE_BOARD==this.mode&&this.createBoard()},updateNote:function(){PanelFormHelper.showLoadingOverlay();var a=PanelFormHelper.getServerTimeoutHandler();this.note.update(this.note).then(function(b){clearTimeout(a),PanelFormHelper.hideLoadingOverlay(),b?AlertComponent.error(_("An error has occurred while trying to edit the note","note editor")):(AlertComponent.success(_("Note successfully edited","note editor")),actionManager.fireEvent(EventHelper.EVENT_NOTE_UPDATED),PanelFormHelper.close())})},createBoard:function(){if(!this.boardCreator.board.isFormValid())return!1;var a=this;this.boardCreator.createBoard().then(function(b){!b&&a.previousMode?(a.userHasBoards=!0,a.switchMode({mode:a.previousMode})):a.boardCreator.handleBoardCreationError(b)})},createNote:function(){this.note.board_id=this.boardSelector.getSelectedBoardId(),PanelFormHelper.showLoadingOverlay();var a=this,b=PanelFormHelper.getServerTimeoutHandler();this.note.create(this.note).then(function(c,d){clearTimeout(b),PanelFormHelper.hideLoadingOverlay(),!c&&!d.error&&d.data.board&&d.data.note&&(PanelFormNote.MODE_COPY_NOTE==a.mode?actionManager.fireEvent(EventHelper.EVENT_NOTE_COPIED,{boardSlug:d.data.board.board_slug}):actionManager.fireEvent(EventHelper.EVENT_NOTE_CREATED,{boardSlug:d.data.board.board_slug,noteUrl:d.data.note.url}),PanelFormHelper.close())})}}),PanelComponent=Class(Component,{$statics:{AJAX_TIMEOUT:10},constructor:function(){this.name="panel";var a=this;window.addEventListener("popstate",function(){a.close.call(a)}),_super(this)},open:function(a,b){addClass($i(this.id),"panel--visible");var c=new State;c.addProperty("panelContent",b),c.addProperty("loading",!0),this.setState(c),this.showOverlay();var d=this,e=promise.join([a,b.getReadyToRender()]),f=PanelFormHelper.getServerTimeoutHandler(this,this.handleLoadingError);e.then(function(a){clearTimeout(f);var c=!0;if(a.map(function(a){var d=a[0],e=a[1]||null;d&&(c=!1),null!==e&&b.receiveData(e.data)}),c){var e=new State;e.addProperty("panelContent",b),actionManager.onCustomEvent(d,PanelFormHelper.EVENT_CLOSE,d.close,{isPersistant:!0}),actionManager.onCustomEvent(d,PanelFormHelper.EVENT_SHOW_LOADING_OVERLAY,d.showLoadingOverlay,{isPersistant:!0}),actionManager.onCustomEvent(d,PanelFormHelper.EVENT_HIDE_LOADING_OVERLAY,d.hideLoadingOverlay,{isPersistant:!0}),d.setState(e)}else d.handleLoadingError()})},showLoadingOverlay:function(){var a=this.state;a.addProperty("loading",!0),this.setState(a);var b=getComputed($i(this.state.panelContent.id),"height")+180;getComputed($i(this.id),"height")<b&&($(".panel__loading_overlay")[0].style.height=b.toString()+"px")},hideLoadingOverlay:function(){var a=this.state;a.addProperty("loading",!1),this.setState(a)},showOverlay:function(){var a=$(".panel_overlay")[0];a.style.display="block",setTimeout(function(){a.style.opacity="1"},10),$("body")[0].style.overflow="hidden",$("body")[0].style.maxHeight="100vh",window.addEventListener("keyup",this.handleKeys)},hideOverlay:function(){var a=$(".panel_overlay")[0];a.style.opacity="0",a.style.display="none",$("body")[0].style.maxHeight="none",$("body")[0].style.overflow="auto",window.removeEventListener("keyup",this.handleKeys)},close:function(){removeClass($i(this.id),"panel--visible"),this.hideOverlay()},handleLoadingError:function(){removeClass($i(this.id),"panel--visible"),this.hideOverlay()},handleKeys:function(a){27===a.keyCode&&PanelFormHelper.close()}}),RegexHelper=Class({$statics:{LETTERS:"A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢲऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛱ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",validateUrl:function(a){return/^(http(s)?:\/\/)?[a-z0-9-]+\.(.[a-z0-9-]+)*(:[0-9]+)?(\/.*)?$/.test(a)},validateGenericName:function(a){return new RegExp("^["+RegexHelper.LETTERS+"0-9- _,']+$").test(a.trim())},escapeRegExp:function(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}}),SearchSelectorComponent=Class(Component,{constructor:function(a,b,c){this.name="search_selector",this.oldValue="";try{this.args=this.checkArgs(a,b,c)}catch(a){throw a}_super(this),this.args.input.addEventListener("keyup",this.searchInList.bind(this,!1))},checkArgs:function(a,b,c){var d=[];if(!(a instanceof HTMLElement))throw"Incorrect use of SearchSelector : input must be a HTMLElement";if(d.input=a,!(b instanceof NodeList))throw"Incorrect use of SearchSelector : list must be a NodeList of HTMLElements";if(d.list=b,!(c instanceof Function))throw"Incorrect use of SearchSelector : checkerFunction must be a Function";return d.function=c,d},searchInList:function(a){var b=this.args.input.value,c=0;!0===a&&(b=this.oldValue);for(var d=0;d<this.args.list.length;++d)!1===this.args.function(b,this.args.list[d])?(addClass(this.args.list[d],"hidden"),c++):removeClass(this.args.list[d],"hidden");this.oldValue=b}}),TooltipComponent=Class(Component,{$statics:{changeContent:function(a){a.it.setState({message:a.message})},placeTooltip:function(a){var b=a.it.id,c=a.componentId,d=$i("tooltip--"+b),e=a.idChanged?$("."+c)[0]:$i(c),f=document.documentElement.clientHeight,g=document.documentElement.clientWidth,h=e.getBoundingClientRect().top,i=e.getBoundingClientRect().left;removeClass(d,"bottom"),removeClass(d,"top"),removeClass(d,"right"),removeClass(d,"left"),h>f/2?(d.style.top=h-d.clientHeight-15+"px",addClass(d,"bottom")):(d.style.top=h+e.clientHeight+15+"px",addClass(d,"top")),i>g/2?(d.style.left=i-d.clientWidth-15+"px",addClass(d,"right")):(d.style.left=i+e.clientWidth+15+"px",addClass(d,"left"))}},constructor:function(a,b){this.name="tooltip",this.args=null,this.scrollListener=null;try{this.args=this.checkArgs(a,b)}catch(a){throw a}_super(this);var c=this;a.hover=function(d,e,f){var g={it:c,parent:a,componentId:c.args.parent.id,alreadyGotId:f,message:d||b};return e&&(g.componentId=e,g.idChanged=!0),c.scrollListener=actionManager.addScrollListener(a,c.hideTooltip,g),actionManager.addHoverListener(a,c.displayTooltip,c.hideTooltip,g)}},checkArgs:function(a,b){var c=[];if(!(a instanceof Object))throw"Incorrect use of Tooltip : parent must be an Object";if(c.parent=a,!(void 0!==b&&0<b.length))throw"Incorrect use of Tooltip : content must be a string";return c.content=b,c},initState:function(){return{message:""}},displayTooltip:function(a){TooltipComponent.changeContent(a),TooltipComponent.placeTooltip(a);var b=$i("tooltip--"+a.it.id);addClass(b,"active")},hideTooltip:function(a){var b=$i("tooltip--"+a.it.id);removeClass(b,"active"),this.scrollListener=null}}),AjaxManager=Class({$statics:{_API_ERROR:[101,102,104,105,106,108,109,111,113,114,304,1103],_HTTP_STATUS:[429],_API_ALLOWED_ERROR:[5,7,15,103,110,112,201,401,402,1102,1104,1301],ajax:function(a,b,c,d){var e=new promise.Promise,f=this,g=Ajax[a](b,c,d);return g.then(function(a,b,c){if(c&&c.status&&AjaxManager._HTTP_STATUS.indexOf(c.status)>-1){try{var d=JSON.parse(c.response)}catch(a){var d=null}var g=!(!d||!d.error)&&d.error;g&&f.hasOwnProperty("http_status_"+c.status)&&AjaxManager["http_status_"+c.status](g)}if(b&&b.error)AjaxManager._API_ERROR.indexOf(b.error)>-1&&f.hasOwnProperty("api_error_"+b.error)?AjaxManager["api_error_"+b.error]():-1===AjaxManager._API_ALLOWED_ERROR.indexOf(b.error)&&(AjaxManager.api_error_default(),c&&c.responseURL&&-1===c.responseURL.indexOf("api/action")&&LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"userInteraction",event:"display",zone:c.responseURL,component:"alert",context:"true",t:"default",locale:applicationState.user.userSetting.getLocalisedSearchRegionCode()}));else if(b&&void 0!==b.session_active&&!b.session_active){applicationState.user=new UserModel;var h=Application.rootComponent.state.header;h.setState(new State({user:applicationState.user,userDropDown:h.getUserDropDown()})),applicationState.user.changeLang(LanguageHelper.getCorrespondingInterfaceLanguage(detectedLanguage)),AlertComponent&&AlertComponent.error&&AlertComponent.component&&AlertComponent.error(_('We\'re sorry, your session has expired. You can <a href="/login">reconnect</a> or continue your activity',"alert"))}e.done(a,b)}),e.abort=g.abort,e},get:function(a,b,c){return AjaxManager.ajax("get",a,b,c)},post:function(a,b,c){return AjaxManager.ajax("post",a,b,c)},api_error_101:function(){actionManager.fireEvent(UserModel.EVENT_INVALID_SESSION),AlertComponent&&AlertComponent.error&&AlertComponent.component&&AlertComponent.error(_('We\'re sorry, your session has expired. You can <a href="/login">reconnect</a> or continue your activity',"alert"))},api_error_102:function(){AlertComponent&&AlertComponent.error&&AlertComponent.component&&AlertComponent.error(_("Your account is not activated yet. Please refer to your legal representative.","alert"))},api_error_104:function(){AlertComponent&&AlertComponent.error&&AlertComponent.component&&AlertComponent.error(_("Maximum number of login attempts reached. Please try again in a few minutes.","alert"))},api_error_105:function(){AlertComponent&&AlertComponent.error&&AlertComponent.component&&AlertComponent.error(_("The login or password you entered is incorrect. ","alert"))},api_error_106:function(){AlertComponent&&AlertComponent.error&&AlertComponent.component&&AlertComponent.error(_("Invalid password","user"))},api_error_108:function(){AlertComponent&&AlertComponent.error&&AlertComponent.component&&AlertComponent.error(_('The given token has expired. Please click <a href="{lostPasswordUrl}">here</a> to get a new one.',"alert",{lostPasswordUrl:UrlFactory.getLostPasswordUrl()}))},api_error_109:function(){AlertComponent&&AlertComponent.error&&AlertComponent.component&&AlertComponent.error(_("The given email address is not allowed for registration","user"))},api_error_111:function(){AlertComponent&&AlertComponent.error&&AlertComponent.component&&AlertComponent.error(_("Your account has been disabled due to a removal request.","alert"))},api_error_113:function(){AlertComponent&&AlertComponent.error&&AlertComponent.component&&AlertComponent.error(_("This e-mail address is already yours","alert"))},api_error_114:function(){AlertComponent&&AlertComponent.error&&AlertComponent.component&&AlertComponent.error(_("For security reasons, you must wait 12 hours before making a new request.","alert"))},api_error_304:function(){AlertComponent&&AlertComponent.error&&AlertComponent.component&&AlertComponent.error(_("A note with the same URL already exists in this board","alert"))},api_error_1103:function(){Dispatcher.history.goTo(1)},api_error_default:function(){AlertComponent&&AlertComponent.error&&AlertComponent.component&&AlertComponent.error(_("Host error, please retry later","alert"))},http_status_429:function(a){Dispatcher&&Dispatcher.route&&Dispatcher.route.path&&"anti_robot"!==Dispatcher.route.path&&(AntiRobotComponent.lastPage=Dispatcher.route.path),page("/anti_robot")}}}),EventHelper=Class({$statics:{EVENT_NOTE_CREATED:"note_created",EVENT_NOTE_COPIED:"note_copied",EVENT_NOTE_UPDATED:"note_updated",EVENT_NOTE_DELETED:"note_deleted",EVENT_BOARD_UPDATED:"board_updated",EXTENSION_LOGIN:"qwant_extension_login",EXTENSION_LOGOUT:"qwant_extension_logout",SEARCHBAR_SUGGEST_ON:"searchbar_suggest_on",SEARCHBAR_SUGGEST_OFF:"searchbar_suggest_off",SUGGESTER_CREATED:"suggester_created",SUGGESTER_CLICKED:"suggester_click",SUGGESTER_DISPLAYED:"suggester_displayed",CAUSE_SEARCHBAR_SUGGEST_ON:"cause_searchbar_suggest_on",CAUSE_SEARCHBAR_SUGGEST_OFF:"cause_searchbar_suggest_off",CAUSE_SUGGESTER_CREATED:"cause_suggester_created",CAUSE_SUGGESTER_CLICKED:"cause_suggester_click",CAUSE_SUGGESTER_DISPLAYED:"cause_suggester_displayed",IA_SUGGESTER_CREATED:"ia_suggester_created",IA_SUGGESTER_CLICKED:"ia_suggester_click",IA_SEARCH_BAR_NEW_QUERY:"ia_search_bar_new_query"}}),FormHelper=Class({$statics:{disableSubmitButton:function(){$("[type=submit]")[0].disabled=!0},enableSubmitButton:function(){$("[type=submit]")[0].disabled=!1}}}),LanguageHelper=Class({$statics:{loadLanguageFile:function(a){return document.documentElement.setAttribute("lang",a.code.substr(0,2)),getScript("js/lang/"+a.code+".js?"+(new Date).getTime())},getContinent:function(a){return constants.AvailableRegions.continents[a]},getContinents:function(){return constants.AvailableRegions.continents},getCountry:function(a){return constants.AvailableRegions.countries[a]||null},getCountries:function(){return constants.AvailableRegions.countries},getLanguage:function(a){return constants.AvailableRegions.languages[a]},getLanguages:function(){return constants.AvailableRegions.languages},getContinentCountries:function(a){for(var b=constants.AvailableRegions.continents[a].countries,c=constants.AvailableRegions.countries,d=[],e=0;e<b.length;e++)c[b[e]]&&d.push(c[b[e]]);return d},getCountryLanguages:function(a){var b=constants.AvailableRegions.languages,c=[];for(var d in b)for(var e=0;e<b[d].countries.length;e++)b[d].countries[e]===a&&c.push(b[d]);if("AD"===a){var f=["ca","es","pt","fr"],g=[];f.forEach(function(a){c.forEach(function(b){b.code===a&&g.push(b)})}),c=g}return c},getCorrespondingInterfaceLanguage:function(a){var b=constants.AvailableLanguages;for(var c in b)if(2==a.length&&b[c].shorthand===a||5==a.length&&b[c].code===a)return b[c];return!1},getContinentFromCountry:function(a){var b=constants.AvailableRegions.continents;for(var c in b)if(-1!==b[c].countries.indexOf(a))return c},isCountryInContinent:function(a,b){return-1!==constants.AvailableRegions.continents[b].countries.indexOf(a)},isSupportedLocale:function(a){var b=a.split("_"),c=this.getLanguage(b[0]);return c&&c.countries&&-1!==c.countries.indexOf(b[1])},
getFirefoxConversion:function(){return constants.FirefoxLanguageConversion[applicationState.user.userSetting.getInterfaceLanguageCode()]||"en-US"}}}),PromiseHelper=Class({$statics:{joinWithPageRendered:function(a){var b=new promise.Promise;actionManager.onCustomEvent(PromiseHelper,"pageRendered",function(){b.done()});var c=new promise.Promise;return promise.join([b,a]).then(function(a){void 0!==a[1]&&void 0!==a[1][0]?void 0!==a[1][1]?c.done(a[1][0],a[1][1]):c.done(a[1][0]):c.done(!0,null)}),c}}}),SecurityHelper=Class({$statics:{targetBlank:function(){var a='rel="noopener"';return applicationState.user.userSetting.targetBlank&&(a+=' target="_blank"'),(hasClass($("body")[0],"libertyBrowser")||hasClass($("body")[0],"native")&&!1===hasClass($("body")[0],"native--v1.0"))&&(a=""),a},escape:function(a){var b=/[&<>"'` !@$%()=+{}[\]]/g;return a.replace(b,function(a){return"&#"+a.charCodeAt(0)+";"})},escapeXSS:function(a){var b=/[&<>"@$%=+{}[\]]/g;return a.replace(b,function(a){return"&#"+a.charCodeAt(0)+";"})},deepCopy:function(a,b){return Object.keys(b).forEach(function(c){a[c]=b[c]}),a}}}),UrlFactory=Class({$statics:{URL_PARAM_TOS_APP:"a",getTosUrlForApp:function(a){return _("https://about.qwant.com/legal/terms-of-service/qwant-{app}/","tos",{app:a})},getLostPasswordUrl:function(){return siteConfiguration.url.SEARCH+"password_lost"}}}),AntiRobotModel=Class(Model,{constructor:function(){_super(this)},get:function(){return AjaxManager.get(ajax.anti_robot.get())},resolve:function(a,b){return AjaxManager.post(ajax.anti_robot.resolve(),new AjaxParameters({id:a,x:b.x,y:b.y}).getParameters())}}),BoardModel=Class(Model,{$statics:{STATUS_PRIVATE:!1,STATUS_PUBLIC:!0,LOCAL_BOARD_ARRAY:["private","public"],DEFAULT_BOARD_STATUS:!1,DEFAULT_CATEGORY_ID:31,CATEGORY_ADULT:69,COMMENTS_ENABLED:!0,COMMENTS_DISABLED:!1,categories:[{id:-1,label:"All",i18n:function(){return _("All","category")}},{id:69,label:"Adult",i18n:function(){return _("Adult","category")}},{id:10,label:"Animals",i18n:function(){return _("Animals","category")}},{id:6,label:"Architecture and decoration",i18n:function(){return _("Architecture and decoration","category")}},{id:2,label:"Art",i18n:function(){return _("Art","category")}},{id:11,label:"Automobile - Motorcycle",i18n:function(){return _("Automobile - Motorcycle","category")}},{id:12,label:"Beauty",i18n:function(){return _("Beauty","category")}},{id:19,label:"Culture",i18n:function(){return _("Culture","category")}},{id:14,label:"Entrepreneur",i18n:function(){return _("Entrepreneur","category")}},{id:7,label:"Fashion",i18n:function(){return _("Fashion","category")}},{id:9,label:"Gastronomy",i18n:function(){return _("Gastronomy","category")}},{id:15,label:"Geek",i18n:function(){return _("Geek","category")}},{id:29,label:"Health and well-being",i18n:function(){return _("Health and well-being","category")}},{id:24,label:"High-Tech",i18n:function(){return _("High-Tech","category")}},{id:25,label:"Hobbies",i18n:function(){return _("Hobbies","category")}},{id:3,label:"Humor",i18n:function(){return _("Humor","category")}},{id:27,label:"Illustration",i18n:function(){return _("Illustration","category")}},{id:8,label:"Job",i18n:function(){return _("Job","category")}},{id:13,label:"Kids",i18n:function(){return _("Kids","category")}},{id:18,label:"Marketing",i18n:function(){return _("Marketing","category")}},{id:28,label:"Movies and TV shows",i18n:function(){return _("Movies and TV shows","category")}},{id:26,label:"Music",i18n:function(){return _("Music","category")}},{id:16,label:"Nature",i18n:function(){return _("Nature","category")}},{id:4,label:"News",i18n:function(){return _("News","category")}},{id:1,label:"People",i18n:function(){return _("People","category")}},{id:5,label:"Politics",i18n:function(){return _("Politics","category")}},{id:23,label:"Sciences",i18n:function(){return _("Sciences","category")}},{id:70,label:"Sexy",i18n:function(){return _("Sexy","category")}},{id:22,label:"Society",i18n:function(){return _("Society","category")}},{id:21,label:"Sport",i18n:function(){return _("Sport","category")}},{id:20,label:"Travel",i18n:function(){return _("Travel","category")}},{id:17,label:"Video Games",i18n:function(){return _("Video Games","category")}},{id:30,label:"Web",i18n:function(){return _("Web","category")}},{id:31,label:"Others",i18n:function(){return _("Others","category")}}],getCategoryFromId:function(a){var b={id:31,label:"Others",i18n:function(){return _("Others","category")}};return BoardModel.categories.forEach(function(c){c.id===a&&(b=c)}),b},getLocalizedCategoryFromLabel:function(a){var b="";return BoardModel.categories.forEach(function(c){c.label===a&&(b=c.i18n())}),b},getAlphabeticallyOrderedCategories:function(a){var b=this.categories.slice(0),c={idx:0,item:null},d={idx:0,item:null},e={idx:0,item:null},f=!1;b.sort(function(a,b){return a.i18n()>b.i18n()?1:a.i18n()<b.i18n()?-1:0}),b.forEach(function(a,d){-1!==a.id||f||(c.idx=d,c.item=a,b.splice(c.idx,1),b.unshift(c.item),f=!0)}),f=!1,b.forEach(function(c,d){69!==c.id||f||(e.idx=d,e.item=c,b.splice(e.idx,1),!0===a&&b.push(e.item),f=!0)}),f=!1,b.forEach(function(a,c){31!==a.id||f||(d.idx=c,d.item=a,b.splice(d.idx,1),b.push(d.item),f=!0)});var g=config_get("restricted.categories");return b.forEach(function(a,c){!g||69!==a.id&&70!==a.id||b.splice(c,1)}),b},getCurrentUserBoards:function(){return AjaxManager.get(ajax.boards.getFlatList(),{session_token:applicationState.user.token})},updateBoardCover:function(a,b){return AjaxManager.post(ajax.boards.cover(),new AjaxParameters({session_token:applicationState.user.token,note_id:a,board_id:b}).getParameters())},validateBoardName:function(a){return RegexHelper.validateGenericName(a.event.target.value)},isBoardFollowedByCurrentUser:function(a){if(applicationState.user.isLogged&&applicationState.user.boards&&applicationState.user.boards.followed)return-1!==applicationState.user.boards.followed.indexOf(parseInt(a))},validateBoardContent:function(a){a=a||{};var b={id:parseInt(a.board_id)||a.id||0,slug:a.board_slug||a.slug||"",name:a.board_name||a.name||"",description:a.board_description||a.description||"",category:parseInt(a.board_category)||a.category||BoardModel.DEFAULT_CATEGORY_ID,cover:a.board_preview_blur||"",thumbnail:a.board_thumbnail||a.thumbnail||"",statFollow:parseInt(a.board_statFollow)||a.statFollow||0,statView:parseInt(a.board_statView)||a.statView||0,statBookmark:parseInt(a.board_statBookmark)||a.statBookmark||0,status:parseInt(a.board_status)||a.status||BoardModel.DEFAULT_BOARD_STATUS,commentsAllowed:"1"===a.board_comments?BoardModel.COMMENTS_ENABLED:BoardModel.COMMENTS_DISABLED,editable:applicationState.user.username==(a.board_user_username||""),followers:a.followers||[],userAvatar:a.board_user_avatar||a.userAvatar||"",userName:a.board_user_username||a.userName||"",notes:[]};return 0===b.category&&(b.category=BoardModel.DEFAULT_CATEGORY_ID),void 0!==a.notes&&a.notes.forEach(function(a){b.notes.push(NoteModel.validateNoteContent(a,b,{}))}),b},validateBoards:function(a){var b=[];return a.map(function(a){b.push(BoardModel.validateBoardContent(a))}),b}},constructor:function(a,b,c,d){this.searchPhrase=a,this.category=b||BoardModel.DEFAULT_CATEGORY_ID,this.filter=c,this.page=d,this.status=BoardModel.DEFAULT_BOARD_STATUS,_super(this)},all:function(){var a={count:configuration.boardsPerPage};if(this.searchPhrase&&(a.q=this.searchPhrase),this.category){var b=-1,c=this.category;BoardModel.categories.forEach(function(a){a.label===c&&(b=a.id)}),b&&-1!=b&&(a.category=b)}return this.filter&&(a.filter=this.filter),this.page&&(a.offset=(this.page-1)*configuration.boardsPerPage),applicationState.user&&applicationState.user.token&&(a.session_token=applicationState.user.token),AjaxManager.get(ajax.boards.all(),a)},get:function(a,b,c){var d="";applicationState.user.isLogged&&(d=applicationState.user.token);var e=0;return c&&(e=(c-1)*configuration.boardNotesPerPage),AjaxManager.get(ajax.boards.get(),{userName:a,boardSlug:b,session_token:d,offset:e,count:configuration.boardNotesPerPage})},categories:function(){return AjaxManager.get(ajax.boards.categories)},publicBoards:function(){var a={count:configuration.boardsPerPage};return this.page>0&&(a.offset=(this.page-1)*configuration.boardsPerPage),a.session_token=applicationState.user.token,a.status=constants.BOARD_STATUS.PUBLIC,AjaxManager.get(ajax.boards.followed(),a)},privateBoards:function(){var a={count:configuration.boardsPerPage};return this.page>0&&(a.offset=(this.page-1)*configuration.boardsPerPage),a.session_token=applicationState.user.token,a.status=constants.BOARD_STATUS.PRIVATE,AjaxManager.get(ajax.boards.followed(),a)},followedList:function(a){var b={count:configuration.boardsPerPage};return this.page>0&&(b.offset=(this.page-1)*configuration.boardsPerPage),b.session_token=applicationState.user.token,b.status=constants.BOARD_STATUS.FOLLOWED,AjaxManager.get(ajax.boards.followed(),b)},follow:function(a){var b=new promise.Promise;return AjaxManager.post(ajax.boards.follow(),{session_token:applicationState.user.token,board:a}).then(function(a,c){!a&&c.data.boards&&c.data.notes?(applicationState.user.boards=c.data.boards,applicationState.user.notes=c.data.notes,Model.store("user",applicationState.user),b.done(!1)):b.done(!0)}),b},unfollow:function(a){var b=new promise.Promise;return AjaxManager.post(ajax.boards.unfollow(),{session_token:applicationState.user.token,board:a}).then(function(a,c){!a&&c.data.boards&&c.data.notes?(applicationState.user.boards=c.data.boards,applicationState.user.notes=c.data.notes,Model.store("user",applicationState.user),b.done(!1)):b.done(!0)}),b},create:function(a){var b={};return b.session_token=applicationState.user.token,b.board_category=a.category,b.board_description=a.description||"",b.board_name=a.name,b.board_status=a.status?1:0,AjaxManager.post(ajax.boards.create(),b)},update:function(a){var b={};return b.session_token=applicationState.user.token,b.board_category=a.category,b.board_description=a.description,b.board_name=a.name,b.board_status=a.status?1:0,b.board_slug=a.slug,b.board_comments=void 0===a.enable_comments?1:a.enable_comments?1:0,AjaxManager.post(ajax.boards.update(),b)},delete:function(a){return AjaxManager.post(ajax.boards.delete(),{session_token:applicationState.user.token,board:a.id})},mapJSONFields:function(a){this.board_name=a.board_name,this.board_description=a.board_description,this.board_status=1!=a.board_status,this.board_id=a.board_id},getFollowers:function(a,b,c){return AjaxManager.get(ajax.boards.followers(),{session_token:applicationState.user.token,board_id:a,count:b,offset:c})}}),NoteModel=Class(Model,{$statics:{TYPE_URL:"url",TYPE_IMAGE:"image",TYPE_VIDEO:"video",TYPE_TEXT:"text",getUrlPicture:function(a){var b=a.split("."),c=constants.noteUrlBackground,d=c[a.charCodeAt(0)%(c.length-1)],e="";return b.forEach(function(a,b,c){0===b?e+='<span class="emphasis">'+a+"</span><span>":(e+=a,b===c.length-1?e+="</span>":e+=".")}),'<p class="note__url__img word-wrap" style="background:'+d+'">'+e+"</p>"},getPreview:function(a){return AjaxManager.get(ajax.notes.preview(),new AjaxParameters({content:a}).getParameters())},delete:function(a,b){return AjaxManager.post(ajax.notes.delete(),new AjaxParameters({session_token:applicationState.user.token,note_id:a,board_id:b}).getParameters())},like:function(a,b){var c=new promise.Promise;return AjaxManager.post(ajax.notes.like(),new AjaxParameters({session_token:applicationState.user.token,note_id:b,board_id:a,like_status:1}).getParameters()).then(function(a,b){!a&&b.data.boards&&b.data.notes?(applicationState.user.boards=b.data.boards,applicationState.user.notes=b.data.notes,Model.store("user",applicationState.user),c.done(!1)):c.done(!0)}),c},validateNoteContent:function(a,b,c){return a=a||{},b=b||{},c=c||{},{id:parseInt(a.id)||0,type:a.type||"text",title:void 0===a.title?"":a.title,dateCreate:a.dateCreate||0,description:a.description||"",descriptionShort:a.descriptionShort||"",searchItemId:a.searchItemId||parseInt(a.searchitem_id)||0,domain:a.domain||"",url:a.url||"",media:a.media||"",mediaSmall:a.mediaSmall||"",mediaSource:a.mediaSource||"",mediaType:a.mediaType||"",mediaAnimated:a.mediaAnimated||"",images:a.images||[],image_src:a.image_src||"",image_key:a.image_key||"",nbComments:parseInt(a.nb_comments)||0,nbLikes:parseInt(a.nb_likes)||0,comments:a.comments||[],likes:a.likes||[],board:{id:parseInt(b.id)||parseInt(a.boardId)||b.id||0,name:b.name||a.boardName||b.name||a.board_name||"",slug:b.slug||a.boardSlug||b.slug||"",category:parseInt(b.category)||parseInt(a.boardCategory)||b.category||BoardModel.DEFAULT_CATEGORY_ID,status:b.status||a.boardStatus||b.status||BoardModel.DEFAULT_BOARD_STATUS,editable:b.editable||!1,commentsAllowed:b.commentsAllowed===BoardModel.COMMENTS_ENABLED?BoardModel.COMMENTS_ENABLED:BoardModel.COMMENTS_DISABLED},user:{name:c.username||a.boardUserName||"",id:c.userId||a.boardUserId||0,avatar:c.avatar||a.boardUserAvatar||""}}}},all:function(){var a={count:configuration.homeNotesPerPage};if(this.searchPhrase&&(a.q=this.searchPhrase),this.category){for(var b=0,c=0;c<constants.noteTypes.length;c+=1){var d=constants.noteTypes[c];if(this.category===d.label){b=d.id;break}}a.category=b}return this.filter&&(a.filter=this.filter),this.page&&(a.offset=(this.page-1)*configuration.homeNotesPerPage),void 0!==this.followed&&(a.followed=1,a.session_token=applicationState.user.token),AjaxManager.get(ajax.notes.all(),a)},get:function(a,b,c){return AjaxManager.get(ajax.notes.get(),{id:a,session_token:applicationState.user.token,board_slug:b,username:c})},board:function(a,b){return AjaxManager.get(ajax.notes.board(),{board:a,offset:(b-1)*configuration.boardNotesPerPage,count:configuration.boardNotesPerPage})},bookmark:function(a){return AjaxManager.post(ajax.notes.bookmark,{note:a,token:applicationState.user.token})},constructor:function(a,b,c,d,e){this.searchPhrase=a,this.category=b,this.filter=c,this.page=d,this.followed=e,_super(this)},update:function(a){var b={};return b.session_token=applicationState.user.token,b.note_id=a.id,b.board_id=a.board_id,b.title=a.title,b.description=a.description,void 0!==a.image_src&&void 0!==a.image_key&&a.images&&a.images.length>0&&"image"!=a.type&&"video"!=a.type&&(b.image_src=a.image_src,b.image_key=a.image_key),AjaxManager.post(ajax.notes.update(),new AjaxParameters(b).getParameters())},create:function(a){var b={};return b.session_token=applicationState.user.token,a.title&&(b.title=a.title),a.description?b.description=a.description:a.searchItemId||(b.description=a.originalDescription),a.type&&(b.type=a.type),a.searchItemId&&(b.searchitem_id=a.searchItemId),void 0!==a.image_src&&void 0!==a.image_key&&(b.image_src=a.image_src,b.image_key=a.image_key),b.board_id=a.board_id||0,a.url&&(b.url=a.url),AjaxManager.post(ajax.notes.create(),b)}}),UserSettingsModel=Class(Model,{constructor:function(){var a,b,c,d=new Url(location.toString()).parseUrl();this.searchRegionKey=preferredRegion;for(a in userFields)b=userFields[a].getForcedValue(d),c=userFields[a].defaultValue(),void 0!==b?this[a]=b:void 0!=c&&(this[a]=c);this.continentKey=preferredContinent,this.searchLanguageKey=LanguageHelper.getCountryLanguages(this.searchRegionKey)[0].code;var e=LanguageHelper.getCountryLanguages(this.searchRegionKey),f=this;e.forEach(function(a){0==detectedLanguage.indexOf(a.code)&&(f.searchLanguageKey=a.code)});var g=d.rawQuery.sr;e.forEach(function(a){g===a.code&&(f.searchLanguageKey=a.code)});var h={en:"en_gb",fr:"fr_fr",de:"de_de",co:"co_fr",br:"br_fr",es:"es_es",it:"it_it",pt:"pt_pt",nl:"nl_nl",ru:"ru_ru",pl:"pl_pl"},i=d.rawQuery.l;this.interfaceLanguageKey=h[i]?h[i]:detectedLanguage},getSearchLanguage:function(){return constants.AvailableRegions.languages[this.searchLanguageKey]||!1},getSearchLanguageCode:function(){return this.getSearchLanguage().code||!1},getSearchRegion:function(){return constants.AvailableRegions.countries[this.searchRegionKey]||!1},getSearchRegionCode:function(){return this.getSearchRegion().code||!1},getInterfaceLanguage:function(){return constants.AvailableLanguages[this.interfaceLanguageKey]||!1},getInterfaceLanguageCode:function(){return this.getInterfaceLanguage().code||"en_gb"},getContinent:function(){return constants.AvailableRegions.continents[this.continentKey]||!1},getLocalisedSearchRegionCode:function(){return this.searchLanguageKey+"_"+this.searchRegionKey},setSearchLanguage:function(a){this.searchLanguageKey=a,!1===LanguageHelper.getLanguage(a)&&(this.searchLanguageKey=detectedTerritory.split("_")[0])},setSearchRegion:function(a){this.searchRegionKey=a,!1===LanguageHelper.getCountry(a)&&(this.searchRegionKey=detectedTerritory.split("_")[1])},setSearchLocale:function(a){if(LanguageHelper.isSupportedLocale(a)){var b=a.split("_");this.setSearchLanguage(b[0].toLowerCase()),this.setSearchRegion(b[1].toUpperCase())}else this.searchLanguageKey=detectedTerritory.split("_")[0],this.searchRegionKey=detectedTerritory.split("_")[1]},setInterfaceLanguage:function(a){a&&(this.interfaceLanguageKey=LanguageHelper.getCorrespondingInterfaceLanguage(a).code)},setContinent:function(a){this.continentKey=a},toHostJson:function(a){return{settings_trends:parseInt(this.showTrends),settings_autocomplete:this.enableSuggest?"1":"0",settings_search_mode:1,settings_target_link:this.targetBlank?"1":"0",settings_shortlink_display:this.completeUrl?"0":"1",settings_safesearch:parseInt(this.safeSearch),settings_smart_news:this.showSmartNews?"1":"0",settings_smart_videos:this.showSmartVideos?"1":"0",settings_smart_social:this.showSmartSocial?"1":"0",settings_donation:this.enableDonationMode?"1":"0",settings_qoz:this.showQoz?"1":"0",settings_header_lang:this.showHeadLang?"1":"0",settings_header_favorites:this.showHeadBookmarks?"1":"0",settings_theme:this.selectedTheme&&parseInt(this.selectedTheme)||0,session_token:a.token,lang:this.getInterfaceLanguageCode()||"",country:this.getLocalisedSearchRegionCode()||""}},mapJSONFields:function(a){-1!==a.country.indexOf("_")?this.setSearchLocale(a.country):(null===LanguageHelper.getCountry(a.country)&&(a.country=detectedTerritory.split("_")[1]),this.setSearchRegion(a.country)),this.setContinent(LanguageHelper.getContinentFromCountry(this.getSearchRegionCode())),!1===LanguageHelper.getCorrespondingInterfaceLanguage(a.lang)&&(a.lang=detectedTerritory.split("_")[0]),this.setInterfaceLanguage(a.lang),this.showTrends=urlParams.showtrends||parseInt(a.settings_trends),this.enableSuggest="1"===a.settings_autocomplete,this.searchMode=1,this.targetBlank="1"===a.settings_target_link,this.completeUrl="0"===a.settings_shortlink_display,this.safeSearch=parseInt(a.settings_safesearch),this.showSmartNews="1"===a.settings_smart_news,this.showSmartVideos="1"===a.settings_smart_videos,this.showSmartSocial="1"===a.settings_smart_social,this.selectedTheme=a.settings_theme&&parseInt(a.settings_theme)||0,this.enableDonationMode="1"===a.settings_donation,this.showQoz="1"===a.settings_qoz,this.showHeadLang="1"===a.settings_header_lang,this.showHeadBookmarks="1"===a.settings_header_favorites},update:function(){var a=applicationState.user;Model.store("user",a);var b=new promise.Promise;if(a.isLogged){var c=this.toHostJson(a);AjaxManager.post(ajax.user.settings.save(),new AjaxParameters(c).getParameters()).then(function(a,c){c.error?b.done(c.error):b.done(!1,c)})}else b.done(!1);return b}}),UserModel=Class(Model,{$statics:{version:29,EVENT_AVATAR_UPDATE:"avatar_update",EVENT_INVALID_SESSION:"invalid_session",GETUSER_ERROR_LOGGED:!1,GETUSER_ERROR_UNLOGGED:!1,getModelClass:function(a){return a?new UserModel(a):new UserModel},getDuplicateModel:function(){return new UserModel({},!0)},getModelSettingsClass:function(){return new UserSettingsModel},getModelVersion:function(){return UserModel.version},login:function(a,b){var c=this,d=new promise.Promise;return AjaxManager.post(ajax.user.login(),new AjaxParameters({login:a,password:b}).getParameters()).then(function(a,b){if(null!==b)if("error"===b.status)d.done(b.error);else{var e=c.getModelClass(b);e.error&&d.done(e.error,e),d.done(!1,e)}else d.done(AJAX_STATUS.INVALID_JSON)}),d},getByName:function(a){var b="";return applicationState.user.isLogged&&(b=applicationState.user.token),AjaxManager.get(ajax.profile.get(),{userName:a,session_token:b})},getUser:function(){var a=this,b=new promise.Promise,c=Model.restore("user");actionManager.onCustomEvent(UserModel,UserModel.EVENT_AVATAR_UPDATE,UserModel.updateUserAvatar,{isPersistant:!0});var d=function(){var c=null;try{c=JSON.parse(localStorage.getItem("user"))}catch(a){}null!==c&&(c.isLogged?UserModel.GETUSER_ERROR_LOGGED=!0:UserModel.GETUSER_ERROR_UNLOGGED=!0),Model.remove("user");var d=a.getModelClass();b.done(d)};return c.then(function(c){if(c)if(c.error)d();else if(c.version==a.getModelVersion()||c.isLogged)try{jsface.extend(c,UserModel),jsface.extend(c.userSetting,UserSettingsModel),a.restoreFromUrl(c),b.done(c)}catch(a){d()}else d()}),b},updateUserAvatar:function(a,b){b&&b.imgUrl&&(applicationState.user.avatar=b.imgUrl,applicationState.user.avatarData=b.img64),Model.store("user",applicationState.user)},logout:function(a){var b=new promise.Promise;a=void 0===a||a;var c;if(Model.remove("user"),Model.remove("userExtension"),a){var d=applicationState.user.token;c=AjaxManager.post(ajax.user.logout(),{session_token:d})}else c=new promise.Promise,c.done();var e=UserModel;return applicationState.user=new e,c.then(function(){var a=Application.rootComponent.state.header;return a.state.user=applicationState.user,a.state.userDropDown=a.getUserDropDown(),void 0!==Application.rootComponent.state.header.state.qozCount&&(a.state.qozCount=new QozCountComponent(applicationState.user.qoz_count)),a.setState(a.state),uxVersions.indexOf("v4")>-1&&Application.rootComponent.state.appMenu&&Application.rootComponent.state.appMenu.setState(Application.rootComponent.state.appMenu.state),setDisplayType({selectedTheme:applicationState.user.userSetting.selectedTheme}),applicationState.user.changeLang(LanguageHelper.getCorrespondingInterfaceLanguage(detectedLanguage))}).then(function(){Dispatcher.history.goTo(0),document.dispatchEvent(new CustomEvent("qwant_website_logout")),b.done()}),b},passwordLost:function(a){return AjaxManager.post(ajax.user.lostPassword(),new AjaxParameters({email:a}).getParameters())},getHeaderDropDownItems:function(){return[{label:_("My account","user"),value:"/account"},{label:_("Bookmarks","user"),value:FavoritesComponent.getPageUrl()},{label:_("Trends","user"),value:TrendsComponent.getPageUrl()},{label:_("Log out","header"),value:"/logout"}]},extensionLogin:function(){},restoreFromUrl:function(a){var b,c,d=new Url(location.toString()).parseUrl();for(b in userFields)c=userFields[b].getForcedValue(d),userFields[b].defaultValue(),void 0!==c&&(a.userSetting[b]=c);var e={en:"en_gb",fr:"fr_fr",de:"de_de",co:"co_fr",br:"br_fr",es:"es_es",it:"it_it",pt:"pt_pt",nl:"nl_nl",ru:"ru_ru",pl:"pl_pl"},f=d.rawQuery.l;f&&(a.userSetting.interfaceLanguageKey=detectedLanguage,e[f]&&(a.userSetting.interfaceLanguageKey=e[f]));var g=d.rawQuery.sr;if(void 0!==g&&/^\w\w$/.test(g)){var h=LanguageHelper.getCountryLanguages(a.userSetting.searchRegionKey);h.forEach(function(b){g==b.code&&(a.userSetting.searchLanguageKey=b.code)}),g||(a.userSetting.searchLanguageKey=h[0].code)}else g=void 0}},constructor:function(a,b){b||this.init(a),_super(this)},init:function(a){if(this.isLogged=!1,this.error=!1,this.userSetting=UserModel.getModelSettingsClass(),this.qoz_count=0,this.associations="",this.selected_asso=!1,a&&"string"==typeof a)try{a=JSON.parse(a)}catch(a){this.error=constants.AJAX_ERRORS.INVALID_JSON}this.version=this.getModelVersion(),void 0===a||a.error||(this.mapJSONFields(a.data),this.favorites=a.data.favorites,this.boards=a.data.boards,this.notes=a.data.notes,a.data.user&&a.data.user.username&&""!==a.data.user.username&&(this.isLogged=!0),a.data.user&&(a.data.user.qoz_count&&(this.qoz_count=a.data.user.qoz_count),a.data.user.associations&&(this.associations=a.data.user.associations),a.data.user.selected_asso&&(this.selected_asso=a.data.user.selected_asso))),Model.store("user",this)},index:function(a,b){var c={count:configuration.usersPerPage};return a&&(c.q=a),b&&(c.offset=(b-1)*configuration.usersPerPage),AjaxManager.get(ajax.user.getUsers(),c)},getPictureUrl:function(){return this.avatarData?this.avatarData:this.avatar},toHostJson:function(){return{firstname:this.firstname||"",lastname:this.lastname||"",userwebsite:this.website||"",city:this.location||"",userabout:this.about||"",notify_update:this.qwant_update,country:this.getSettings().getLocalisedSearchRegionCode()||"",lang:this.getSettings().getInterfaceLanguageCode()||"",password_last_modification:this.password_last_modification,qoz_count:this.qoz_count,associations:this.associations||"",selected_asso:this.selected_asso}},prepareRegistrationJson:function(){var a=1,b=1;return void 0!==this.userSetting.enableSuggest&&(a=this.userSetting.enableSuggest?"1":"0"),void 0!==this.userSetting.targetBlank&&(b=this.userSetting.targetBlank?"1":"0"),{email:this.email||"",firstname:this.firstname||"",lastname:this.lastname||"",username:this.username||"",password:this.password||"",password_confirmation:this.password_confirmation||"",notify_update:this.qwant_update?"1":"0",password_last_modification:this.password_last_modification||null,qoz_count:this.qoz_count||0,associations:this.associations||"",selected_asso:this.selected_asso||null,lang:this.getSettings().getInterfaceLanguageCode()||"",country:this.getSettings().getLocalisedSearchRegionCode()||"",settings_autocomplete:a,settings_target_link:b,settings_theme:0,settings_trends:isNaN(parseInt(this.userSetting.showTrends))?1:parseInt(this.userSetting.showTrends),settings_search_mode:isNaN(parseInt(this.userSetting.searchMode))?0:parseInt(this.userSetting.searchMode),settings_safesearch:isNaN(parseInt(this.userSetting.safeSearch))?1:parseInt(this.userSetting.safeSearch),settings_donation:isNaN(parseInt(this.userSetting.enableDonationMode))?1:parseInt(this.userSetting.enableDonationMode),settings_smart_news:isNaN(parseInt(this.userSetting.showSmartNews))?1:parseInt(this.userSetting.showSmartNews),settings_smart_videos:isNaN(parseInt(this.userSetting.showSmartVideos))?1:parseInt(this.userSetting.showSmartVideos),settings_smart_social:isNaN(parseInt(this.userSetting.showSmartSocial))?1:parseInt(this.userSetting.showSmartSocial),settings_qoz:isNaN(parseInt(this.userSetting.showQoz))?1:parseInt(this.userSetting.showQoz),settings_header_lang:isNaN(parseInt(this.userSetting.showHeadLang))?1:parseInt(this.userSetting.showHeadLang),settings_header_favorites:isNaN(parseInt(this.userSetting.showHeadBookmarks))?1:parseInt(this.userSetting.showHeadBookmarks)}},update:function(a){if(a=a||!1,this.version=this.getModelVersion(),Model.store("user",this),a||this.isLogged){var b=this.toHostJson();b.session_token=this.token;return AjaxManager.post(ajax.user.update(),new AjaxParameters(b).getParameters())}var c=new promise.Promise;return c.done(),c},saveProfilePicture:function(a){var b={session_token:this.token,uploadedImage:a};return AjaxManager.post(ajax.user.savePicture(),b)},updatePasswordTimeStamp:function(a){this.password_last_modification=a,Model.store("user",this)},register:function(){return AjaxManager.post(ajax.user.register(),new AjaxParameters(this.prepareRegistrationJson()).getParameters())},isUserAvailable:function(a){return AjaxManager.post(ajax.user.checkUserNameAvailability(),new AjaxParameters({username:a.event.target.value}).getParameters())},isEmailAvailable:function(a){return AjaxManager.post(ajax.user.checkEmailAddressAvailability(),new AjaxParameters({email:a.event.target.value}).getParameters())},doPasswordsMatch:function(a){var b;if(a.passwordField)b=a.passwordField;else if(a.passwordConfirmationField){if(""==$i(a.passwordConfirmationField).value)return!0;b=a.passwordConfirmationField}return a.event.target.value===$i(b).value},validateUrl:function(a){return RegexHelper.validateUrl(a.event.target.value)},validateName:function(a){return RegexHelper.validateGenericName(a.event.target.value)},unRegister:function(a){return AjaxManager.post(ajax.user.delete(),{password:a,session_token:this.token})},mapJSONFields:function(a){var b=a.user;this.token=a.session_token,this.avatar=b.avatar,this.email=b.email,this.username=b.username,this.firstname=htmlDecode(b.firstname),this.lastname=htmlDecode(b.lastname),this.website=b.userwebsite,this.about=htmlDecode(b.userabout),this.location=htmlDecode(b.city),this.qwant_update=b.notify_update,this.rateFlag=b.feature_user_rating,this.reportFlag=b.feature_report||0,this.qoz_count=b.qoz_count||0,this.associations=b.associations||"",this.selected_asso=b.selected_asso,this.password_last_modification=b.password_last_modification,this.userSetting.mapJSONFields(b),this.favorites=[],this.boards=b.boards||{public:[],private:[],followed:[]},this.notes=b.notes||{liked:[]}},getFlagName:function(){return 1===LanguageHelper.getCountryLanguages(this.getSettings().getSearchRegion().code).length?this.getSettings().getSearchRegion().code.toUpperCase():this.userSetting.getLocalisedSearchRegionCode()},changeLang:function(a){return this.getSettings().setInterfaceLanguage(a.code),document.documentElement.setAttribute("lang",a.code.substr(0,2)),getScript("js/lang/"+a.code+".js?"+(new Date).getTime())},updateLang:function(a){var b=new promise.Promise;return this.changeLang(a).then(function(){b.done(!1,!0)}),b},isTargetBlank:function(){return applicationState.user.userSetting.targetBlank},target:function(){return this.isTargetBlank()?SecurityHelper.targetBlank():""},changePassword:function(a,b,c){return AjaxManager.post(ajax.user.changePassword(),{password_current:a,password:b,password_conf:c,session_token:this.token})},changeLostPassword:function(a,b,c){return AjaxManager.post(ajax.user.changeLostPassword(),{token:a,password:b,password_conf:c})},changeEmail:function(a,b){return AjaxManager.post(ajax.user.changeEmail(),{password:a,email:b,session_token:this.token})},favoriteIndexOf:function(a){return!(!this.favorites||0==this.favorites.length)&&this.favorites.map(function(b,c){return b.url==a&&c}).reduce(function(a,b){return!1!==a?a:!1!==b&&b})},canRate:function(){return"1"===this.rateFlag},getSettings:function(){return this.userSetting},canReport:function(){return!1},canReportAds:function(){return!!this.isLogged&&(this.reportFlag&&1==this.reportFlag)}}),userFieldsParents={language:{label:function(){return _("Languages","settings")},desc:function(){return _("For your convenience, we have two language settings: one for the language of the search results, the other for the language of the interface.","settings")}},header:{label:function(){return _("Header shortcuts","settings")},desc:function(){return _("To customize your experience, choose the shortcuts in the header of Qwant's pages.","settings")}},general:{label:function(){return _("Settings","settings")},desc:function(){return _("Improve the ease of use of the Qwant engine.","settings")}},appearance:{label:function(){return _("Appearance","settings")},desc:function(){return!1},parent:"general",uxVersion:-1}},userFields={searchRegionKey:{label:function(){return _("Search results language","settings")},type:constants.FieldTypes.DROPDOWN,getParam:"r",parent:"language",isVisible:function(){return!0},values:function(){var a=[],b=constants.AvailableRegions.countries,c=[],d=["FR","GB","DE","IT"];for(var e in b){var f=b[e];-1===d.indexOf(e)&&a.push({label:'<div class="country--'+e+'"><span class="country__icon"></span><div class="country__label">'+_(f.i18n.label,f.i18n.context)+"</div></div>",value:f.code,name:_(f.i18n.label,f.i18n.context)})}a.sort(function(a,b){return a.name.localeCompare(b.name)});for(var g in d){var e=d[g],f=b[e];c.push({label:'<div class="country--'+e+'"><span class="country__icon"></span><div class="country__label">'+_(f.i18n.label,f.i18n.context)+"</div></div>",value:f.code,name:_(f.i18n.label,f.i18n.context)})}return c.concat(a)},getValue:function(a){return a.searchRegionKey},
defaultValue:function(){},getForcedValue:function(a){var b=void 0,c=a.rawQuery.r;if(void 0!==c&&/^\w\w$/.test(c)){var d=constants.AvailableRegions.countries;for(var e in d)e===c&&(b=e)}return b},getParentMenu:function(){return userFieldsParents.language}},searchLanguageSetting:{label:function(){return _("Choose the search language","settings")},type:constants.FieldTypes.DROPDOWN,key:"searchLanguage",getParam:"sr",parent:"language",values:function(){var a=[],b=constants.AvailableRegions.countries;for(var c in b){var d=b[c];a.push({label:'<div class="country--'+c+'"><span class="country__icon"></span><div class="country__label">'+_(d.i18n.label,d.i18n.context)+"</div></div>",value:d.code})}return a},isVisible:function(){return!0},getValue:function(a){return a.searchLanguageKey.substring(0,2)},defaultValue:function(){},getForcedValue:function(a){var b=a.rawQuery.sr;for(var c in constants.AvailableLanguages)if(b===constants.AvailableLanguages[c].code)return c},getParentMenu:function(){return userFieldsParents.language}},languageSetting:{label:function(){return _("Interface language","settings")},key:"language",getParam:"l",parent:"language",isVisible:function(){return!1},getValue:function(a){return a.getInterfaceLanguageCode()},defaultValue:function(){},getForcedValue:function(a){var b=a.rawQuery.l;for(var c in constants.AvailableLanguages)if(b===constants.AvailableLanguages[c].code)return c},getParentMenu:function(){return userFieldsParents.language}},searchMode:{label:function(){return _("Define my default Qwant search page","settings")},type:constants.FieldTypes.DROPDOWN,hostKey:"settings_search",parent:"general",values:function(){var a=[];for(var b in siteConfiguration.searchCategories){var c=siteConfiguration.searchCategories[b];SiteHelper.isHomepageRestricted(c)||a.push({label:c.i18n(),value:c.index})}return a},getParam:"h",isVisible:function(){return!1},getValue:function(a){return a.searchMode},defaultValue:function(){return"de_de"!==detectedLanguage&&"de_DE"!==detectedTerritory||isMobile||isTablet?0:1},getForcedValue:function(a){var b=a.rawQuery.h;if(-1!==["0","1","2","3","4","5","6","7"].indexOf(b))return parseInt(b)},getParentMenu:function(){return userFieldsParents.general}},safeSearch:{label:function(){return _("Filter adult content","settings")},type:constants.FieldTypes.DROPDOWN,hostKey:"settings_safesearch",parent:"general",values:function(){var a=[];for(var b in siteConfiguration.safeSearchModes)a.push({label:siteConfiguration.safeSearchModes[b].i18n(),value:siteConfiguration.safeSearchModes[b].value});return a},getParam:"s",isVisible:function(){return!0},getValue:function(a){return a.safeSearch},defaultValue:function(){return 1},getForcedValue:function(a){var b=a.rawQuery.s;if(-1!==["0","1","2"].indexOf(b))return parseInt(b)},getParentMenu:function(){return userFieldsParents.general}},enableSuggest:{label:function(){return _("Activate the search suggestion","settings")},type:constants.FieldTypes.CHECKBOX,hostKey:"settings_suggest",getParam:"a",parent:"general",isVisible:function(){return!1},getValue:function(a){return a.enableSuggest?"1":"0"},defaultValue:function(){return!0},getForcedValue:function(a){var b=a.rawQuery.a;if(-1!==["0","1"].indexOf(b))return"1"===b},getParentMenu:function(){return userFieldsParents.general}},targetBlank:{label:function(){return _("Open outgoing links in a new tab","settings")},type:constants.FieldTypes.CHECKBOX,hostKey:"settings_blank",getParam:"b",parent:"general",isVisible:function(){return!0},getValue:function(a){return a.targetBlank?"1":"0"},defaultValue:function(){return!0},getForcedValue:function(a){var b=a.rawQuery.b;if(-1!==["0","1"].indexOf(b))return"1"===b},getParentMenu:function(){return userFieldsParents.general}},showTrends:{label:function(){return _("Display trends on homepage","settings")},type:constants.FieldTypes.CHECKBOX,hostKey:"settings_trends",parent:"general",getParam:"hc",isVisible:function(){return!0},getValue:function(a){return a.showTrends},defaultValue:function(){return 1},getForcedValue:function(a){var b=a.rawQuery.hc;if(-1!==["0","1"].indexOf(b))return parseInt(b)},getParentMenu:function(){return userFieldsParents.general}},showSmartNews:{label:function(){return _("Display news next to web results","settings")},type:constants.FieldTypes.CHECKBOX,hostKey:"settings_smart_news",getParam:"smartNews",parent:"general",isVisible:function(){return!0},getValue:function(a){return a.showSmartNews?"1":"0"},defaultValue:function(){return!0},getForcedValue:function(a){return a.rawQuery.smartNews},getParentMenu:function(){return userFieldsParents.general}},showSmartSocial:{label:function(){return _("Display social next to web results","settings")},type:constants.FieldTypes.CHECKBOX,hostKey:"settings_smart_social",getParam:"smartSocial",parent:"general",isVisible:function(){return!0},getValue:function(a){return a.showSmartSocial?"1":"0"},defaultValue:function(){return!0},getForcedValue:function(a){return a.rawQuery.smartSocial},getParentMenu:function(){return userFieldsParents.general}},selectedTheme:{label:function(){return _("Change theme","settings")},type:constants.FieldTypes.DROPDOWN,hostKey:"settings_theme",getParam:"theme",parent:"appearance",isVisible:function(){return!0},values:function(){var a=[];for(var b in siteConfiguration.themes)a.push({label:siteConfiguration.themes[b].i18n(),value:siteConfiguration.themes[b].value});return a},getValue:function(a){return a.selectedTheme?a.selectedTheme:0},defaultValue:function(){return 0},getForcedValue:function(a){var b=void 0,c=a.rawQuery.theme;if(void 0!==c&&void 0!==siteConfiguration.themes)for(var d in siteConfiguration.themes)d===c&&(b=d);return b},getParentMenu:function(){return userFieldsParents.appearance}},showFavicon:{label:function(){return _('Display "favicons" on the search results',"settings")},type:constants.FieldTypes.CHECKBOX,hostKey:"settings_favicon",getParam:"i",parent:"appearance",isVisible:function(){return!1},getValue:function(a){return a.showFavicon?"1":"0"},defaultValue:function(){return!0},getForcedValue:function(a){var b=a.rawQuery.i;if(-1!==["0","1"].indexOf(b))return"1"===b},getParentMenu:function(){return userFieldsParents.appearance}},enableDonationMode:{label:function(){return _("Enable donation mode","settings")},type:constants.FieldTypes.CHECKBOX,hostKey:"settings_donation",getParam:"donation",parent:"general",isVisible:function(){return!1},getValue:function(a){return a.enableDonationMode?"1":"0"},defaultValue:function(){return!1},getForcedValue:function(a){return a.rawQuery.donation},getParentMenu:function(){return userFieldsParents.general}},showQoz:{label:function(){return _("Display Qoz","settings")},type:constants.FieldTypes.CHECKBOX,hostKey:"settings_qoz",getParam:"qoz",parent:"header",isVisible:function(){return!0},getValue:function(a){return a.showQoz?"1":"0"},defaultValue:function(){return!0},getForcedValue:function(a){var b=a.rawQuery.qoz;if(-1!==["0","1"].indexOf(b))return"1"===b},getParentMenu:function(){return userFieldsParents.header}},showHeadBookmarks:{label:function(){return _("Display bookmarks","settings")},type:constants.FieldTypes.CHECKBOX,hostKey:"settings_header_favorites",getParam:"shb",parent:"header",isVisible:function(){return!0},getValue:function(a){return a.showHeadBookmarks?"1":"0"},defaultValue:function(){return!0},getForcedValue:function(a){var b=a.rawQuery.shb;if(-1!==["0","1"].indexOf(b))return"1"===b},getParentMenu:function(){return userFieldsParents.header}},showHeadLang:{label:function(){return _("Display languages","settings")},type:constants.FieldTypes.CHECKBOX,hostKey:"settings_header_lang",getParam:"shl",parent:"header",isVisible:function(){return!0},getValue:function(a){return a.showHeadLang?"1":"0"},defaultValue:function(){return!0},getForcedValue:function(a){var b=a.rawQuery.shl;if(-1!==["0","1"].indexOf(b))return"1"===b},getParentMenu:function(){return userFieldsParents.header}}},passwordMinChars=8,ResultPageComponent=Class(Component,{constructor:function(){SearchAjaxManager.abort(),this.searchManager=new SearchManagerModel,this.regroupResponse(),this.timerFactor=1,this.searchColumnCount=0,this.$class.$super.$super.call(this),LayoutComponent.registerBeforeAction(function(){SearchBarComponent.homeLastQuery=""})},addColumnComponent:function(a,b){this.searchManager.addSearch(b),this.state.addComponent(a,b),this.searchColumnCount+=1},launchSearch:function(a){this.searchManager.launchSearch(a),this.regroupResponse()},onMount:function(){},regroupResponse:function(){var a=this;this.searchManager.requestPromiseStatus().then(function(b){if(!b.success){var c=a.searchManager.getCategorizedColumns().error,d=[];c.map(function(a){d.push(a.searchModel.type)}),l.error(d)}})},searchAgainErrorColumns:function(){AlertComponent.removeMessage({id:this.alertHandler});for(var a=this.searchManager.getCategorizedColumns().error,b=0;b<a.length;b+=1)a[b].search();this.regroupResponse()},loadFilters:function(a){var b=this;a.searchModel.searchPromise.then(function(){var c=a.searchModel.searchPromise.result[0],d=ResultFilterFactory.createFilters(c);d&&(a.state.filtersContainer?(a.state.filtersContainer.filters=d,a.state.filtersContainer.setState()):b.state.filtersContainer&&(b.state.filtersContainer.filters=d,b.state.filtersContainer.setState()))})},formatFilters:function(){var a={},b=this.route.rawParams;for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}}),IAListComponent=Class(Component,{$statics:{listItemReference:{}},constructor:function(a){this.items=a.items,this.title=a.title,this.iconTitle=a.iconTitle,this.roundThumbnail=a.roundThumbnail||!1,this.qwantSearch=a.qwantSearch||!1,this.imageField=a.image||"image",this.subName=a.subName||"",this.logItem=a.logItem||null,this.name="ia_list",this.isInit=!1,actionManager.onCustomEvent(this,"rendered",this.initRendered),_super(this)},initState:function(){return{items:this.items,title:this.title,iconTitle:this.iconTitle,roundThumbnail:this.roundThumbnail,imageField:this.imageField,subName:this.subName,logItem:this.logItem,qwantSearch:this.qwantSearch}},initRendered:function(){this.isInit||(IAListComponent.listItemReference[this.id]={list:".ia_list--list_"+this.id,container:".ia_list--content_"+this.id,item:".ia_list--content-link_"+this.id,arrowRight:".ia_list--nav_next_"+this.id,arrowLeft:".ia_list--nav_prev_"+this.id,margin:10,lastOffset:20},BrowserHelper.isTabletOrMobile&&IAHelper.setSwipableList(this.id,IAHelper.getImagesWidth(this.id,this),this),this.isInit=!0)},redirectPage:function(a){page(a.link)}}),AppHubPageComponent=Class(Component,{$statics:{MAX_LOCAL_STORAGE_DURATION:864e5,ARRAY_SLUG_CATEGORIES:["web","communication","security","data"],refreshCatalog:function(a){a=a||"both",(new MobileAppModel).applications(a).then(function(a,b){a?l.error(a):AppHubPageComponent.refreshCatalogWithCategories(b.data)})},refreshCatalogWithCategories:function(a,b){var c=[],d={};d.duration=(new Date).getTime(),a.forEach(function(a){var e=new promise.Promise;c.push(e),QwantMobile.filterInstalledApps(a.applications,function(c){var f=c.length,g=a.slug;d[g]={},d[g].installed=c,d[g].count=f,AppHubPageComponent.underlineCategory(g,f),g===b&&AppHubPageComponent.underlineApplications(c),e.done()})}),promise.join(c).then(function(){try{localStorage.setItem("mobile",JSON.stringify(d))}catch(a){l.error("local storage is not available for mobile app")}})},underlineCategory:function(a,b){if(b){var c=document.getElementsByClassName("category--"+a)[0];if(c){c.className+=" app_hub_landing__category--filled";var d=c.getElementsByClassName("app_hub_landing__category__count")[0];d&&(d.innerHTML=b)}}},underlineApplications:function(a){a.forEach(function(a){var b=document.getElementsByClassName(a.title+"--open")[0],c=document.getElementsByClassName(a.title+"--install")[0];b&&(b.style.display="inline-block"),c&&(c.style.display="none")})}},constructor:function(a){var b=$("body")[0];if(!AppComponent.isNativeApp())return void page("/");this.route=a,this.name="app_hub",b.style.background="#F5F6F7";var c=a.rawParams.platform;(!c||"ios"!==c&&"android"!==c)&&(c="both");var d=this;(new MobileAppModel).applications(c).then(function(a,b){if(a)l.error(a);else{var c=b.data;c.forEach(function(a,b){constants.AppHubConfiguration.categories[a.slug]&&(c[b].label=constants.AppHubConfiguration.categories[a.slug].label(),c[b].footer=constants.AppHubConfiguration.categories[a.slug].footer())}),d.categories=c,d.setState({categories:c,isLanding:!0});try{d.handleLocalStorage(c)}catch(a){l.error("local storage is not reachable for mobile app")}}}),_super(this)},initState:function(){return{categories:[],isLanding:!0}},loadCatalog:function(a){document.body.scrollTop=document.documentElement.scrollTop=0,this.setState({isLanding:!1,currentCategory:a.category.label,footer:a.category.footer,applications:a.category.applications});try{this.handleLocalStorage(this.categories,a.category.slug)}catch(a){l.error("local storage is not reachable for mobile app")}},returnHome:function(){document.body.scrollTop=document.documentElement.scrollTop=0,this.setState({categories:this.categories,isLanding:!0});try{this.handleLocalStorage(this.categories)}catch(a){l.error("local storage is not reachable for mobile app")}},handleLocalStorage:function(a,b){var c=JSON.parse(localStorage.getItem("mobile"));if(!c||(new Date).getTime()-c.duration>AppHubPageComponent.MAX_LOCAL_STORAGE_DURATION)AppHubPageComponent.refreshCatalogWithCategories(a,b);else{AppHubPageComponent.ARRAY_SLUG_CATEGORIES.forEach(function(a){var d=c[a];if(d){var e=d.count;AppHubPageComponent.underlineCategory(a,e),b===a&&AppHubPageComponent.underlineApplications(c[a].installed)}})}}}),AppComponent=Class(Component,{$statics:{currentWidth:window.innerWidth,currentPage:function(){return Application.rootComponent.state.page.currentPage},isExtensionDisabled:function(){return!$i("extension--enabled")||0===$i("extension--enabled").offsetHeight},isShoppingDisabled:function(){return!$(".shopping--enabled")[0]||0===$(".shopping--enabled")[0].offsetHeight},isNativeApp:function(){return hasClass($("body")[0],"native")},scrollBehaviour:function(){var a=document.documentElement.scrollTop||document.body.scrollTop;a>0?addClass(document.body,"scrolled"):removeClass(document.body,"scrolled"),hasClass(document.body,"device--mobile")&&a>250||a>400?addClass(document.body,"scrolled_more"):hasClass(document.body,"device--mobile")&&a>170?$(".home_page").length>0&&$(".search_bar").length>0?document.activeElement!==$(".search_bar__form__input")[0]&&addClass(document.body,"scrolled_more"):addClass(document.body,"scrolled_more"):removeClass(document.body,"scrolled_more")},resizeBehaviour:function(){var a=$("body")[0];if(hasClass(a,"desktop")){var b=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;b<=1024?(this.currentWidth>1024&&(Application.rootComponent.refresh(),Dispatcher.history.goTo(0)),addClass(a,"device"),b>640?(removeClass(a,"device--mobile"),addClass(a,"device--tablet")):(removeClass(a,"device--tablet"),addClass(a,"device--mobile"))):b>1024&&(this.currentWidth>1210&&b<=1210&&(Application.rootComponent.refresh(),Dispatcher.history.goTo(0)),b>1210&&this.currentWidth<=1210&&(Application.rootComponent.refresh(),Dispatcher.history.goTo(0)),this.currentWidth<=1024&&(Application.rootComponent.refresh(),Dispatcher.history.goTo(0)),hasClass(a,"device--forced")||(removeClass(a,"device"),removeClass(a,"device--tablet"),removeClass(a,"device--mobile"))),this.currentWidth=b}},canDisplayMobilePopup:function(){try{var a=!!localStorage.getItem("QwantAppPopupClosed")}catch(a){l.error("local storage is not available")}var b=$("body")[0];return!(!BrowserHelper.isMobile||a||AppComponent.isNativeApp()||hasClass(b,"libertyBrowser")||!config_get("qwant.app.mobile.popup.enabled")||"bouytel"===userClient)&&(addClass(b,"popup-mobile"),!0)},isDelayedByUser:function(){try{var a=localStorage.getItem("OldAppPopupDelay");if(!0===a||a>Date.now())return!0}catch(a){l.error("local storage is not available")}return!1},isOldLibertyApp:function(){try{var a=!!localStorage.getItem("OldAppPopupClosed")}catch(a){l.error("local storage is not available")}var b=$("body")[0];return!(!BrowserHelper.isMobile||a||this.isDelayedByUser()||!AppComponent.isNativeApp()||hasClass(b,"libertyBrowser")||"bouytel"===userClient||"ios"===BrowserHelper.getOS())&&(addClass(b,"popup-oldapp"),!0)},hidePopupLibertyApp:function(){removeClass($("body")[0],"popup-oldapp")},hideMobilePopup:function(){removeClass($("body")[0],"popup-mobile");try{localStorage.setItem("QwantAppPopupClosed","true")}catch(a){l.error("local storage is not available")}},hideOldAppPopup:function(){removeClass($("body")[0],"popup-oldapp");try{localStorage.setItem("OldAppPopupClosed","true")}catch(a){l.error("local storage is not available")}},getAppDownloadLink:function(){var a=null,b=navigator.userAgent;if(/android/i.test(b)?a="Android":/ip(hone|od|ad)/i.test(b)&&!window.MSStream&&(a="iOS"),a){if("Android"===a)return"https://play.google.com/store/apps/details?id=com.qwant.liberty";if("iOS"===a)return"fr"===applicationState.user.userSetting.getInterfaceLanguage().shorthand?"https://itunes.apple.com/fr/app/qwant/id924470452":"https://itunes.apple.com/us/app/qwant/id924470452"}}},constructor:function(a){this.name="application",this.route=a,this.lazyload=lazyload(),this.getABTestSurveys(),this.browser=BrowserHelper.getBrowserUri(),actionManager.onCustomEvent(this,EventHelper.EVENT_NOTE_CREATED,this.onNewNote,{isPersistant:!0}),actionManager.onCustomEvent(this,"pageRendered",this.onPageRendered,{isPersistant:!0}),a=window.location.href,this.element=-1!==a.indexOf("q=")||""!==this.route&&"/"!==this.route?"":"home",this.setCurrentTab(),"all"===this.tab&&(this.tab="web"),this.resizeBehaviour(),void 0!==window.IntersectionObserver&&(this.popinObserver=new IntersectionObserver(function(a){var b=$(".survey__popin")[0];a.forEach(function(a){a.intersectionRatio>0?(b.style.transitionDuration="0s",b.style.bottom="78px",setTimeout(function(){b.style.transitionDuration="0.4s"},400)):(b.style.transitionDuration="0s",b.style.bottom="0",setTimeout(function(){b.style.transitionDuration="0.4s"},400))})},{root:null,rootMargin:"0px",threshold:[.01]})),LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"displayPage",element:this.element,t:this.tab},function(a){if(null!==BrowserHelper.getFirefoxMobileVersion()){var b=JSON.parse(a);if(b.data&&b.data===parseInt(b.data)){b.data-serverTime>=6e5&&window.location.reload(!0)}}}),_super(this)},setCurrentTab:function(){var a=window.siteConfiguration.searchCategories,b=window.location.href.replace(/https?:\/\/[a-zA-Z0-9-_.]+/,"");this.tab=null;for(var c in a)b.indexOf("/"+a[c].name)>-1?(this.tab=a[c].name,this.element="home"):b.indexOf("t="+a[c].name)>-1&&(this.tab=a[c].name,this.element="");"home"===this.element&&(this.tab="web")},onNewNote:function(a,b){if(b.boardSlug){var c="board/"+applicationState.user.username+"/"+b.boardSlug;AlertComponent.success('<a href="'+(siteConfiguration.url.BOARDS||"")+c+'" '+SecurityHelper.targetBlank()+">"+_("Note has been added to your board.","note creator")+"</a>",{timeout:PanelFormNote.NOTE_CREATED_ALERT_TIMEOUT})}},checkGetUserErrors:function(){var a=null;UserModel.GETUSER_ERROR_LOGGED?(a=_('Your session has expired, <a href="{HREF}">please reconnect</a>',"login",{HREF:"/login"}),UserModel.GETUSER_ERROR_LOGGED=!1):UserModel.GETUSER_ERROR_UNLOGGED&&(a=_('Your session has expired and your settings have been reset <a href="{HREF}">to their default values</a>',"login",{HREF:"/settings"}),UserModel.GETUSER_ERROR_UNLOGGED=!1),null!==a&&AlertComponent.error(a,{timeout:3e4})},initState:function(){var a=$route.get({path:this.route.replace("/",""),params:{}}),b={};return b=a&&a.isSimple?{loadBar:new LoadBarComponent,sideBar:new SideBarComponent,alert:new AlertComponent,page:new LayoutComponent}:{loadBar:new LoadBarComponent,alert:new AlertComponent,sideBar:new SideBarComponent,header:new HeaderComponent,page:new LayoutComponent,footer:new FooterComponent,sidePanel:new PanelComponent,libertyPopup:new LibertyPopupComponent},b.account_overlay=new AccountOverlayComponent,b.appMenu=new AppMenuComponent,b},getABTestSurveys:function(){var a=this;(new SurveyModel).active().then(function(b,c){!b&&c&&c.data&&c.data.surveys&&(a.surveys=c.data.surveys,a.isThereAnABTestSurvey())})},isThereAnABTestSurvey:function(){if(this.closeSurveyPopin(),this.surveys&&this.surveys instanceof Array){var a=window.location.href.replace(/https?:\/\/[a-zA-Z0-9-_.]+/,""),b=isReachableStore?JSON.parse(localStorage.getItem("ansSurvey")):null,c={locale:applicationState.user.userSetting.getLocalisedSearchRegionCode().toLowerCase(),test_group:testGroupPer,device:BrowserHelper.deviceType()};for(var d in this.surveys)if(this.surveys[d].id&&this.surveys[d].locale&&this.surveys[d].test_group&&this.surveys[d].device&&(this.surveys[d].path||this.surveys[d].search_domain)){var e=this.surveys[d].search_domain?this.surveys[d].search_domain.split(","):null,f=null===b||b instanceof Array&&-1===b.indexOf(this.surveys[d].id),g=a.match(this.surveys[d].path)&&(!e||e&&-1!==e.indexOf(this.tab)),h=c.locale.indexOf(this.surveys[d].locale.replace("*","").toLowerCase())>-1,i=this.surveys[d].test_group.split(",").indexOf(String(c.test_group))>-1,j=this.surveys[d].device===c.device;if(f&&g&&h&&i&&j){this.activeSurvey=this.surveys[d],this.triggerSurveyPopin(this.surveys[d].id);break}}}},triggerSurveyPopin:function(a){var b=this;setTimeout(function(){void 0!==window.IntersectionObserver&&void 0!==b.popinObserver&&b.popinObserver.observe($(".footer")[0]),$(".survey__popin__title")[0].innerHTML=_("Welcome to the new version of Qwant","survey"),$(".survey__popin__content")[0].innerHTML=_("Give us your opinion!","survey"),$(".survey__popin__link")[0].href="/survey/"+a,$(".survey__popin")[0].style.opacity=1,$(".survey__popin")[0].style.bottom=0,LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"display",element:"survey_popin_"+a})},1e3)},closeSurveyPopin:function(){void 0!==window.IntersectionObserver&&void 0!==this.popinObserver&&"edge"!==BrowserHelper.getBrowserUri()&&this.popinObserver.unobserve($(".footer")[0]),$(".survey__popin")[0].style.position="fixed",$(".survey__popin")[0].style.bottom="-110px",setTimeout(function(){$(".survey__popin")[0].style.opacity=0},500)},killSurveyPopin:function(){if(this.closeSurveyPopin(),this.activeSurvey&&this.activeSurvey.id){var a=isReachableStore?JSON.parse(localStorage.getItem("ansSurvey")):null;a instanceof Array?a.push(this.activeSurvey.id):a=[this.activeSurvey.id],isReachableStore&&localStorage.setItem("ansSurvey",JSON.stringify(a)),LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"userInteraction",event:"dismiss",zone:"survey_popin",item:this.activeSurvey.id})}},onPageRendered:function(){this.setCurrentTab(),this.isThereAnABTestSurvey(),this.checkGetUserErrors()}});window.addEventListener("scroll",function(a){AppComponent.scrollBehaviour()}),window.addEventListener("resize",function(a){AppComponent.resizeBehaviour()});var AppMenuComponent=Class(Component,{$statics:{_BOOKMARKS:"bookmarks",_MAIN_MENU:"main_menu",_LANGUAGE:"language",_SETTINGS:"settings",trustedReferer:new RegExp(/^\/(music|causes)([\/\?].*)?$/),content:{main_menu:{blocks:[{title:function(){return _("Qwant is also","appmenu")},icon:"hash",links:[{text:function(){return"Qwant Music"},url:function(){return siteConfiguration.url.MUSIC},logName:function(){return"music"}},{text:function(){return"Qwant Boards"},url:function(){return siteConfiguration.url.BOARDS},logName:function(){return"boards"}},{text:function(){return _("Qwant on Android","appmenu")},url:function(){return"https://play.google.com/store/apps/details?id=com.qwant.liberty"},logName:function(){return"android"}},{text:function(){return _("Qwant on iOS","appmenu")},url:function(){return"https://itunes.apple.com/app/qwant/id924470452"},logName:function(){return"iOS"}},{text:function(){return _("Qwant Junior","appmenu")},url:function(){return siteConfiguration.url.JUNIOR},logName:function(){return"junior"}},{text:function(){return _("Qwant Lite","appmenu")},url:function(){return siteConfiguration.url.LITE},logName:function(){return"lite"}}]},{title:function(){return _("About us","appmenu")},icon:"users",links:[{text:function(){return constants.StaticPagesInfos.BLOG.pageName()},url:function(){return constants.StaticPagesInfos.BLOG.url()},logName:function(){return"blog"}},{text:function(){return constants.StaticPagesInfos.PRESS.pageName()},url:function(){return constants.StaticPagesInfos.PRESS.url()},logName:function(){return"press"}},{text:function(){return constants.StaticPagesInfos.JOBS.pageName()},url:function(){return constants.StaticPagesInfos.JOBS.url()},logName:function(){return"job"}},{text:function(){return constants.StaticPagesInfos.FAQ.pageName()},url:function(){return constants.StaticPagesInfos.FAQ.url()},logName:function(){return"faq"}},{text:function(){return constants.StaticPagesInfos.LN.pageName()},url:function(){return constants.StaticPagesInfos.LN.url()},logName:function(){return"legal"}},{text:function(){return constants.StaticPagesInfos.TOS.pageName()},url:function(){return constants.StaticPagesInfos.TOS.url()},logName:function(){return"tos"}},{text:function(){return constants.StaticPagesInfos.ABOUT.pageName()},url:function(){return constants.StaticPagesInfos.ABOUT.url()},logName:function(){return"about"}},{text:function(){return constants.StaticPagesInfos.PRIVACY.pageName()},url:function(){return constants.StaticPagesInfos.PRIVACY.url()},logName:function(){return"privacy"}},{text:function(){return constants.StaticPagesInfos.RANKING.pageName()},url:function(){return constants.StaticPagesInfos.RANKING.url()},logName:function(){return"results_ranking"}}]},{title:function(){return constants.StaticPagesInfos.CONTACT.pageName()},icon:"at-sign",link:function(){return constants.StaticPagesInfos.CONTACT.url()},logName:function(){return"contact"}},{title:function(){return _("Share Qwant","appmenu")},icon:"share",links:[{text:function(){return _("on Twitter","appmenu")},url:function(){return"https://twitter.com/share?url=https://www.qwant.com/&text="+_("Why allowing from a search engine something you won't in real life?","appmenu")+"&hashtags=switchToQwant&via=Qwant_FR"},logName:function(){return"twitter"}},{text:function(){return _("on Facebook","appmenu")},url:function(){return"http://www.facebook.com/sharer.php?u=https://www.qwant.com/"},logName:function(){return"facebook"}}]}]},bookmarks:{},language:{},settings:{}},account:function(){applicationState.user.isLogged?page("/account"):AppMenuComponent.login()},changePage:function(a){var a=a||{};if(a.hasOwnProperty("content")||(a.content=AppMenuComponent._MAIN_MENU),a.content===AppMenuComponent._MAIN_MENU){var b=Dispatcher.getUrlParameter("referer");b&&b.match(AppMenuComponent.trustedReferer)&&(window.location=config_get("qwantUrl")+b)}Application.rootComponent.state.appMenu.setContent(a.content)},login:function(){AppMenuComponent.close({disableNotif:!0}),Application.rootComponent.state.account_overlay.displayAccountOverlay()},open:function(a){var a=a||{};if(a.hasOwnProperty("content")||(a.content=AppMenuComponent._MAIN_MENU),a.content===AppMenuComponent._BOOKMARKS&&!applicationState.user.isLogged)return void AppMenuComponent.login();Application.rootComponent.state.appMenu.setContent(a.content);var b=$(".appmenu__background")[0],c=$(".appmenu__container")[0],d=$("body")[0];b&&d&&setTimeout(function(){addClass(d,"appmenu"),addClass(b,"appmenu--active"),addClass(b,"appmenu--fadeout"),addClass(c,"appmenu__container--active")},50),Application.rootComponent.state.appMenu.isOpen=!0},close:function(a){var b=$(".appmenu__background")[0],c=$(".appmenu__container")[0],d=$("body")[0];if(b&&d&&(removeClass(c,"appmenu__container--active"),removeClass(b,"appmenu--fadeout"),removeClass(d,"appmenu"),setTimeout(function(){removeClass(b,"appmenu--active")},300)),a.disableNotif){var e=Dispatcher.getUrlParameter("referer");e&&e.match(AppMenuComponent.trustedReferer)&&(window.location=config_get("qwantUrl")+e);try{localStorage.setItem("appMenuNotifDisabled",JSON.stringify({theme:!0,qoz:!0}));for(var f=$(".appmenu__notification"),g=0;g<f.length;g++)f[g].parentNode.removeChild(f[g])}catch(a){l.error("local storage is not available")}}Application.rootComponent.state.appMenu.isOpen=!1},isNotifEnabled:function(){try{var a=localStorage.getItem("appMenuNotifDisabled");a&&(a=JSON.parse(a).qoz)}catch(a){l.error("local storage is not available")}return!a}},constructor:function(){this.name="appmenu",this.isOpen=!1,this.content=AppMenuComponent._MAIN_MENU,this.bookmarksModel=new FavoriteModel,this.referer=Dispatcher.getUrlParameter("referer"),document.addEventListener("keydown",function(a){a.altKey||a.ctrlKey||a.metaKey||27===a.keyCode&&AppMenuComponent.close({disableNotif:!0})}),LayoutComponent.registerBeforeActionGlobal(function(a){AppMenuComponent.close({disableNotif:!1})}),_super(this)},initState:function(){return{type:this.content,content:AppMenuComponent.content[this.content]}},setContent:function(a){switch(this.content=a,this.state.type=a,this.content){case AppMenuComponent._BOOKMARKS:var b=this;this.bookmarksModel.get(!0).then(function(c,d){c||(AppMenuComponent.content.bookmarks.list=d.data,b.state.content=AppMenuComponent.content[a],b.setState(b.state),b.sortBookmarks())});break;case AppMenuComponent._LANGUAGE:var c={};jsface.extend(c,applicationState.user.userSetting),this.state.content=AppMenuComponent.content[a],this.state.settings=c,this.setState(this.state);break;case AppMenuComponent._MAIN_MENU:default:this.state.content=AppMenuComponent.content[a],this.setState(this.state)}},updateBookmarksOrder:function(){if(!applicationState.user.isLogged)return page("/login"),void AlertComponent.info(_("You must be logged in to edit your bookmarks","favorites"));for(var a=$(".appmenu__content__block--bookmark"),b=[],c=this,d=0;d<=a.length-1;++d){var e=a[d].className.replace(/^\D+|\D+$/g,"");b.push(e)}c.bookmarksModel.order(b).then(function(a){a?AlertComponent.error(_("Your bookmarks could not be reordered, please try again.","favorites")):AlertComponent.info(_("Your bookmarks have been reordered.","favorites"))}),this.sortBookmarks()},sortBookmarks:function(){if(this.state.content.list.length>0){var a=this;this.sortable=Sortable.create($(".appmenu__content--bookmarks")[0],{sort:!0,handle:".appmenu__content__block--bookmark__order",scroll:!0,onUpdate:function(){a.updateBookmarksOrder(),a.sortBookmarks()}})}},toggleBookmarkSubMenu:function(a){var b=!1,c=a.bookmark,d=$(".appmenu__content__block--bookmark--"+c.index+" .appmenu__content__block--bookmark__button")[0],e=$(".appmenu__content__block--bookmark--"+c.index+" .appmenu__content__block--bookmark__submenu__content")[0];hasClass(d,"active")||(b=!0),this.disableAllBookmarkSubMenu(),b&&(addClass(d,"active"),addClass(e,"active"))},disableAllBookmarkSubMenu:function(){var a=$(".appmenu__content__block--bookmark__button"),b=$(".appmenu__content__block--bookmark__submenu__content");window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(a,b){b=b||window;for(var c=0;c<this.length;c++)a.call(b,this[c],c,this)}),a.forEach(function(a){removeClass(a,"active")}),b.forEach(function(a){removeClass(a,"active")})},cancelBookmarkCreation:function(){var a=$(".appmenu__content--bookmarks")[0],b=$(".appmenu__content--bookmarks__overlay")[1];removeClass(a,"overlay"),removeClass(b,"active")},cancelBookmarkEdit:function(){var a=$(".appmenu__content--bookmarks")[0],b=$(".appmenu__content--bookmarks__overlay")[0];removeClass(a,"overlay"),removeClass(b,"active")},addBookmark:function(a){
var b=this,c=$(".appmenu__content--bookmarks")[0],d=$(".appmenu__content--bookmarks__overlay")[1],e=$(".appmenu__content--bookmarks__overlay__container__form__input--name")[1],f=$(".appmenu__content--bookmarks__overlay__container__form__input--url")[1],g=$(".appmenu__content--bookmarks__overlay__container__form__button--cancel")[1],h=($(".appmenu__content--bookmarks__overlay__container__form__button--submit")[1],a&&a.bookmark?a.bookmark:{name:"",url:""});e.value=h.name,f.value=h.url,addClass(c,"overlay"),addClass(d,"active"),c.scrollTop=0,actionManager.addSubmitListener(this,function(){""!==e.value&&""!==f.value?b.validateBookmarkUrl({bookmark:{url:f.value}})?b.bookmarksModel.create(e.value,f.value,1).then(function(a,c){a?b.handleBookmarkError(a):AlertComponent.success(_("Your bookmark has been created.","favorites")),b.setContent(AppMenuComponent._BOOKMARKS)}):AlertComponent.error(_("Bookmark URL must be valid","favorites")):AlertComponent.error(_("Bookmark informations cannot be empty","favorites"))},{key:"add_bookmark"}),g.onclick=function(a){a.preventDefault(),b.cancelBookmarkCreation()}},editBookmark:function(a){var b=this,c=$(".appmenu__content--bookmarks")[0],d=$(".appmenu__content--bookmarks__overlay")[0],e=$(".appmenu__content--bookmarks__overlay .appmenu__content__block--bookmark__content")[0],f=$(".appmenu__content--bookmarks__overlay .appmenu__content__block--bookmark__content__img")[0],g=$(".appmenu__content--bookmarks__overlay .appmenu__content__block--bookmark__content__name")[0],h=$(".appmenu__content--bookmarks__overlay .appmenu__content__block--bookmark__content__link")[0],i=$(".appmenu__content--bookmarks__overlay__container__form__input--name")[0],j=$(".appmenu__content--bookmarks__overlay__container__form__input--url")[0],k=$(".appmenu__content--bookmarks__overlay__container__form__button--cancel")[0],l=($(".appmenu__content--bookmarks__overlay__container__form__button--submit")[0],a&&a.bookmark?a.bookmark:{name:"",url:""});e.href=a.bookmark.url,f.src=a.bookmark.favicon,i.value=g.innerHTML=a.bookmark.name,j.value=h.innerHTML=a.bookmark.url,addClass(c,"overlay"),addClass(d,"active"),c.scrollTop=0,i.oninput=function(a){g.innerHTML=a.target.value},j.oninput=function(a){h.innerHTML=a.target.value},actionManager.addSubmitListener(this,function(a){""!==i.value&&""!==j.value?b.validateBookmarkUrl({bookmark:{url:j.value}})?a.bookmark.name===i.value&&a.bookmark.url===j.value?AlertComponent.error(_("The favorite is unchanged.","favorites")):b.bookmarksModel.update(i.value,j.value,1,a.bookmark.index).then(function(a,c){a?b.handleBookmarkError(a):AlertComponent.success(_("Your bookmark has been updated.","favorites")),b.setContent(AppMenuComponent._BOOKMARKS)}):AlertComponent.error(_("Bookmark URL must be valid","favorites")):AlertComponent.error(_("Bookmark informations cannot be empty","favorites"))},{key:"edit_bookmark",bookmark:l}),k.onclick=function(c){c.preventDefault(),b.cancelBookmarkEdit(),b.toggleBookmarkSubMenu(a)}},deleteBookmark:function(a){var b=this;this.bookmarksModel.delete(a.bookmark.index).then(function(a,c){a||(AlertComponent.info(_("Your bookmark has been deleted.","favorites")),b.setContent(AppMenuComponent._BOOKMARKS))})},copyBookmark:function(a){var b=$(".appmenu__content__block--bookmark--"+a.bookmark.index+" .appmenu__content__block--bookmark__submenu__content__element__url")[0],c=b.value;if("iOS"===BrowserHelper.getOS()){var d=b.contentEditable,e=b.readOnly;b.contentEditable=!0,b.readOnly=!1;var f=document.createRange();f.selectNodeContents(b);var g=window.getSelection();g.removeAllRanges(),g.addRange(f),b.select(),b.setSelectionRange(0,c.length),b.contentEditable=d,b.readOnly=e}else{b.select();try{document.execCommand("copy"),AlertComponent.success(_("The URL was copied to your clipboard.","alert"))}catch(a){AlertComponent.error(_("The URL could not be copied to your clipboard. Your browser might not allow it.","alert"))}}},handleBookmarkError:function(a){FavoriteModel.ERROR_FAVORITE_ALREADY_EXISTS===a?AlertComponent.error(_("This Web page already exists in your bookmarks.","favorites")):FavoriteModel.ERROR_FAVORITE_URL_NOT_ACCESSIBLE===a?AlertComponent.error(_("The given URL is not accessible.","favorites")):AlertComponent.error(_("An error has occurred while trying to add a bookmark link, please try again.","search"))},getInterfaceLanguageItems:function(){var a=[];for(var b in constants.AvailableLanguages){var c=constants.AvailableLanguages[b],d=c.code.substr(3,2).toUpperCase();LanguageHelper.getCountryLanguages(d).length>1&&(d=c.code.substr(0,3)+d),a.push({value:c.code,label:c.name})}return a},getLanguageItems:function(a,b){for(var c=[],d=0;a[d];d++){var e=a[d].code+"_"+b;c.push({value:a[d].code,label:'<div class="country--'+e+'"><span class="country__icon"></span><div class="country__label">'+a[d].name+"</div></div>"})}return c},updateSearchLanguage:function(a){this.state.settings.interfaceLanguageKey=LanguageHelper.getCorrespondingInterfaceLanguage(a).code||"en_gb",$i("appmenu_setting__item--interface-language").innerHTML=new DropDownComponent(this.getInterfaceLanguageItems(),{key:userFields.languageSetting.key,value:this.state.settings.interfaceLanguageKey,callback:this.updateDropDown,component:this}).render(),this.state.settings.searchLanguageKey=a},updateDropDown:function(a,b){$i("appmenu_language_btns").style.display="flex",$i("appmenu_language_header--content").style.display="none","language"===b.key?this.state.settings.interfaceLanguageKey=LanguageHelper.getCorrespondingInterfaceLanguage(a).code:"searchRegionKey"===b.key?this.updateSearchRegion(a):"searchLanguage"===b.key&&(this.state.settings.searchLanguageKey=a)},updateSelectedRegion:function(a){$i("appmenu_language_btns").style.display="flex",$i("appmenu_language_header--content").style.display="none",removeClass($(".appmenu__language--region-selected")[0],"appmenu__language--region-selected"),addClass($(".lang--"+a.region.value),"appmenu__language--region-selected"),this.state.settings.searchLanguageKey=a.region.value,this.updateSearchLanguage(a.region.value)},updateSearchRegion:function(a){var b=LanguageHelper.getCountryLanguages(a),c=$i("appmenu_setting__item--language"),d=$i("appmenu_setting__item--language-label");b.length>1?(c.innerHTML=this.renderPartial("appmenu_language_regions",{languages:this.getLanguageItems(b,a),isChangedCountry:!0}),removeClass(c,"setting__item--hidden"),removeClass(d,"setting__item--hidden")):(addClass(c,"setting__item--hidden"),addClass(d,"setting__item--hidden")),this.updateSearchLanguage(b[0].code),this.state.settings.searchRegionKey=a},updateLang:function(){this.referer=Dispatcher.getUrlParameter("referer");var a=this,b=new promise.Promise;!0===config_get("features.l10n.lang.switch.enabled")?b=applicationState.user.changeLang(applicationState.user.getSettings().getInterfaceLanguage()):b.done(),b.then(function(){_initI18n({showMissingTranslation:config_get("isDevelopmentMode")&&"en_gb"!==a.state.settings.interfaceLanguageKey}),a.referer&&a.referer.match(AppMenuComponent.trustedReferer)?window.location=config_get("qwantUrl")+a.referer:(Application.rootComponent.refresh(),Dispatcher.history.goTo(0),AlertComponent.success(_("Settings successfully updated","user"),{timeout:3e3}))})},saveSettings:function(){LoadBarComponent.clear(),LoadBarComponent.init(1);var a=this,b=applicationState.user.userSetting.update();null===b?a.updateLang():b.then(function(b){if(b){if(101==b){UserModel.logout().then(function(){AlertComponent.error(_('Your session has expired, <a href="{HREF}">please reconnect</a>',"login",{HREF:"/login"}))})}else AlertComponent.error(_("an error occurred in updating your settings","user"));FormHelper.enableSubmitButton()}else a.updateLang()}),LoadBarComponent.step()},update:function(){FormHelper.disableSubmitButton(),applicationState.user.userSetting=this.state.settings,!0===config_get("features.l10n.lang.switch.enabled")&&applicationState.user.getSettings().setInterfaceLanguage(this.state.settings.interfaceLanguageKey),this.saveSettings()},toggleTheme:function(a){a.toggle&&(a.theme=1===applicationState.user.userSetting.selectedTheme?0:1),void 0!==applicationState.user.userSetting.selectedTheme&&a.theme===applicationState.user.userSetting.selectedTheme||(this.state.settings=applicationState.user.userSetting,this.state.settings.selectedTheme=a.theme,this.saveSettings(),setDisplayType(applicationState.user.userSetting),LinkHelper.logHandler(this,Event,{AjaxRoute:"userInteraction",event:"click",zone:"theme_"+a.theme,component:"app_menu",context:"true",t:"default"}),AppMenuComponent.close({disableNotif:!0}))},validateBookmarkUrl:function(a){return/^(https?:\/\/)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,20}\b(\/.*)?$/.test(a&&a.bookmark?a.bookmark.url:a.event.target.value)},submitForm:function(a){var b=a.form;$i("appmenu_"+b+"_btns").style.display="none",$i("appmenu_"+b+"_header--content").style.display="block",$i(b+"_form--submit").click()},cancel:function(a){var b=a.form;this.setState(this.state),$i("appmenu_"+b+"_btns").style.display="none",$i("appmenu_"+b+"_header--content").style.display="block",$i(b+"_form--reset").click()}}),CalendarComponent=Class(Component,{$statics:{libraryStatuses:{IDLE:0,PENDING:1,READY:2},libraryStatus:0,delayedPickers:[]},constructor:function(a,b){if(this.options=b||{},this.date=a||new Date,this.dateString=strftime(i18n.date.dateFormat,this.date),this.minDate=b.minDate,this.name="calendar",_super(this),CalendarComponent.libraryStatus===CalendarComponent.libraryStatuses.READY)actionManager.onCustomEvent(this,"rendered",this.initPicker);else if(CalendarComponent.libraryStatus===CalendarComponent.libraryStatuses.IDLE){getCss("/css/calendar/pikaday.css"),CalendarComponent.libraryStatus=CalendarComponent.libraryStatuses.PENDING;var c=getScript("/js/calendar/pikaday.js"),d=this;c.then(function(a){a?(CalendarComponent.libraryStatus=CalendarComponent.libraryStatuses.IDLE,CalendarComponent.delayedPickers=[],l.error("Calendar library cannot be loaded",a)):(actionManager.onCustomEvent(d,"rendered",d.initPicker),CalendarComponent.delayedPickers.forEach(function(a){actionManager.onCustomEvent(a,"rendered",a.initPicker)}),CalendarComponent.libraryStatus=CalendarComponent.libraryStatuses.READY)})}else CalendarComponent.libraryStatus===CalendarComponent.libraryStatuses.PENDING&&CalendarComponent.delayedPickers.push(this)},initState:function(){return{inputId:"picker_"+this.id,dateString:this.dateString}},setMinDate:function(a){this.pikaday.getDate().getTime()<a.getTime()&&this.pikaday.setDate(a,!0),this.pikaday.setMinDate(a)},setDate:function(a){this.pikaday.setDate(a,!0)},initPicker:function(){var a=this,b=$i("picker_"+this.id),c={field:b,i18n:{previousMonth:i18n.date.prevText,nextMonth:i18n.date.nextText,months:i18n.date.monthNames,weekdays:i18n.date.dayNames,weekdaysShort:i18n.date.dayNamesMin},toString:function(a){return strftime(i18n.date.longFormat,a)},onSelect:function(b){a.date=b,a.options.callback&&a.options.callback.call(a.options.component,b)},minDate:this.minDate,firstDay:1};if(this.options.container){var d=$(this.options.container);d&&d.length>0&&(c.container=d[0])}else{var d=$i(this.id);d&&(c.container=d)}c.onOpen=function(){addClass($i(a.id),"open")},c.onClose=function(){removeClass($i(a.id),"open")},this.pikaday=new Pikaday(c),actionManager.cleanCustomEvent("rendered",this.initPicker),this.pikaday.setDate(this.date,!0)}}),ConfettiComponent=Class(Component,{$statics:{startConfettis:function(){window.confettiful=new Confettiful($(".js-container")[0])},stopConfettis:function(){if(window.confettiful){window.confettiful=!1;var a=document.querySelector(".confetti-container");a&&a.parentNode.removeChild(a)}}}}),OverviewPageComponent=Class(Component,{$statics:{OVERVIEW_NEWS_PATTERN:[[[{type:"table",columnNumber:2,rowNumber:3,index:0,partial:"news_column_list",subPartial:"news_list_item"}]],[[{type:"array",beginning:0,end:6,partial:"news_list",subPartial:"news_list_item"}]]],creditsTranslated:{Modes:function(){return _("Modes","credits")},Genre:function(){return _("Genre","credits")},Engine:function(){return _("Engine","credits")},Platforms:function(){return _("Platforms","credits")},Developer:function(){return _("Developer","credits")},Publisher:function(){return _("Publisher","credits")},"Release date":function(){return _("Release date","credits")},"Official site":function(){return _("Official site","credits")}},slug:"",listItemReference:{videos:{list:".videos_list",container:".videos_list--container",arrowRight:".videos_list__arrow_right",arrowLeft:".videos_list__arrow_left",item:".videos_list__item",margin:10,lastOffset:0},similars:{list:".similars_list",container:".similars_list--container",arrowRight:".similars_list__arrow_right",arrowLeft:".similars_list__arrow_left",item:".similar__item",margin:30,lastOffset:50}}},constructor:function(a,b,c){this.name="overview",this.data=a,this.customPage=b,this.slug=c,this.partialMosaic=null,this.openedBiography=!1,this.listPosition={},a.getNews()&&a.getNews().length>0&&(OverviewPageComponent.slug=this.slug?this.slug:"",this.partialMosaic=new PartialMosaicComponent(a.getNews(),OverviewPageComponent.OVERVIEW_NEWS_PATTERN,"overview_news",this.customPage,800)),this.getMediaCount()>0&&(this.mediaOverlay=new MediaOverlayComponent({params:{}}),a.media.videoAds&&a.media.videoAds.length>0&&(a.media.videos[0].type="video",MediaOverlayComponent.addMedias(a.media.videoAds)),a.media.twitch&&a.media.twitch.length>0&&(a.media.twitch[0].type="twitch",MediaOverlayComponent.setMedias(a.media.twitch)),a.media.videos&&a.media.videos.length>0&&(a.media.videos[0].type="video",MediaOverlayComponent.addMedias(a.media.videos)),a.media.pictures&&a.media.pictures.length>0&&(a.media.pictures[0].type="image",MediaOverlayComponent.addMedias(a.media.pictures))),this.changeMeta(),_super(this)},initState:function(){return{data:this.data,partialMosaic:this.partialMosaic,mediaOverlay:this.mediaOverlay}},afterActions:function(){this.data.getNews()&&this.data.getNews().length>0&&this.partialMosaic.firstBuild(),this.data.getReviews()&&this.data.getReviews().getOverall()&&CustomPageHelper.buildCanvas("scores__header__score__canvas",this.data.getReviews().getOverall().getScore(),!1),this.getMediaCount()>0&&(BrowserHelper.isTabletOrMobile?this.setSwipableList("videos",this.getAllMediaCount(),490):(this.checkListScrollable(".videos_list",".videos_list__arrow_right",this.getMediaCount(),490),this.listPosition.videos=0)),this.data.getSimilars().length>0&&(BrowserHelper.isTabletOrMobile?this.setSwipableList("similars",this.data.getSimilars().length,220):(this.checkListScrollable(".similars_list",".similars_list__arrow_right",this.data.getSimilars().length,220),this.listPosition.similars=0)),this.data.getGameList().length>0&&(this.checkListScrollable(".similars_list",".similars_list__arrow_right",this.data.getGameList().length,220),this.listPosition.similars=0),this.data.getMagazines().length>0&&(BrowserHelper.isTabletOrMobile?this.setSwipableList("similars",this.data.getMagazines().length,220):(this.checkListScrollable(".similars_list",".similars_list__arrow_right",this.data.getMagazines().length,220),this.listPosition.similars=0))},haveSocialPost:function(a,b){return a.data.getSocial(b)&&a.data.getSocial(b).getPosts().length>0},checkListScrollable:function(a,b,c,d){var e=0,d=d,f=$(a)[0],g=$(b)[0],h=c;f&&(e=f.offsetWidth),e>=h*d&&g&&(g.style.display="none")},listScroll:function(a){var b=a.type,c=$(OverviewPageComponent.listItemReference[b].list)[0],d=$(OverviewPageComponent.listItemReference[b].container)[0],e=$(OverviewPageComponent.listItemReference[b].arrowRight)[0],f=$(OverviewPageComponent.listItemReference[b].arrowLeft)[0],g=$(OverviewPageComponent.listItemReference[b].item)[0];e.style.display="block",f.style.display="block";var h,i=g.clientWidth+OverviewPageComponent.listItemReference[b].margin,j=a.position,k=c.offsetWidth,l=parseInt(window.getComputedStyle(d).marginLeft),m=a.numberOfItems;"left"===j?(h=l+i,this.listPosition[b]--,h>=0&&(h=0,f.style.display="none")):(h=l-i,this.listPosition[b]++,Math.floor(k/i)>=m-this.listPosition[b]&&(h=k-i*m-OverviewPageComponent.listItemReference[b].lastOffset,e.style.display="none")),d.style.marginLeft=h+"px"},setSwipableList:function(a,b){var c=$(OverviewPageComponent.listItemReference[a].list)[0],d=$(OverviewPageComponent.listItemReference[a].container)[0],e=$(OverviewPageComponent.listItemReference[a].arrowRight)[0],f=$(OverviewPageComponent.listItemReference[a].arrowLeft)[0],g=$(OverviewPageComponent.listItemReference[a].item)[0],h=OverviewPageComponent.listItemReference[a].margin,i=g.clientWidth+h,j=g.clientHeight+parseInt(window.getComputedStyle(g).marginTop.replace("px",""))+parseInt(window.getComputedStyle(g).marginBottom.replace("px",""));d.style.width=b*i+h+"px",d.style.overflowY="hidden",c.style.overflowX="scroll",c.style.height=j+"px",e.style.display="none",f.style.display="none"},getMediaCount:function(){return this.data.getMedia().getVideos().length+this.data.getMedia().getPictures().length+this.data.getMedia().getVideoAds().length+this.data.getMedia().getTwitch().length},getAllMediaCount:function(){return this.getMediaCount()+this.data.getMedia().getWebcams().length},changeMeta:function(){var a=_("{appTitle} - Qwant {customPage}","overview",{appTitle:this.data.getMain().getName(),customPage:this.customPage}),b=this.data.getBiography()?this.data.getBiography().getContent(150):"";MetaHelper.set([{property:"og:title",content:a},{property:"og:site_name",content:_("{appTitle} Search","overview",{appTitle:config_get("appTitle")})},{property:"og:image",content:config_get("searchUrl")+config_get("logo.url")},{property:"og:url",content:document.URL},{property:"og:description",content:b},{name:"description",content:b}]),MetaHelper.changeTitle(a)}}),SummaryPageComponent=Class(Component,{$statics:{TABS:["similars","social","images","live","videos","news","reviews","header"]},constructor:function(a,b,c){this.name="summary",this.data=a,this.customPage=b,this.slug=c,this.query=a&&a.main&&a.main.name?a.main.name:CustomPageHelper.unslugalize(c),this.tabs=null,this.changeMeta(),actionManager.addScrollListener(this,this.manageSidebar),window.scrollTo(0,0),_super(this)},initState:function(){return{data:this.data}},afterActions:function(){this.data.getReviews()&&this.data.getReviews().getOverall()&&CustomPageHelper.buildV4Canvas("reviews__main_score__canvas",this.data.getReviews().getOverall().getScore(),!0,72,5),this.data.getReviews()&&this.data.getReviews().getHighestScore()&&CustomPageHelper.buildV4Canvas("reviews__highest_score__canvas",this.data.getReviews().getHighestScore().getScore(),!1,40,3),this.data.getReviews()&&this.data.getReviews().getLowestScore()&&CustomPageHelper.buildV4Canvas("reviews__lowest_score__canvas",this.data.getReviews().getLowestScore().getScore(),!1,40,3),this.data.getReviews()&&this.data.getReviews().getAverageScore()&&CustomPageHelper.buildV4Canvas("reviews__average_score__canvas",this.data.getReviews().getAverageScore().getScore(),!1,40,3)},haveSocialPost:function(a,b){return a&&a.data&&a.data.getSocial(b)&&a.data.getSocial(b).getPosts().length>0},goTo:function(a){if(!a||!a.section)return!1;var b=$i(a.section);if(!b)return!1;var c=b.offsetTop;a.margin&&(c-=10),smoothScrollTo(c)},manageSidebar:function(){var a=$(".summary__sidebar")[0],b=window.scrollY;b>0&&b<=150?a.style.top=165-b+"px":b>150&&(a.style.top="15px"),this.tabs||(this.tabs=this.getTabs());var c=$(".summary__sidebar__item--selected"),d=!1,e=document.documentElement,f=e.scrollTop+window.innerHeight,g=e.offsetHeight,h=this;this.tabs.forEach(function(a){f!==g||d||(removeClass(c,"summary__sidebar__item--selected"),addClass($(".summary__sidebar--"+h.tabs[0].name)[0],"summary__sidebar__item--selected"),d=!0),b>=a.top&&!d&&(removeClass(c,"summary__sidebar__item--selected"),addClass($(".summary__sidebar--"+a.name)[0],"summary__sidebar__item--selected"),d=!0)})},getTabs:function(){var a=[];return SummaryPageComponent.TABS.forEach(function(b){var c=$i(b);c&&a.push({name:b,top:c.offsetTop-10})}),a},changeMeta:function(){var a=_("{appTitle} - Qwant {customPage}","overview",{appTitle:this.data.getMain().getName(),customPage:this.customPage}),b=this.data.getBiography()?this.data.getBiography().getContent(150):"";MetaHelper.set([{property:"og:title",content:a},{property:"og:site_name",content:_("{appTitle} Search","overview",{appTitle:config_get("appTitle")})},{property:"og:image",content:config_get("searchUrl")+config_get("logo.url")},{property:"og:url",content:document.URL},{property:"og:description",content:b},{name:"description",content:b}]),MetaHelper.changeTitle(a)}}),CustomPagePageComponent=Class(Component,{constructor:function(a){this.route=a,this.customPage=a.path.split("/")[0],this.slug=a.restParams[0],this.name="custom_page",this.load(),_super(this);var b=this;addClass(document.body,"no_sidebar"),addClass(document.body,this.customPage),LayoutComponent.registerBeforeAction(function(){removeClass(document.body,"no_sidebar"),removeClass(document.body,b.customPage)})},initState:function(){return{customPageHeader:null,component:null}},load:function(){var a=this,b={},c=new CustomPageModel;c[a.customPage]?c[a.customPage](a.slug).then(function(c,d,e,f){c?(l.error(c),page("/"),AlertComponent.error(_("An error has occurred","alert"))):(b.component=d,e&&(b.customPageHeader=new CustomPageHeaderComponent(e,a.slug,a.customPage,f)),a.setState(b),e&&(b.component.afterActions(),b.customPageHeader.afterActions()))}):(page("/"),AlertComponent.error(_("An error has occurred","alert")))}}),CustomPageHeaderComponent=Class(Component,{$statics:{SECTION_GAME:"game",SECTION_GAME_EDITOR:"game-editor",SECTION_METROPOLIS:"metropolis",SECTION_DISCOGRAPHY:"discography"},constructor:function(a,b,c,d){this.name="custom_page_header",this.defaultClassName="results-view",this.query=a&&a.main&&a.main.name?a.main.name:CustomPageHelper.unslugalize(b),this.slug=b,this.customPage=c,this.data=a,this.section=d,this.autocomplete=null,this.tooltip=new TooltipComponent(this,"Social Links"),this.webTagger=new WebTagger(this,{device:BrowserHelper.deviceType()}),Application.rootComponent.state.sideBar.changeSearch({item:QwantHomepageComponent.currentHomepage.name,changePage:!1}),this.logoForRetina="metropolis"===c,addClass(document.body,"scroll_on_results"),LayoutComponent.registerBeforeAction(function(){removeClass(document.body,"scroll_on_results"),SearchBarComponent.homeLastQuery=""}),actionManager.addSubmitListener(this,this.search,{key:"result-list__search"}),_super(this)},initState:function(){return{rawKeyPhrase:this.query,keyPhrase:this.query,encodedKeyPhrase:this.query,navigation:this.getNavigation(),data:this.data}},getNavigation:function(){return{game:[{name:_("Game page","custom_page_header"),section:CustomPageHeaderComponent.SECTION_GAME,href:CustomPageHelper.getOverviewRoute(this.customPage,this.data.getMain().getSlug())}],"game-editor":[{name:_("Games publisher page","custom_page_header"),section:CustomPageHeaderComponent.SECTION_GAME_EDITOR,href:CustomPageHelper.getOverviewRoute(this.customPage,this.data.getMain().getSlug())}],metropolis:[{name:_("Metropolis","custom_page_header"),section:CustomPageHeaderComponent.SECTION_METROPOLIS,href:CustomPageHelper.getOverviewRoute(this.customPage,this.data.getMain().getSlug())}]}[this.customPage]},getCurrentSection:function(){return this.section},afterActions:function(){CustomPageHelper.buildCanvas("custom_page_header__score__canvas",this.data.getMain().getScore(),!0)},scoreScroll:function(){var a=document.getElementById("scores_section");null!==a&&smoothScrollTo(getBoxPosition(a).top-50)}}),FavoritesComponent=Class(Component,{$statics:{getPageUrl:function(){var a="/?tab=bookmarks";return-1!=navigator.userAgent.indexOf("MSIE 9")&&(a="/#/?tab=bookmarks"),a}},constructor:function(){this.name="favorites",this.model=new FavoriteModel,this.favoriteUrlInputId="favoriteUrl",this.favoriteNameInputId="favoriteName",this.favoriteSourceInputId="favorite_page",_super(this)},openFavoritePopin:function(){var a=this;setTimeout(function(){null!==Dispatcher.getUrlParameter("url")&&(a.createFav(),a.favoriteNameInputId&&a.favoriteUrlInputId&&($i(a.favoriteUrlInputId).value=Dispatcher.getUrlParameter("url"),null!==Dispatcher.getUrlParameter("title")&&($i(a.favoriteNameInputId).value=Dispatcher.getUrlParameter("title")),$i(a.favoriteNameInputId).focus()))},700)},updateContent:function(a){if(applicationState.user.isLogged){var b=this.model.get(a),c=this;b.then(function(b,d){c.showFavorites(d),!0===a&&c.openFavoritePopin()})}else this.setState({})},showFavorites:function(a){if(a&&a.data){var b=constants.favoriteItemsBackground,c=a.data.length,d=a.data,e=this,f=d.map(function(a,c){var d=UrlHelper.extractDomain(a.url),f=d.split("."),g={id:a.id,url:a.url,name:a.name};return g.index=c,g.urlHostname=g.urlTopLevelDomain="",f.length>=2?(g.urlTopLevelDomain=f.pop(),g.urlHostname=f.join(".")):g.urlHostname=d,g.bgImageUrl=b[g.urlHostname.charCodeAt(0)%b.length],g.name=textSnippet(g.name,90),g.urlTopLevelDomain="."+textSnippet(g.urlTopLevelDomain,21),e.hasSpecialBg(g)&&(g.bgImageUrl=g.urlHostname),g});this.setState(new State({data:f,totalCount:c,search:"",hideBanner:!1})),this.activateSorting()}},hasSpecialBg:function(a){for(var b=0;b<constants.favoriteDomainsSpecials.length;++b)if(constants.favoriteDomainsSpecials[b]===a.url)return!0;return!1},onMount:function(){this.resizeUrls(),BrowserHelper.isTabletOrMobile||(this.state.createFav?BrowserHelper.focusInput($i(this.favoriteUrlInputId)):this.state.editFav&&BrowserHelper.focusInput($i(this.favoriteNameInputId)))},resizeUrls:function(){if("none"==$i(this.id).style.display)return!1;var a=$(".favorites__item .favorites__item__header");if(a.length>constants.FAVORITES_RESIZING_ALGORITHM_THRESHOLD){for(var b=0;b<a.length;b++){var c=a[b],d=$(".emphasis",c)[0],e=$(".normal",c)[0];d.style.overflow="hidden",e.style.fontSize="13px"}return!0}for(var b=0;b<a.length;b++){var c=a[b],d=$(".emphasis",c)[0],e=$(".normal",c)[0],f=parseInt(window.getComputedStyle(d).getPropertyValue("font-size").split("px")[0]),g=14,h=this.isElementOverflowing(d,c);if(h){for(;h&&f>15;)f--,d.style.fontSize=f+"px",h=this.isElementOverflowing(d,c);d.style.fontSize=f-2+"px"}else{for(;!h&&f<44;)f++,g--,d.style.fontSize=f+"px",0<=g&&(d.style.marginTop=g+"px"),h=this.isElementOverflowing(d,c);d.style.fontSize=f-4+"px"}d.innerHTML.length%2==0&&(d.style.fontWeight="600"),e.style.marginTop="-6px"}return!0},isElementOverflowing:function(a,b){var c=a.style.overflow;c&&"visible"===c||(a.style.overflow="visible");var d=b.getBoundingClientRect(),e=Math.ceil(d.width)-60,f=Math.ceil(d.height),g=a.scrollWidth>e||a.scrollHeight>f;return a.style.overflow=c,g},searchFavourite:function(a){var b=$i(a.key).value;this.state.data.forEach(function(a){-1===a.urlHostname.toLowerCase().indexOf(b)&&-1===a.name.toLowerCase().indexOf(b)?addClass($(".favorites__item--"+a.id),"hidden"):removeClass($(".favorites__item--"+a.id),"hidden")})},menuAction:function(a){applicationState.user.isLogged?this[a.action+"Fav"](a.favorite):(page("/login"),AlertComponent.info(_("You must be logged in to edit your bookmarks","favorites")))},createFav:function(){if(!applicationState.user.isLogged)return page("/login"),void AlertComponent.info(_("You must be logged in to edit your bookmarks","favorites"));this.state.createFav=!0,this.state.editFav&&(this.state.editFav=!1),this.setState(this.state),addClass($(".favorites__item--create .favorites__item__subwrapper")[0],"zoom")},editFav:function(a){this.state.editFav=a.id,this.state.createFav&&(this.state.createFav=!1),this.setState(this.state),setTimeout(function(){addClass($(".favorites__item--edit .favorites__item__subwrapper")[0],"zoom")},0)},editFavUpdateLabel:function(){var a=$(".settings__form__option__toggle-switch__label")[0],b=$i("favoriteCheckbox").checked;a.innerHTML=b?_("Private","favorites"):_("Public","favorites")},deleteFav:function(a){this.state.deleteFav=FavoriteModel.areFavoritesStoredLocally()?a.index:a.id;var b=this;AlertComponent.confirm(_("Do you really want to delete this bookmark?","favorites"),this,function(){this.model.delete(parseInt(this.state.deleteFav)).then(function(a,c){a||(AlertComponent.info(_("Your bookmark has been deleted.","favorites")),b.state.deleteFav=null,b.updateContent(),Application.rootComponent.refresh(),b.resizeUrls())})},function(){AlertComponent.clearAll()},{})},order:function(a){if(!applicationState.user.isLogged)return page("/login"),void AlertComponent.info(_("You must be logged in to edit your bookmarks","favorites"));for(var b=$(".favorites__item"),c=[],d=this,e=0;e<b.length-1;++e){var f=b[e].className.replace(/^\D+|\D+$/g,"");c.push(f)}(new FavoriteModel).order(c).then(function(a,b){a?AlertComponent.error(_("Your bookmarks could not be reordered, please try again.","favorites")):AlertComponent.info(_("Your bookmarks have been reordered.","favorites")),d.updateContent(),d.activateSorting()})},submitFavorite:function(a){var b=a.state,c=a.favoriteItem,d=$i(this.favoriteNameInputId).value,e=$i(this.favoriteUrlInputId).value,f=$i(this.favoriteSourceInputId).value,g=this;if(0==/^(http(s)?:\/\/)?[a-z0-9-]+\.(.[a-z0-9-]+)*(:[0-9]+)?(\/.*)?$/.test(e))return void AlertComponent.error(_("Favorite URL format is invalid","alert"));if(a.favoriteItem&&a.favoriteItem.url===e&&a.favoriteItem.name===d)return void AlertComponent.error(_("The favorite is unchanged.","favorites"));if("edit"===b){var h=FavoriteModel.areFavoritesStoredLocally()?c.index:c.id;this.model.update(d,e,1,h).then(function(a){a?g.handleError(a):(AlertComponent.success(_("Your bookmark has been updated.","favorites")),g.updateContent())})}else this.model.create(d,e,1,f).then(function(a){a?g.handleError(a):(AlertComponent.success(_("Your bookmark has been created.","favorites")),g.updateContent(),document.dispatchEvent(new CustomEvent("qwant_website_bookmark_created")))})},handleError:function(a){FavoriteModel.ERROR_FAVORITE_ALREADY_EXISTS==a?AlertComponent.error(_("This Web page already exists in your bookmarks.","favorites")):FavoriteModel.ERROR_FAVORITE_URL_NOT_ACCESSIBLE==a?AlertComponent.error(_("The given URL is not accessible.","favorites")):AlertComponent.error(_("An error has occurred while trying to add a bookmark link, please try again.","search"))},closeForm:function(){this.state.createFav&&(this.state.createFav=!1),this.state.editFav&&(this.state.editFav=!1),this.setState(this.state),this.activateSorting()},activateSorting:function(){$(".favorites__sub-container").length>0&&!BrowserHelper.isTabletOrMobile&&(this.sortable=Sortable.create($(".favorites__sub-container")[0],{sort:!0,filter:".favorites__item--empty",ghostClass:"favorites__item--ghost",scroll:!0,onUpdate:this.order.bind(this)}))}}),FooterComponent=Class(Component,{constructor:function(){this.name="footer",_super(this)}}),HeaderComponent=Class(Component,{$statics:{imageURL:null,GAMES:"games",MUSIC:"music",JUNIOR:"junior",CAUSES:"causes",WEB:"web",toggleVerticals:function(){var a=$(".verticals__toggle"),b=$(".verticals__item"),c=$(".verticals__items__container"),d=$(".verticals__container__mobile");hasClass(a,"verticals__toggle__icon--reduce")?(removeClass(a,"verticals__toggle__icon--reduce"),addClass(b,"verticals__item--expanded"),removeClass(b,"verticals__item--displayed"),removeClass(c,"verticals__items__container--displayed"),removeClass($(".verticals__buttons"),"verticals__buttons--displayed"),removeClass(d,"verticals__container__mobile--displayed")):(addClass(a,"verticals__toggle__icon--reduce"),removeClass(b,"verticals__item--expanded"),addClass(b,"verticals__item--displayed"),addClass(c,"verticals__items__container--displayed"),addClass($(".verticals__buttons"),"verticals__buttons--displayed"),addClass(d,"verticals__container__mobile--displayed"))},toggleMobileVerticals:function(){toggleClass($(".verticals__btns--toggle")[0],"active"),toggleClass($(".verticals__btns--container")[0],"active")},navigate:function(a){
a.to===HeaderComponent.GAMES&&page("/game/"+a.query),a.to===HeaderComponent.MUSIC&&(null!==a.query?window.location=config_get("qwantUrl")+"/music/search?q="+a.query:window.location=config_get("qwantUrl")+"/music"),a.to===HeaderComponent.CAUSES&&(null!==a.query?window.location=config_get("qwantUrl")+"/causes/"+applicationState.user.userSetting.getInterfaceLanguageCode()+"?q="+a.query:window.location=config_get("qwantUrl")+"/causes"),a.to===HeaderComponent.WEB&&(null!==a.query?page("/?q="+a.query+"&t=web"):page("/")),a.to===HeaderComponent.JUNIOR&&(window.location=config_get("juniorUrl"))},goToOrg:function(){window.location.href=window.location.href.replace("://www.","://org.")},hideTooltipCause:function(){removeClass($(".tooltip_switch_cause")[0],"active")}},constructor:function(){this.name="header",this.isStatic=!1,HeaderComponent.$super.call(this),LayoutComponent.registerComponent(this),actionManager.onCustomEvent(this,UserModel.EVENT_INVALID_SESSION,UserModel.logout,{isPersistant:!0,withAjaxRequest:!1})},initState:function(){return{user:applicationState.user,userDropDown:this.getUserDropDown(),preciseSearchLanguageCode:this.preciseSearchLanguageCode(),preciseSearchCountryCode:this.preciseSearchCountryCode()}},preciseSearchLanguageCode:function(){var a=LanguageHelper.getLanguage(applicationState.user.userSetting.getSearchLanguageCode()),b=applicationState.user.userSetting.getSearchRegionCode(),c=LanguageHelper.getCountryLanguages(b),d=!1;return a.hasOwnProperty("hasFlag")?d:(c.forEach(function(b){b.code===a.code||b.hasOwnProperty("hasFlag")||(d=applicationState.user.userSetting.getSearchLanguageCode())}),d)},preciseSearchCountryCode:function(){var a=LanguageHelper.getLanguage(applicationState.user.userSetting.getSearchLanguageCode()),b=!1;return a.hasOwnProperty("displayCountryCode")&&(b=!0),b},notify:function(a){this.state.userDropDown=this.getUserDropDown(),this.state.preciseSearchLanguageCode=this.preciseSearchLanguageCode(),this.state.preciseSearchCountryCode=this.preciseSearchCountryCode(),this.setState(this.state)},getUserDropDown:function(){return UserModel.getHeaderDropDownItems()},chooseLink:function(a){""!==a&&window.open(a),this.state.userDropDown=this.getUserDropDown(),this.state.preciseSearchLanguageCode=this.preciseSearchLanguageCode(),this.state.preciseSearchCountryCode=this.preciseSearchCountryCode(),this.setState(this.state)},chooseUserAction:function(a){""!==a&&("/logout"==a?UserModel.logout():page(a)),this.state.user=applicationState.user,this.state.userDropDown=this.getUserDropDown(),this.state.preciseSearchLanguageCode=this.preciseSearchLanguageCode(),this.state.preciseSearchCountryCode=this.preciseSearchCountryCode(),this.setState(this.state)},displayShareQwant:function(){setTimeout(function(){var a=$(".home__snippet__extension")[0],b=$(".header__share-qwant")[0];if(a&&b){var c=getComputedStyle(a);c&&"none"===c.display&&!b.style.display&&(b.style.display="inline-block")}},50)}}),HeaderStaticComponent=Class(HeaderComponent,{constructor:function(a,b){HeaderStaticComponent.$super.call(this),this.title=a,this.isStatic=!0,this.useNativeHistory=!(!b||!b.useNativeHistory)&&b.useNativeHistory,this.referer=b.route&&b.route.params&&b.route.params.referer?b.route.params.referer:null,Application.rootComponent.state.headerStatic=this,addClass(document.body,"scroll_on_statics"),LayoutComponent.registerBeforeAction(function(){removeClass(document.body,"scroll_on_statics")})},goBack:function(){this.referer?window.location=config_get("qwantUrl")+this.referer:this.useNativeHistory?history.length>1?history.go(-1):document.location.href="/":Dispatcher.history.goTo(0)}}),AllContentComponent=Class(Component,{$statics:{_AVAILABLE_TABS:["","trends"]},constructor:function(a){this.route=a,this.name="all_content",this.currentTabIndex=this.getActiveTabName(),this.currentTabComponent=this.getTabComponent(this.currentTabIndex),null!==this.currentTabComponent&&this.currentTabComponent.updateContent(!0),_super(this)},initState:function(){return{currentTab:this.currentTabComponent,currentTabIndex:this.currentTabIndex,currentTabLink:this.currentTabLink,mediaOverlay:new MediaOverlayComponent(this.route)}},getActiveTabName:function(){var a=Dispatcher.getUrlParameter("tab");if(void 0==a)return applicationState.user.userSetting.showTrends;var b=AllContentComponent._AVAILABLE_TABS.indexOf(a);return-1===b?applicationState.user.userSetting.showTrends:b||applicationState.user.userSetting.showTrends},getTabComponent:function(a){var b;switch(a){case 1:b=new TrendsComponent;break;default:b=null}return b},hideTrends:function(){AlertComponent.confirm(_("Hide trends? This choice can be undone from the settings page.","trends"),this,function(){applicationState.user.userSetting.showTrends=0,applicationState.user.userSetting.update().then(function(a,b){if(!a){Application.rootComponent.refresh();var c=$(".trends")[0],d=$i("home__links");c&&d&&(c.style.display="none",d.style.display="none"),AlertComponent.success(_("Trends successfully hidden from the home page.","trends"))}})},function(){AlertComponent.clearAll()},{})}}),ExtensionPopinComponent=Class(Component,{$statics:{WEEK_IN_MS:6048e5},constructor:function(){this.name="extension_popin",this.isDisplayed=ExtensionHelper.displayPopin(),_super(this),actionManager.onCustomEvent(this,"rendered",function(){if(("chrome"===BrowserHelper.getBrowserUri()||["p_techstage_1","p_gazzetta_d_b3","p_gazzetta_d_b2","p_corriere_d_b3","p_corriere_d_b1","p_welt","brz-brave"].indexOf(userClient)>=0)&&!BrowserHelper.isTabletOrMobile&&$(".results-page--web").length>0){var a=this.id;addClass($i(a),"active with-right-column"),setTimeout(function(){$(".ia_container").length>0&&"none"!==$(".ia_container")[0].style.display||$(".results-column--smart").length>0&&"none"!==$(".results-column--smart")[0].style.display||Dispatcher.history.get(0).rawParams&&Dispatcher.history.get(0).rawParams.source||removeClass($i(a),"with-right-column")},1e3)}})},initState:function(){return{isDisplayed:this.isDisplayed}},willBeDisplayed:function(){var a=$(".home__snippet__extension");if(this.isDisplayed&&a.length>0&&"none"!==window.getComputedStyle(a[0],null).getPropertyValue("display"))return!0}}),QwantHomepageComponent=Class(Component,{$statics:{currentHomepage:{},loadBarStepsByComponent:[{component:"AllContentComponent",condition:function(){var a=null,b=Dispatcher.getUrlParameter("tab");if(b){-1!==AllContentComponent._AVAILABLE_TABS.indexOf(b)&&(a=b)}return"trends"===a||!a&&1===applicationState.user.userSetting.showTrends},steps:4}],isAppMobile:function(){return-1!==navigator.userAgent.indexOf("QwantMobile")||-1!==navigator.userAgent.indexOf("QwantBrowser")||-1!==navigator.userAgent.indexOf("QwantiOS")}},constructor:function(a){this.route=a,this.name="home_page",this.autocomplete=null,this.extensionPopin=new ExtensionPopinComponent,this.shouldDisplayQwoodle=!1,this.mediaOverlay=new MediaOverlayComponent(a),QwantHomepageComponent.currentHomepage=this.getCurrentHomepage(),Application.rootComponent.state.sideBar.toggleHomePage(QwantHomepageComponent.currentHomepage.name),window.scrollTo(0);var b=QwantHomepageComponent.currentHomepage.name.charAt(0).toUpperCase()+QwantHomepageComponent.currentHomepage.name.slice(1);this.homepageComponent=b+"ContentComponent";var c=this.getLoadBarSteps();LoadBarComponent.clear(),LoadBarComponent.init(c),this.getEvents(),Component.call(this),LayoutComponent.registerBeforeAction(function(){removeClass(document.body,"scroll_on_homepage")}),actionManager.onCustomEvent(this,"pageRendered",function(){addClass($(".home_page")[0],QwantHomepageComponent.currentHomepage.name+"_home_page")}),addClass(document.body,"scroll_on_homepage"),a.hasOwnProperty("params")&&a.params.hasOwnProperty("tab")&&"bookmarks"===a.params.tab&&(AppMenuComponent.open({content:AppMenuComponent._BOOKMARKS}),a.params.hasOwnProperty("url")&&setTimeout(function(){Application.rootComponent.state.appMenu.addBookmark({bookmark:{url:a.params.url,name:a.params.hasOwnProperty("title")?a.params.title:""}})},1500)),"settings"===a.restParams.input&&AppMenuComponent.open({content:AppMenuComponent._SETTINGS}),"region"===a.restParams.input&&AppMenuComponent.open({content:AppMenuComponent._LANGUAGE})},onMount:function(){if(BrowserHelper.isMobile){var a=$(".search_bar__form__input")[0];a&&a.addEventListener("click",function(a){addClass($("body"),"mobile__input__focus")})}},initState:function(){return{section:QwantHomepageComponent.currentHomepage.name,name:QwantHomepageComponent.currentHomepage.displayName?QwantHomepageComponent.currentHomepage.i18n():null,content:this.getContent(),qwoodle:-1,snippet:-1,extensionPopin:this.extensionPopin,openEduMorePanel:this.openEduMorePanel,mediaOverlay:this.mediaOverlay}},getCurrentHomepage:function(){return siteConfiguration.searchCategories.ALL},getContentClass:function(){return window[this.homepageComponent]},getContent:function(){var a=this.getContentClass();return a?new a(this.route):null},getEvents:function(){var a={locale:applicationState.user.userSetting.getLocalisedSearchRegionCode(),t:"web",device:SiteHelper.getDeviceName(),uiv:4};applicationState.user.isLogged&&(a.session_token=applicationState.user.token);var b=AjaxManager.get(ajax.getEvents(),new AjaxParameters(a).getParameters()),c=this;PromiseHelper.joinWithPageRendered(b).then(function(a,b){LoadBarComponent.step(),c.state||(c.state={}),b&&!b.error?(c.generateState(b.data.events),b.data.test&&c.generateState(b.data.test.web),"0"===Dispatcher.getUrlParameter("qwoodle")&&(c.state.qwoodle=0),c.setState(c.state),c.state.qwoodle&&0!==c.state.qwoodle&&-1!==c.state.qwoodle&&LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"displayEvent",type:"qwoodle",t:"web",item:c.state.qwoodle.id}),c.state.snippet&&0!==c.state.snippet&&-1!==c.state.snippet&&LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"displayEvent",type:"snippet",t:"web",item:c.state.snippet.id}),c.extensionPopin.willBeDisplayed()&&LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"extensionHomepagePopin",type:"display",browser:BrowserHelper.getBrowserUri(),os:BrowserHelper.getOS()})):(c.state.qwoodle=0,c.setState(c.state)),"1"===c.route.rawParams.live&&0!==c.state.live&&c.displayLiveEvent(c.state.live)}),LoadBarComponent.step()},generateState:function(a){a.qwoodle?(this.state.qwoodle=a.qwoodle,a.qwoodle.interactive&&a.qwoodle.interactive.js&&"string"==typeof a.qwoodle.interactive.js&&(window.interactiveQwoodleJS=new Function(a.qwoodle.interactive.js)),a.qwoodle.extended&&a.qwoodle.extended.js&&(window.extendedQwoodleJs=new Function(a.qwoodle.extended.js)),a.qwoodle.extended&&void 0!==this.route.params.open&&this.route.params.open+""=="1"&&(this.state.extendedOpen=!0),this.shouldDisplayQwoodle="object"==typeof this.state.qwoodle&&(BrowserHelper.isTabletOrMobile&&this.state.qwoodle.mobile||!BrowserHelper.isTabletOrMobile&&this.state.qwoodle.desktop)&&(this.state.qwoodle.applications&&QwantHomepageComponent.isAppMobile()||!QwantHomepageComponent.isAppMobile()),this.qwoodleLink=this.state.qwoodle.link,"Android"===BrowserHelper.getOS()?this.qwoodleLink=this.state.qwoodle.link_mobile_android:"iOS"===BrowserHelper.getOS()&&(this.qwoodleLink=this.state.qwoodle.link_mobile_iOS)):this.state.qwoodle=0,a.snippet?this.state.snippet=a.snippet:this.state.snippet=0,a.live?this.state.live=a.live:this.state.live=0},getLoadBarSteps:function(){var a=2,b=this.homepageComponent;return QwantHomepageComponent.loadBarStepsByComponent.forEach(function(c){c.component===b&&c.condition()&&(a=c.steps)}),a},openEduMorePanel:function(){var a=$i("edu_description__text__more");a&&0==getComputed(a,"max-height")&&(a.style.maxHeight="500px",a.style.paddingBottom="50px"),$i("edu_description__link").style.display="none",$(".edu_description")[0].style.color="#393b3d"},displayLiveEvent:function(a){a.type="video",a.title=a.name,a.media="https://kamoov.com/",a.url="https://kamoov.com/",a.index=0,MediaOverlayComponent.setMedias([a])},getSnippetLink:function(a){if("_self"!==a.target&&applicationState.user.userSetting.targetBlank&&0!==applicationState.user.userSetting.targetBlank||("/music"===a.link&&(a.link="javascript:window.location = '"+config_get("qwantUrl")+"/music';"),"/music"===a.link_mobile_iOS&&(a.link_mobile_iOS="javascript:window.location = '"+config_get("qwantUrl")+"/music';"),"/music"===a.link_mobile_android&&(a.link_mobile_android="javascript:window.location = '"+config_get("qwantUrl")+"/music';")),BrowserHelper.isTabletOrMobile){var b=BrowserHelper.getOS();if("ios"===b.toLowerCase()&&a.link_mobile_iOS)return a.link_mobile_iOS;if("android"===b.toLowerCase()&&a.link_mobile_android)return a.link_mobile_android}return a.link},getSnippetImg:function(a){var b=BrowserHelper.isRetina()?"x2":"x1";return 1===applicationState.user.userSetting.selectedTheme&&(b="dark_"+b),a[b]},getQwoodleImg:function(a){var b;return b=a.dark_x1&&hasClass(document.body,"theme-dark")?BrowserHelper.isRetina()?a.dark_x2:a.dark_x1:BrowserHelper.isRetina()?a.x2:a.x1,"firefox"===BrowserHelper.getBrowserUri()&&(b+="?"+(new Date).getTime()),b}});ExtendedQwoodle.toggle=function(){var a=$i("extended_qwoodle");a&&0==getComputed(a,"max-height")?(a.style.maxHeight="1000px",void 0!==window.extendedQwoodleJs&&window.extendedQwoodleJs()):a.style.maxHeight="0px"};var ImageComponent=Class(Component,{constructor:function(a){this.background=a.background||!1,this.tag=this.background?"div":"img",this.name="image",this.src=a.src,this.lazyload=a.lazyload||!1,this.classes=a.classes||"",this.eventsList=a.eventsList||{},this.attrList=a.attrList||{},this.fallbackSrc=a.fallbackSrc,_super(this),actionManager.onCustomEvent(this,"rendered",this.init)},init:function(){var a=$i(this.id),b=this;if(a){a.className=this.classes,this.background||(a.onerror=function(){this.onerror=null,this.style.minHeight="initial",this.style.minWidth="initial",this.src=b.fallbackSrc});for(var c in this.eventsList)a.addEventListener(c,this.eventsList[c]);for(var d in this.attrList)a.setAttribute(d,this.attrList[d]);this.lazyload&&window.IntersectionObserver&&"edge"!==BrowserHelper.getBrowserUri()?(a.setAttribute("data-src",this.src),Application.rootComponent.lazyload.observer.observe(a)):this.background?a.style.backgroundImage="url("+this.src+"), url("+this.fallbackSrc+")":a.src=this.src}}}),LoadBarComponent=Class(Component,function(){return{constructor:function(){LayoutComponent.registerBeforeAction(LoadBarComponent.clear,[]),this.isDisplayed=!1,this.name="load_bar",LoadBarComponent.load=this,LoadBarComponent.currentStep=0,"firefox"===BrowserHelper.getBrowserUri()&&BrowserHelper.isTabletOrMobile&&(this.defaultClassName="load_bar--inactive"),_super(this)},initState:function(){return{advancement:0}},hide:function(){var a=$i(this.id);removeClass(a,"load_bar--with-transition"),a.offsetHeight,a.style.width=0},start:function(){var a=$i(this.id);a.style.width="10%",a.style.height="2px",a.offsetHeight,addClass(a,"load_bar--with-transition")},update:function(a){a=Math.min(a,100);var b=$i(this.id),c=this;100==a&&(this.removeHandler=setTimeout(function(){b.style.height=0},800)),this.advanceHandler=setTimeout(function(){a>=c.state.advancement&&($i(c.id).style.width=a+"%")},0)},$statics:{init:function(a){clearTimeout(LoadBarComponent.load.advanceHandler),clearTimeout(LoadBarComponent.load.removeHandler),LoadBarComponent.stepCount=a,LoadBarComponent.currentStep=0,LoadBarComponent.load.start()},step:function(){LoadBarComponent.currentStep+=1;var a=LoadBarComponent.currentStep/LoadBarComponent.stepCount*100;LoadBarComponent.load.update(a)},clear:function(){LoadBarComponent.load.hide(),clearTimeout(LoadBarComponent.load.advanceHandler),clearTimeout(LoadBarComponent.load.removeHandler)}}}}),LocalFiltersComponent=Class(Component,{constructor:function(a,b,c){this.name="local_filters",this.localFilters=this.choosesFilter(a,b,c),_super(this)},initState:function(){return{localFilters:this.localFilters}},onMount:function(){this.localFilters&&this.localFilters.onMount()},choosesFilter:function(a,b,c){var d=null;return"pages_jaunes"===a&&(d=new LocalFiltersPagesJaunesComponent(b,c)),d},getFilters:function(){return this.localFilters},updateFilters:function(a,b,c){this.localFilters=this.choosesFilter(a,b,c),this.setState({localFilters:this.localFilters})},hideFiltersDropdown:function(){this.localFilters&&this.localFilters.updateFiltersDropdownDisplay(!1)},showFiltersDropdown:function(){this.localFilters.updateFiltersDropdownDisplay(!0)}}),LocalFiltersPagesJaunesComponent=Class(Component,{constructor:function(a,b){this.name="local_filters_pages_jaunes",this.selectedFilters=a,this.getSelectedFilters=this.getSelectedFilters.bind(this),this.callback=b,this.filtersActive=!0,this.needValidationTime=!!BrowserHelper.isTabletOrMobile,this.tempFilters={},this.filters=this.initFilters(),_super(this)},initFilters:function(){return{ratingsListNoRefresh:new ListNoRefreshComponent(this.ratingsListItems(this.selectedFilters.reviews||""),this.ratingsListOptions()),openingHoursListNoRefresh:new ListNoRefreshComponent(this.openingHoursListItems(this.selectedFilters.openingHours||""),this.openingHoursListOptions()),ratingsDropDown:new LocalDropDownComponent(this.ratingsListItems(this.selectedFilters.reviews||""),this.ratingsDropdownOptions(),LocalHelper.closeAllDropDowns.bind(this,[])),openingHoursDropDown:new LocalDropDownComponent(this.openingHoursListItems(this.selectedFilters.openingHours||""),this.openingHoursDropdownOptions(),LocalHelper.closeAllDropDowns.bind(this,[]))}},initState:function(){return{filters:this.filters,filtersActive:this.filtersActive}},onMount:function(){this.filters.openingHoursDropDown&&this.updateDotFilter(this.selectedFilters.openingHours,this.filters.openingHoursDropDown),this.filters.ratingsDropDown&&this.updateDotFilter(this.selectedFilters.reviews,this.filters.ratingsDropDown)},ratingsListItems:function(a){return[{label:_("All ratings","local"),value:"",selected:""===a},{label:_("{rating} and higher","local",{rating:4}),value:"4",selected:"4"===a},{label:_("{rating} and higher","local",{rating:3}),value:"3",selected:"3"===a},{label:_("{rating} and higher","local",{rating:2}),value:"2",selected:"2"===a}]},openingHoursListItems:function(a){return[{label:_("Any Date","local"),value:"",selected:""===a},{label:LocalHelper.capitalizeFirstLetter(i18n.date.dayNames[1]),value:"Mo",selected:"Mo"===a},{label:LocalHelper.capitalizeFirstLetter(i18n.date.dayNames[2]),value:"Tu",selected:"Tu"===a},{label:LocalHelper.capitalizeFirstLetter(i18n.date.dayNames[3]),value:"We",selected:"We"===a},{label:LocalHelper.capitalizeFirstLetter(i18n.date.dayNames[4]),value:"Th",selected:"Th"===a},{label:LocalHelper.capitalizeFirstLetter(i18n.date.dayNames[5]),value:"Fr",selected:"Fr"===a},{label:LocalHelper.capitalizeFirstLetter(i18n.date.dayNames[6]),value:"Sa",selected:"Sa"===a},{label:LocalHelper.capitalizeFirstLetter(i18n.date.dayNames[0]),value:"Su",selected:"Su"===a}]},ratingsDropdownOptions:function(){return{placeholder:LocalHelper.getLabel(this.ratingsListItems(),this.selectedFilters.reviews||"",_("All reviews","local")),callback:this.selectFilter,component:this,filter:"reviews",value:""}},openingHoursDropdownOptions:function(){return{placeholder:LocalHelper.getLabel(this.openingHoursListItems(),this.selectedFilters.openingHours||"",_("Any date","local")),callback:this.selectFilter,component:this,filter:"openingHours",value:""}},ratingsListOptions:function(){return{callback:this.selectFilter,component:this,element:"result_filter__item--reviews",filter:"reviews"}},openingHoursListOptions:function(){return{callback:this.selectFilter,component:this,element:"result_filter__item--openingHours",filter:"openingHours"}},getSelectedFilters:function(){return this.selectedFilters},selectFilter:function(a,b){this.needValidationTime?this.tempFilters[b.filter]=a:(this.applyFilter(a,b.filter),LocalHelper.closeFilters(),this.callback())},applyFilter:function(a,b){switch(b){case"reviews":this.selectedFilters.reviews=a,UrlHelper.removeGETParam(["reviews"]),this.selectedFilters.reviews&&""!==this.selectedFilters.reviews&&UrlHelper.addGETParam("reviews",encodeURIComponent(this.selectedFilters.reviews)),this.updateDotFilter(a,this.filters.ratingsDropDown);break;case"openingHours":this.selectedFilters.openingHours=a,UrlHelper.removeGETParam(["openingHours"]),this.selectedFilters.openingHours&&""!==this.selectedFilters.openingHours&&UrlHelper.addGETParam("openingHours",encodeURIComponent(this.selectedFilters.openingHours)),this.updateDotFilter(a,this.filters.openingHoursDropDown)}},updateDotFilter:function(a,b){var c=$("#"+b.id+" .dropdown__item"),d={};b.items.forEach(function(b){b.value===a&&(d=b)}),c.forEach(function(a){a.innerHTML===d.label?addClass(a,"dropdown__item__selected"):removeClass(a,"dropdown__item__selected")})},saveFilters:function(){for(var a in this.tempFilters)this.applyFilter(this.tempFilters[a],a);LocalHelper.closeFilters(),this.callback()},cleanFilters:function(){UrlHelper.removeGETParam(["reviews","openingHours"]),this.filters=this.initFilters(),this.resetState()},leaveFilters:function(){LocalHelper.closeFilters(),this.resetState()},updateFiltersDropdownDisplay:function(a){this.filtersActive=a,this.resetState()},resetState:function(){this.setState({filters:this.filters,filtersActive:this.filtersActive})}}),LocalMarkerComponent=Class({$statics:{PIN_DEFAULT_MULTIPLE:"map",PIN_DEFAULT_SINGLE:"map-without-outline"},constructor:function(a,b,c){this.data=a,this.context=c,this.items=b},createIconsInfos:function(a){var b=[],c=this;return a.forEach(function(d){var e={},f=null,g=MapsFactory.leafIcon.local.default.className,h=null,i=MapsFactory.leafIcon.local.hover.className,j="",k=d.review?d.review.mark:null,l=d.picture,m=d.review?d.review.count:null,n=null;if("pages_jaunes"===c.data.type){if(e=c.buildPagesJaunesActions(d,c.data.type),j=d.name,1===a.length){var o=void 0!==d.iconCategory&&null!=d.iconCategory?d.iconCategory:LocalMarkerComponent.PIN_DEFAULT_SINGLE;f=c.buildMarker(o,e,35,42),g=MapsFactory.leafIcon.local.selected.className}else{var o=void 0!==d.iconCategory&&null!=d.iconCategory?d.iconCategory:LocalMarkerComponent.PIN_DEFAULT_MULTIPLE;f=c.buildMarker(o,e,18,22),h=c.buildMarker(o,e,35,42)}n=c.buildTooltip(l,k,m,j,c.data.type)}else if("city"===c.data.type)if(1===a.length){var o=void 0!==d.iconCategory&&null!=d.iconCategory?d.iconCategory:LocalMarkerComponent.PIN_DEFAULT_SINGLE;f=c.buildMarker(o,e,35,42),g=MapsFactory.leafIcon.local.selected.className}else{var o=void 0!==d.iconCategory&&null!=d.iconCategory?d.iconCategory:LocalMarkerComponent.PIN_DEFAULT_MULTIPLE;f=c.buildMarker(o,e,18,22),h=c.buildMarker(o,e,35,42),j=d.name,n=c.buildTooltip(l,k,m,j,c.data.type)}b.push({key:d.key,latitude:d.coordinates.latitude,longitude:d.coordinates.longitude,icon:f,iconClass:g,iconSelected:h,iconSelectedClass:i,tooltip:n,context:c.context,identity:"ia_local"})}),b},buildTooltip:function(a,b,c,d,e){var f=this.buildPicture(a);return f+='<div class="local-detail__info">',f+='<h1 class="local-detail__name">'+d+"</h1>",null!==c&&null!==b&&(f+=this.buildReview(c,b)),"pages_jaunes"===e&&(f+='<span class="local__partner_icon local__partner_icon_pages_jaunes tooltip-local__partner"></span>'),f+="</div>"},buildPicture:function(a){var b='<div class="tooltip-local__no-image"><svg width="20" height="20" viewBox="0 0 24 24"><use xlink:href="/img/v4/icon-spritesheet.svg#image"></use></svg></div>';return a&&(b='<div class="tooltip-local__image" style="background:url('+a+');background-size: auto 60px"></div>'),b},buildReview:function(a,b){var c='<span class="result-local__no-reviews">'+_("No reviews","local")+"</span>";if(a){c='<div class="local-detail__rating">'+this.buildStars(b)+'&nbsp;<a class="result-local__reviews">'+_n("%d review","%d reviews",a)+"</a></div>"}return c},buildStars:function(a){for(var b="",c=0;c<a;c++)b+='<svg class="local_star_container active" viewBox="0 0 24 24"><use xlink:href="/img/v4/icon-spritesheet.svg?1559053494836#star"></use></svg>';for(var c=0;c<5-a;c++)b+='<svg class="local_star_container empty" viewBox="0 0 24 24"><use xlink:href="/img/v4/icon-spritesheet.svg?1559053494836#star"></use></svg>';return b},buildPagesJaunesActions:function(a){var b=this;return actionManager.addClickListener(b.context,b.context.openDetailFromMarker,{item:a,data:b.data})},buildMarker:function(a,b,c,d){var e="<svg ";return b&&(e+='id="'+b+'" '),e+='width="'+c+'" height="'+d+'"><use xlink:href="/img/v4/icon-spritesheet.svg?1559053494836#icon-pin-'+a+'"></use></svg>'},getMarkers:function(){return this.createIconsInfos(this.items)}}),ResultDetailLocalComponent=Class(Component,{$statics:{listItemReference:{images:{list:".local-detail__images_list",container:".local-detail__images_list-container",arrowRight:".local-detail__images_list-arrow_right",arrowLeft:".local-detail__images_list-arrow_left",item:".local-detail__images_list-item",margin:10,lastOffset:0}},openingDays:["Mo","Tu","We","Th","Fr","Sa","Su"]},constructor:function(a){this.name="result_detail_local",this.data=null,this.type=null,this.context=a,this.updateCarousel(),_super(this)},initState:function(){return{data:this.data}},addData:function(a,b,c){this.data=b,this.type=a.type,this.uniqueItem=1===a.items.length,this.storeOpenComponent=new ResultStoreOpenLocalComponent(this.data),this.setState({data:this.data,type:this.type,categoryPJTriggered:this.data.categoryTriggered?this.data.categoryTriggered:"unknown",uniqueItem:this.uniqueItem,options:c,query:this.context.query,resultPartner:this.context.resultPartner,storeOpenComponent:this.storeOpenComponent}),this.updateCarousel()},clearData:function(){this.data=null,this.type=null,this.setState({data:this.data,type:this.type})},closeDetail:function(){this.context.closeDetail()},getCurrentData:function(){return this.data},updateCarousel:function(){this.data&&this.data.images&&(BrowserHelper.isTabletOrMobile?LocalHelper.setSwipableList("images",this.getImagesWidth(),this):LocalHelper.checkListScrollable(ResultDetailLocalComponent.listItemReference.images.list,ResultDetailLocalComponent.listItemReference.images.arrowRight,this.getImagesWidth()))},formatDisplayCategory:function(a){return LocalHelper.formatDisplayCategory(a)},showPhoneNumbers:function(a){a.caller=$i("local-detail__buttons__phone"),LocalHelper.showPhoneNumbers(a,"ribbon_local-container__info-phone-numbers-button","result-local__phone-numbers")},getImagesWidth:function(){if(this.data){var a=0;return this.data.images.forEach(function(b){a+=140*b.width/b.height,a+=ResultDetailLocalComponent.listItemReference.images.margin}),a}return 0},toggleOpeningHours:function(){var a=$(".local-detail_opening_hours")[0];a&&toggleClass(a,"local-detail_opening_hours--visible")}}),ResultListLocalComponent=Class(Component,{$statics:{listItemReference:{images:{list:".local-city__images_list",container:".local-city__images_list-container",arrowRight:".local-city__images_list-arrow_right",arrowLeft:".local-city__images_list-arrow_left",item:".local-city__images_list-item",margin:10,lastOffset:0}}},constructor:function(a){this.name="result_list_local",this.data=null,this.context=a,this.resultListPlace=null,this.resultListPlace=null,_super(this)},initState:function(){return{data:this.data,ghostLoading:!1,query:this.context.query,localFiltersMonitor:this.context.localFiltersMonitor,resultListPlace:this.resultListPlace}},updateData:function(a){this.data=a,this.updateListPOI(),this.setState({data:a,ghostLoading:!1,query:this.context.query,localFiltersMonitor:this.context.localFiltersMonitor,resultListPlace:this.resultListPlace})},updateListPOI:function(){"city"===this.data.type&&(this.resultListPlace=new ResultListPlaceLocalComponent(this.data,this.context))},activateGhostLoading:function(){var a=$(".result_list_local")[0];a&&a.scrollTo(0,0),this.state.ghostLoading=!0,this.setState(this.state)},showPhoneNumbers:function(a){LocalHelper.showPhoneNumbers(a,"result-local__phone-numbers-button","result-local__phone-numbers")},clickListItem:function(a){a.entity&&this.context.openDetail(this.data,a.entity,a)},itemHoverIn:function(a){a.item&&this.context.selectMarker(a.item)},itemHoverOut:function(a){var b=this.context.resultDetail.getCurrentData();a.item&&(null===b||b&&b.key!==a.item.key)&&this.context.deselectMarker(a.item)},hasFilters:function(){for(var a in this.context.selectedFilters)if(null!==this.context.selectedFilters[a])return!0;return!1},hasMoved:function(){return this.context.mapHasMoved},searchCategoriesNearby:function(a){this.context.searchCategoriesNearby(a)},getImagesWidth:function(){if(this.data&&this.data.items&&this.data.items[0]&&this.data.items[0].info){var a=0;return this.data.items[0].info.images.forEach(function(b){a+=140*b.thumb_width/b.thumb_height,a+=ResultListLocalComponent.listItemReference.images.margin}),a}return 0}}),ResultListPlaceLocalComponent=Class(Component,{constructor:function(a,b){this.name="result_list_place_local",this.data=a,this.context=b,this.parent=parent,_super(this)},initState:function(){return{data:this.data,query:this.context.query,ghostLoading:!1,hasLoadMorePlace:!1}},updateData:function(a,b){this.data=a,this.setState({data:a,query:this.context.query,ghostLoading:!1,hasLoadMorePlace:b})},activateGhostLoading:function(){this.setState({ghostLoading:!0})},searchNearbyPOI:function(a){this.context.doQuery({q:a.query,localType:this.context.data.type,entity:a.entity})},displayNearbyPOIs:function(){if(0!==this.context.data.items.length&&(this.context.data.items[0].coordinates.hasOwnProperty("latitude")||this.context.data.items[0].coordinates.hasOwnProperty("longitude"))){this.activateGhostLoading();var a=this.context.data.items[0].coordinates.latitude,b=this.context.data.items[0].coordinates.longitude,c=a+","+b,d={q:this.context.query,o:c,lang:applicationState.user.userSetting.getInterfaceLanguage().shorthand},e=this;LocalHelper.getMorePlaces(d).then(function(a){a.items.length>0&&(e.context.addAsyncPOIs(a.items),e.updateData(e.context.data,!0))})}},itemHoverIn:function(a){a.item&&this.context.selectMarker(a.item)},itemHoverOut:function(a){a.item&&this.context.deselectMarker(a.item)}}),ResultMiniDetailLocalComponent=Class(Component,{constructor:function(a){this.name="result_mini_detail_local",this.item=null,this.data=null,this.context=a,_super(this)},initState:function(){return{data:this.item,type:null,isSingleItem:!1}},addData:function(a,b){this.item=b,this.data=a,this.setState({data:this.item,type:this.data.type,categoryPJTriggered:this.item.categoryTriggered?this.item.categoryTriggered:"unknown",isSingleItem:!(this.data.items.length>1),query:this.context.query})},clearData:function(){this.item=null,this.data=null,this.setState({data:this.item,type:null,isSingleItem:!1})},getCurrentData:function(){return this.item},clickListItem:function(a){a.entity&&this.context.openDetail(this.data,a.entity)},openCityMobile:function(a){a.entity&&this.context.openCityModeDetail(this.data,a.entity)},closeMiniDetail:function(a){this.context.closeMiniMobileDetail(a.item)}}),ResultPartnerLocalComponent=Class(Component,{$statics:{VIEW:{LOGO:"logo",LOGOANDBACK:"logoAndBack"}},constructor:function(a){this.name="result_partner_local",this.type=a.data?a.data.type:null,this.context=a,this.view=ResultPartnerLocalComponent.VIEW.LOGO,this.tooltipID=actionManager.addClickListener(this,this.openTooltip,{clickOutHandler:this.closeTooltip}),this.tooltip=new TooltipComponent(this,_('These ads are ordered according to various criteria.</br></br><a href="{link}" {target}>{text}</a>',"local",{link:"https://about.qwant.com/fr/legal/modalites-de-referencement-dereferencement-et-de-classement/",text:_("Learn more","local"),target:SecurityHelper.targetBlank()})),_super(this)},initState:function(){return{type:this.type,view:this.view}},listCorrectlySized:function(){var a=$(".result_page_local__item_list")[0];a&&"city"!==this.context.data.type&&!hasClass(a,"result_page_local__item_list--partner")&&addClass(a,"result_page_local__item_list--partner")},addData:function(a){
a&&a.type&&(this.listCorrectlySized(),this.type=a.type,this.doSetState())},clearData:function(){this.listCorrectlySized(),this.type=null,this.doSetState()},setCallbackView:function(){this.view=ResultPartnerLocalComponent.VIEW.LOGOANDBACK,this.doSetState()},setLogoView:function(){this.view=ResultPartnerLocalComponent.VIEW.LOGO,this.doSetState()},doSetState:function(){this.setState({type:this.type,view:this.view}),this.listCorrectlySized()},getCurrentData:function(){return this.type},back:function(){this.context.closeDetail(),this.context.resultPartner.setLogoView()},openTooltip:function(){TooltipComponent.changeContent({it:this.tooltip,message:_('These ads are ordered according to various criteria.</br></br><a href="{link}" {target}>{text}</a>',"local",{link:"https://about.qwant.com/fr/legal/modalites-de-referencement-dereferencement-et-de-classement/",text:_("Learn more","local"),target:SecurityHelper.targetBlank()})}),TooltipComponent.placeTooltip({it:this.tooltip,componentId:this.tooltipID});var a=$i("tooltip--"+this.tooltip.id);addClass(a,"active")},closeTooltip:function(){var a=$i("tooltip--"+this.tooltip.id);removeClass(a,"active")}}),ResultPrivacyPopupLocalComponent=Class(Component,{constructor:function(a){this.name="result_privacy_popup_local",this.context=a,_super(this)},initState:function(){return{show:!1}},showPrivacyPopup:function(){this.setState({show:!0})},hidePrivacyPopup:function(){this.setState({show:!1})},acceptPrivacyPopup:function(){this.hidePrivacyPopup(),this.context.map.enableGeolocation()}}),ResultStoreOpenLocalComponent=Class(Component,{$statics:{storeOpeningState:{none:"none",closed:"closed",open:"open"}},constructor:function(a){this.name="result_store_open_local",this.data=a,this.openingHoursState=ResultStoreOpenLocalComponent.storeOpeningState.none,this.closingTime=null,this.openingTime=null,this.data.openingHours&&this.load(this.data.openingHours),_super(this)},load:function(a){var b=new Date,c=new Array(7);c[0]="Su",c[1]="Mo",c[2]="Tu",c[3]="We",c[4]="Th",c[5]="Fr",c[6]="Sa";var d=c[b.getDay()],e=a[d];if(this.openingHoursState=ResultStoreOpenLocalComponent.storeOpeningState.closed,void 0!==e&&null!=e&&""!==e){if("24/7"===e)return void(this.openingHoursState=ResultStoreOpenLocalComponent.storeOpeningState.open);var f=b.getHours(),g=b.getMinutes(),h=e.split(","),i=this;h.forEach(function(a){var b=a.split("-");if(2===b.length){var c=b[0].split(":"),d=b[1].split(":");c[0]<f&&f<d[0]||c[0]==f&&c[1]<=g||d[0]==f&&d[1]>=g?(i.openingHoursState=ResultStoreOpenLocalComponent.storeOpeningState.open,i.closingTime=b[1]):i.openingHoursState!==ResultStoreOpenLocalComponent.storeOpeningState.open&&null===i.openingTime&&(f<c[0]||f===c[0]&&g<c[1])&&(i.openingTime=b[0])}})}},initState:function(){return{openingHoursState:this.openingHoursState,closingTime:this.closingTime,openingTime:this.openingTime}}}),ResultWrapperLocalComponent=Class(Component,{constructor:function(a){this.name="result_wrapper_local",this.context=a,this.view="list",_super(this)},initState:function(){return{resultList:this.context.resultList,resultDetail:this.context.resultDetail,resultPartner:this.context.resultPartner,view:this.view}},manage:function(a){var b=$(".result_wrapper_local")[0];null!==a&&""!==a||!b?b&&hasClass(b,"disable")&&removeClass(b,"disable"):addClass(b,"disable")},updateWrapper:function(){this.setState({resultList:this.context.resultList,resultDetail:this.context.resultDetail,resultPartner:this.context.resultPartner,view:this.view})},updateList:function(a){this.view="list",this.updateWrapper(),this.context.resultList.updateData(a),this.context.resultPartner.setLogoView(),this.context.resultPartner.addData(a),this.context.resultPartner.listCorrectlySized(),this.manageMobileMove(a)},updateDetail:function(a,b,c){this.view="detail",this.updateWrapper(),this.context.resultDetail.addData(a,b,c),1!=a.items.length&&this.context.resultPartner.setCallbackView(),this.context.resultPartner.listCorrectlySized()},clearDetail:function(){this.view="list",this.updateWrapper(),this.context.resultDetail.clearData()},hideList:function(){this.context.hideList()},manageMobileMove:function(a){if(BrowserHelper.isTabletOrMobile&&a&&"pages_jaunes"===a.type){var b=this,c=$(".result_page_local__item_list")[0];c&&(c.ontouchstart=function(a){b.context.listTouchStart(a)},c.ontouchmove=function(a){b.context.listTouchMove(a)})}}}),LocalPageComponent=Class(Component,{constructor:function(a){this.route=a,this.name="local_page",this.map=new MapsFactory(this),this.doQuery=this.doQuery.bind(this),this.onFilterChange=this.onFilterChange.bind(this),this.mapInit=!1,this.mapHasMoved=!1,this.blockRefreshAuto=!0,this.selectedFilters=LocalHelper.getSelectedFilters(),this.listTop=290,this.touchTop=null,this.geolocationData={active:!1,class:"maps_global--button__gps"},this.lastQueryTypeInSearchBar=null,this.query=this.route.rawParams.q?this.route.rawParams.q.replace(/"/g,"&quot;"):"",this.data=[],this.localFiltersMonitor=new LocalFiltersComponent(null,this.selectedFilters,this.onFilterChange),this.localFilters=this.localFiltersMonitor.getFilters(),this.resultList=new ResultListLocalComponent(this),this.resultDetail=new ResultDetailLocalComponent(this),this.miniMobileDetail=new ResultMiniDetailLocalComponent(this),this.resultPartner=new ResultPartnerLocalComponent(this,this.data),this.resultWrapper=new ResultWrapperLocalComponent(this),this.privacyPopup=new ResultPrivacyPopupLocalComponent(this),LayoutComponent.registerBeforeAction(function(){$(".side_bar")[0].removeAttribute("style")}),this.load(),_super(this)},initState:function(){return{data:this.data,rawKeyPhrase:this.query,resultWrapper:this.resultWrapper,miniMobileDetail:this.miniMobileDetail,localFiltersMonitor:this.localFiltersMonitor,map:this.map,doQuery:this.doQuery,privacyPopup:this.privacyPopup}},onMount:function(){var a=this;if(this.resultWrapper&&this.resultWrapper.manage(this.query),a.data&&!this.mapInit&&a.initMap(),BrowserHelper.isTabletOrMobile){var b=$(".local_page")[0];b&&(b.style.height=window.innerHeight+"px"),window.addEventListener("resize",function(b){a.resizeMapMobileTablet(),a.resizeDetailViewMobile()}),this.showList()}this.localFiltersMonitor&&this.localFiltersMonitor.onMount()},load:function(){if(addClass($("html")[0],"local"),LayoutComponent.registerBeforeAction(function(){removeClass($("html")[0],"local")}),""!==this.query){var a=this;this.resultList.activateGhostLoading();var b=this.getCurrentFiltersCriteria(),c=Dispatcher.getUrlParameter("o");c&&(b.o=c),LocalHelper.queryLocal(b).then(function(b){a.data=b,a.localFiltersMonitor.updateFilters(a.data.type,a.selectedFilters,a.onFilterChange),a.localFilters=a.localFiltersMonitor.getFilters(),a.updateMarkers(),a.setState({data:a.data,rawKeyPhrase:a.query,resultWrapper:a.resultWrapper,miniMobileDetail:a.miniMobileDetail,localFiltersMonitor:a.localFiltersMonitor,map:a.map,doQuery:a.doQuery,privacyPopup:a.privacyPopup}),a.initMap(),a.resultWrapper.updateList(a.data),a.data&&a.data.items&&1===a.data.items.length&&a.localFiltersMonitor.hideFiltersDropdown(),a.lastQueryTypeInSearchBar=a.data.type,a.needToOpenDetail()})}},initMap:function(){var a=this;this.map.initializeMap({multiple:!0},"map_container",{mousewheelScroll:!0,fullscreenable:!1}).then(function(){a.mapInit=!0,a.updateMarkers(),"city"===a.data.type&&a.centerOnCity(),a.currentMapCenter=a.map.getCenterBounds(),a.setMapOrigin(),a.manageZoomButton(),a.map.map_handle.on("zoomend",function(){a.blockRefreshAuto||a.loadMoreDataWithBbox(),a.manageZoomButton()}),a.map.map_handle.on("dragstart ",function(){null===a.resultDetail.getCurrentData()&&a.unlockAutoRefresh()}),a.map.map_handle.on("dragend",function(){a.onMapMoving()}),a.map.map_handle.on("pitch",function(){a.onOrientationChange()})})},onMapMoving:function(){this.map.isPointInPolygon(this.currentMapCenter)||this.blockRefreshAuto||(this.loadMoreDataWithBbox(),this.currentMapCenter=this.map.getCenterBounds(),this.setMapOrigin(),this.mapHasMoved=!0)},loadMoreDataWithBbox:function(){if(!(this.map.getZoom()<11)){this.resultList.activateGhostLoading();var a=this.getCurrentFiltersCriteria(),b=this.map.map_handle.getBounds();a.bbox=b._ne.lat+","+b._ne.lng+","+b._sw.lat+","+b._sw.lng,a.local_type=this.data.type?this.data.type:this.lastQueryTypeInSearchBar;var c=this;LocalHelper.queryLocal(a).then(function(a){if(c.closeDetail(),c.data=a,c.resultWrapper.updateList(a),a&&c.data.items){c.map.clearMap();var b=new LocalMarkerComponent(c.data,c.data.items,c).getMarkers(),d=c.map.addMarkers(b);c.bindsMarkersItems(d),c.currentMapCenter=c.map.getCenterBounds(),c.setMapOrigin(),c.needToOpenDetail()}c.blockRefreshAuto=!1})}},bindsMarkersItems:function(a){this.data.items.forEach(function(b){a[b.key]&&(b.marker=a[b.key].marker,b.markerBuilder=a[b.key].builder)})},updateMarkers:function(){if(this.data.items&&this.data.items.length>0){var a=new LocalMarkerComponent(this.data,this.data.items,this).getMarkers(),b=this.map.recenterMap(a);this.bindsMarkersItems(b);var c=this;setTimeout(function(){c.unlockAutoRefresh()},1e3)}else this.map.centerOnWorld()},doQuery:function(a){var b=a.q.replace(/"/g,"&quot;");this.blockRefreshAuto=!0,this.closeDetail(),BrowserHelper.isTabletOrMobile&&this.closeMiniMobileDetail(),this.resultPartner.clearData(),this.mapHasMoved=!1;var c=$(".search_bar__form__input")[0];if(c&&(c.blur(),c.value=b),b){this.query=b,this.resultWrapper.manage(this.query),this.resultList.activateGhostLoading(),LocalHelper.updateUrlParameters("q",this.query),UrlHelper.removeGETParam(["entityKey"]),this.localFilters&&(this.localFilters.cleanFilters(),this.selectedFilters=LocalHelper.getSelectedFilters());var d=this.map.map_handle.getBounds(),e=d._ne.lat+","+d._ne.lng+","+d._sw.lat+","+d._sw.lng;this.map.clearMap();var f={q:this.query,previousBbox:e};a.localType&&(f.local_type=a.localType),a.entity&&(f.entity=a.entity);var g=this;LocalHelper.queryLocal(f).then(function(a){if(g.data=a,g.lastQueryTypeInSearchBar=g.data.type,g.resultWrapper.updateList(a),g.localFiltersMonitor.updateFilters(g.data.type,g.selectedFilters,g.onFilterChange),g.localFilters=g.localFiltersMonitor.getFilters(),a&&a.items){g.mapInit||g.initMap(),g.currentMapCenter=g.map.getCenterBounds(),g.setMapOrigin(),g.updateMarkers(),"city"===g.data.type&&g.centerOnCity(),g.data.items&&1===g.data.items.length?(g.needToOpenDetail(),g.localFiltersMonitor.hideFiltersDropdown()):g.localFiltersMonitor.showFiltersDropdown();var b=$(".suggester");b&&b[0]&&(b[0].innerHTML="")}else setTimeout(function(){g.unlockAutoRefresh()},500)}),this.updateQuitLinks(b)}},searchCategoriesNearby:function(a){if(a.query){var b=a.query.replace(/"/g,"&quot;");this.data.items[0].street?this.query=b:this.query=b+" "+this.data.items[0].place;var c=$(".search_bar__form__input")[0];c&&(c.value=this.query),this.doQuery({q:this.query})}},updateQuitLinks:function(a){[$(".ribbon--map-info__button--minimize")[0],$i("result_page_local__quit")].forEach(function(b){b&&(b.href="/?q="+UrlHelper.fixedEncodeURIComponent(a).replace(/"/g,"&quot;"))})},selectMarker:function(a){a&&a.marker&&a.marker.markerSelected&&this.map.openSelectedMarker(a.marker.markerSelected._element)},deselectMarker:function(a){a.marker&&a.marker.markerSelected&&this.map.closeSelectedMarker(a.marker.markerSelected._element)},openDetailFromMarker:function(a){var b=1===this.data.items;if(LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"userInteraction",event:"click",component:"local",type:this.data.type,template:b?"single":"multiple",zone:"map",element:"marker",item:a.item.key,query:this.query,context:"true",category:a.item.categoryTriggered?a.item.categoryTriggered:"unknown"}),BrowserHelper.isTabletOrMobile){var c=this.miniMobileDetail.getCurrentData();null!==c&&this.deselectMarker(c),this.openMiniMobileDetail(a.data,a.item)}else this.openDetail(a.data,a.item)},openDetail:function(a,b,c){if("city"!==this.data.type){var d=this.resultDetail.getCurrentData();if(!d||d.key!==b.key){this.closeDetail(),LocalHelper.updateUrlParameters("entityKey",b.key);var e=$i(b.key);e&&addClass(e,"selected"),this.resultWrapper.updateDetail(a,b,c),this.blockRefreshAuto=!0,BrowserHelper.isTabletOrMobile&&(this.closeMiniMobileDetail(),addClass($i("result_page_local_mobile_container"),"detail-visible"),removeClass($i("result_page_local_mobile_container"),"list-visible"),this.resizeDetailViewMobile()),this.selectMarker(b)}}},closeDetail:function(){var a=this.resultDetail.getCurrentData();if(a){this.deselectMarker(a),UrlHelper.removeGETParam(["entityKey"]);var b=$i(a.key);b&&removeClass(b,"selected"),this.unlockAutoRefresh(),this.resultWrapper.clearDetail(),removeClass($i("result_page_local_mobile_container"),"detail-visible"),BrowserHelper.isTabletOrMobile&&this.resizeMapMobileTablet(),this.resultWrapper.manageMobileMove()}},openMiniMobileDetail:function(a,b){this.miniMobileDetail.addData(a,b),BrowserHelper.isTabletOrMobile||1===this.data.length||(addClass($i("result_page_local_mobile_container"),"detail-visible"),removeClass($i("result_page_local_mobile_container"),"list-visible")),"city"!==this.data.type&&addClass($i("result_page_local_mobile_container"),"mini-detail-visible"),this.hideList(),this.resizeMapMobileTablet()},closeMiniMobileDetail:function(a){a&&this.deselectMarker(a),this.miniMobileDetail.clearData();var b=$i("result_page_local_mobile_container");b&&(removeClass(b,"detail-visible"),removeClass(b,"city-visible"),removeClass(b,"mini-detail-visible")),this.resizeMapMobileTablet()},openCityModeDetail:function(a){if(BrowserHelper.isTabletOrMobile){this.closeMiniMobileDetail(),this.resultWrapper.updateList(a);var b=$i("result_page_local_mobile_container");b&&(addClass(b,"detail-visible"),addClass(b,"city-visible"),removeClass(b,"list-visible"))}},onFilterChange:function(){var a=this,b=this.getCurrentFiltersCriteria();b.local_type=this.data.type,this.blockRefreshAuto=!0,this.closeDetail(),this.resultList.activateGhostLoading(),UrlHelper.removeGETParam(["entityKey"]),this.map.clearMap(),LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"userInteraction",event:"click",component:"local",type:a.data.type,template:"multiple",zone:"list",element:"filter",item:1,query:a.query,context:"true"}),LocalHelper.queryLocal(b).then(function(b){a.data=b,a.resultWrapper.updateList(b),b&&a.updateMarkers()})},needToOpenDetail:function(){if("city"===this.data.type)return void(BrowserHelper.isTabletOrMobile&&(this.openMiniMobileDetail(this.data,this.data.items[0]),addClass($i("result_page_local_mobile_container"),"city-visible")));this.data.items&&1===this.data.items.length&&(BrowserHelper.isTabletOrMobile?this.openMiniMobileDetail(this.data,this.data.items[0]):this.openDetail(this.data,this.data.items[0])),Dispatcher.getUrlParameter("entityKey")&&this.data.items&&this.data.items.length>1&&this.openDetailWithUrlParameters()},openDetailWithUrlParameters:function(){var a=Dispatcher.getUrlParameter("entityKey"),b=null;this.data.items.forEach(function(c){c.key.toString()===a&&(b=c)}),null!==b&&this.openDetail(this.data,b)},getCurrentFiltersCriteria:function(){var a=this;this.selectedFilters=LocalHelper.getSelectedFilters();var b={q:this.query};for(var c in this.selectedFilters)a.selectedFilters[c]&&(b[c]=a.selectedFilters[c]);return b},showList:function(){this.listTop=290,addClass($i("result_page_local_mobile_container"),"list-visible"),removeClass($i("result_page_local_mobile_container"),"detail-visible");var a=$(".result_page_local__item_list")[0];a&&(a.scrollTop=0,a.style.top=this.listTop+"px",a.style.height="auto",a.style.bottom="0px",a.style.display="block");var b=$(".maps_global--button-shadowed-box--fullscreen")[0],c=$(".result_page_local__hide-list")[0];b&&(b.style.display="block"),c&&(c.style.display="block"),this.resultWrapper.manageMobileMove(this.data),this.resizeMapMobileTablet()},hideList:function(){removeClass($i("result_page_local_mobile_container"),"list-visible");var a=$(".result_page_local__item_list")[0];a&&(a.style.top="100%",a.style.display="none");var b=$(".ribbon--map-info__button--minimize")[0];null===this.miniMobileDetail.getCurrentData()&&b&&(b.style.display="block"),this.resizeMapMobileTablet()},listTouchStart:function(a){this.touchTop=a.touches[0]?a.touches[0].pageY:null},listTouchMove:function(a){if(this.touchTop&&a.touches[0]){var b=a.touches[0].pageY-this.touchTop;this.listTop+=b;var c=$i("result_page_local__item_list"),d=$(".result_list_local")[0];if(this.listTop<80)this.listTop=40,c.style.top=this.listTop+"px",c.style.height=window.innerHeight-this.listTop-13+"px";else if(this.listTop>window.innerHeight-200)this.listTop=window.innerHeight,this.returnToMap();else if(b>0&&d.scrollTop>0)this.listTop=120;else{c.style.bottom="0",c.style.top="auto",c.style.height=window.innerHeight-this.listTop-50+"px";var e=$i("ribbon--map-container");if(e){var f=this.listTop-54;e.style.height=f+"px"}this.touchTop=a.touches[0].pageY,a.preventDefault()}this.map.map_handle.resize()}},returnToMap:function(){this.hideList(),this.closeDetail(),"city"===this.data.type&&(this.data.items=this.data.items.slice(0,1),this.updateMarkers());var a=$i("result_page_local_mobile_container");a&&(removeClass(a,"list-visible"),removeClass(a,"detail-visible")),!BrowserHelper.isTabletOrMobile||1!==this.data.items.length&&"city"!==this.data.type||this.openMiniMobileDetail(this.data,this.data.items[0]),this.listTop=window.innerHeight,this.touchTop=null},unlockAutoRefresh:function(){this.data&&"city"!==this.data.type&&(this.blockRefreshAuto=!1)},resizeDetailViewMobile:function(){var a=$(".result_page_local__item_detail ")[0];a&&(a.style.height=window.innerHeight-108+"px")},centerOnCity:function(){if(this.data.items&&this.data.items[0]&&this.data.items[0].bbox){var a=this.data.items[0].bbox,b=[a.NW.longitude,a.NW.latitude],c=[a.SE.longitude,a.SE.latitude],d=[c,b];this.map.map_handle.fitBounds(d,{duration:10})}},resizeMapMobileTablet:function(){var a=$i("ribbon--map-container"),b=$(".list-visible")[0],c=$(".result_page_local__mini_detail")[0];if(a){var d=window.innerHeight-146;b?d=this.listTop-44:c&&(d=window.innerHeight-c.offsetHeight-106),a.style.height=d+"px"}this.map.map_handle&&this.map.map_handle.resize()},setMapOrigin:function(){0!==this.currentMapCenter.lat&&0!==this.currentMapCenter.lng&&LocalHelper.updateUrlParameters("o",this.currentMapCenter.lat.toFixed(7)+","+this.currentMapCenter.lng.toFixed(7)+","+this.map.getZoom())},addAsyncPOIs:function(a){this.data.items=this.data.items.concat(a);var b=new LocalMarkerComponent(this.data,a,this).getMarkers(),c=this.map.addMarkers(b);this.bindsMarkersItems(c)},manageZoomButton:function(){var a=$(".maps_global--button__zoomLess")[0],b=$(".maps_global--button__zoomMore")[0];a&&b&&(removeClass(b,"disabled"),removeClass(a,"disabled"),this.map.isAtMiniZoomLevel()?addClass(b,"disabled"):this.map.isAtMaxZoomLevel()&&addClass(a,"disabled"))},switchGeolocation:function(){this.geolocationData.active&&null!==this.geolocationData.marker?this.disableGeolocation():this.privacyPopup.showPrivacyPopup();var a=1===this.data.items;LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"userInteraction",event:"click",component:"local",type:this.data.type,template:a?"single":"multiple",zone:"map",element:"geolocation",item:1,query:this.query,context:"true"})},toggle3D:function(){this.map.toggle3D()},disableGeolocation:function(){this.geolocationData.marker.remove(),this.geolocationData.active=!1,this.geolocationData.marker=null;var a=$("."+this.geolocationData.class)[0];a&&toggleClass(a,"geolocation-active")},onOrientationChange:function(){var a=this.map.map_handle.getPitch(),b=this.map.map_handle.getBearing(),c=1-.01*a,d=$(".maps_global--button__2d--icon")[0];if(d){var e="scale(1, "+c+") rotate("+b+"deg)";d.style.webkitTransform=e,d.style.mozTransform=e,d.style.msTransform=e,d.style.oTransform=e,d.style.transform=e,d.setAttribute("class","maps_global--button__2d--icon active")}},redirectMaps:function(){var a=1===this.data.items;LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"userInteraction",event:"click",component:"local",type:this.data.type,template:a?"single":"multiple",zone:"map",element:"link_maps",item:1,query:this.query,context:"true"}),this.currentMapCenter=this.map.getCenterBounds(),window.open("https://www.qwant.com/maps/#map="+this.map.getZoom().toFixed(2)+"/"+this.currentMapCenter.lat.toFixed(7)+"/"+this.currentMapCenter.lng.toFixed(7),"_blank")}}),AddonsComponent=Class(Component,{constructor:function(a){QwantHomepageComponent.isAppMobile()||(document.location.href="/"),this.name="addons",this.hideTemplate(),LayoutComponent.registerBeforeAction(function(){$("body")[0].removeAttribute("style"),$(".wrapper")[0].removeAttribute("style"),$(".header")&&$(".header")[0]&&$(".header")[0].removeAttribute("style"),$(".side_bar")[0].removeAttribute("style"),$(".footer")[0].removeAttribute("style")}),window.scrollTo(0),_super(this),this.getAddons()},initState:function(){return{addons:[]}},hideTemplate:function(){var a=$("body")[0];a.style.background="none",a.style.paddingLeft=0;var b=$(".wrapper")[0];b.style.paddingBottom=0,b.style.marginTop=0,$(".header")&&$(".header")[0]&&($(".header")[0].style.display="none"),$(".footer")[0].style.display="none",$(".side_bar")[0].style.display="none"},getAddons:function(){var a=AjaxManager.get(ajax.addons());if(null!==a){var b=this;a.then(function(a,c){!a&&"success"===c.status&&c.data&&c.data.addons&&b.setState({addons:c.data.addons})})}},getLocalizedAddonName:function(a){return a.hasOwnProperty(applicationState.user.userSetting.getInterfaceLanguage().shorthand)?a[applicationState.user.userSetting.getInterfaceLanguage().shorthand]:a["en-US"]},getAddonStarName:function(a,b){return a<=b?"full":a-.5===b?"half":"empty"},getAvailableLanguages:function(){return["fr","es","it","de","pt"]}}),NotFoundComponent=Class(Component,{constructor:function(){this.name="not_found",this.hideTemplate(),LayoutComponent.registerBeforeAction(function(){$("body")[0].removeAttribute("style"),void 0!==$(".wrapper")[0]&&$(".wrapper")[0].removeAttribute("style"),void 0!==$(".header")[0]&&$(".header")[0].removeAttribute("style"),void 0!==$(".side_bar")[0]&&$(".side_bar")[0].removeAttribute("style"),void 0!==$(".footer")[0]&&$(".footer")[0].removeAttribute("style")}),_super(this)},hideTemplate:function(){var a=$("body")[0];a.style.background="none",a.style.paddingLeft=0;var b=$(".wrapper")[0];b.style.paddingBottom=0,b.style.marginTop=0,void 0!==$(".header")[0]&&($(".header")[0].style.display="none"),void 0!==$(".footer")[0]&&($(".footer")[0].style.display="none"),void 0!==$(".side_bar")[0]&&($(".side_bar")[0].style.display="none")}}),ImageOverlay=function(){};ImageOverlay.onOpen=function(){};var MediaOverlayComponent=Class(Component,{constructor:function(a){this.name="media_overlay",MediaOverlayComponent.route=a,MediaOverlayComponent.medias=[],MediaOverlayComponent.errors=[],MediaOverlayComponent.mediaOverlayPreload=new MediaOverPreloadComponent,MediaOverlayComponent.mediaOverlayPreload.medias=MediaOverlayComponent.medias,MediaOverlayComponent.mediaOverlayAction=new MediaOverlayActionComponent,MediaOverlayComponent.mediaOverlayDisplay=new MediaOverlayDisplayComponent;var b=null;for(var c in siteConfiguration.searchCategories)applicationState.user.userSetting.searchMode===siteConfiguration.searchCategories[c].index&&(b=siteConfiguration.searchCategories[c].name);MediaOverlayComponent.tab=a&&a.rawParams&&a.rawParams.t?a.rawParams.t:b,MediaOverlayComponent.query=a&&a.rawParams&&a.rawParams.q?a.rawParams.q:null,_super(this),MediaOverlayComponent.id=this.id,LayoutComponent.registerBeforeAction(MediaOverlayComponent.clean),actionManager.handleChange(Application.rootComponent,MediaOverlayComponent.handleInput)},initState:function(){return{media:{},mediaOverlayDisplay:MediaOverlayComponent.mediaOverlayDisplay,mediaOverlayPreload:MediaOverlayComponent.mediaOverlayPreload,mediaOverlayAction:MediaOverlayComponent.mediaOverlayAction}},$statics:{TYPES:["video","image","twitch"],filters:null,errors:null,clean:function(){var a=$i("video__overlay__iframe");a&&a.parentNode.removeChild(a);var b=$i("video");b&&b.pause(),removeClass(document.body,"overlay")},open:function(a){window.addEventListener("keyup",MediaOverlayActionComponent.handleKey),MediaOverlayComponent.media=a.media,MediaOverlayComponent.index=a.media.index,$i(MediaOverlayComponent.id)&&addClass($i(MediaOverlayComponent.id),"media_overlay--visible"),addClass($("body"),"overlay"),MediaOverlayComponent.index=MediaOverlayComponent.media.index,MediaOverlayComponent.mediaOverlayAction.setMedia(MediaOverlayComponent.media),MediaOverlayComponent.mediaOverlayDisplay.setMedia(MediaOverlayComponent.media),MediaOverlayComponent.media&&"number"==typeof MediaOverlayComponent.media.page&&MediaOverlayComponent.media._id?UrlHelper.addGETParam("o",MediaOverlayComponent.media.page+":"+MediaOverlayComponent.media._id,!0):UrlHelper.addGETParam("overlay","open",!0);var b=a.ia||null;LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"overlay",link:MediaOverlayComponent.media.media,overlay:MediaOverlayComponent.media.type,event:"open_overlay",t:MediaOverlayComponent.tab,ia:b}),MediaOverlayComponent.updateDom()},updateDom:function(){if(0===MediaOverlayComponent.medias.length)return addClass($i("media_overlay_media_link_prev"),"media_overlay__media-link-arrow--disabled"),void addClass($i("media_overlay_media_link_next"),"media_overlay__media-link-arrow--disabled");0===MediaOverlayComponent.index?addClass($i("media_overlay_media_link_prev"),"media_overlay__media-link-arrow--disabled"):removeClass($i("media_overlay_media_link_prev"),"media_overlay__media-link-arrow--disabled"),MediaOverlayComponent.index>=MediaOverlayComponent.medias.length-1?addClass($i("media_overlay_media_link_next"),"media_overlay__media-link-arrow--disabled"):removeClass($i("media_overlay_media_link_next"),"media_overlay__media-link-arrow--disabled")},close:function(){window.removeEventListener("keyup",MediaOverlayActionComponent.handleKey),$i("video__overlay__iframe")&&($i("video__overlay__iframe").src=""),$(".livestream_page")[0]&&($(".livestream_page")[0].innerHTML=""),MediaOverlayComponent.clean(),removeClass($("body"),"overlay"),removeClass($i(MediaOverlayComponent.id),"media_overlay--visible"),UrlHelper.removeGETParam(["o","p","overlay","live"]),MediaOverlayComponent.route.params&&(MediaOverlayComponent.route.params.o&&(MediaOverlayComponent.route.params.o=null),MediaOverlayComponent.route.params.p&&(MediaOverlayComponent.route.params.p=null))},setMedias:function(a,b,c){MediaOverlayComponent.medias.length=0,MediaOverlayComponent.addMedias(a,b,c)},addMedias:function(a,b,c){if(c=c||{},a&&a.length>0){a.forEach(function(a){a.page=c.page||0});var d=a[0].type;constants.Overlays.forEach(function(c){if(c.type===d){MediaOverlayComponent.medias=MediaOverlayComponent.medias.concat(a),MediaOverlayComponent.filters=b;var e=MediaOverlayComponent.route.params.o;if(e&&-1!==e.indexOf(":")){var f=e.split(":")[1];MediaOverlayComponent.medias.forEach(function(a,b){a._id===f&&(a.index=b,MediaOverlayComponent.open({media:a}))})}else"1"===MediaOverlayComponent.route.params.p&&MediaOverlayComponent.medias.length>0&&(MediaOverlayComponent.media=MediaOverlayComponent.medias[0],MediaOverlayComponent.media.index=0,MediaOverlayComponent.open({media:MediaOverlayComponent.media,noHistory:!0}));"special_event"!==a[0].section&&"videos"!==a[0].section&&"live"!==a[0].section||(MediaOverlayComponent.media=MediaOverlayComponent.medias[0],MediaOverlayComponent.media.index=0,MediaOverlayComponent.open({media:MediaOverlayComponent.media,noHistory:!0}))}})}},offset:function(a){var b=a>0?1:-1,c=0,d=MediaOverlayComponent.index+b;do{if(d<0||d>=MediaOverlayComponent.medias.length)break;var e=MediaOverlayComponent.medias[d];if(-1===MediaOverlayComponent.errors.indexOf(e.index)&&(c+=b)==a){MediaOverlayComponent.index=d;break}}while(d+=b);e&&(MediaOverlayComponent.mediaOverlayAction.setMedia(e),MediaOverlayComponent.mediaOverlayDisplay.setMedia(e),MediaOverlayComponent.index=d,MediaOverlayComponent.media=e,MediaOverlayComponent.media&&"number"==typeof MediaOverlayComponent.index&&MediaOverlayComponent.media._id&&UrlHelper.addGETParam("o",Math.floor(MediaOverlayComponent.index/50)+":"+MediaOverlayComponent.media._id),MediaOverlayComponent.updateDom())},setError:function(a){MediaOverlayComponent.errors.push(a)}}}),MediaOverlayActionComponent=Class(Component,{$statics:{actionInstance:null,setMedia:function(a){MediaOverlayActionComponent.overlay=MediaOverlayActionComponent.getOverlay(a.type),MediaOverlayActionComponent.media=a,MediaOverlayActionComponent.actionInstance.setState(new State({mediaData:a,actions:MediaOverlayActionComponent.getActions(a.type)}))},handleKey:function(a){37===a.keyCode&&MediaOverlayComponent.offset(-1),39===a.keyCode&&MediaOverlayComponent.offset(1),27===a.keyCode&&MediaOverlayComponent.close()},getOverlay:function(a){var b=ImageOverlay;return constants.Overlays.forEach(function(c){-1!==a.indexOf(c.type)&&(b=window[c.componentName])}),b},getActions:function(a){var b=[];return constants.Overlays.forEach(function(c){-1!==a.indexOf(c.type)&&(b=c.actions)}),b},updateDifferedStatus:function(){MediaOverlayActionComponent.differedStatus++},openNoteCreatorPanel:function(a){if(a=a||{},LayoutComponent.registerBeforeActionGlobal(this.updateDifferedStatus),!applicationState.user.isLogged)return Application.rootComponent.state.account_overlay.displayAccountOverlay(),MediaOverlayActionComponent.differedStatus=0,AlertComponent.info(_("You must be logged in to create a new note","serp")),void actionManager.onCustomEvent(this,"user_login",this.openNoteCreatorPanel,{isPersistant:!0,isDiffered:!0,url:a.url});if(a.isDiffered&&MediaOverlayActionComponent.differedStatus>2)return actionManager.cleanCustomEvent("user_login",this.openNoteCreatorPanel),void LayoutComponent.cleanBeforeActionGlobal(this.updateDifferedStatus);if(a.url){var b=new promise.Promise;b.done(!1,{data:{}});var c=new NoteModel;c.originalDescription=a.url;var d=new PanelFormNote(PanelFormNote.MODE_QUICK_CREATE,c);Application.rootComponent.state.sidePanel.open(b,d)}},website:function(){if("videos"===MediaOverlayComponent.media.type)if(MediaOverlayComponent.media.media.match(/^https:\/\/www.youtube/)){var a=$i("video__overlay__iframe");a&&a.contentWindow.postMessage(JSON.stringify({event:"command",func:"pauseVideo",id:"video__overlay__iframe"}),"*")}else MediaOverlayComponent.close()},copyLinkToClipboard:function(){var a=SearchBarComponent.getLastQuery();if("all"===MediaOverlayComponent.tab)var b="&r="+("video"===MediaOverlayActionComponent.media.type?"videos":"images")+"&t=all";else var b="&t="+MediaOverlayActionComponent.media.type;var c="https:"+config_get("searchUrl")+"?q="+encodeURIComponent(a)+b+"&o="+MediaOverlayComponent.media.page+":"+MediaOverlayComponent.media._id,d=c.split("&o=");3===d.length&&(c=d[0]+"&o="+d[2]);var e=[];MediaOverlayComponent.filters&&(e=MediaOverlayComponent.filters);for(var f in e)c+="&"+e[f].name+"="+e[f].selected;var g=$i("overlay-sharing-url");if(g.value=c,"iOS"===BrowserHelper.getOS()){var h=g.contentEditable,i=g.readOnly;g.contentEditable=!0,g.readOnly=!1;var j=document.createRange();j.selectNodeContents(g);var k=window.getSelection();k.removeAllRanges(),k.addRange(j),g.select(),g.setSelectionRange(0,g.value.length),g.contentEditable=h,g.readOnly=i}else g.select();try{document.execCommand("copy"),AlertComponent.success(_("The URL was copied to your clipboard.","alert"))}catch(a){AlertComponent.error(_("The URL could not be copied to your clipboard. Your browser might not allow it.","alert"))}g.setAttribute("readonly","readonly"),g.setAttribute("disabled",!0),setTimeout(function(){g.blur(),g.removeAttribute("readonly"),g.removeAttribute("disabled")},100)}},constructor:function(a,b){this.name="media_overlay_action",_super(this),MediaOverlayActionComponent.actionInstance=this},initState:function(){return{mediaData:null,actions:[]}}
}),MediaOverlayDisplayComponent=Class(Component,{$statics:{displayInstance:null,setMedia:function(a){MediaOverlayDisplayComponent.media=a;var b="image";constants.Overlays.forEach(function(c){-1!==a.type.indexOf(c.type)&&(b=c.type)}),MediaOverlayDisplayComponent.displayInstance.setState(new State({mediaData:MediaOverlayDisplayComponent.media,type:b}))}},constructor:function(a){this.mediaOverlay=a,this.name="media_overlay_display",_super(this),MediaOverlayDisplayComponent.displayInstance=this},initState:function(){return{mediaData:null}},kamoovFullscreen:function(){var a=$i("kmv_fullscreen");a&&a.click()}}),MediaOverPreloadComponent=Class(Component,{constructor:function(){this.name="media_overlay_preload",_super(this)},initState:function(){return{media:null,medias:MediaOverPreloadComponent.getMedias()}},$statics:{getMedias:function(){return MediaOverPreloadComponent.medias}}}),StreamOverlay=function(){};StreamOverlay.onOpen=function(){};var TwitchOverlay=function(){},VideoOverlay=function(){};VideoOverlay.minimize=function(){MediaOverlayComponent.close()};var PartialMosaicComponent=Class(Component,{$statics:{firstBuild:function(){this.buildMosaic()},customPage:""},constructor:function(a,b,c,d,e,f){this.name="partial_mosaic",this.data=a,this.patterns=b,this.idSelector=c,this.blockMinWidth=e||500,this.blockSpacing=f||30,this.cachedPartials={},PartialMosaicComponent.customPage=d||"",this.initMosaic(),actionManager.addResizeListener(this,this.buildMosaic),_super(this)},initState:function(){return{}},initMosaic:function(){var a=this.patterns.length,b=[],c=this;a>1&&this.patterns.forEach(function(d,e){var f=0;d.forEach(function(a){f<a.length&&(f=a.length)});var g=0;f>0&&e!==a-1&&(g=f*c.blockMinWidth+c.blockSpacing),b.push(g)}),this.mediaQueries=b},buildMosaic:function(){var a=$i(this.idSelector),b=0;if(a&&this.mediaQueries&&this.mediaQueries.length>0){for(var c=a.style.paddingLeft+a.style.paddingRight+a.style.marginLeft+a.style.marginRight,d=a.offsetWidth-c,e=0,f=this.mediaQueries.length;e<f;e++)if(d>this.mediaQueries[e]){b=e;break}null!==this.selectedPattern&&b===this.selectedPattern||(this.selectedPattern=b,this.setState({data:this.data,pattern:this.patterns[b]}))}},renderPartialIfNecessary:function(a,b){var c=b.index,d=b.subPartial;if(d){if(this.cachedPartials[a]&&this.cachedPartials[a][d]&&this.cachedPartials[a][d][c])return this.cachedPartials[a][d][c];var e=this.renderPartial(a,b);return this.cachedPartials[a]=this.cachedPartials[a]||{},this.cachedPartials[a][d]=this.cachedPartials[a][d]||{},this.cachedPartials[a][d][c]=e,e}if(this.cachedPartials[a]&&this.cachedPartials[a][c])return this.cachedPartials[a][c];var f=this.renderPartial(a,b);return this.cachedPartials[a]=this.cachedPartials[a]||{},this.cachedPartials[a][c]=f,f}}),ReportContentComponent=Class(Component,{$statics:{instance:null,getInstance:function(){return ReportContentComponent.instance||(ReportContentComponent.instance=new ReportContentComponent),ReportContentComponent.instance},showPopup:function(a){ReportContentComponent.getInstance().show(a)}},constructor:function(){this.name="report_content",this.reportContentPopupId="reportContentPopupId",_super(this),LayoutComponent.registerBeforeAction(this.hide,{component:this})},initState:function(){return{reportContentPopupId:this.reportContentPopupId,isVisible:!1,isSent:!1}},show:function(a){if(this.reportContentModel=new ReportContentModel(a.url,a.urlId,a.index,a.type),BrowserHelper.isTabletOrMobile||a.context&&"overlay"==a.context)return void page("/report_content?id="+a.urlId+"&index="+a.index+"&type="+a.type+"&url="+encodeURIComponent(a.url));if(this.state.isSent=!1,this.state.isVisible=!0,this.setState(this.state),!a.context){var b=$i(a.key).parentNode,c=$i(this.id),d=getBoxPosition(b),e=b.getBoundingClientRect();c.style.top=d.top+"px",c.style.left=d.left+e.width+"px"}},hide:function(){this.state.isSent=!1,this.state.isVisible=!1,this.setState(this.state)},send:function(){var a=$i("input__text__form_validation_alert_container--report_content__message_f"),b=$i("report_content__message_f").value;if(a||b.length>1024)return!1;$i("report_content__submit").disabled="true",this.reportContentModel.send(b),this.state.isSent=!0,this.setState(this.state)}}),QueryContextComponent=Class(Component,{constructor:function(a,b){this.name="query_context",this.route=a,this.isSingleColumn=b,_super(this)},setQueryContext:function(a){this.setState({queryContext:a,t:this.route.rawParams.t})},initState:function(){return{queryContext:""}}}),ResultColumnComponent=Class({offset:0,search:function(a){var b=this;this.canScroll=!1,this.route=a,this.isAPIError=!1,this.state.searchModel.search().then(function(c){if(LoadBarComponent.step(),c.status!==AJAX_STATUS.USER_INTERRUPT){var d=new State;if(d.type=b.state.resultFragment.state.type,d.options=b.state.resultFragment.options,d.offset=0,c.error===AJAX_STATUS.HOST_ERROR||c.error===AJAX_STATUS.TIMEOUT)return d.isHostError=!0,void b.state.resultFragment.setState(d);if(c.status===AJAX_STATUS.ERROR)return d.isEmptyResult=!0,void b.state.resultFragment.setState(d);if("api_error"===c.status)return d.isAPIError=!0,b.isAPIError=!0,b.setState(b.state),void b.state.resultFragment.setState(d);c.status===AJAX_STATUS.EMPTY_RESULT||!1===c.items?(b.state.searchModel.isLocked=!0,d.isEmptyResult=!0,d.type===constants.SearchTypes.SOCIAL&&addClass($(".results-column--social")[0],"results-column--social--empty")):c.status===constants.ADULT_CONTENT_STATUS?(b.state.searchModel.isLocked=!0,d.isAdultContent=!0):(b.canScroll=!0,d.items=c.items,c.version&&(d.version=c.version),b.webAddBlock&&b.webAddBlock.setAds(c.ads,0,c.version),b.queryContext&&b.queryContext.setQueryContext(c.queryContext),d.route=a,actionManager.fireEvent("firstFragmentRendered"),"smart"!==d.type&&MediaOverlayComponent.addMedias(c.items,c.filters,{page:b.searchModel.page}));var e=$(".results-page")[0];if(d.type===constants.SearchTypes.SMART&&c.status!==AJAX_STATUS.EMPTY_RESULT&&e&&addClass(e,"results-page--with-smart"),d.type===constants.SearchTypes.WEB&&c.status===AJAX_STATUS.EMPTY_RESULT||d.type===constants.SearchTypes.SMART&&c.status===AJAX_STATUS.EMPTY_RESULT){var f=$(".results-column--smart")[0];f&&(f.style.display="none")}BrowserHelper.isMobile&&!$i("ia--container")&&d.type===constants.SearchTypes.WEB&&$(".web_add_block")&&$(".result--ext")&&$(".results-column--web")[0].insertBefore($(".result_filters_container")[0],$(".web_add_block")[0]),$i(b.state.resultFragment.id)?(b.state.resultFragment.setState(d),b.state.resultFragment.iaContainer&&b.state.resultFragment.iaContainer.specialRibbon&&b.state.resultFragment.iaContainer.specialRibbon.onMount&&b.state.resultFragment.iaContainer.specialRibbon.onMount.call(b.state.resultFragment.iaContainer.specialRibbon),actionManager.fireEvent("rendered",{name:"result_column"})):setTimeout(function(){b.state.resultFragment.setState(d),actionManager.fireEvent("rendered",{name:"result_column"}),b.state.resultFragment.iaContainer&&b.state.resultFragment.iaContainer.specialRibbon&&b.state.resultFragment.iaContainer.specialRibbon.onMount&&b.state.resultFragment.iaContainer.specialRibbon.onMount.call(b.state.resultFragment.iaContainer.specialRibbon)},0),"images"===d.type&&0!=window.scrollY&&$i(b.id).scrollHeight<window.innerHeight&&!c.last&&setTimeout(function(){b.addPage()},0),b.isInfinite&&!c.last&&actionManager.addScrollListener(b,b.addPage)}})},addPage:function(){if(getScrollOffset($i(this.id))<configuration.SCROLL_OFFSET&&this.canScroll){if(this.state.searchModel.isLocked)return;this.canScroll=!1;var a=this.state.searchModel.add(),b=this;a.then(function(a){var c=new ResultFragmentComponent(b.state.resultFragment.state.type,b.route,[],b);b.state.resultFragment=c;var d=$i(b.id);if(d){if(a.ads&&"web"===b.state.resultFragment.state.type){var e=new WebAddBlockComponent(b.route,constants.SearchTypes.WEB,"B",!0);d.insertAdjacentHTML("beforeEnd",e.render()),e.setAds(a.ads,b.offset/10+1,a.version)}d.insertAdjacentHTML("beforeEnd",c.render()),actionManager.fireEvent("fragmentRendered")}b.offset+=b.state.searchModel.count;var f=new State;if(f.offset=b.offset,f.addProperty("type",b.state.resultFragment.state.type),f.addProperty("route",b.route),a.status===AJAX_STATUS.EMPTY_RESULT&&(b.state.searchModel.isLocked=!0,b.route.params.f||f.addProperty("isBottomResult",!0)),a.error===AJAX_STATUS.HOST_ERROR||a.error===AJAX_STATUS.TIMEOUT)return f.isHostError=!0,void c.setState(f);f.addProperty("items",a.items),a.ads&&f.addProperty("ads",a.ads),a.version&&f.addProperty("version",a.version),d&&MediaOverlayComponent.addMedias(a.items,a.filters,{page:b.searchModel.page}),"images"===f.type&&d.scrollHeight<window.innerHeight&&setTimeout(function(){b.addPage()},0),c.setState(f),b.canScroll=!0,a.last&&hasClass(document.body,"device")&&$("footer")[0]&&($("footer")[0].style.display="block")})}},getTitleClass:function(){return this.isAPIError?'class="results-column-title--no-results"':""}}),AllMobileColumnComponent=Class([Component,ResultColumnComponent],{constructor:function(a,b){b=b||{},this.route=a,this.isInfinite=!!b.isInfinite,this.name="all_mobile_column",this.defaultClassName="results-column results-column--all-mobile";var c=b.filters||{};c.device=SiteHelper.getDeviceName(),AppComponent.isExtensionDisabled()&&(c.extensionDisabled=!0),this.searchModel=new SearchModel(constants.SearchTypes.SMART_MOBILE,a.rawParams.q,{filters:c}),this.queryContext=new QueryContextComponent(this.route,this.isSingleColumn),this.webAddBlock=new WebAddBlockComponent(this.route,constants.SearchTypes.WEB),this.iaContainer=new IAContainerComponent(this.route),_super(this)},initState:function(){return{filtersContainer:new ResultFiltersContainer([]),encodedKeyPhrase:this.route&&this.route.params?this.route.params.q:"",searchModel:this.searchModel,resultFragment:new ResultFragmentComponent(constants.SearchTypes.ALL_MOBILE,this.route,[],this,{firstFragment:!0,isSingleColumn:!0}),webAddBlock:this.webAddBlock,queryContext:this.queryContext,iaContainer:this.iaContainer}}}),ImagesColumnComponent=Class([Component,ResultColumnComponent],{constructor:function(a,b){if(b=b||{},this.page=0,this.route=a,a.params.o){var c=a.params.o.split(":")[0];c&&(this.page=parseInt(c))}this.isInfinite=!!b.isInfinite,this.searchModel=new SearchModel(constants.SearchTypes.IMAGES,a.rawParams.q,{filters:b.filters,count:50,nocache:a.params.nc,page:this.page}),this.name="images_column",this.defaultClassName="results-column results-column--images",_super(this),window.innerWidth<=640?window.addEventListener("resize",function(){window.innerWidth>640&&($(".results-column")[0].style.display="none",window.location=window.location)}):(this.timeoutId=null,actionManager.addResizeListener(this,this.mosaiq,{resize:!0}),actionManager.onCustomEvent(this,"rendered",this.mosaiq,{resize:!1}),window.addEventListener("resize",function(){window.innerWidth<640&&($(".results-column")[0].style.display="none",window.location=window.location)}))},initState:function(){return{searchModel:this.searchModel,resultFragment:new ResultFragmentComponent(constants.SearchTypes.IMAGES,this.route,[],this)}},hideMorePicturesButton:function(){var a=$(".search__result__add")[0];a&&(a.style.display="none")},showMorePicturesButton:function(){var a=$(".search__result__add")[0];a&&(a.style.display="block")},doneResizing:function(a){if(a){removeClass($(".image_preview--arrow-up--active")[0],"image_preview--arrow-up--active");for(var b=parseInt(a.className.substring(2)),c=$(".result--images"),d=null,e=0;e<c.length;e++)if(hasClass(c[e],"first")&&parseInt(c[e].id.substring(2))>b){d=c[e];break}if(d){var f=a.cloneNode(!0);addClass($i(a.className.substr(0,a.className.indexOf(" "))).lastChild,"image_preview--arrow-up--active"),d.parentNode.insertBefore(f,d),f.style.display="flex"}a.remove()}},mosaiq:function(a,b){if(b&&"result_fragment"!==b.name)return!1;if(a.resize){var c=$(".result--images-preview")[0];c&&(removeClass($(".image_preview--arrow-up--active")[0],"image_preview--arrow-up--active"),c.style.display="none")}if(setTimeout(function(){new Mosaiq("results-column--images").process()},0),a.resize){this.timeoutId&&clearTimeout(this.timeoutId);var d=this;this.timeoutId=setTimeout(function(){d.doneResizing(c)},150)}}}),NewsColumnComponent=Class([Component,ResultColumnComponent],{$statics:{openSimilars:function(a){var b=$i("result-news--similars--to-develop-"+a),c=$i("result-news--similars--label-"+a);b&&c&&(b.classList.add("result-news--similars--open"),c.style.display="none")},logClick:function(a,b,c){var d=$(".result-news--similars-links--first");if(d){c.displayed_urls=[];for(var e=0;e<d.length;e++)c.displayed_urls[e]=d[e].innerHTML;LinkHelper.logHandler(a,b,c)}},formatDateOfNews:function(a){var b=a-applicationState.timeMillisOffset/1e3;return DateHelper.getDelta(b)<86400?DotHelper.timeAgoInWords(b):strftime(i18n.date.mediumFormat,new Date(1e3*b))}},constructor:function(a,b){this.route=a,b=b||{},AppComponent.isExtensionDisabled()&&(b.filters.extensionDisabled=!0),this.isInfinite=!!b.isInfinite,this.isSingleColumn=!!b.isSingleColumn;b.filters.device=SiteHelper.getDeviceName(),this.searchModel=new SearchModel(constants.SearchTypes.NEWS,a.rawParams.q,{filters:b.filters,count:50}),this.webAddBlock=new WebAddBlockComponent(this.route,constants.SearchTypes.NEWS,"C",this.isSingleColumn),this.name="news_column",this.defaultClassName="results-column results-column--news",_super(this)},initState:function(){return{filtersContainer:new ResultFiltersContainer([]),encodedKeyPhrase:this.route&&this.route.params?this.route.params.q:"",isSingleColumn:this.isSingleColumn,searchModel:this.searchModel,resultFragment:new ResultFragmentComponent(constants.SearchTypes.NEWS,this.route,[],this,{ghostLoad:"news",ghostLoadNb:10}),reportContentComponent:ReportContentComponent.getInstance(),webAddBlock:this.webAddBlock}}}),ResultHelper=Class({$statics:{checkExtension:function(a){for(var b=a.split("."),c=b.reverse()[0],d=["pdf","doc","docx","dot","docm","dotx","dotm","docb","xls","xlsx","xlt","xlm","xlsm","xltx","xltm","xlsb","xla","xlam","xll","xlw","ppt","pot","pps","pptx","pptm","potx","potm","ppam","ppsx","ppsm","sldx","sldm","odt","ott","odm","odf","ots","oth","ods","ots","odg","otg","odp","otp","odf","odb","oxt"],e=d.length;e--;)if(d[e]===c)return c;return null},getDomainUrl:function(a){try{var b=new URL(a)}catch(a){return""}return b.host}}}),ShoppingColumnComponent=Class([Component,ResultColumnComponent],{$statics:{openOtherOffers:function(a,b){var c=$i("result--shopping__other-offers-"+a);if(b&&(c=$i("result--shopping__other-offers-"+a+"-"+b)),c)if(hasClass(c,"open")){var d=$(".shopping-mosaic")[0],e=$(".shopping-mosaic-ia")[0];(d||e)&&(c.style.height="32px",c.style.transition="height 0.5s"),removeClass(c,"open")}else{var f="other-offers-see-more";$(".shopping-mosaic")[0]?c.style.height="335px":$(".shopping-list")[0]||(c.style.height="268px",f="other-offers-see-more-ia"),addClass(c,"open"),LinkHelper.logHandler(this,Event,{AjaxRoute:"userInteraction",event:"click",zone:f,position:a+1,domain:null===b?"shopping":"homeShopping"})}},getDisplayType:function(){return hasClass(document.body,"shopping-mosaic")?"mosaic":"list"}},constructor:function(a,b){b=b||{},this.route=a,this.isInfinite=!!b.isInfinite,this.filters=b.filters,this.searchModel=new SearchModel(constants.SearchTypes.SHOPPING,a.rawParams.q,{filters:b.filters,nocache:a.params.nc}),this.name="shopping_column",this.isListForced=!1,this.ghost="shopping",hasClass(document.body,"device")?(removeClass(document.body,"shopping-mosaic"),addClass(document.body,"shopping-list")):hasClass(document.body,"shopping-list")||(addClass(document.body,"shopping-mosaic"),this.ghost="shopping_card"),actionManager.addResizeListener(this,this.updateDisplayType),this.tooltipID=actionManager.addClickListener(this,this.openTooltip,{clickOutHandler:this.closeTooltip}),this.defaultClassName="results-column results-column--shopping",this.tooltip=new TooltipComponent(this,_('The products and services listed on this results page match your query. Qwant is paid by advertisers according to a hybrid model of CPC ("cost per click") and CPA ("cost per acquisition"). On Qwant Shopping, the default ranking is based on criteria of relevance to your request and takes into account the quality of the advertiser\'s data as well as the price (the lowest prevails). As with all Qwant products and services, Qwant Shopping is guaranteed without cookies or any other form of tracking. On our platform, you search for products and services anonymously and with respect for your privacy. The merchants from whom you finalize your purchases have their own general terms and conditions of sale (RGPD, applicable taxes, shipping costs, delivery options...) and their own personal data protection policies. For more information on these terms and conditions, please visit the dedicated merchant sites page.',"result")),_super(this)},initState:function(){return this.state={searchModel:this.searchModel,resultFragment:new ResultFragmentComponent(constants.SearchTypes.SHOPPING_V4,this.route,[],this,{ghostLoad:this.ghost,ghostLoadNb:10})},this.state},setDisplayType:function(a){hasClass(document.body,"shopping-"+a.type)||(removeClass(document.body,"shopping-mosaic"),removeClass(document.body,"shopping-list"),addClass(document.body,"shopping-"+a.type),this.state.searchModel=new SearchModel(constants.SearchTypes.SHOPPING,this.route.rawParams.q,{filters:this.filters,nocache:this.route.params.nc}),this.setState(this.state),this.search(this.route),this.isListForced=!1)},updateDisplayType:function(){!this.isListForced&&window.innerWidth<=1024&&(this.setDisplayType({type:"list"}),this.isListForced=!0)},openTooltip:function(){TooltipComponent.changeContent({it:this.tooltip,message:_('The results presented on this page do not necessarily represent all the products and services available on the Web. These are results for which Qwant is remunerated by advertisers according to a hybrid model with CPC ("cost per click") and CPA ("cost per acquisition"). The default ranking of Shopping offers is based on criteria of relevance to your request and takes into account the quality of the advertiser\'s data as well as the price of the product, excluding transport costs, insurance or additional services. The classification of merchants for the same product is carried out by default by ascending price. As with all Qwant products and services, Qwant Shopping is guaranteed to be cookie-free and free of any other form of tracking. On our platform, you search for products and services anonymously and with respect for your privacy. The merchants from whom you finalize your purchases have their own general terms and conditions of sale (applicable taxes, shipping costs, delivery options...) which you must read before purchase. Strikethrough prices are indicative information provided by the merchant when indexing its product data.<a href="{link}" {target}>{text}</a>',"result",{link:"https://about.qwant.com/fr/legal/modalites-de-referencement-dereferencement-et-de-classement/",text:_("Learn more","result"),target:SecurityHelper.targetBlank()})}),TooltipComponent.placeTooltip({it:this.tooltip,componentId:this.tooltipID});var a=$i("tooltip--"+this.tooltip.id);addClass(a,"active")},closeTooltip:function(){var a=$i("tooltip--"+this.tooltip.id);removeClass(a,"active")}}),SmartColumnComponent=Class([Component,ResultColumnComponent],{constructor:function(a){this.searchModel=new SearchModel(constants.SearchTypes.SMART,a.rawParams.q,{filters:{exclude:"web,videos"},count:3}),this.name="smart_column",this.defaultClassName="results-column results-column--smart",_super(this)},initState:function(){return{searchModel:this.searchModel,resultFragment:new ResultFragmentComponent(constants.SearchTypes.SMART,this.route,[],this)}}}),SocialColumnComponent=Class([Component,ResultColumnComponent],{constructor:function(a,b){this.route=a,b=b||{},this.isInfinite=!!b.isInfinite,this.isSingleColumn=!!b.isSingleColumn,this.searchModel=new SearchModel(constants.SearchTypes.SOCIAL,a.rawParams.q,{filters:b.filters}),this.name="social_column",this.defaultClassName="results-column results-column--social",_super(this)},initState:function(){return{encodedKeyPhrase:this.route&&this.route.params?this.route.params.q:"",isSingleColumn:this.isSingleColumn,searchModel:this.searchModel,resultFragment:new ResultFragmentComponent(constants.SearchTypes.SOCIAL,this.route,[],this,{ghostLoad:"social",ghostLoadNb:10})}}}),VideosColumnComponent=Class([Component,ResultColumnComponent],{constructor:function(a,b){b=b||{},this.isInfinite=!!b.isInfinite;var c=0;a.params.o&&(c=a.params.o.split(":")[0]),this.searchModel=new SearchModel(constants.SearchTypes.VIDEOS,a.rawParams.q,{filters:b.filters,count:30,nocache:a.params.nc,page:c}),this.name="videos_column",this.route=a,this.defaultClassName="results-column results-column--videos",_super(this)},initState:function(){return{searchModel:this.searchModel,resultFragment:new ResultFragmentComponent(constants.SearchTypes.VIDEOS,this.route,[],this,{ghostLoad:"videos",ghostLoadNb:30})}}}),WebColumnComponent=Class([Component,ResultColumnComponent],{$statics:{toggleAdsTooltip:function(a){for(var b=a.index||0,c=$(".result__web__tooltip"),d=0,e=c.length;d<e;d++)d!=b&&WebColumnComponent.hideAdsTooltip({index:d});WebColumnComponent.isAdsTooltipOpened({index:b})?WebColumnComponent.hideAdsTooltip({index:b}):WebColumnComponent.displayAdsTooltip({index:b})},displayAdsTooltip:function(a){ResultActionsComponent.closeAllMenus(),addClass($(".result__web__tooltip--"+a.index),"result__web__tooltip--visible")},hideAdsTooltip:function(a){removeClass($(".result__web__tooltip--"+a.index),"result__web__tooltip--visible")},isAdsTooltipOpened:function(a){return hasClass($(".result__web__tooltip--"+a.index),"result__web__tooltip--visible")},logClick:function(a,b,c){var d=$(".result--web--link");if(d){c.displayed_urls=[];for(var e=0;e<d.length;e++)c.displayed_urls[e]=d[e].href;LinkHelper.logHandler(a,b,c)}}},constructor:function(a,b){this.route=a,b=b||{},this.isInfinite=!!b.isInfinite,this.isSingleColumn=!!b.isSingleColumn,b.filters=b.filters||{},b.filters.device=SiteHelper.getDeviceName(),AppComponent.isExtensionDisabled()&&(b.filters.extensionDisabled=!0),this.searchModel=new SearchModel(constants.SearchTypes.WEB,a.rawParams.q,b),this.name="web_column",this.defaultClassName="results-column results-column--web",this.iaContainer=null,this.webAddBlock=new WebAddBlockComponent(this.route,constants.SearchTypes.WEB,"A",this.isSingleColumn),this.queryContext=new QueryContextComponent(this.route,this.isSingleColumn),this.tooltipID=actionManager.addClickListener(this,this.openTooltip,{clickOutHandler:this.closeTooltip}),this.tooltip=new TooltipComponent(this,_("Sorted by relevance","result")),this.isSingleColumn&&window.innerWidth<=1210&&(this.iaContainer=new IAContainerComponent(this.route)),_super(this)},initState:function(){return{filtersContainer:new ResultFiltersContainer([]),encodedKeyPhrase:this.route&&this.route.params?this.route.params.q:"",isSingleColumn:this.isSingleColumn,searchModel:this.searchModel,resultFragment:new ResultFragmentComponent(constants.SearchTypes.WEB,this.route,[],this,{firstFragment:!0,isSingleColumn:this.isSingleColumn,ghostLoad:"web",ghostLoadNb:10}),reportContentComponent:ReportContentComponent.getInstance(),webAddBlock:this.webAddBlock,queryContext:this.queryContext,iaContainer:this.iaContainer}},openTooltip:function(){TooltipComponent.changeContent({it:this.tooltip,message:_('Sorted by relevance<a href="{link}" {target}>{text}</a>',"result",{link:"https://about.qwant.com/fr/legal/modalites-de-referencement-dereferencement-et-de-classement/",text:_("Learn more","result"),target:SecurityHelper.targetBlank()})}),TooltipComponent.placeTooltip({it:this.tooltip,componentId:this.tooltipID});var a=$i("tooltip--"+this.tooltip.id);addClass(a,"active")},closeTooltip:function(){var a=$i("tooltip--"+this.tooltip.id);removeClass(a,"active")}}),ResultFilterComponent=Class(Component,{$statics:{toggleFilters:function(a){if("input_list"===a.name)var b=$(".result_filter__item--input_list")[0];else var b=$(".result_filter__item--"+a.name)[0];hasClass(b,"result_filter__item--reduced")?(removeClass(b,"result_filter__item--reduced"),removeClass($(".result_filter__item--"+a.name+" span")[0],"result_filter__item__label--icon-plus"),addClass($(".result_filter__item--"+a.name+" span")[0],"result_filter__item__label--icon-minus")):(addClass(b,"result_filter__item--reduced"),removeClass($(".result_filter__item--"+a.name+" span")[0],"result_filter__item__label--icon-minus"),addClass($(".result_filter__item--"+a.name+" span")[0],"result_filter__item__label--icon-plus"))}},constructor:function(a){this.name=a.name,this.label=a.label,this.type=a.type,this.values=a.values,a.selected&&(this.selected=a.selected),a.icon&&(this.icon=a.icon),this.route=Dispatcher.history.get(0),ResultFilterComponent.$super.call(this),actionManager.addSubmitListener(this,ResultFiltersContainer.validate,{key:"validate_filters"})},getLabel:function(){throw new Error("Invalid call to abstract method getLabel")},getPartialTemplateName:function(){if(hasClass($("body"),"device")&&hasClass($("body"),"desktop")&&("list_single_choice"===this.type||"dropdown"===this.type))return"result_filter_dropdown";if(hasClass($("body"),"device")&&("list_single_choice"===this.type||"dropdown"===this.type))return"result_filter_dropdown";if("dropdown"===this.type){if("web"===this.route.params.t&&"freshness"===this.name&&window.innerWidth>=1025)return"result_filter_dropdown";if("shopping"===this.route.params.t||"news"===this.route.params.t||window.innerWidth<1025)return"result_filter_list_single_choice"}switch(this.type){case ResultFilterFactory.LIST_DROPDOWN:return"result_filter_dropdown";case ResultFilterFactory.LIST_MULTIPLE_CHOICE:return"result_filter_list_multiple_choice";case ResultFilterFactory.LIST_SINGLE_CHOICE:return"result_filter_list_single_choice";case ResultFilterFactory.INPUT:return"result_filter_input";default:throw"Unknown filter type"}},getFilterItems:function(){return this.values.map(this.prepareFilterItems,this)},prepareFilterItems:function(a){var b=a.label;!0===a.translate&&(b=_(b));var c=!1;return void 0===a.value&&(a.value=a.label),(Array.isArray(this.selected)&&-1!==this.selected.indexOf(a.value)||!Array.isArray(this.selected)&&a.value===this.selected)&&(c=!0),{label:b,selected:c,value:a.value}},getFilterOptions:function(a){for(var b=this.selected,c=null,d=this.values.length,e=0;e<d;e++)this.values[e].value&&this.values[e].value===b&&(c=this.values[e]);var f="",g=null;if(c){if(g=this.icon||null,!0===c.translate||c.label.match(/^grid:/))if(c.placeholder)if(c.placeholder.match(/^grid:color:/)){var h=c.placeholder.match(/^grid:color:([a-z]+) (.*)$/);f='<div class="dropdown__placeholder__pin filter__color--'+h[1]+'"></div>'+_(h[2]),this.placeholderMobile='<div class="dropdown__placeholder__pin filter__color--'+h[1]+'"></div>'+this.getLabel()}else f=_(c.placeholder);else f=_(c.value!==this.values[0].value||"all"!==this.values[0].value&&null!==Dispatcher.getUrlParameter(a)?c.label:this.label);else f=c.value!==this.values[0].value||"all"!==this.values[0].value&&null!==Dispatcher.getUrlParameter(a)?c.label:this.label;g&&(f='<span class="icon icon-'+g+' result_filter__icon__before"></span>'+f)}return{placeholder:f,value:c?c.value:"",callback:this.filterSearch,component:this,filterName:a,filterType:this.type}},filterSearch:function(a,b){if(hasClass($("body"),"device"))ResultFiltersContainer.addFilter(b.filterName,a);else{var c=this.getNewFiltersValues(a,b);page(this.getNewUrl(c))}},getNewFiltersValues:function(a,b){var c=this.route.rawParams||{},d=b.filterName;return d?(c[d]=a,c):c},getNewUrl:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&this.isFilterWorthConsidering(a[c])&&b.push([c,encodeURIComponent(a[c])].join("="));return this.route.pathname+"?"+b.join("&")},isFilterWorthConsidering:function(a){return null!==a&&(Array.isArray(a)&&a.length>0||!Array.isArray(a)&&""!==a)}}),ResultFilterBrand=Class(ResultFilterComponent,{constructor:function(a){ResultFilterBrand.$super.call(this,a)},getLabel:function(){return _("Filter by brands","filters")},getFilterOptions:function(a){var b=ResultFilterBrand.$superp.getFilterOptions.call(this,a);return b.initialCount=6,b.partialDisplay=!0,b}}),ResultFilterCategory=Class(ResultFilterComponent,{$statics:{URL_PARAM_SEPARATOR:"|",formatLabel:function(a){return a.replace("&","").replace(" ","-")},selected:"",setActiveCategory:function(){if(ResultFilterCategory.selected.length>0){var a=$(".sub__item--"+ResultFilterCategory.selected[0])[0];addClass(a,"sub__item--active")}}},constructor:function(a){ResultFilterCategory.$super.call(this,a),hasClass($("body"),"device")&&(this.selected.length>0&&(ResultFilterCategory.selected=this.selected),this.values.unshift({label:_("All","filter"),value:"all",count:0,subitems:{}}))},filterSearch:function(a,b){if(hasClass($("body"),"device")){var c=this.getNewFiltersValues(a,b);this.selected=[a];for(var d=$(".sub__item"),e=0;e<d.length;e++)hasClass(d[e],"sub__item--active")&&removeClass(d[e],"sub__item--active");if(a!==_("All","filter")){var f=$(".sub__item--"+ResultFilterCategory.formatLabel(a))[0];addClass(f,"sub__item--active");this.getNewUrl(c);ResultFiltersContainer.addFilter(b.filterName,a)}else ResultFilterCategory.selected=[],ResultFiltersContainer.addFilter(b.filterName,a)}else ResultFilterCategory.$superp.filterSearch.call(this,a,b)},getLabel:function(){return _("Filter by category","filters")},prepareFilterItems:function(a){var b=ResultFilterCategory.$superp.prepareFilterItems.call(this,a);return a.count&&(b.count=a.count),Array.isArray(this.selected)&&(b=this.formatFilterData(a)),b},formatFilterData:function(a){var b=-1!==this.selected.indexOf(a.label),c={label:a.label,value:a.label,count:a.count,selected:b};if(a.subitems)if(Array.isArray(a.subitems))c.subitems=a.subitems.map(this.formatFilterData,this);else{c.subitems=[];var d;for(d in a.subitems)if(a.subitems.hasOwnProperty(d)){var e=a.subitems[d];c.subitems.push({label:d,value:d,count:e,selected:-1!==this.selected.indexOf(d)})}}return c},getNewFiltersValues:function(a,b){var c=this.route.rawParams||{};return Array.isArray(a)?c[ResultFilterFactory.FILTER_CATEGORY]=a.join(ResultFilterCategory.URL_PARAM_SEPARATOR):c[ResultFilterFactory.FILTER_CATEGORY]=a,c},filterSubItem:function(a,b){ResultFiltersContainer.addFilter(b.filterName,a)},getFilterSubOptions:function(a){return{placeholder:_("All","filter"),value:a.label,callback:this.filterSubItem,component:this,filterName:"sub",filterType:this.type,allValue:_("All","filter")}},getFilterOptions:function(a){var b,c=this.selected;b=Array.isArray(c)?c[c.length-1]:c;var d={placeholder:b||_("All","filter"),value:b||"",callback:this.filterSearch,component:this,filterName:a,filterType:this.type,allValue:_("All","filter")};return d.displayCloseButton=!0,d.displayItemCount=!0,d}}),ResultFilterColor=Class(ResultFilterComponent,{constructor:function(a){ResultFilterColor.$super.call(this,a)},getLabel:function(){return _("Color","filters")},getFilterOptions:function(a){return ResultFilterShop.$superp.getFilterOptions.call(this,a)}}),ResultFilterFactory=Class({$statics:{LIST_SINGLE_CHOICE:"list_single_choice",LIST_DROPDOWN:"dropdown",LIST_MULTIPLE_CHOICE:"list_multiple_choice",INPUT:"input",FILTER_PRICE_RANGE:"price",FILTER_CATEGORY:"category",FILTER_BRAND:"brands",FILTER_SHOP:"merchant",FILTER_SOURCE:"source",FILTER_SORT:"order",FILTER_SIZE:"size",FILTER_LICENSE:"license",FILTER_FRESHNESS:"freshness",FILTER_COLOR:"color",FILTER_TYPE:"imagetype",FILTER_FORMAT:"format",createFilters:function(a){var b=[],c=a.items,d=a.filters;for(var e in d)if(d.hasOwnProperty(e)&&d[e].values&&d[e].values.length>0){var f=d[e];f.name=e;var g=ResultFilterFactory.createFilterByName(f,c);null!==g&&b.push(g)}return b},createFilterByName:function(a,b){switch(a.name){
case ResultFilterFactory.FILTER_PRICE_RANGE:return new ResultFilterPriceRange(a,b);case ResultFilterFactory.FILTER_BRAND:return new ResultFilterBrand(a);case ResultFilterFactory.FILTER_CATEGORY:return new ResultFilterCategory(a);case ResultFilterFactory.FILTER_SHOP:return new ResultFilterShop(a);case ResultFilterFactory.FILTER_SOURCE:return new ResultFilterSource(a);case ResultFilterFactory.FILTER_SORT:return new ResultFilterSort(a);case ResultFilterFactory.FILTER_SIZE:return new ResultFilterSize(a);case ResultFilterFactory.FILTER_LICENSE:return new ResultFilterLicense(a);case ResultFilterFactory.FILTER_FRESHNESS:return new ResultFilterFreshness(a);case ResultFilterFactory.FILTER_COLOR:return new ResultFilterColor(a);case ResultFilterFactory.FILTER_TYPE:return new ResultFilterType(a);case ResultFilterFactory.FILTER_FORMAT:return new ResultFilterFormat(a);default:return new ResultFilterComponent(a)}}}}),ResultFilterFormat=Class(ResultFilterComponent,{constructor:function(a){ResultFilterFormat.$super.call(this,a)},getLabel:function(){return _("Format","filters")}}),ResultFilterFreshness=Class(ResultFilterComponent,{constructor:function(a){ResultFilterFreshness.$super.call(this,a)},getLabel:function(){return _("Freshness","filters")}}),ResultFilterLicense=Class(ResultFilterComponent,{constructor:function(a){ResultFilterLicense.$super.call(this,a)},getLabel:function(){return _("License","filters")},getFilterOptions:function(a){var b=ResultFilterShop.$superp.getFilterOptions.call(this,a);return b.partialDisplay=!0,b}}),ResultFilterPriceRange=Class(ResultFilterComponent,{$statics:{URL_PARAM_MIN_PRICE:"minPrice",URL_PARAM_MAX_PRICE:"maxPrice",DEFAULT_CURRENCY:"EUR"},constructor:function(a,b){ResultFilterPriceRange.$super.call(this,a),this.currency=this.getResultsCurrency(b)},getLabel:function(){return _("Filter by price","filters")},getResultsCurrency:function(a){if(a&&a.length>0){var b=a[0];if(b.offers){var c=b.offers[0];return c.priceCurrency?c.priceCurrency:ResultFilterPriceRange.DEFAULT_CURRENCY}}return ResultFilterPriceRange.DEFAULT_CURRENCY},getCurrency:function(){return this.currency},filterSearch:function(){var a=$(".result_filter__item__container__input"),b=$(".result_filter__item__errorMessage")[0],c=a[0].value.trim(),d=a[1].value.trim();if(""===c&&""===d){if(!this.isPriceFilterActive())return b.innerHTML=_("You need to fill one or both input above","shopping"),!1;var e=this.route.rawParams||{};return e[ResultFilterPriceRange.URL_PARAM_MIN_PRICE]=null,e[ResultFilterPriceRange.URL_PARAM_MAX_PRICE]=null,page(this.getNewUrl(e)),!1}if(c=c.replace(",","."),d=d.replace(",","."),isNaN(c)||isNaN(d))return b.innerHTML=_("You need to use numbers","shopping"),!1;if(c=isNaN(c)||""===c?"":parseFloat(c),d=isNaN(d)||""===d?"":parseFloat(d),c<0||d<0)return b.innerHTML=_("The price can't be a negative number","shopping"),!1;if(c>=d&&""!==d)return b.innerHTML=_("The minimum price must be below the to maximum price","shopping"),!1;var f={};f[ResultFilterPriceRange.URL_PARAM_MIN_PRICE]=c,f[ResultFilterPriceRange.URL_PARAM_MAX_PRICE]=d;var e=this.route.rawParams||{};for(var g in f)f.hasOwnProperty(g)&&(e[g]=f[g]);page(this.getNewUrl(e))},isPriceFilterActive:function(){var a=this.route.rawParams||{};return a[ResultFilterPriceRange.URL_PARAM_MIN_PRICE]||a[ResultFilterPriceRange.URL_PARAM_MAX_PRICE]},getInputPlaceholder:function(a){return!isNaN(a.value)&&a.value>=0?"value="+a.value:a.name===ResultFilterPriceRange.URL_PARAM_MIN_PRICE?"placeholder="+_("min","filters"):"placeholder="+_("max","filters")},renderInputField:function(a){var b=i18n.number.currencyFormat,c=Component.renderPartial("filter_input_price",{value:a,filter:this});return c=b.replace(/\{price}/,c).replace(/\{currency}/,NumberHelper.getCurrencySymbol(this.getCurrency()))}}),ResultFilterShop=Class(ResultFilterComponent,{constructor:function(a){ResultFilterShop.$super.call(this,a)},getLabel:function(){return _("Filter by shop","filters")},getFilterOptions:function(a){var b=ResultFilterShop.$superp.getFilterOptions.call(this,a);return b.displayCloseButton=!0,b.partialDisplay=!0,b.allValue=_("All","filter"),b}}),ResultFilterSize=Class(ResultFilterComponent,{constructor:function(a){ResultFilterSize.$super.call(this,a)},getLabel:function(){return _("Size","filters")}}),ResultFilterSort=Class(ResultFilterComponent,{constructor:function(a){ResultFilterSort.$super.call(this,a)},getLabel:function(){return _("Order by","filters")}}),ResultFilterSource=Class(ResultFilterComponent,{constructor:function(a){ResultFilterSource.$super.call(this,a),"news"===this.route.params.t&&"all"===a.values[0].value&&a.values.splice(0,1)},getLabel:function(){return _("Sources","filters")},getFilterOptions:function(a){var b=ResultFilterCategory.$superp.getFilterOptions.call(this,a);if("news"===this.route.params.t){for(var c=[],d=this.values.length,e=0;e<d;e++)this.values[e].value&&this.isSourceSelected(this.values[e].value)&&c.push(this.values[e]);c.length>0&&(b.value=c),b.displayCloseButton=!0,b.allValue=_("All","filter")}return b},isSourceSelected:function(a){return Array.isArray(this.selected)?-1!==this.selected.indexOf(a):this.selected===a},getNewFiltersValues:function(a,b){var c=ResultFilterSource.$superp.getNewFiltersValues.call(this,a,b);return"all"===a&&("web"===this.route.params.t?c=ResultFilterSource.$superp.getNewFiltersValues.call(this,null,b):c.q=c.q.replace(this.cleanSiteQueryRegex(),"")),c},cleanSiteQueryRegex:function(){return new RegExp(" *site *: *("+this.values.map(function(a){return a.value}).join("|")+") *","i")}}),ResultFilterType=Class(ResultFilterComponent,{constructor:function(a){ResultFilterType.$super.call(this,a)},getLabel:function(){return _("Type","filters")}}),ResultFiltersContainer=Class(Component,{$statics:{filters:[],validate:function(){var a=Dispatcher.history.get(0),b=ResultFiltersContainer.filters,c=[],d=$(".result_filter__item__container__input"),e="",f="";d.length>0&&(e=d[0].value.trim(),f=d[1].value.trim());var g=a.rawParams?a.rawParams:[];for(var h in g)b[h]||"q"===h||"t"===h||(b[h]=g[h]);if(""!==e&&(e=e.replace(",","."),e=isNaN(e)||""===e?"":parseFloat(e),c.push([ResultFilterPriceRange.URL_PARAM_MIN_PRICE,e].join("="))),""!==f&&(f=f.replace(",","."),f=isNaN(f)||""===f?"":parseFloat(f),c.push([ResultFilterPriceRange.URL_PARAM_MAX_PRICE,f].join("="))),void 0!==b.category&&b.category===_("All","filter")&&(delete b.category,delete ResultFiltersContainer.filters.category,void 0!==b.sub&&(delete b.sub,delete ResultFiltersContainer.filters.sub)),void 0!==b.sub){var i=b.category+"|"+b.sub;c.push(["category",encodeURIComponent(i)].join("="))}else void 0!==b.category&&c.push(["category",encodeURIComponent(b.category)].join("="));for(var j in b)"sub"!==j&&"category"!==j&&b[j].length>0&&"all"!==b[j]&&c.push([j,encodeURIComponent(b[j])].join("="));var k="q="+a.rawParams.q+"&t="+a.rawParams.t,l=a.pathname+"?"+k;c.length>0&&(l+="&"+c.join("&")),ResultFiltersContainer.filters=[],page(l)},getNewUrl:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&this.isFilterWorthConsidering(a[c])&&b.push([c,encodeURIComponent(a[c])].join("="));return this.route.pathname+"?"+b.join("&")},addFilter:function(a,b){ResultFiltersContainer.filters[a]=b},toggleResultFilters:function(a){if(!a.id)return!1;var b=$i(a.id);b&&(hasClass(b,"result_filters--visible")?ResultFiltersContainer.hideResultFilters(b):ResultFiltersContainer.showResultFilters(b))},showResultFilters:function(a){if(a){var b=$("body")[0];ResultFilterCategory.setActiveCategory(),addClass(a,"filters__menu--active"),addClass(b,"appmenu"),addClass(a,"result_filters--visible")}},hideResultFilters:function(a){if(a){var b=$("body")[0];removeClass(a,"filters__menu--active"),removeClass(b,"appmenu"),removeClass(a,"result_filters--visible")}},areFiltersValid:function(a){if("object"!=typeof a)return!1;var b=0;for(var c in a)if(b++,"object"!=typeof a[c])return!1;return b>0},clickHideResultFilters:function(a){if(!a.id)return!1;var b=$i(a.id);b&&removeClass(b,"result_filters--visible")},shouldDisplayDisclaimer:function(){return($(".results-view--web")[0]||$(".results-view--shopping")[0])&&"FR"===applicationState.user.userSetting.getSearchRegionCode()}},constructor:function(a){this.name="result_filters_container",this.filters=a,_super(this)}}),ResultFragmentComponent=Class(Component,{$statics:{getInstance:function(){return ResultFragmentComponent.instance?ResultFragmentComponent.instance:new ResultFragmentComponent},prepareResultItems:function(a,b,c,d){return"smart"===b?a:(d=d||!1,a.map(function(a,e){if(b==constants.SearchTypes.SHOPPING||b==constants.SearchTypes.SHOPPING_V4)try{a=new ShoppingSearchResultModel(a),a.url=a.getMainOffer().getUrl()}catch(a){return l.error(a),{}}return a.type=b,a.index=e+c,siteConfiguration.resultActionsOptions&&siteConfiguration.resultActionsOptions[a._type||a.type]&&(a.resultActionsComponent=new ResultActionsComponent(a,siteConfiguration.resultActionsOptions[a._type||a.type]||{},d)),a}))},hasValidResultsToDisplay:function(a){return a&&a.filter(function(a){return Object.keys(a).length>0}).length>0||0===a.length},instance:null},constructor:function(a,b,c,d,e){e=e||{},this.column=d,this.type=a,this.route=b,this.items=c||[],this.ghostLoad=e.ghostLoad||!1,this.ghostLoadNb=e.ghostLoadNb||1,this.name="result_fragment",e.firstFragment&&(this.defaultClassName="result_fragment result_fragment--first"),this.options=e||{},this.imageNotSameRow=!0,addClass(document.body,"scroll_on_results"),LayoutComponent.registerBeforeAction(function(){removeClass(document.body,"scroll_on_results")}),_super(this)},initState:function(){return{type:this.type,items:this.items,isEmptyResult:!1,route:this.route,ghostLoad:this.ghostLoad,ghostLoadNb:this.ghostLoadNb}},partialName:function(){return"result_"+this.type},gifHoverIn:function(a){var b=$(".gif_animated--"+a.id)[0];$(".button_gif--"+a.id)[0].style.display="none",b.src=a.mediaAnimated,b.style.display="inline-block",b.style.visibility="visible"},gifHoverOut:function(a){var b=$(".gif_animated--"+a.id)[0];$(".button_gif--"+a.id)[0].style.display="inline-block",b.style.display="none",b.style.visibility="hidden"},onErrorImageLoad:function(a){window.innerWidth>640&&(MediaOverlayComponent.setError(a),removeParentByClassName(this,"result"),setTimeout(function(){new Mosaiq("results-column--images").process()},500))},reloadSearch:function(){this.column.search(this.route)},shouldDisplaySmartItem:function(a){switch(a){case"news":return void 0===applicationState.user.userSetting.showSmartNews&&(applicationState.user.userSetting.showSmartNews=!0),applicationState.user.userSetting.showSmartNews;case"videos":return void 0===applicationState.user.userSetting.showSmartVideos&&(applicationState.user.userSetting.showSmartVideos=!0),applicationState.user.userSetting.showSmartVideos;case"social":return void 0===applicationState.user.userSetting.showSmartSocial&&(applicationState.user.userSetting.showSmartSocial=!0),applicationState.user.userSetting.showSmartSocial;default:return!1}},hideImagePreview:function(){this.imageNotSameRow=!0;var a=$(".result--images-preview")[0];removeClass($(".image_preview--arrow-up--active")[0],"image_preview--arrow-up--active"),a.style.height="0",setTimeout(function(){a.remove()},200)},isPreviewActive:function(a){var b=$(".result--images-preview")[0];if(b){if(parseInt(b.className.substring(2))===parseInt(a.substring(2)))return this.hideImagePreview(),!0;this.setImageNotSameRow(a,b),removeClass($(".image_preview--arrow-up--active")[0],"image_preview--arrow-up--active"),function(a){a.forEach(function(a){a.hasOwnProperty("remove")||Object.defineProperty(a,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){null!==this.parentNode&&this.parentNode.removeChild(this)}})})}([Element.prototype,CharacterData.prototype,DocumentType.prototype]),b.remove()}return!1},setImageNotSameRow:function(a,b){for(var c=$(".result--images"),d=parseInt(b.className.substring(2)),e=parseInt(a.substring(2)),f=0,g=0;g<c.length;g++)if(hasClass(c[g],"first")&&(f=parseInt(c[g].id.substring(2)),d>e&&f>e&&f<=d||d<e&&f<=e&&f>d))return void(this.imageNotSameRow=!0);this.imageNotSameRow=!1},displayImagePreview:function(a){if(!this.isPreviewActive(a.key)){for(var b=$(".result--images"),c=null,d=0;d<b.length;d++)if(hasClass(b[d],"first")&&parseInt(b[d].id.substring(2))>parseInt(a.key.substring(2))){c=b[d];break}var e=document.createElement("div");e.innerHTML=this.renderPartial("result_image_preview",a),addClass($i(a.key).lastChild,"image_preview--arrow-up--active"),c?c.parentNode.insertBefore(e.firstChild,c):b[b.length-1].parentNode.insertBefore(e.firstChild,b[b.length]),this.imageNotSameRow&&($(".result--images-preview")[0].style.height="0",setTimeout(function(){$(".result--images-preview")[0].style.height="500px"},0),smoothScrollTo($i(a.key).offsetTop))}}}),ResultHelplink=Class(Component,{$statics:{},constructor:function(a,b){this.name="result_helplink",this.data=a,this.route=b.route,this.parent=b,_super(this)},initState:function(){return{ia_runtime:this.data.IARuntime,ia_partnerName:this.data.partnerName,ia_template_name:this.data.templateName}}}),ResultListPageComponent=Class(Component,{constructor:function(a){document.activeElement&&"function"===document.activeElement.blur&&document.activeElement.blur(),this.route=a;var b=[];for(var c in siteConfiguration.searchCategories){var d=siteConfiguration.searchCategories[c];SiteHelper.isHomepageRestricted(d)||(b.push(d.name),d.index===applicationState.user.userSetting.searchMode&&(this.userDefinedSearchType=d))}a.params.t||this.userDefinedSearchType||(this.searchType=siteConfiguration.defaultSearch.name),this.searchType||(a.params.t&&-1==b.indexOf(a.params.t)&&(a.params.t=this.userDefinedSearchType.name),this.searchType=a.params.t||this.userDefinedSearchType.name),this.isScrolled=!1;for(c in siteConfiguration.searchCategories)siteConfiguration.searchCategories[c].name===this.searchType&&(QwantHomepageComponent.currentHomepage=siteConfiguration.searchCategories[c]);"all"===this.searchType&&(this.searchType="web",a.params.t=this.searchType),Application.rootComponent.state.sideBar.changeSearch({item:this.searchType,changePage:!1}),actionManager.addSubmitListener(this,this.search,{key:"result-list__search"}),this.name="result_list_page",this.defaultClassName="results-view results-view--"+this.searchType,this.webTagger=new WebTagger(this,{device:BrowserHelper.deviceType()}),this.autocomplete=null,hasClass(document.body,"device")&&$("footer")[0]&&($("footer")[0].style.display="none",LayoutComponent.registerBeforeAction(function(){$("footer")[0].style.display="block"})),_super(this)},initState:function(){document.activeElement&&"function"===document.activeElement.blur&&document.activeElement.blur();var a={};if(a.keyPhrase=this.route.params.q||"",a.rawKeyPhrase=this.route.rawParams.q||"",a.encodedKeyPhrase=this.route&&this.route.params?this.route.params.q:"",a.searchType=this.searchType,siteConfiguration.searchCategories.ALL&&this.searchType===siteConfiguration.searchCategories.ALL.name)return siteConfiguration.searchCategories.ALL&&innerWidth<siteConfiguration.searchCategories.ALL.minWidth?a.resultPage=new ResultPageAllMobileComponent(this.route):a.resultPage=new ResultPageAllComponent(this.route),a;for(var b in siteConfiguration.searchCategories){var c=siteConfiguration.searchCategories[b];if(this.searchType===c.name){var d="ResultPage"+c.name.charAt(0).toUpperCase()+c.name.slice(1)+"Component";a.resultPage=new window[d](this.route),this.isScrolled=c.scrollMobile;break}}return a.resultPage?a:(a.resultPage=new ResultPageWebComponent(this.route),this.isScrolled=!1,a)},onMount:function(){this.isScrolled&&($(".result-list__carousel")[0].scrollLeft=9999)}}),HotelsComponent=Class(Component,{constructor:function(a,b,c){this.name="hotels",this.criteria=c,this.defaultClassName="hotel-ribbon--hotels",this.hotels=a.hotels,this.searchUrl=b,this.pullLimit=20,this.isComplete=!!a.isComplete;var d=this;this.isComplete||setTimeout(function(){d.update()},1e3),_super(this)},initPull:function(a){this.criteria=a,this.pullLimit=30,this.hotels=[],this.update()},update:function(){var a=this;HotelModel.search(this.criteria).then(function(b,c){c.hotels.length>0&&(a.hotels=c.hotels),a.isComplete=!!c.isComplete,!a.isComplete&&--a.pullLimit>0&&setTimeout(function(){a.update()},1e3),a.setState({isComplete:a.isComplete,hotels:a.hotels,searchUrl:c.searchUrl})})},initState:function(){return{hotels:this.hotels,searchUrl:this.searchUrl,isComplete:this.isComplete}}}),MapsFactory=Class({$statics:{leafIcon:{general:{default:{className:"local_marker",tooltipClassName:"local_tooltip_container"}},local:{selected:{className:"local_marker local_marker_selected"},hover:{className:"local_marker local_marker_hover"},default:{className:"local_marker"}}},map_handle:null,popup:null,map_center:null,map_traffic:!1,map_view:"standard",centered_on_city:0,focused:0,createIcon:function(a,b){var c=document.createElement("div");return c.innerHTML=b,c.className=a,c},initializeMap:function(a,b,c){if($i(b)){this.focused=0,this.map_handle&&(this.map_handle=null);var d=this,e=getScript("js/maps/mapbox-gl.js?v=20181120",{noCache:!0});return e.then(function(e){"https://www.qwant.com"!==config_get("qwantUrl")&&(window.mapbox_style.sources.basemap.tiles[0]="https://www.qwant.plive/maps/tiles/ozbasemap/{z}/{x}/{y}.pbf",window.mapbox_style.glyphs="https://www.qwant.plive/maps/mapstyle/font/{fontstack}/{range}.pbf",window.mapbox_style.sprite="https://www.qwant.plive/maps/mapstyle/sprite"),d.centerMap(a,b,c)}),e}},centerMap:function(a,b,c){if(c=c||{},c.mousewheelScroll=c.mousewheelScroll||!1,c.fullscreenable=c.fullscreenable||!0,null===this.map_handle){this.map_handle=window.map_handle=new mapboxgl.Map({container:b,style:window.mapbox_style,zoom:13,hash:!1});var d=this;this.map_handle.on("load",function(){var a=["poi-level-1","poi-level-2","poi-level-3"];for(var b in a)d.map_handle.setLayoutProperty(a[b],"visibility","none")});var e=new mapboxgl.ScaleControl;this.map_handle.addControl(e,"bottom-left"),e.setUnit("metric"),this.all_markers=[]}if(!a.multiple)if(a.cityCoordinates){if(!this.centered_on_city){this.map_handle.setView(a.cityCoordinates,10);var f=$i("map_container");f&&f.classList.remove("map_container--hidden"),this.centered_on_city=1}}else a.coordinates=a.coordinates.reverse(),this.map_handle.setView(a.coordinates,9),"traffic"==a.overlay&&(this.map_handle.setOverlay(),this.map_view="standard",this.map_handle.setViewmode(this.map_view),this.map_traffic=!0,this.map_handle.setOverlay("traffic"),addClass($(".maps_global--button__toggleTraffic")[0],"active"),addClass($(".maps_global--button-shadowed-box--traffic")[0],"visible"),removeClass($(".maps_global--button__toggleView")[0],"active"),removeClass($(".ribbon--map-info")[0],"satellite")),"satellite"==a.overlay&&(this.map_handle.setOverlay(),this.map_view="photo",this.map_handle.setViewmode(this.map_view),addClass($(".maps_global--button__toggleView")[0],"active"),addClass($(".ribbon--map-info")[0],"satellite"),removeClass($(".maps_global--button__toggleTraffic")[0],"active"),removeClass($(".maps_global--button-shadowed-box--traffic")[0],"visible"));this.map_handle.getZoom()>16&&this.map_handle.setZoom(16),$(".ribbon--map-container")[0].ondblclick=function(){removeClass($(".maps_global--button__zoomLess")[0],"disabled")},this.map_handle&&(this.map_center=this.map_handle.getCenter())},recenterMap:function(a){var b=this,c=[];if(0===this.focused){if(a.length>0){var d=$i("map_container");d&&(d.style.display="block")}return null===this.map_handle||0==a.length?setTimeout(function(){b.recenterMap(a)},500):(this.clearMap(),c=this.centerMapOnMarkers(a,this)),this.centered_on_city=0,c}},centerMapOnMarkers:function(a,b){var c=200,d=-200,e=-200,f=200,g=[];a.forEach(function(a){c=Math.min(c,a.longitude),e=Math.max(e,a.longitude),d=Math.max(d,a.latitude),f=Math.min(f,a.latitude);var h=b.addMarker(a);null!==h&&(g[a.key]={marker:h,builder:a},b.all_markers.push(g[a.key]))});var h=[c-.002,f-.002],i=[e+.002,d+.002],j=[h,i];try{b.map_handle.fitBounds(j,{duration:10})}catch(a){}return g},addMarkers:function(a){var b=[],c=this;return a.forEach(function(a){var d=c.addMarker(a);null!==d&&(b[a.key]={marker:d,builder:a},c.all_markers.push(b[a.key]))}),b},addMarker:function(a){if(a.icon){var b=this,c=[a.longitude,a.latitude],d=this.createIcon(a.iconClass,a.icon),e=new mapboxgl.Marker(d);if(e.setLngLat(c),e.addTo(this.map_handle),!BrowserHelper.isTabletOrMobile&&a.tooltip&&(e._element.onmouseenter=function(c){e.markerSelected&&b.openSelectedMarker(e.markerSelected._element),b.openPopup(a)}),a.iconSelected){var f=MapsFactory.createIcon(a.iconSelectedClass,a.iconSelected),g=new mapboxgl.Marker(f);g.setLngLat(c),g.addTo(this.map_handle),g._element.onmouseenter=function(c){e.markerSelected&&b.openSelectedMarker(e.markerSelected._element),b.openPopup(a)},g._element.onmouseleave=function(c){"ia_local"===a.identity&&null!==a.context.resultDetail.getCurrentData()&&a.context.resultDetail.getCurrentData().key==a.key||(b.closeSelectedMarker(e.markerSelected._element),b.removePopup())},e.markerSelected=g}return BrowserHelper.isTabletOrMobile&&(e._element.onclick=function(a){e.markerSelected&&b.openSelectedMarker(e.markerSelected._element)}),e}return null},removePopup:function(){MapsFactory.popup&&MapsFactory.popup.remove()},openPopup:function(a){var b=[a.longitude,a.latitude],c={top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-50],"bottom-left":[25,-65],"bottom-right":[-25,-65],left:[10,-40],right:[-10,-40]};this.removePopup(),MapsFactory.popup=new mapboxgl.Popup({offset:c,className:MapsFactory.leafIcon.general.default.tooltipClassName}).setLngLat(b).setHTML(a.tooltip),MapsFactory.popup.addTo(this.map_handle)},addMarkerToLayer:function(a){var b={marker:a,builder:null};this.all_markers.push(b),a.addTo(this.map_handle)},openSelectedMarker:function(a){var b=this;this.all_markers.forEach(function(a){null!==b.context.resultDetail.getCurrentData()&&b.context.resultDetail.getCurrentData().key==a.builder.key||void 0===a.marker.markerSelected||b.closeSelectedMarker(a.marker.markerSelected._element)}),addClass(a,"marker_open")},closeSelectedMarker:function(a){removeClass(a,"marker_open")},clearMap:function(){for(var a=0;a<this.all_markers.length;a++)this.all_markers[a].marker.remove();this.all_markers=[]},centerOnPosition:function(a){this.map_handle.setView(a)},centerOnWorld:function(){this.map_handle.fitBounds([[-90,-90],[90,90]],{duration:10})},getCenterBounds:function(){return this.map_handle.getCenter()},getZoom:function(){return this.map_handle.getZoom()},isPointInPolygon:function(a){var b=this.map_handle.getBounds(),c=(a.lng-b._ne.lng)*(a.lng-b._sw.lng)<0,d=(a.lat-b._ne.lat)*(a.lat-b._sw.lat)<0;return c&&d},enableGeolocation:function(){var a=this;config_get("geoloc.enabled")?navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){a.initGeoloc(b)}):a.initGeoloc({coords:{longitude:7,latitude:44}})},initGeoloc:function(a){var b=[a.coords.longitude,a.coords.latitude];this.map_handle.setZoom(14),this.map_handle.flyTo({center:b});var c=this.createIcon("position_marker","<div class='geolocation_blink'></div>"),d=new mapboxgl.Marker(c);if(d.setLngLat(b),d.addTo(this.map_handle),this.context.geolocationData){this.context.geolocationData.active=!0,this.context.geolocationData.marker=d;var e=$("."+this.context.geolocationData.class)[0];e&&toggleClass(e,"geolocation-active")}},zoomMore:function(){17==this.map_handle.getZoom()&&addClass($(".maps_global--button__zoomMore")[0],"disabled"),this.map_handle.setZoom(this.map_handle.getZoom()+1),removeClass($(".maps_global--button__zoomLess")[0],"disabled")},zoomLess:function(){2===this.map_handle.getZoom()&&addClass($(".maps_global--button__zoomLess")[0],"disabled"),this.map_handle.setZoom(this.map_handle.getZoom()-1),removeClass($(".maps_global--button__zoomMore")[0],"disabled")},isAtMiniZoomLevel:function(){return!(!this.map_handle||18!==this.map_handle.getZoom())},isAtMaxZoomLevel:function(){return!(!this.map_handle||2!=this.map_handle.getZoom())},toggle3D:function(){var a=0===this.map_handle.getPitch()?60:0;this.map_handle.easeTo({bearing:0,pitch:a,duration:200})}},constructor:function(a){this.name="map",this.initializeMap=this.initializeMap.bind(this),this.centerMap=this.centerMap.bind(this),this.context=a}}),ResultMovieContent=Class(Component,{$statics:{ALLOCINE_BASE_URL:"http://www.allocine.fr/",listItemReference:{seasons:{list:".ia_movie--seasons--list",container:".ia_movie--seasons--content",item:".ia_movie--seasons--season-link",arrowRight:".ia_movie--seasons--nav_next",arrowLeft:".ia_movie--seasons--nav_prev",margin:12,lastOffset:34}}},constructor:function(a,b){this.name="result_movie_content",this.isWeb=a.isWeb,this.data=a.data[0],this.movieId=this.data.id,this.route=b.route,this.movieModel=new MovieModel,this.parent=b,this.isInit=!1,this.ticketsComponent=null,this.initData(),actionManager.onCustomEvent(this,"rendered",this.initRendered),_super(this)},initState:function(){return{data:this.data,route:this.route,movieComponent:this.movieComponent,theatersSearchBar:this.theatersSearchBar,ticketsComponent:this.ticketsComponent}},initData:function(){if(this.data.duration){var a=this.minutesFromIsoDuration(this.data.duration),b="";isNaN(a.hours)||(b=a.hours+"h"),isNaN(a.hours)||(b+=a.minutes+"min"),this.data.duration=b}if(this.data.synopsis&&this.data.synopsis.length>200){var c=this.data.synopsis.indexOf(" ",199),d=this.data.synopsis.indexOf(".",199),e=c;-1!==d&&(e=c<d?c:d),this.data.synopsis=this.data.synopsis.substring(0,e)+"..."}if(this.theatersSearchBar=null,this.data.hasShowtime&&!this.isVODService()){var f=_("City, theater","movie");this.searchBarData={id:"theaters_suggest",placeholder:f,mobilePlaceholder:f,suggesterRoute:ajax.suggest.theaters(),suggestOptions:{movie:this.data.id}},this.theatersSearchBar=new IASearchBarComponent(this.searchBarData),this.ticketsComponent=new ResultMovieTickets(this.data)}},initRendered:function(){if(!this.isInit&&this.data.hasShowtime&&!this.isVODService()){var a=this;actionManager.onCustomEvent(this,EventHelper.IA_SEARCH_BAR_NEW_QUERY+"_"+a.searchBarData.id,function(b,c){a.searchTickets(c,a.searchBarData)}),this.isInit=!0}BrowserHelper.isTabletOrMobile&&this.data.seasons&&IAHelper.setSwipableList("seasons",this.getImagesWidth("seasons"),this)},isVODService:function(){return this.parent.isVODService()},searchTickets:function(a,b){if(a.payload.id){LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"ribbon",ia_name:"movie",ia_type:"movie",ia_link:"theater",category:a.value}),this.ticketsComponent.showLoader();var c=a.payload.id,d=this.data.id,e=this;this.movieModel.sessions(c,d).then(function(b,c){b||e.ticketsComponent.updateData(c.data,a)})}},minutesFromIsoDuration:function(a){var b=a.match("P((([0-9]*.?[0-9]*)Y)?(([0-9]*.?[0-9]*)M)?(([0-9]*.?[0-9]*)W)?(([0-9]*.?[0-9]*)D)?)?(T(([0-9]*.?[0-9]*)H)?(([0-9]*.?[0-9]*)M)?(([0-9]*.?[0-9]*)S)?)?");return{years:parseFloat(b[3]),months:parseFloat(b[5]),weeks:parseFloat(b[7]),days:parseFloat(b[9]),hours:parseFloat(b[12]),minutes:parseFloat(b[14]),seconds:parseFloat(b[16])}},getUrlAllocine:function(a,b,c,d,e){var f=ResultMovieContent.ALLOCINE_BASE_URL;return c||d?(c||d)&&(f+="movie"===a?"film/fichefilm-":"series/ficheserie-"):f+="movie"===a?"film/fichefilm_gen_cfilm=":"serie"===a?"series/ficheserie_gen_cserie=":"series/ficheserie-"+e+"/saison-",f+=b,c?f+="/critiques/presse/":d?f+="movie"===a?"/critiques/spectateurs/":"/critiques/":"season"!==a&&(f+=".html"),f},formatSeasonNumber:function(a){return String("0"+a).slice(-2)},getSeasonStatus:function(a){var b={CANCELLED:_("Cancelled","movie"),TO_COME:_("To come","movie"),PILOT:_("Pilot","movie"),IN_PROGRESS:_("In progress","movie"),DEFAULT:_("Ended","movie")};return void 0===b[a]&&(a="DEFAULT"),b[a]},getImagesWidth:function(a){var b=0,c=$(ResultMovieContent.listItemReference[a].item);if(c&&c[0]){var d=c[0].offsetWidth;c.forEach(function(c){b+=d+ResultMovieContent.listItemReference[a].margin})}return b},formatEpisodeLength:function(a){var b=a.split(":"),c="";return b[0]&&"00"!==b[0]&&(c=b[0]+"h "),b[1]&&"00"!==b[1]&&(c+=b[1]+"min "),b[2]&&"00"!==b[2]&&(c+=b[2]+"s"),c},toggleMovieContainer:function(){toggleClass($(".result_movie_content")[0],"expanded")},toggleEpisode:function(a){toggleClass($i("movie__episode_"+a.index),"expanded");var b=$(".result_movie_content")[0];hasClass(b,"expanded")||addClass(b,"expanded")},hasPicture:function(a){var b=!1;return a.forEach(function(a){void 0!==a.picture&&(b=!0)}),b}}),ResultMovieListContent=Class(Component,{$statics:{margins:{desktop:16,tablet:16,mobile:32},listItemReference:{movies:{list:".movie_list--items_container",container:".movie_list--items",item:".movie_list__page",arrowRight:".movie_list--nav_next",arrowLeft:".movie_list--nav_prev",margin:0,lastOffset:0}}},constructor:function(a,b){this.name="result_movie_list_content",this.data=a.list,this.franchise=a.franchise||"",this.route=b.route,this.parent=b,this.listPosition={},this.renderedPage=!1,this.isWeb=this.parent.isWeb,this.selector=0,this.initData(),_super(this)},onMount:function(){if(this.renderedPage||(this.renderedPage=!0,this.displayMovies()),BrowserHelper.isTabletOrMobile){IAHelper.setSwipableList("movies",this.getListWidth(),this);var a=$(ResultMovieListContent.listItemReference.movies.list)[0];if(a){var b=a.offsetWidth;b-=64;$(ResultMovieListContent.listItemReference.movies.item).forEach(function(a){a.style.width=b+"px"}),IAHelper.setSwipableList("movies",this.getListWidth(),this)}}},initState:function(){return{data:this.data,parent:this.parent,franchise:this.franchise}},getListWidth:function(){var a=0,b=$(ResultMovieListContent.listItemReference.movies.item),c=ResultMovieListContent.margins[BrowserHelper.deviceType()];if(b&&b[0]){a=b[0].offsetWidth*b.length+c*b.length}return a},initData:function(){this.data.forEach(function(a){a.title.length>35&&(a.titleReduce=a.title.substring(0,32)+"...")}),BrowserHelper.isMobile?this.offset=4:this.offset=this.data.length<6?3:6,actionManager.onCustomEvent(this,"rendered",this.onMount)},navigateMovies:function(a){var b=this.selector;a&&a.next?b+=1:b-=1,$i("movie-page-"+b)&&(this.selector=b,this.displayMovies())},displayMovies:function(){for(var a=$(ResultMovieListContent.listItemReference.movies.item),b=0;b<a.length;b++)removeClass(a[b],"active-page");var c=$i("movie-page-"+this.selector);c&&addClass(c,"active-page"),this.updateMoviesNavigation()},updateMoviesNavigation:function(){var a=$(ResultMovieListContent.listItemReference.movies.arrowLeft)[0];a&&(0===this.selector?a.setAttribute("disabled","disabled"):a.removeAttribute("disabled"));var b=$(ResultMovieListContent.listItemReference.movies.arrowRight)[0];b&&(this.selector===Math.ceil(this.data.length/this.offset)-1?b.setAttribute("disabled","disabled"):b.removeAttribute("disabled"))},getMovieQuery:function(a){if(!a)return"";var b="film";"serie"===a.type&&(b="serie");return b=b.concat(" "),b=b.concat(a.title.toLowerCase()),this.neededDirectorMovieQuery(a)&&a.directors&&(b=b.concat(" "),b=b.concat(a.directors[0]).toLowerCase()),a.productionYear?(b=b.concat(" "),b=b.concat(a.productionYear)):a.fullDate&&(b=b.concat(" "),b=b.concat(strftime("%Y",new Date(a.fullDate)))),encodeURIComponent(b)},neededDirectorMovieQuery:function(a){if(void 0===a.fullDate&&void 0===a.productionYear)return!1;var b=a.fullDate?strftime("%Y",new Date(a.fullDate)):a.productionYear.toString(),c=!1;return this.data.forEach(function(d){if(d.fullDate||d.productionYear){var e=d.fullDate?strftime("%Y",new Date(d.fullDate)):d.productionYear.toString();d.id!==a.id&&b===e&&d.title===a.title&&(c=!0)}}),c}}),ResultMovieTickets=Class(Component,{$statics:{NEXT:"next",PREVIOUS:"previous",listItemReference:{tickets:{list:".ia_movie--tickets_list",container:".ia_movie--tickets--content",item:".ia_movie--tickets_item",margin:10,lastOffset:20}}},constructor:function(a){this.name="result_movie_tickets",this.contextData=a,this.data=null,
this.currentItems=null,this.today=(new Date).getDate(),this.currentDay=this.today,this.loading=!1,this.theater=null,_super(this)},initState:function(){return{currentItems:this.currentItems,loading:this.loading,contextData:this.contextData,theater:this.theater}},showLoader:function(){this.loading=!0,this.data=null,this.updateState()},updateData:function(a,b){this.data=this.formatData(a),this.theater=b,this.loading=!1,this.updateItems(this.currentDay,ResultMovieTickets.NEXT),this.updateState(),BrowserHelper.isTabletOrMobile&&IAHelper.setSwipableList("tickets",this.getImagesWidth("tickets"),this)},formatData:function(a){var b=[],c=this;return a.forEach(function(a){var d=strftime("%e",new Date(a.startsAt)).trim();c.sessionPass(d,a)||(void 0===b[d]&&(b[d]=[]),b[d].push(a))}),b},sessionPass:function(a,b){if(this.today!==parseInt(a))return!1;var c=strftime("%H",new Date),d=strftime("%H",new Date(b.startsAt));if(c===d){if(strftime("%M",new Date)>strftime("%M",new Date(b.startsAt)))return!0}else if(c>d)return!0;return!1},updateItems:function(a,b){this.currentDay=a,void 0===this.data[a]?this.changeDay(b):this.currentItems=this.data[this.currentDay]},changeDay:function(a){var b=a===ResultMovieTickets.PREVIOUS?-1:1,c=new Date;c.setDate(this.currentDay+b);var d=c.getDate();this.updateItems(d,a)},switchDay:function(a){this.disabledPreviousButton()&&a.type===ResultMovieTickets.PREVIOUS||this.disableNextButton()&&a.type===ResultMovieTickets.NEXT||(this.changeDay(a.type),this.updateState(),BrowserHelper.isTabletOrMobile&&IAHelper.setSwipableList("tickets",this.getImagesWidth("tickets"),this))},disabledPreviousButton:function(){if(this.today===this.currentDay)return!0;var a=new Date;a.setDate(this.currentDay-1);var b=a.getDate();return void 0===this.data[b]},disableNextButton:function(){var a=new Date;a.setDate(this.currentDay+1);var b=a.getDate();return void 0===this.data[b]},updateState:function(){this.setState({currentItems:this.currentItems,loading:this.loading,contextData:this.contextData,theater:this.theater})},getFormattedDate:function(){if(this.today===this.currentDay)return i18n.date.currentText;if(this.currentDay===this.today+1)return _("Tomorrow","movie");var a=new Date;return a.setDate(this.currentDay),i18n.date.dayNamesShort[a.getDay()]+" "+a.getDate()+" "+i18n.date.monthNamesShort[a.getMonth()]},getTicketUrl:function(a){var b=BrowserHelper.isTabletOrMobile?"mobile":"desktop",c="";return a.forEach(function(a){a.type===b&&(c=a.url)}),""===c?a[0].url:c},getImagesWidth:function(a){var b=0,c=$(ResultMovieTickets.listItemReference[a].item);if(c&&c[0]){b=c[0].offsetWidth*c.length+ResultMovieTickets.listItemReference[a].margin*c.length}return b}}),ResultRibbonMovie=Class(Component,{$statics:{listItemReference:{seeMore:{container:".movie-web__vod--container",seeMoreBtn:".movie__vod--see_more",linkSeeMore:".movie__vod--link_more",vodContainer:".movie-web__vod"}}},constructor:function(a){this.name="result_ribbon_movie",this.isWeb=a.isWeb,void 0!==a.data.list?(this.data=a.data,this.serviceDisplay="list",this.movieContent=new ResultMovieListContent(a.data,this)):(this.data=a.data[0],this.serviceDisplay="single",this.movieContent=new ResultMovieContent(a,this)),_super(this)},initState:function(){return{data:this.data,movieContent:this.movieContent}},serviceDisplayList:function(){return"list"===this.serviceDisplay},isVODService:function(){return void 0!==this.data.vod&&null!=this.data.vod&&this.data.vod.length>0}}),ResultActionsComponent=Class(Component,{$statics:{visibleComponent:null,differedStatus:0,closeAllMenus:function(a){for(var b=0;$(".result__web__tooltip--"+b).length>0;b++)if(hasClass($(".result__web__tooltip--"+b),"result__web__tooltip--visible")){WebColumnComponent.hideAdsTooltip({index:b});break}ResultActionsComponent.visibleComponent&&(a&&ResultActionsComponent.visibleComponent.id==a||(removeClass($(".result_actions__button_container",$i(ResultActionsComponent.visibleComponent.id))[0],"result_actions__button_container--arrow"),removeClass($(".result_actions__menu",$i(ResultActionsComponent.visibleComponent.id))[0],"result_actions__menu--visible"),removeClass($i(ResultActionsComponent.visibleComponent.id),"result_actions--active"),ResultActionsComponent.visibleComponent.isVisible=!1,ResultActionsComponent.visibleComponent=null))}},constructor:function(a,b,c){if(b.isAd=this.isAd=c||!1,this.name="result_actions",this.result=a,this.resultActionsModel=new ResultActionsModel,this.isVisible=!1,this.tooltip=new TooltipComponent(this,_("Add to my boards","result_action")),this.pendingFavorite=!1,this.initializeMenuButtons(b),_super(this),applicationState.user.isLogged)try{var d=decodeURI(this.result.url);!1!==applicationState.user.favoriteIndexOf(d)&&(this.alreadyFavorite=!0)}catch(a){this.alreadyFavorite=!1}actionManager.onCustomEvent(this,EventHelper.EVENT_NOTE_CREATED,this.onNoteCreation)},initializeMenuButtons:function(a){this.menuButtons=[],a.showBoardsButton&&!a.isAd&&this.menuButtons.push({parentClassName:"result_action__menu_item_create_note",className:"result_actions__create_note_button",id:actionManager.addClickListener(this,this.openNoteCreatorPanel),title:_("Add to my boards","result_action"),action:"create_note"}),a.showFavoriteButton&&!a.isAd&&(this.menuButtons.push({parentClassName:"result_action__menu_item_star_button",className:"result_actions__star_button result_actions__star_button--inactive",id:actionManager.addClickListener(this,this.toggleFavorite),title:_("Add to my bookmarks","result_action"),action:"bookmark"}),this.menuButtons.push({parentClassName:"result_action__menu_item_star_button",className:"result_actions__star_button result_actions__star_button--active",id:actionManager.addClickListener(this,this.toggleFavorite),title:_("Remove from my bookmarks","result_action"),action:"bookmark"})),config_get("report.from-users.enabled")&&applicationState.user.canReport()&&this.menuButtons.push({className:"result_actions__report_button icon-report",id:actionManager.addClickListener(ReportContentComponent,ReportContentComponent.showPopup,{url:this.result.url,urlId:this.result._id,index:this.result.index+1,type:this.result.type}),title:_("Report an inappropriate content","result_action"),action:"report"}),applicationState.user.canReportAds()&&a.isAd&&(this.menuButtons.push({className:"result_actions__info_button icon-information",id:"info-"+this.result.index,title:_("This ad is based on your current search terms.","result_action"),action:"info"}),this.menuButtons.push({className:"result_actions__report_button icon-report",id:actionManager.addClickListener(ReportContentComponent,ReportContentComponent.showPopup,{url:this.result.url,urlId:this.result._id,index:this.result.index+1,type:"ad"}),title:_("Report an inappropriate content","result_action"),action:"report"})),a.showUserRatingButton&&applicationState.user.canRate()&&this.menuButtons.push({className:"result_actions__user_rating_button",id:actionManager.addClickListener(this,this.openUserRatingPanel),title:_("Rate this result","result_action"),action:"rate"}),0===this.menuButtons.length&&(this.resultActionsComponent=!1)},updateDifferedStatus:function(){ResultActionsComponent.differedStatus++},openNoteCreatorPanel:function(a){if(a=a||{},LayoutComponent.registerBeforeActionGlobal(this.updateDifferedStatus),!applicationState.user.isLogged)return Application.rootComponent.state.account_overlay.displayAccountOverlay(),ResultActionsComponent.differedStatus=0,AlertComponent.info(_("You must be logged in to create a new note","serp")),void actionManager.onCustomEvent(this,"user_login",this.openNoteCreatorPanel,{isPersistant:!0,isDiffered:!0});if(a.isDiffered&&ResultActionsComponent.differedStatus>2)return actionManager.cleanCustomEvent("user_login",this.openNoteCreatorPanel),void LayoutComponent.cleanBeforeActionGlobal(this.updateDifferedStatus);var b=new promise.Promise;b.done(!1,{data:{}});var c=new NoteModel;c.originalDescription=this.result.url_original||this.result.url;var d=new PanelFormNote(PanelFormNote.MODE_QUICK_CREATE,c);Application.rootComponent.state.sidePanel.open(b,d)},toggleMenu:function(){ResultActionsComponent.closeAllMenus(this.id),this.isVisible=!this.isVisible,toggleClass($(".result_actions__button_container",$i(this.id))[0],"result_actions__button_container--arrow"),toggleClass($(".result_actions__menu",$i(this.id))[0],"result_actions__menu--visible"),toggleClass($i(this.id),"result_actions--active"),ResultActionsComponent.visibleComponent=this.isVisible?this:null,this.isVisible&&(this.updateStarButton(),this.updateNoteCreationButton())},updateNoteCreationButton:function(){addClass($(".result_actions__create_note_button",$i(this.id))[0],"result_actions__create_note_button--loading");var a=this.resultActionsModel.isURLInBoards(this.result.url),b=this;a.then(function(a,c){removeClass($(".result_actions__create_note_button",$i(b.id))[0],"result_actions__create_note_button--loading"),a||(c&&c.data.isInBoards?b.fillNoteCreationButton():b.emptyNoteCreationButton())})},onNoteCreation:function(a,b){var c=decodeURI(this.result.url);b.noteUrl==c&&this.fillNoteCreationButton()},fillNoteCreationButton:function(){addClass($(".result_actions__create_note_button",$i(this.id))[0],"result_actions__create_note_button--full"),removeClass($(".result_actions__create_note_button",$i(this.id))[0],"result_actions__create_note_button--empty")},emptyNoteCreationButton:function(){addClass($(".result_actions__create_note_button",$i(this.id))[0],"result_actions__create_note_button--empty"),removeClass($(".result_actions__create_note_button",$i(this.id))[0],"result_actions__create_note_button--full")},toggleFavorite:function(){addClass($(".result_actions__star_button"),"star_button--waiting"),this.isResultInFavorites()?this.removeFavorite({index:applicationState.user.favoriteIndexOf(decodeURI(this.result.url))}):this.addFavorite({url:this.result.url,title:this.result.title})},addFavoriteFromLogin:function(a,b){this.pendingFavorite&&b.fromFavorite&&this.addFavorite(this.pendingFavorite),this.pendingFavorite=!1},addFavorite:function(a){if(actionManager.cleanCustomEvent("user_login",this.addFavoriteFromLogin),!applicationState.user.isLogged)return Application.rootComponent.state.account_overlay.displayAccountOverlay(),removeClass($(".result_actions__star_button"),"star_button--waiting"),AlertComponent.info(_("You must be logged in to edit your bookmarks","favorites")),this.pendingFavorite=a,void actionManager.onCustomEvent(this,"user_login",this.addFavoriteFromLogin,{isPersistant:!0});var b=this.resultActionsModel.addFavorite(a.url,a.title),c=this;b.then(function(a){a?AlertComponent.error(_("An error has occurred while trying to add a bookmark link, please try again.","search")):(c.alreadyFavorite=!0,c.updateStarButton(),AlertComponent.success(_('You have added a new bookmark link. <a href="{url}" id={click}>Manage your bookmarks</a>',"search",{url:"javascript:;",click:actionManager.addClickListener(c,function(){AppMenuComponent.open({content:AppMenuComponent._BOOKMARKS}),AlertComponent.clearAll()})}))),removeClass($(".result_actions__star_button"),"star_button--waiting")})},removeFavorite:function(a){var b=this.resultActionsModel.removeFavorite(a.index),c=this;b.then(function(a){a?AlertComponent.error(_("An error has occurred while trying to remove a favorite link, please try again.","search")):(c.alreadyFavorite=!1,c.updateStarButton(),AlertComponent.success(_("You have removed a favorite link","search"))),removeClass($(".result_actions__star_button"),"star_button--waiting")})},updateStarButton:function(){this.isResultInFavorites()?(addClass($(".result_actions__star_button",$i(this.id))[0],"result_actions__star_button--invisible"),removeClass($(".result_actions__star_button",$i(this.id))[1],"result_actions__star_button--invisible"),addClass($(".result_action__menu_item_star_button",$i(this.id))[0],"result_action__menu_item_star_button--invisible"),removeClass($(".result_action__menu_item_star_button",$i(this.id))[1],"result_action__menu_item_star_button--invisible")):(removeClass($(".result_actions__star_button",$i(this.id))[0],"result_actions__star_button--invisible"),addClass($(".result_actions__star_button",$i(this.id))[1],"result_actions__star_button--invisible"),addClass($(".result_action__menu_item_star_button",$i(this.id))[1],"result_action__menu_item_star_button--invisible"),removeClass($(".result_action__menu_item_star_button",$i(this.id))[0],"result_action__menu_item_star_button--invisible"))},isResultInFavorites:function(){return this.alreadyFavorite&&!1!==this.favoriteIndex},openUserRatingPanel:function(){if(!applicationState.user.isLogged)return Application.rootComponent.state.account_overlay.displayAccountOverlay(),void AlertComponent.info(_("You must be logged in to rate a search result","serp"));var a=new promise.Promise;a.done(!1,{data:{}});var b=new UserRatingModel(this.result,applicationState),c=new PanelFormUserRating(b);Application.rootComponent.state.sidePanel.open(a,c)}}),ResultPageAllComponent=Class(ResultPageComponent,{constructor:function(a){this.name="result_page_all",this.route=a,this.defaultClassName="results-page results-page--all",_super(this);var b=new WebColumnComponent(this.route,{isInfinite:!0,filters:this.formatFilters()});this.addColumnComponent(constants.SearchTypes.WEB,b),this.addColumnComponent(constants.SearchTypes.SOCIAL,new SocialColumnComponent(this.route,{isInfinite:!0})),this.addColumnComponent(constants.SearchTypes.NEWS,new NewsColumnComponent(this.route,{isInfinite:!0})),LoadBarComponent.init(this.searchColumnCount+1),this.launchSearch(a),this.loadFilters(b)},initState:function(){return{encodedKeyPhrase:this.route&&this.route.params?this.route.params.q:"",ribbonContainer:new RibbonContainerComponent(this.route),mediaOverlay:new MediaOverlayComponent(this.route)}}}),ResultPageAllMobileComponent=Class(ResultPageComponent,{constructor:function(a){this.name="result_page_all_mobile",this.route=a,this.defaultClassName="results-page results-page--all-mobile",_super(this);var b=new AllMobileColumnComponent(this.route,{isInfinite:!0,filters:this.formatFilters()});this.addColumnComponent("all_mobile",b),LoadBarComponent.init(this.searchColumnCount),this.launchSearch(a),this.loadFilters(b)},initState:function(){return{keyPhrase:this.route.params.q,mediaOverlay:new MediaOverlayComponent(this.route)}}}),RibbonContainerComponent=Class(Component,{$statics:{URL_PARAM_RIBBON_TYPE:"r"},constructor:function(a){this.route=a,this.name="ribbon_container",this.defaultClassName="ribbon_box",this.query=this.route.params.q,this.shopping_tooltip=new TooltipComponent(this,_('The products and services listed on this results page match your query. Qwant is paid by advertisers according to a hybrid model of CPC ("cost per click") and CPA ("cost per acquisition"). On Qwant Shopping, the default ranking is based on criteria of relevance to your request and takes into account the quality of the advertiser\'s data as well as the price (the lowest prevails). As with all Qwant products and services, Qwant Shopping is guaranteed without cookies or any other form of tracking. On our platform, you search for products and services anonymously and with respect for your privacy. The merchants from whom you finalize your purchases have their own general terms and conditions of sale (RGPD, applicable taxes, shipping costs, delivery options...) and their own personal data protection policies. For more information on these terms and conditions, please visit the dedicated merchant sites page.',"result")),_super(this),this.specialRibbon=!1,this.searchModel=new RibbonSearchModel(this.route),this.UIPromiseStack=[],this.APIPromiseStack=[];var b=Dispatcher.getUrlParameter(RibbonContainerComponent.URL_PARAM_RIBBON_TYPE);this.initRibbon(b)},initRibbon:function(a){var b=this;PromiseHelper.joinWithPageRendered(this.searchModel.search()).then(function(c){if(LoadBarComponent.step(),c.status===AJAX_STATUS.SUCCESS&&c.items&&c.items.length>0){var d=[],e=0;return c.items.forEach(function(c,f){"ia/movie"===c.endpoint_suffix&&c.data&&c.data.length>0?(c.data[0].video&&(c.data[0].video.type="video",MediaOverlayComponent.addMedias([c.data[0].video],[])),c.data[0].images&&c.data[0].images[0]&&(c.data[0].images[0].type="image",MediaOverlayComponent.addMedias(c.data[0].images,[]))):("ia/knowledge"===c.endpoint_suffix||"ia/game"===c.endpoint_suffix||"ia/game/editor"===c.endpoint_suffix)&&c.data&&c.data.length>0&&c.data[0].images&&c.data[0].images.length>0?(c.data[0].images[0].type="image",MediaOverlayComponent.setMedias(c.data[0].images,[])):c.data&&c.data.length>0&&c.data[0]&&("image"===c.data[0].type||"video"===c.data[0].type)?MediaOverlayComponent.setMedias(c.data,[]):"nodejs"===c.runtime&&c.data&&c.data.images&&c.data.images.length>0&&MediaOverlayComponent.addMedias(c.data.images,[]),c.query=b.query;var g=new RibbonModel(c);d.push(g),a===g.getTemplateName()&&(e=f),"movie"===g.getTemplateName()&&(c.helplink={IARuntime:g.getRuntime(),templateName:g.getTemplateName(),partnerName:g.getPartnerName()},b.specialRibbon=new ResultRibbonMovie(c)),"local"===g.getTemplateName()&&(b.specialRibbon=new LocalRibbonComponent(c,b.route.params.t)),"causes"===g.getTemplateName()&&(b.specialRibbon=new CausesRibbonComponent(c))}),b.ribbons=d,d.length>0&&d[0]&&("images"==d[0].templateName||"videos"==d[0].templateName||"shopping"==d[0].templateName)&&LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"ribbon",ia_element:"first_displayed",ia_name:d[0].templateName,t:"all",query:d[0].encodedKeyPhrase}),b.loadRibbon(e)}return b.hideRibbon(b.id),null}).then(function(a,c){a||(b.setState({ribbons:b.ribbons,requestedRibbon:c.requestedRibbon,specialRibbon:b.specialRibbon}),b.displayIA())})},initState:function(){return{requestedRibbon:!1,specialRibbon:this.specialRibbon,ribbons:[]}},hideRibbon:function(a){addClass($i(a),"ribbon_box--hidden")},displayRibbon:function(a){removeClass($i(a),"ribbon_box--hidden")},toggleRibbon:function(a){if(!a)return!1;var b=this.ribbons,c=b[a.index];this.UIPromiseStack.push(c.getDisplayName()),$(".results-column--ribbon")[0].innerHTML="",this.updateRibbonUnderline(c.getDisplayName()),LoadBarComponent.clear(),LoadBarComponent.init(1),this.updateDisplay(c,a.index)},loadRibbon:function(a){var b=new promise.Promise,c=this.state,d=this.ribbons,e=d[a];return e.alreadyLoaded()?(c.requestedRibbon=e,b.done(!1,c),b):(-1===this.APIPromiseStack.indexOf(e.getDisplayName())&&(this.APIPromiseStack.push(e.getDisplayName()),e.getDataToDisplay().then(function(a,d){c.requestedRibbon=e,d?a||(e.getRuntime()===RibbonModel.RUNTIME_PHP?(c.requestedRibbon.data=d,MediaOverlayComponent.setMedias(d,[])):c.requestedRibbon.template=d):(c.requestedRibbon.data=!1,c.requestedRibbon.template=!1),b.done(!1,c)})),b)},updateDisplay:function(a,b){var c,d=Dispatcher.history.get(0).rawParams,e=[],f=RibbonContainerComponent.URL_PARAM_RIBBON_TYPE+"="+a.getTemplateName();for(var g in d)d.hasOwnProperty(g)&&g!==RibbonContainerComponent.URL_PARAM_RIBBON_TYPE&&e.push(g+"="+d[g]);c="?"+e.join("&")+"&"+f;var h=this;this.showLoadingOverlay(a.alreadyLoaded()),this.loadRibbon(b).then(function(b,c){h.hideLoadingOverlay(),LoadBarComponent.step(),!b&&h.UIPromiseStack.length>0&&c.requestedRibbon.getDisplayName()===h.UIPromiseStack[h.UIPromiseStack.length-1]&&(MediaOverlayComponent.setMedias([],[]),"ia/movie"===a.endpoint_suffix&&c.requestedRibbon.data&&c.requestedRibbon.data.length>0?(c.requestedRibbon.data[0].video&&(c.requestedRibbon.data[0].video.type="video",MediaOverlayComponent.addMedias([c.requestedRibbon.data[0].video],[])),c.requestedRibbon.data[0].images&&(c.requestedRibbon.data[0].images[0].type="image",MediaOverlayComponent.addMedias(c.requestedRibbon.data[0].images,[]))):("ia/knowledge"===c.requestedRibbon.endpointSuffix||"ia/game"===c.requestedRibbon.endpointSuffix)&&c.requestedRibbon.data.length>0&&c.requestedRibbon.data[0].images?MediaOverlayComponent.setMedias(c.requestedRibbon.data[0].images,[]):c.requestedRibbon.data&&c.requestedRibbon.data instanceof Array&&MediaOverlayComponent.setMedias(c.requestedRibbon.data,[]),h.setState({ribbons:h.ribbons,requestedRibbon:c.requestedRibbon,specialRibbon:h.specialRibbon}),h.displayIA(),h.UIPromiseStack=[])});var i={path:c,params:new Url(c).parseUrl().encodedQuery,rawParams:new Url(c).parseUrl().rawQuery};Dispatcher.history.add(i),history.pushState({path:c},document.title,c)},showLoadingOverlay:function(a){if(!a){var b=$i("ribbon_container__loading_overlay");addClass(b,"ribbon_container__loading_overlay--visible")}},hideLoadingOverlay:function(){var a=$i("ribbon_container__loading_overlay");removeClass(a,"ribbon_container__loading_overlay--visible")},updateRibbonUnderline:function(a){Array.prototype.slice.call($(".ribbon__tabs__tab")).map(function(b){b.innerHTML===a?addClass(b,"ribbon__tabs__tab--selected"):hasClass(b,"ribbon__tabs__tab--selected")&&removeClass(b,"ribbon__tabs__tab--selected")})},displayIA:function(){var a=this.state.requestedRibbon,b=this;if(a.runtime===RibbonModel.RUNTIME_NODEJS){var c=$(".results-ia-ribbon")[0];b.showLoadingOverlay(!1);var d=b.route.params.t||"all";a.loadScript(d).then(function(a){a||(addClass(c,"results-ia-ribbon--visible"),b.hideLoadingOverlay())})}},gifHoverIn:function(a){var b=$(".gif_animated--"+a.id)[0];$(".button_gif--"+a.id)[0].style.display="none",b.src=a.mediaAnimated,b.style.display="inline-block",b.style.visibility="visible"},gifHoverOut:function(a){var b=$(".gif_animated--"+a.id)[0];$(".button_gif--"+a.id)[0].style.display="inline-block",b.style.display="none",b.style.visibility="hidden"}}),ResultPageImagesComponent=Class(ResultPageComponent,{constructor:function(a){this.route=a,this.name="result_page_images",this.defaultClassName="results-page results-page--images",_super(this),this.count=0,this.total=0;var b=new ImagesColumnComponent(this.route,{isInfinite:!0,filters:this.formatFilters()});this.addColumnComponent(constants.SearchTypes.IMAGES,b),LoadBarComponent.init(this.searchColumnCount),this.launchSearch(a),this.loadFilters(b)},initState:function(){return{filtersContainer:new ResultFiltersContainer([]),mediaOverlay:new MediaOverlayComponent(this.route)}}}),ResultPageNewsComponent=Class(ResultPageComponent,{constructor:function(a){this.route=a,this.name="result_page_news",this.defaultClassName="results-page results-page--news",_super(this);var b=new NewsColumnComponent(this.route,{filters:this.formatFilters(),isInfinite:!0,isSingleColumn:!0});this.addColumnComponent(constants.SearchTypes.NEWS,b),LoadBarComponent.init(this.searchColumnCount),this.launchSearch(a),this.loadFilters(b)},initState:function(){return{}}}),ResultPageShoppingComponent=Class(ResultPageComponent,{constructor:function(a){this.route=a,this.name="result_page_shopping",this.defaultClassName="results-page results-page--shopping",_super(this);var b=new ShoppingColumnComponent(this.route,{filters:this.formatFilters(),isInfinite:!0,isSingleColumn:!0});this.addColumnComponent(constants.SearchTypes.SHOPPING,b),LoadBarComponent.init(this.searchColumnCount),this.launchSearch(a),this.loadFilters(b)},initState:function(){return{filtersContainer:new ResultFiltersContainer([])}}}),ResultPageSocialComponent=Class(ResultPageComponent,{constructor:function(a){this.route=a,this.name="result_page_social",this.defaultClassName="results-page results-page--social",_super(this);var b=new SocialColumnComponent(this.route,{isInfinite:!0,isSingleColumn:!0});this.addColumnComponent(constants.SearchTypes.SOCIAL,b),LoadBarComponent.init(this.searchColumnCount),this.launchSearch(a)}}),ResultPageVideosComponent=Class(ResultPageComponent,{constructor:function(a){this.route=a,this.name="result_page_videos",this.defaultClassName="results-page results-page--videos",_super(this);var b=new VideosColumnComponent(this.route,{filters:this.formatFilters(),isInfinite:!0});this.addColumnComponent(constants.SearchTypes.VIDEOS,b),LoadBarComponent.init(this.searchColumnCount),this.launchSearch(a),this.loadFilters(b)},initState:function(){return{filtersContainer:new ResultFiltersContainer([]),mediaOverlay:new MediaOverlayComponent(this.route)}}}),AdGoalContainerComponent=Class(Component,{constructor:function(a){this.route=a,this.name="adgoal_container",this.query=this.route.params.q,this.page=a&&a.params&&a.params.page?parseInt(a.params.page):1,this.tooltipID=actionManager.addClickListener(this,this.openTooltip,{clickOutHandler:this.closeTooltip}),this.tooltip=new TooltipComponent(this,_('This sponsored content is published without transmission of personal data to the advertiser. Hyperlinks are provided by our partner AdGoal whose <a href="{link}" {target}>{text}</a> applies when you click them.',"adgoal",{link:"https://www.adgoal.de/en/privacy.html",text:_("Privacy Policy","adgoal"),target:SecurityHelper.targetBlank()})),this.getPartners(),_super(this)},initState:function(){return{query:this.query,hasContent:!1,partners:{}}},openTooltip:function(){TooltipComponent.changeContent({it:this.tooltip,message:_('This sponsored content is published without transmission of personal data to the advertiser. Hyperlinks are provided by our partner AdGoal whose <a href="{link}" {target}>{text}</a> applies when you click them.',"adgoal",{link:"https://www.adgoal.de/en/privacy.html",text:_("Privacy Policy","adgoal"),target:SecurityHelper.targetBlank()})}),TooltipComponent.placeTooltip({it:this.tooltip,componentId:this.tooltipID});var a=$i("tooltip--"+this.tooltip.id);addClass(a,"active")},closeTooltip:function(){var a=$i("tooltip--"+this.tooltip.id);removeClass(a,"active")},getPartners:function(){var a=this,b={q:this.query,locale:applicationState.user.getSettings().getLocalisedSearchRegionCode().toLowerCase(),count:10,safesearch:applicationState.user.userSetting.safeSearch};AppComponent.isExtensionDisabled()||BrowserHelper.isTabletOrMobile||AjaxManager.get(ajax.adgoal(),b).then(function(b,c){!b&&"error"!==c.status&&Object.keys(c.data.items).length>0&&a.setState({query:a.query,hasContent:!0,partners:c.data.items})})}}),IAContainerComponent=Class(Component,{constructor:function(a){this.route=a,this.name="ia_container",this.query=this.route.params.q,this.page=a&&a.params&&a.params.page?parseInt(a.params.page):1,this.specialRibbon=!1,_super(this),this.searchModel=new RibbonSearchModel(this.route),this.tooltip=new TooltipComponent(this,_('The products and services listed on this results page match your query. Qwant is paid by advertisers according to a hybrid model of CPC ("cost per click") and CPA ("cost per acquisition"). On Qwant Shopping, the default ranking is based on criteria of relevance to your request and takes into account the quality of the advertiser\'s data as well as the price (the lowest prevails). As with all Qwant products and services, Qwant Shopping is guaranteed without cookies or any other form of tracking. On our platform, you search for products and services anonymously and with respect for your privacy. The merchants from whom you finalize your purchases have their own general terms and conditions of sale (RGPD, applicable taxes, shipping costs, delivery options...) and their own personal data protection policies. For more information on these terms and conditions, please visit the dedicated merchant sites page.',"result")),this.tooltipID=actionManager.addClickListener(this,this.openTooltip,{clickOutHandler:this.closeTooltip}),this.partnerTooltip=new TooltipComponent(this,_("This sponsored content is published without transmission of personal data to the advertiser. Hyperlinks are provided by our partner Effiliate whose Privacy Policy applies when you click them.","result")),this.partnerTooltipID=actionManager.addClickListener(this,this.openPartnerTooltip,{clickOutHandler:this.closePartnerTooltip}),1===this.page&&this.initIA()},initIA:function(){var a=this;PromiseHelper.joinWithPageRendered(this.searchModel.search()).then(function(b){if(LoadBarComponent.step(),b.status===AJAX_STATUS.SUCCESS&&b.items&&b.items.length>0){var c=b.items[0];c.query=a.query;var d=new RibbonModel(c),e=d.getRuntime(),f=d.getTemplateName(),g=d.getHelpLink(),h=d.getPartnerName(),i=d.getLastUpdate(),j=d.isCNCService();if(e===RibbonModel.RUNTIME_NODEJS)d.data&&d.data.images&&window.innerWidth>1210&&(d.data.images=a.initImagesMosaic(d.data.images)),d.isWeb=!0,d.tab=a.route.params.t||"web",d.loadTemplate().then(function(){d.template=tmpl_ia[d.getTemplateName()](d);var b=window.innerWidth>999?"ia_container-web_desktop results-ia-ribbon-nodejs":"ia_container-"+a.route.params.t+"_handheld results-ia-ribbon-nodejs";b+="metropole_nca"===f||"public_places"===f?" results-ia-ribbon-metropolis":"",a.setState({item:d,ia_runtime:e,className:b,ia_helplink:g,ia_partnerName:h,ia_lastUpdate:i,ia_template_name:f}),a.displayIA(d)});else{var k=null;if(d.data&&d.data[0]){d.data[0].images&&(window.innerWidth>1210&&(d.data[0].images=a.initImagesMosaic(d.data[0].images)),k=c.data[0].images),"movie"===f?(d.data[0].video&&(d.data[0].video.type="video",MediaOverlayComponent.addMedias([d.data[0].video],[])),d.data[0].images&&!d.data[0].video&&(d.data[0].images[0].type="image",MediaOverlayComponent.addMedias(d.data[0].images,[]))):MediaOverlayComponent.addMedias(k,[]);var l=$(".footer")[0];if(hasClass(l,"has--vertical")&&removeClass(l,"has--vertical"),"music"===f){if(!BrowserHelper.isTabletOrMobile){var m=c.data[0].discography;m&&m.length>6&&(d.data[0].discography=m.slice(0,6))}var n=$(".verticals__container")[0],o=$(".verticals__container__mobile")[0];addClass(l,"has--vertical"),addClass(n,"has--music"),o.firstChild.id=actionManager.addClickListener(a,HeaderComponent.navigate,{to:HeaderComponent.MUSIC,query:a.query}),addClass(o,"has--music")}}d.isWeb=!0,c.isWeb=!0,addClass($(".results-page")[0],"results-page--with-knowledge");var p=window.innerWidth>999?"ia_container-web_desktop":"ia_container-"+a.route.params.t+"_handheld";"movie"===f&&(c.helplink={IARuntime:e,templateName:f,partnerName:h},a.specialRibbon=new ResultRibbonMovie(c)),"local"===f&&(a.specialRibbon=new LocalRibbonComponent(c,a.route.params.t)),"causes"===f&&(a.specialRibbon=new CausesRibbonComponent(c)),"knowledge"===f&&(a.specialRibbon=new KnowledgeRibbonComponent(c)),"shopping"===f&&(p+=" ia_container--with__see__more"),a.setState({item:d,encodedKeyPhrase:a.query,className:p,ia_runtime:e,ia_template_name:f,ia_partnerName:h,specialRibbon:a.specialRibbon,ia_isCNCService:j}),a.ia_model=d}}else{var q=$(".ia_container")[0];q&&(q.style.display="none")}})},initState:function(){return{item:null,position:""}},displayIA:function(a){a.getRuntime()===RibbonModel.RUNTIME_NODEJS&&a.loadScript(a.tab).then(function(a){a&&l.error("Something went wrong when loading the extra JS for the Node IA")})},initImagesMosaic:function(a){var b=70,c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=!1,m=!1,n=!1;if(a)for(j;i<a.length&&(2!==d&&300!==j);i++,j++){var o=a[i],p=o.width/o.height,q=b*p;q>399&&(q=399),q>o.width&&!n&&(q=o.width),q=Math.round(q),c+=q,l?(a[i].newWidth=q+k,a[i].newHeight=b,i==f+e-1&&(a[i].newWidth=q+k+h,d++,b=70,c=0,f=i+1,e=0,g=0,h=0,k=0,m=!1,l=!1,n=!1)):(399==c&&(l=!0,e=i+1-f,i=f-1),c>399?(b-=1,m=!0,c=0,e=i+1-f,i=f-1):c<399&&m&&i==f+e-1&&(g=399-c,h=g%e,k=(g-h)/e,l=!0,i=f-1),c<399&&c>349&&!m&&(b+=1,n=!0,c=0,i=f-1))}return a=a.slice(0,20)},openTooltip:function(){TooltipComponent.changeContent({it:this.tooltip,
message:_('The results presented on this page do not necessarily represent all the products and services available on the Web. These are results for which Qwant is remunerated by advertisers according to a hybrid model with CPC ("cost per click") and CPA ("cost per acquisition"). The default ranking of Shopping offers is based on criteria of relevance to your request and takes into account the quality of the advertiser\'s data as well as the price of the product, excluding transport costs, insurance or additional services. The classification of merchants for the same product is carried out by default by ascending price. As with all Qwant products and services, Qwant Shopping is guaranteed to be cookie-free and free of any other form of tracking. On our platform, you search for products and services anonymously and with respect for your privacy. The merchants from whom you finalize your purchases have their own general terms and conditions of sale (applicable taxes, shipping costs, delivery options...) which you must read before purchase. Strikethrough prices are indicative information provided by the merchant when indexing its product data.<a href="{link}" {target}>{text}</a>',"result",{link:"https://about.qwant.com/fr/legal/modalites-de-referencement-dereferencement-et-de-classement/",text:_("Learn more","result"),target:SecurityHelper.targetBlank()})}),TooltipComponent.placeTooltip({it:this.tooltip,componentId:this.tooltipID});var a=$i("tooltip--"+this.tooltip.id);addClass(a,"active")},closeTooltip:function(){var a=$i("tooltip--"+this.tooltip.id);removeClass(a,"active")},openPartnerTooltip:function(){var a=this.ia_model.data[0].data,b=""!==a.partner?" "+a.partner:"",c=""!==a.partner_privacy_policy?'<a href="'+a.partner_privacy_policy+'" '+SecurityHelper.targetBlank()+"> Privacy policy </a>":"Privacy policy";TooltipComponent.changeContent({it:this.partnerTooltip,message:_("This sponsored content is published without transmission of personal data to the advertiser. Hyperlinks are provided by our partner{partner} whose {privacy_policy} applies when you click them.","effinity",{partner:b,privacy_policy:c})}),TooltipComponent.placeTooltip({it:this.partnerTooltip,componentId:this.partnerTooltipID});var d=$i("tooltip--"+this.partnerTooltip.id);addClass(d,"active")},closePartnerTooltip:function(){var a=$i("tooltip--"+this.partnerTooltip.id);removeClass(a,"active")}}),ResultPageWebComponent=Class(ResultPageComponent,{constructor:function(a){this.route=a,this.name="result_page_web",this.defaultClassName="results-page results-page--web",this.staticWidth=window.innerWidth,this.searchManager=new SearchManagerModel,_super(this);var b={isInfinite:!1,isSingleColumn:!0,filters:this.formatFilters()};b.isInfinite=!0;var c=this.route&&this.route.rawParams&&this.route.rawParams.source;if(this.webComponent=new WebColumnComponent(this.route,b),this.addColumnComponent(constants.SearchTypes.WEB,this.webComponent),innerWidth>siteConfiguration.defaultSearch.minWidth&&!c){var d=new SmartColumnComponent(this.route);this.addColumnComponent(constants.SearchTypes.SMART,d)}LoadBarComponent.init(this.searchColumnCount),actionManager.onCustomEvent(this,"pageRendered",this.search)},search:function(){this.launchSearch(this.route),this.loadFilters(this.webComponent),actionManager.cleanCustomEvent&&actionManager.cleanCustomEvent("pageRendered",this.search)},initState:function(){var a={mediaOverlay:new MediaOverlayComponent(this.route)},b=this.route&&this.route.rawParams&&this.route.rawParams.source;return window.innerWidth>1210&&!b&&(a.iaContainer=new IAContainerComponent(this.route),a.sponsoredContent=new SponsoredContentComponent(this.route),a.adGoal=new AdGoalContainerComponent(this.route)),a}}),SponsoredContentComponent=Class(Component,{constructor:function(a){this.route=a,this.name="sponsored_content",this.query=a.params.q,this.tooltip=new TooltipComponent(this,_("Your request seems to target a product. We inform you that each link referenced below corresponds to a commercial advertisement on which Qwant receives remuneration.","result")),this.getSponsoredContent(a),_super(this)},initState:function(){return{hasContent:!1}},getSponsoredContent:function(a){var b=this,c={q:a.params.q,locale:applicationState.user.getSettings().getLocalisedSearchRegionCode().toLowerCase()};AppComponent.isExtensionDisabled()||BrowserHelper.isTabletOrMobile||AjaxManager.get(ajax.getSponsored(),c).then(function(a,c){a||"error"===c.status||b.setState({data:c.data,hasContent:!0})})}}),WebPaginateComponent=Class(Component,{constructor:function(a,b,c,d,e){this.route=a,this.component=b,this.total=Math.ceil(e/10),this.current=a&&a.params&&a.params.page?parseInt(a.params.page):1,this.name="web_paginate",this.itemsArray=[],this.itemsArray[this.current]=c,this.adsArray=[],this.adsArray[this.current]=d,_super(this)},initState:function(){return{total:this.total}},goTo:function(a){if("left"===a.side?a.index=this.current-1:"right"===a.side&&(a.index=this.current+1),a.index===this.current||a.index<1||a.index>this.total)return!1;removeClass($(".web_paginate__index--"+this.current)[0],"web_paginate__index--current"),addClass($(".web_paginate__index--"+a.index)[0],"web_paginate__index--current"),1===a.index?addClass($(".web_paginate__left__selector")[0],"web_paginate__selector--hidden"):removeClass($(".web_paginate__left__selector")[0],"web_paginate__selector--hidden"),a.index===this.total?addClass($(".web_paginate__right__selector")[0],"web_paginate__selector--hidden"):removeClass($(".web_paginate__right__selector")[0],"web_paginate__selector--hidden"),this.current=a.index,this.searchWeb(),this.updateHistory()},next:function(){this.current++,this.checkButtonState(),this.switchIADisplay(),this.searchWeb(),this.updateHistory()},previous:function(){this.current--,this.checkButtonState(),this.switchIADisplay(),this.searchWeb(),this.updateHistory()},beginning:function(){this.current=1,this.checkButtonState(),this.switchIADisplay(),this.searchWeb(),this.updateHistory()},switchIADisplay:function(){var a=$(".ia_container")[0];a&&(1===this.current?a.style.display="block":a.style.display="none")},checkButtonState:function(){var a=$(".web_pagination__navigation--next")[0],b=$(".web_pagination__navigation--prev")[0],c=$(".web_pagination__navigation--begin")[0],d=$(".web_pagination__navigation--number")[0];b&&(1===this.current?removeClass(b,"web_pagination__navigation--visible"):hasClass(b,"web_pagination__navigation--visible")||addClass(b,"web_pagination__navigation--visible"),this.current===this.total||hasClass(b,"web_pagination__navigation--no_label")?this.current===this.total&&removeClass(b,"web_pagination__navigation--no_label"):addClass(b,"web_pagination__navigation--no_label")),a&&(this.current===this.total?removeClass(a,"web_pagination__navigation--visible"):hasClass(a,"web_pagination__navigation--visible")||addClass(a,"web_pagination__navigation--visible"),1===this.current||hasClass(a,"web_pagination__navigation--no_label")?1===this.current&&removeClass(a,"web_pagination__navigation--no_label"):addClass(a,"web_pagination__navigation--no_label")),c&&(this.current<3?removeClass(c,"web_pagination__navigation--visible"):hasClass(c,"web_pagination__navigation--visible")||addClass(c,"web_pagination__navigation--visible")),d&&(this.current!==this.total&&1!==this.current?d.innerHTML=_("Page {number}","pagination",{number:this.current}):d.innerHTML="")},updateHistory:function(){var a,b=Dispatcher.history.get(0).rawParams,c=[],d="page="+this.current;for(var e in b)b.hasOwnProperty(e)&&"page"!==e&&c.push(e+"="+b[e]);a="?"+c.join("&")+"&"+d;var f={path:a,params:new Url(a).parseUrl().encodedQuery,rawParams:new Url(a).parseUrl().rawQuery};Dispatcher.history.add(f),history.pushState({path:a},document.title,a)},searchWeb:function(){if(document.documentElement.scrollTop=document.scrollTop=0,this.component.webAddBlock&&(this.adsArray[this.current]?this.component.webAddBlock.setAds(this.adsArray[this.current],this.current):this.component.webAddBlock.setAds([],0)),this.itemsArray[this.current])this.component.state.resultFragment.state.items=this.itemsArray[this.current],this.component.state.resultFragment.setState(this.component.state.resultFragment.state);else{this.component.state.resultFragment.state.ghostLoad="web",this.component.state.resultFragment.state.ghostLoadNb=10,this.component.state.resultFragment.state.items=[],this.component.state.resultFragment.setState(this.component.state.resultFragment.state),this.component.searchModel.truePage=this.current;var a=this;this.component.searchModel.search().then(function(b){if(b.status!==AJAX_STATUS.USER_INTERRUPT){var c=null;b.error===AJAX_STATUS.HOST_ERROR||b.error===AJAX_STATUS.TIMEOUT?c="isHostError":"api_error"===b.status?c="isAPIError":b.status!==AJAX_STATUS.ERROR&&b.status!==AJAX_STATUS.EMPTY_RESULT&&b.items||(c="isEmptyResult"),c?a.component.state.resultFragment.state[c]=!0:(a.itemsArray[a.current]=a.component.state.resultFragment.state.items=b.items,b.ads&&(a.adsArray[a.current]=b.ads,a.component.webAddBlock&&a.component.webAddBlock.setAds(b.ads,a.current))),a.component.state.resultFragment.state.ghostLoad=!1,a.component.state.resultFragment.setState(a.component.state.resultFragment.state)}})}}}),CausesRibbonComponent=Class(Component,{$statics:{listItemReference:{causes:{list:".ia_causes--list--list",container:".ia_causes--list--content",item:".ia_causes--list--content-link",arrowRight:".ia_causes--list--nav_next",arrowLeft:".ia_causes--list--nav_prev",margin:10,lastOffset:20}}},constructor:function(a){this.data=a.data,this.name="result_ribbon_causes",this.initData(),_super(this)},initState:function(){return{data:this.data}},initData:function(){this.data.associations&&(this.data.associations=this.sortAssociations(this.data.associations)),this.data.similar&&(this.data.similar=this.sortAssociations(this.data.similar))},sortAssociations:function(a){return a.sort(function(a,b){return null===b.image?-1:1}),a}}),HotelRibbonComponent=Class(Component,{$statics:{ROOM_TYPE_SIMPLE:1,ROOM_TYPE_DOUBLE:2,offset:0,slide:function(a){if(!(a<0&&0===HotelRibbonComponent.offset)){a<0&&1===HotelRibbonComponent.offset&&addClass($(".hotel_ribbon__suggest__place__left"),"hotel_ribbon__suggest__place__left--disabled");var b=$i("hotel_ribbon__suggest__place__slider").offsetLeft,c=getComputed($i("hotel_ribbon__suggest__place__slider"),"width"),d=getComputed($(".hotel_ribbon__suggest")[0],"width"),e=b+c-d;a<0?(HotelRibbonComponent.offset+=a,removeClass($(".hotel_ribbon__suggest__place__right"),"hotel_ribbon__suggest__place__right--disabled"),$i("hotel_ribbon__suggest__place__slider").style["margin-left"]=-144*HotelRibbonComponent.offset+"px"):(removeClass($(".hotel_ribbon__suggest__place__left"),"hotel_ribbon__suggest__place__left--disabled"),e<144&&e>0?($i("hotel_ribbon__suggest__place__slider").style["margin-left"]=d-c+"px",addClass($(".hotel_ribbon__suggest__place__right"),"hotel_ribbon__suggest__place__right--disabled"),HotelRibbonComponent.offset+=a):e<=0?addClass($(".hotel_ribbon__suggest__place__right"),"hotel_ribbon__suggest__place__right--disabled"):(HotelRibbonComponent.offset+=a,$i("hotel_ribbon__suggest__place__slider").style["margin-left"]=-144*HotelRibbonComponent.offset+"px"))}}},constructor:function(a,b){if(HotelRibbonComponent.offset=0,this.places=[],this.hotels=[],this.searchColumn=b,this.name="result_ribbon_hotels",this.defaultClassName="results-column--ribbon result_ribbon_hotels",a.data.hotels){this.hotelState="search",this.hotels=a.data.hotels,this.filters=a.data.filters,this.sessionId=a.data.sid,this.query=a.data.q||a.query,this.criteria={checkIn:new Date(this.filters.checkin),checkOut:new Date(this.filters.checkout),roomType:this.filters.room,sessionId:this.sessionId,query:this.query};var c=new Date;c.setDate(c.getDate()+1),this.checkInCalendar=this.constructCalendar(this.criteria.checkIn,this.updateCheckIn,null,new Date),this.checkInCalendarMobile=this.constructCalendar(this.criteria.checkIn,this.updateCheckIn,".hotel-ribbon--top-bar--form",new Date),this.checkOutCalendar=this.constructCalendar(this.criteria.checkOut,this.updateCheckOut,null,c),this.checkOutCalendarMobile=this.constructCalendar(this.criteria.checkOut,this.updateCheckOut,".hotel-ribbon--top-bar--form",c);var d=[{label:_("Simple room","hotel"),value:HotelRibbonComponent.ROOM_TYPE_SIMPLE},{label:_("Double room","hotel"),value:HotelRibbonComponent.ROOM_TYPE_DOUBLE}];this.roomSelector=new DropDownComponent(d,{callback:this.updateRoomType,value:this.criteria.roomType,component:this}),this.hotelsComponent=new HotelsComponent(a.data,a.data.searchUrl,this.criteria)}else a.data.places&&(this.hotelState="suggest",this.places=this.shuffle(a.data.places),actionManager.addResizeListener(this,this.resizeSuggest));_super(this)},resizeSuggest:function(){if($i("hotel_ribbon__suggest__place__slider")){var a=window.innerWidth>640?144*this.places.length:130*this.places.length+5;$i("hotel_ribbon__suggest__place__slider").style.width=a+"px",$i("hotel_ribbon__suggest__place__slider").style["margin-left"]="5px",HotelRibbonComponent.offset=0,addClass($(".hotel_ribbon__suggest__place__left"),"hotel_ribbon__suggest__place__left--disabled"),removeClass($(".hotel_ribbon__suggest__place__right"),"hotel_ribbon__suggest__place__right--disabled")}},initState:function(){return{places:this.places,hotels:this.hotels,hotelState:this.hotelState}},updateRoomType:function(a){this.criteria.roomType=a,this.hotelsComponent.initPull(this.criteria)},updateCheckIn:function(a){if(this.criteria.checkIn=a,this.criteria.checkOut<=a){var b=new Date(this.criteria.checkIn);b.setDate(b.getDate()+1),this.updateCheckOut(b),this.checkOutCalendar.setDate(b),this.checkOutCalendarMobile.setDate(b)}this.hotelsComponent.initPull(this.criteria)},updateCheckOut:function(a){if(this.criteria.checkOut=a,this.criteria.checkIn>=a){var b=new Date(this.criteria.checkOut);b.setDate(b.getDate()-1),this.updateCheckIn(b),this.checkInCalendar.setDate(b),this.checkInCalendarMobile.setDate(b)}this.hotelsComponent.initPull(this.criteria)},constructCalendar:function(a,b,c,d){var e={callback:b,component:this,minDate:d};return c&&(e.container=c),new CalendarComponent(a,e)},shuffle:function(a){for(var b,c=a.length-1;c>0;c--){var d=Math.floor(Math.random()*(c+1));b=a[c],a[c]=a[d],a[d]=b}return a}}),KnowledgeRibbonComponent=Class(Component,{$statics:{listItemReference:{images:{name:"nearby",list:".ribbon-knowledge_nearby__places",container:".ribbon-knowledge_nearby__places--content",item:".ribbon-knowledge_nearby__link",arrowRight:".ribbon-knowledge_nearby-arrow_right",arrowLeft:".ribbon-knowledge_nearby-arrow_left",margin:10,lastOffset:0},movies:{name:"filmography",list:".ribbon-knowledge_filmography--list",container:".ribbon-knowledge_filmography--content",item:".ribbon-knowledge_filmography--movie-link",arrowRight:".movie_list--nav_next",arrowLeft:".movie_list--nav_prev",margin:10,lastOffset:24}}},constructor:function(a){this.data=a.data[0],this.query=a.query,this.name="result_ribbon_knowledge",this.roundCoverImage=this.needRoundCoverImage(),this.data.coordinates&&(this.map=new MapsFactory(this)),_super(this)},initState:function(){return{data:this.data,roundCoverImage:this.roundCoverImage}},onMount:function(){this.data.coordinates&&this.initMap(),this.data.nearby&&BrowserHelper.isTabletOrMobile&&IAHelper.setSwipableList("images",this.getImagesWidth("images"),this),this.data.filmography&&BrowserHelper.isTabletOrMobile&&IAHelper.setSwipableList("movies",this.getImagesWidth("movies"),this)},initMap:function(){var a=this;this.map.initializeMap({multiple:!0},"map_container",{mousewheelScroll:!1,fullscreenable:!1}).then(function(){var b=[{key:0,latitude:a.data.coordinates.latitude,longitude:a.data.coordinates.longitude,icon:new LocalMarkerComponent([],[],this).buildMarker(LocalMarkerComponent.PIN_DEFAULT_SINGLE,null,35,42),iconClass:MapsFactory.leafIcon.local.default.className,identity:"ia_knowledge"}],c=a.data.infobox_type?a.data.infobox_type:null;"settlement"===c&&(b[0].icon=null,b[0].iconClass=null),a.currentMarkers=a.map.recenterMap(b),setTimeout(function(){a.map.map_handle.setZoom(a.getZoomLevelByInfobox(c))},1e3)})},getZoomLevelByInfobox:function(a){var b=["body_of_water","diocese","ecoregion","forest","glacier","island","landform","mountain","protected_area","settlement","ski_resort","tectonic_plate","valley"],c=this.map.map_handle.getZoom();return a&&-1!==b.indexOf(a)&&(c-=4),c},getImagesWidth:function(a){if(this.data){var b=0,c=KnowledgeRibbonComponent.listItemReference[a].name;return this.data[c].forEach(function(c){b+=108,b+=KnowledgeRibbonComponent.listItemReference[a].margin}),b}return 0},getLocalUrl:function(){page(LocalHelper.getLocalUrlString({q:this.query}))},searchCategoriesNearby:function(a){a.query&&page(LocalHelper.getLocalUrlString({q:a.query}))},toggleSeeMore:function(){var a=$(".ribbon-knowledge--container")[0];a&&toggleClass(a,"expanded")},categorySearchNearbyIsActive:function(a,b){return!("FRA"!==a||!b||"settlement"!==b)},needRoundCoverImage:function(){var a=this.data.infobox_type?this.data.infobox_type:null,b=["body_of_water","diocese","ecoregion","forest","glacier","island","landform","mountain","protected_area","settlement","ski_resort","tectonic_plate","valley","american_football_player","architect","artist","astronaut","australian_football_player","badminton_player","baseball_player","basketball_player","boxer","character","chess_player","christian_leader","cricketer","criminal","cyclist","deity","esports_player","figure_skater","football_player","golfer","gymnast","handball_player","ice_hockey_player","martial_artist","military_person","model","motorcycle_rider","music_artist","noble","pageant_titleholder","person","philosopher","poker_player","politician","pornographic_actor","racing_driver","rugby_player","saint","scientist","skier","sport_person","swimmer","tennis_player","volleyball_player","wrestler","writer","youtube_personality"];return!(!a||-1===b.indexOf(a))}}),LocalRibbonComponent=Class(Component,{constructor:function(a,b){this.data=a.data,this.query=a.query,this.name="result_ribbon_local",this.map=new MapsFactory(this),this.singleView=1===this.data.items.length,this.selectedFilters=LocalHelper.getSelectedFilters(),this.onFilterChange=this.onFilterChange.bind(this),this.localFilters=null,this.tab=b,this.storeOpenComponent=null,"pages_jaunes"===this.data.type&&(this.singleView?(this.storeOpenComponent=new ResultStoreOpenLocalComponent(this.data.items[0]),this.tooltipID=actionManager.addClickListener(this,this.openTooltip,{clickOutHandler:this.closeTooltip}),this.tooltip=new TooltipComponent(this,_('Sponsored result chosen for its relevance to your request. <a href="{link}" {target}>{text}</a>',"local",{link:"https://about.qwant.com/fr/legal/modalites-de-referencement-dereferencement-et-de-classement/",text:_("Learn more","local"),target:SecurityHelper.targetBlank()}))):this.localFilters=new LocalFiltersPagesJaunesComponent(this.selectedFilters,this.onFilterChange)),_super(this)},initState:function(){return{type:this.data.type,localFilters:this.localFilters,data:this.data,storeOpenComponent:this.storeOpenComponent}},onMount:function(){this.initMap(),this.singleView||this.updateResultCount(this.data.totalItems)},initMap:function(){var a=this;this.map.initializeMap({multiple:!0},"map_container",{mousewheelScroll:!1,fullscreenable:!1}).then(function(){var b=new LocalMarkerComponent(a.data,a.data.items,a).getMarkers();a.currentMarkers=a.map.recenterMap(b)})},getLocalUrl:function(){page(this.getLocalUrlString())},getLocalUrlString:function(){var a=this.localFilters?this.localFilters.getSelectedFilters():{};return a.q=this.query,"/local/?"+Object.entries(a).filter(function(a){return a[1]&&""!==a[1]}).map(function(a){return a[0]+"="+a[1]}).join("&")},updateResultCount:function(a){var b=_("No results for the selected filters.","local"),c="";if(0!==a){b=_n("See the result","See the %d results",a,"local");this.data.categoryTriggered&&this.data.categoryTriggered;c='<a href="'+this.getLocalUrlString()+"\" class=\"ribbon_local__discover\" onmousedown=\"LinkHelper.logHandler(this, Event, {AjaxRoute: 'ribbon', ia_name: 'local', ia_type: '"+this.data.type+'\', ia_template: \'multiple\', ia_link: \'more\', ia_item: 1})" onclick="LinkHelper.clickHandler(this, Event)" onmouseup="LinkHelper.mouseUpHandler(this, Event)"><svg width="24" height="24" viewBox="0 0 24 24">    <use xlink:href="/img/v4/icon-spritesheet.svg?1539938515#eye"></use></svg><span>'+b+"</span></a>"}var d=$(".ribbon_local__infos")[0];d&&(d.innerHTML=c)},onFilterChange:function(){var a=this;this.selectedFilters=LocalHelper.getSelectedFilters();var b={q:this.query,local_type:this.data.type};for(var c in this.selectedFilters)a.selectedFilters[c]&&(b[c]=a.selectedFilters[c]);LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"ribbon",ia_name:"local",type:a.data.type,ia_template:"multiple",ia_link:"filter",item:1}),LocalHelper.queryLocal(b).then(function(b){if(b&&b.items){a.data=b,a.updateResultCount(b.totalItems);var c=new LocalMarkerComponent(a.data,a.data.items,a).getMarkers();a.currentMarkers=a.map.recenterMap(c)}})},formatDisplayCategory:function(a){return LocalHelper.formatDisplayCategory(a)},showPhoneNumbers:function(a){a.caller&&$i(a.caller)&&(a.caller=$i(a.caller)),LocalHelper.showPhoneNumbers(a,"result-local__phone-numbers-button","result-local__phone-numbers")},openTooltip:function(){TooltipComponent.changeContent({it:this.tooltip,message:_('Sponsored result chosen for its relevance to your request. <a href="{link}" {target}>{text}</a>',"local",{link:"https://about.qwant.com/fr/legal/modalites-de-referencement-dereferencement-et-de-classement/",text:_("Learn more","local"),target:SecurityHelper.targetBlank()})}),TooltipComponent.placeTooltip({it:this.tooltip,componentId:this.tooltipID});var a=$i("tooltip--"+this.tooltip.id);addClass(a,"active")},closeTooltip:function(){var a=$i("tooltip--"+this.tooltip.id);removeClass(a,"active")}}),IASearchBarComponent=Class(Component,{constructor:function(a){this.data=a,this.searchBarId=this.data.id,this.name="ia_search_bar",this.currentQuery="",this.isInit=!1,this.lastQuery="",actionManager.onCustomEvent(this,"rendered",this.init),_super(this)},initState:function(){return{data:this.data,searchBarId:this.searchBarId}},init:function(){this.isInit||(this.initElements(),this.initEvents(),this.data.value&&this.updateValue(this.data.value),actionManager.onCustomEvent(this,EventHelper.IA_SUGGESTER_CREATED+"_"+this.searchBarId,function(a,b){this.onSuggesterCreated(a,b)}),actionManager.onCustomEvent(this,EventHelper.IA_SUGGESTER_CLICKED+"_"+this.searchBarId,function(a,b){this.onSuggesterClicked(a,b)}),this.isInit=!0)},initElements:function(){this.elements={searchBar:$i(this.searchBarId+"_search_bar"),input:$i(this.searchBarId+"_input")}},initEvents:function(){var a=this;this.elements.input&&(this.elements.input.onkeyup=function(b){b.stopImmediatePropagation(),a.onInput(b)},this.elements.input.onkeydown=function(b){a.onKeyDown(b)},this.elements.input.onfocus=function(b){a.onFocus(b)},this.elements.input.onblur=function(b){a.onBlur(b)})},toggleSuggester:function(a){function b(){switch(a){case SuggesterComponent.ACTIONS.SUGGEST:var b=c.data.suggestOptions?c.data.suggestOptions:{};b.q=d,c.suggester.suggest(b).then(function(a){});break;case SuggesterComponent.ACTIONS.CLEAN:c.suggester.clean()}}var c=this,d=this.elements.input.value;this.suggester.currentSuggestIndex=null,this.suggester?b():setTimeout(function(){b()},250)},onFocus:function(a){this.lastQuery=this.elements.input.value,this.elements.input.value="",hasClass(this.elements.searchBar,"search_focused")||addClass(this.elements.searchBar,"search_focused"),this.toggleSuggester(SuggesterComponent.ACTIONS.SUGGEST)},onBlur:function(a){var b=this;""!==this.lastQuery&&(this.elements.input.value=this.lastQuery),""===this.elements.input.value&&removeClass(this.elements.searchBar,"search_focused"),setTimeout(function(){b.toggleSuggester(SuggesterComponent.ACTIONS.CLEAN)},150)},onKeyDown:function(a){var b=a.keyCode||a.which;if(b===SearchBarComponent.keys._ENTER&&a.preventDefault(),b)switch(b){case SearchBarComponent.keys._BACKSPACE:""===this.elements.input.value&&this.toggleSuggester(SuggesterComponent.ACTIONS.CLEAN)}},onInput:function(a,b){if(this.elements.input){if(this.currentQuery=this.elements.input.value,"firefox"===BrowserHelper.getBrowserUri()&&BrowserHelper.isTabletOrMobile)var c=1;else var c=a?a.keyCode||a.which:1;switch("iOS"===BrowserHelper.getOS()&&"Enter"===a.key&&(c=13),c){case SearchBarComponent.keys._ENTER:null!=this.suggester.currentSuggestIndex&&this.onSuggesterClicked(null,this.suggester.currentSuggest[this.suggester.currentSuggestIndex]);break;case SearchBarComponent.keys._TAB:break;case SearchBarComponent.keys._ESCAPE:this.toggleSuggester(SuggesterComponent.ACTIONS.CLEAN);break;case SearchBarComponent.keys._BACKSPACE:""!==this.currentQuery?this.toggleSuggester(SuggesterComponent.ACTIONS.SUGGEST):this.toggleSuggester(SuggesterComponent.ACTIONS.CLEAN);break;case SearchBarComponent.keys._UP:a.preventDefault(),this.displayPreviousSuggest();break;case SearchBarComponent.keys._DOWN:this.displayNextSuggest();break;case SearchBarComponent.keys._RIGHT:this.applyFirstSuggest();break;default:""!==this.currentQuery?this.toggleSuggester(SuggesterComponent.ACTIONS.SUGGEST):this.toggleSuggester(SuggesterComponent.ACTIONS.CLEAN)}}},onSuggesterCreated:function(a,b){this.suggester=b},onSuggesterClicked:function(a,b){this.lastQuery="",this.updateValue(b.value),this.toggleSuggester(SuggesterComponent.ACTIONS.CLEAN),actionManager.fireEvent(EventHelper.IA_SEARCH_BAR_NEW_QUERY+"_"+this.searchBarId,b)},applyFirstSuggest:function(){this.suggester&&this.suggester.currentSuggest.length>0&&(this.elements.input.value=this.suggester.currentSuggest[0].value)},displayPreviousSuggest:function(){this.suggester&&(null!==this.suggester.currentSuggestIndex&&toggleClass($("."+IASuggesterComponent.suggestCls)[this.suggester.currentSuggestIndex],IASuggesterComponent.suggestActiveCls),null===this.suggester.currentSuggestIndex||0===this.suggester.currentSuggestIndex?this.suggester.currentSuggestIndex=this.suggester.currentSuggest.length-1:this.suggester.currentSuggestIndex--,this.suggester.currentSuggest[this.suggester.currentSuggestIndex]&&(this.elements.input.value=this.suggester.currentSuggest[this.suggester.currentSuggestIndex].value),toggleClass($("."+IASuggesterComponent.suggestCls)[this.suggester.currentSuggestIndex],IASuggesterComponent.suggestActiveCls))},displayNextSuggest:function(){this.suggester&&(null!==this.suggester.currentSuggestIndex&&toggleClass($("."+IASuggesterComponent.suggestCls)[this.suggester.currentSuggestIndex],IASuggesterComponent.suggestActiveCls),null===this.suggester.currentSuggestIndex||this.suggester.currentSuggestIndex===this.suggester.currentSuggest.length-1?this.suggester.currentSuggestIndex=0:this.suggester.currentSuggestIndex++,this.suggester.currentSuggest[this.suggester.currentSuggestIndex]&&(this.elements.input.value=this.suggester.currentSuggest[this.suggester.currentSuggestIndex].value),toggleClass($("."+IASuggesterComponent.suggestCls)[this.suggester.currentSuggestIndex],IASuggesterComponent.suggestActiveCls))},updateValue:function(a){this.lastQuery="",this.elements&&this.elements.input&&(this.currentQuery=a,this.elements.input.value=this.currentQuery,hasClass(this.elements.searchBar,"search_focused")||addClass(this.elements.searchBar,"search_focused"))},getCurrentValue:function(){return this.currentQuery}}),IASuggesterComponent=Class(Component,{$statics:{suggestCls:"ia_suggester__list__element",suggestActiveCls:"ia_suggester__list__element--active"},constructor:function(a){this.data=a,this.searchBarId=this.data.id,this.route=this.data.suggesterRoute,this.name="ia_suggester",this.currentSuggest=[],this.currentSuggestIndex=null,this.cache=[],this.isInit=!1,actionManager.onCustomEvent(this,"rendered",this.init),_super(this)},initState:function(){return{data:null}},init:function(){this.isInit||(actionManager.fireEvent(EventHelper.IA_SUGGESTER_CREATED+"_"+this.searchBarId,this),this.isInit=!0)},suggest:function(a){var b=this,c=new promise.Promise,d=a;d.lang=applicationState.user.getSettings().getLocalisedSearchRegionCode().toLowerCase();var e="";return Object.keys(d).map(function(a,b){e+=d[a]+"_"}),void 0!==this.cache[e]?(b.currentSuggest=this.cache[e],b.resetState(b.currentSuggest),c.done(!1,null),c):(AjaxManager.get(this.route,new AjaxParameters(d).getParameters()).then(function(a,d){a&&c.done(a),b.currentSuggest=[],d.data.items&&d.data.items.length>0&&(b.currentSuggest=d.data.items),b.cache[e]=b.currentSuggest,b.resetState(b.currentSuggest),c.done(!1,null)}),c)},clean:function(){this.setState({data:null})},resetState:function(a){this.setState({data:a})},onClickItem:function(a){actionManager.fireEvent(EventHelper.IA_SUGGESTER_CLICKED+"_"+this.searchBarId,a)}}),SearchBarComponent=Class(Component,{$statics:{defaultPlaceholder:function(){return _("What are you looking for?","home")},doSearch:function(a,b){if(a)switch(a.value=a.value.trim(),SearchBarComponent.homeLastQuery=a.value,a.type){case SuggesterComponent.CATEGORIES.QWICK:window.location="/?q="+UrlHelper.formatQwick(a.value)+"&t="+QwantHomepageComponent.currentHomepage.name+"&l="+applicationState.user.userSetting.getSearchLanguageCode(),LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"suggest",rank:a.rank,query:UrlHelper.formatQwick(a.value),count:a.commonPartLength,t:QwantHomepageComponent.currentHomepage.name,type:"qwick"});break;case SuggesterComponent.CATEGORIES.ARTIST:LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"suggest",rank:a.rank,query:a.slug,count:a.commonPartLength,t:QwantHomepageComponent.currentHomepage.name,suggestType:a.suggestType,type:"music_artist"}),MusicHelper.redirectArtistRoute({artistSlug:a.slug});break;case SuggesterComponent.CATEGORIES.GAME:LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"suggest",rank:a.rank,query:a.slug,count:a.commonPartLength,t:QwantHomepageComponent.currentHomepage.name,suggestType:a.suggestType,type:"game"}),page("/game/"+encodeURIComponent(a.slug));break;case SuggesterComponent.CATEGORIES.GAME_EDITOR:LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"suggest",rank:a.rank,query:a.slug,count:a.commonPartLength,t:QwantHomepageComponent.currentHomepage.name,suggestType:a.suggestType,type:"game-editor"}),page("/game-editor/"+encodeURIComponent(a.slug));break;case SuggesterComponent.CATEGORIES.NORMAL:default:LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"suggest",rank:a.rank,count:a.commonPartLength,query:UrlHelper.formatQwick(a.value),t:QwantHomepageComponent.currentHomepage.name,suggestType:a.suggestType,type:0===a.value.indexOf("&")?"qwick":"standard"}),SearchBarComponent.page&&SearchBarComponent.component?SearchBarComponent.component.doQuery({q:a.value}):page("/?q="+UrlHelper.formatQwick(a.value)+"&t="+QwantHomepageComponent.currentHomepage.name)}else{var c=UrlHelper.formatQwick(SearchBarComponent.homeLastQuery),d="";void 0!==b&&(a?(a.value=a.value.trim(),d=a.value):d=UrlHelper.formatQwick(SearchBarComponent.homeLastQuery),LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"userInteraction",event:"submit",zone:"search_bar",query:d,type:b,context:"true"}));var e=QwantHomepageComponent.currentHomepage.name;if("all"===e){var f=applicationState.user.userSetting.searchMode;for(var g in window.siteConfiguration.searchCategories)if(window.siteConfiguration.searchCategories[g].index===f){e=window.siteConfiguration.searchCategories[g].name;break}"all"===e&&(e="web")}if(""!==c.trim())if(SearchBarComponent.inputHasQwick(SearchBarComponent.homeLastQuery))window.location="/?q="+c+"&t="+e+"&l="+applicationState.user.userSetting.getSearchLanguageCode();else if("local"===SearchBarComponent.page&&SearchBarComponent.component)SearchBarComponent.component.doQuery({q:c});else{
var h="/?q="+c+"&t="+e,i=Dispatcher.history.get(0).rawParams&&Dispatcher.history.get(0).rawParams.source?Dispatcher.history.get(0).rawParams.source:null;"web"===e&&Dispatcher.history.get(0).rawParams&&i&&(h+="&source="+i),page(h)}}},inputHasQwick:function(a){return/(^|\s)[&!](\d|\w)+(\s|\b)/.test(a)},getLastQuery:function(){return SearchBarComponent.homeLastQuery},qwickPage:"&qwick",resetBtnCls:"search_bar__form__reset--hidden",homeLastQuery:"",keys:{_BACKSPACE:8,_ESCAPE:27,_ENTER:13,_TAB:9,_UP:38,_DOWN:40,_LEFT:37,_RIGHT:39},SUBMIT_TYPE:{KEYBOARD:"keyboard",CLICK:"click",SUGGEST_KEYBOARD:"suggest_keyboard",SUGGEST_CLICK:"suggest_click"}},isSpecialKey:function(a){var b=!1;for(var c in SearchBarComponent.keys){if(SearchBarComponent.keys[c]===a){b=!0;break}}return b},constructor:function(a){this.name="search_bar",this.options=a,this.onlySpecialKeys=!1,this.hasLogo=void 0===a.hasLogo||a.hasLogo,SearchBarComponent.component=a.component||null,this.options&&this.options.q&&(SearchBarComponent.homeLastQuery=this.options.q.trim()),this.options&&this.options.homePage&&(QwantHomepageComponent.currentHomepage=this.options.homePage),0===Object.getOwnPropertyNames(QwantHomepageComponent.currentHomepage).length&&(QwantHomepageComponent.currentHomepage=siteConfiguration.defaultSearch),SearchBarComponent.page=this.options&&this.options.page?this.options.page:"",_super(this),actionManager.onCustomEvent(this,"rendered",this.init),LayoutComponent.registerBeforeAction(function(){removeClass(document.body,"search_focused")})},init:function(a,b){if("suggester"!==b.name&&"tooltip"!==b.name){this.initElements();var c=this;if(this.elements.form){if(this.initEvents(),this.toggleResetButton(),this.options&&this.options.autofocus&&!hasClass(document.body,"device")&&this.elements&&this.elements.input){this.elements.input.focus();var d=this.elements.input.value.length;this.elements.input.setSelectionRange(d,d)}BrowserHelper.isTabletOrMobile||document.addEventListener("keydown",function(a){if(!(a.altKey||a.ctrlKey||a.metaKey)&&(a.keyCode>47&&a.keyCode<58||32==a.keyCode||a.keyCode>64&&a.keyCode<91||a.keyCode<37&&a.keyCode>40||a.keyCode>95&&a.keyCode<112)&&13!=a.keyCode&&"INPUT"!=document.activeElement.tagName&&"TEXTAREA"!=document.activeElement.tagName&&c.elements.input){c.elements.input.focus();c.elements.input.setSelectionRange(999,999)}}),actionManager.onCustomEvent(this,EventHelper.SUGGESTER_CREATED,function(a,b){this.onSuggesterCreated(a,b)}),actionManager.onCustomEvent(this,EventHelper.SUGGESTER_CLICKED,function(a,b){this.onSuggesterClicked(a,b)}),actionManager.onCustomEvent(this,EventHelper.SUGGESTER_DISPLAYED,function(a,b){this.onSuggesterDisplayed(a,b)}),"true"===Dispatcher.getUrlParameter("topsearch")&&(addClass(document.body,"topsearch"),LayoutComponent.registerBeforeAction(function(){removeClass(document.body,"topsearch")}),this.elements.input.focus(),d=999,this.elements.input.setSelectionRange(d,d),this.elements.input.click())}}},initElements:function(){this.elements={form:$i(this.id+"_form"),input:$i(this.id+"_input"),placeholder:$i(this.id+"_placeholder"),resetBtn:$i(this.id+"_reset"),searchBtn:$i(this.id+"_search"),suggester:$i(this.id+"_suggester")}},initEvents:function(){var a=this;this.elements.form.onsubmit=function(b){a.onSubmit(b,SearchBarComponent.SUBMIT_TYPE.KEYBOARD)},this.elements.input.onkeyup=function(b){b.stopImmediatePropagation(),a.onInput(b,!1)},this.elements.input.onkeydown=function(b){a.onKeyDown(b)},this.elements.input.oninput=function(b){a.onlySpecialKeys=!0,a.onInput(b,!1)},this.elements.input.onfocus=function(b){a.onFocus(b)},this.elements.input.onblur=function(b){a.onBlur(b)},this.elements.resetBtn.onclick=function(b){a.onReset(b)},this.elements.searchBtn.onclick=function(b){b.stopImmediatePropagation(),b.preventDefault(),a.onSubmit(b,SearchBarComponent.SUBMIT_TYPE.CLICK)}},isAutoCompleteEnabled:function(){return applicationState.user.userSetting.enableSuggest},toggleSuggester:function(a){function b(){switch(c.fillPlaceholder(""),a){case SuggesterComponent.ACTIONS.SUGGEST:c.suggester.suggest().then(function(a){a||c.onSuggesterDisplayed()});break;case SuggesterComponent.ACTIONS.CLEAN:c.suggester.clean(),SuggesterComponent.LAST_SUGGEST=""}}var c=this;this.isAutoCompleteEnabled()&&(this.suggester?b():setTimeout(function(){b()},250))},onKeyDown:function(a){var b=a.keyCode||a.which;if(b===SearchBarComponent.keys._ENTER&&a.preventDefault(),this.isSpecialKey(b)||!this.onlySpecialKeys)if("firefox"===BrowserHelper.getBrowserUri()&&BrowserHelper.isTabletOrMobile)this.onInput(a,!0);else{var b=a.keyCode||a.which;if(b)switch(b){case SearchBarComponent.keys._BACKSPACE:""===this.elements.input.value&&this.toggleSuggester(SuggesterComponent.ACTIONS.CLEAN);break;case SearchBarComponent.keys._TAB:this.fillPlaceholder(""),this.toggleSuggester(SuggesterComponent.ACTIONS.CLEAN),this.toggleResetButton()}}},onInput:function(a,b){if(this.elements.input){if(SearchBarComponent.homeLastQuery=this.elements.input.value,!b&&"firefox"===BrowserHelper.getBrowserUri()&&BrowserHelper.isTabletOrMobile)var c=1;else var c=a?a.keyCode||a.which:1;if("iOS"===BrowserHelper.getOS()&&"Enter"===a.key&&(c=13),this.isSpecialKey(c)||!this.onlySpecialKeys||"input"===a.type){switch(c){case SearchBarComponent.keys._ENTER:1===$("."+SuggesterComponent.suggestActiveCls).length?SearchBarComponent.doSearch(SuggesterComponent.CURRENT_SUGGESTS[SuggesterComponent.CURRENT_SUGGESTS_INDEX],SearchBarComponent.SUBMIT_TYPE.SUGGEST_KEYBOARD):SearchBarComponent.doSearch(null,SearchBarComponent.SUBMIT_TYPE.KEYBOARD);break;case SearchBarComponent.keys._TAB:break;case SearchBarComponent.keys._ESCAPE:this.toggleSuggester(SuggesterComponent.ACTIONS.CLEAN);break;case SearchBarComponent.keys._BACKSPACE:""!==this.elements.input.value?this.toggleSuggester(SuggesterComponent.ACTIONS.SUGGEST):this.toggleSuggester(SuggesterComponent.ACTIONS.CLEAN);break;case SearchBarComponent.keys._UP:this.fillPlaceholder(""),a.preventDefault(),this.displayPreviousSuggest();break;case SearchBarComponent.keys._DOWN:this.fillPlaceholder(""),this.displayNextSuggest();break;case SearchBarComponent.keys._LEFT:this.fillPlaceholder("");break;case SearchBarComponent.keys._RIGHT:this.isAutoCompleteEnabled()&&this.elements.placeholder&&""!==this.elements.placeholder.value&&(this.elements.input.value=this.elements.placeholder.value,SearchBarComponent.homeLastQuery=this.elements.input.value,this.toggleSuggester(SuggesterComponent.ACTIONS.SUGGEST));break;default:""!==SearchBarComponent.homeLastQuery?this.toggleSuggester(SuggesterComponent.ACTIONS.SUGGEST):this.toggleSuggester(SuggesterComponent.ACTIONS.CLEAN)}this.toggleResetButton()}}},onSubmit:function(a,b){SearchBarComponent.doSearch(null,b)},onFocus:function(a){addClass(document.body,"search_focused"),""!==SearchBarComponent.homeLastQuery&&this.toggleSuggester(SuggesterComponent.ACTIONS.SUGGEST),hasClass(document.body,"device")&&hasClass(document.body,"scroll_on_homepage")&&!hasClass(document.body,"scrolled_more")&&smoothScrollTo(0)},onBlur:function(a){"true"!==Dispatcher.getUrlParameter("topsearch")&&(hasClass(document.body,"device")?setTimeout(function(){hasClass(document.body,"search_reset")?removeClass(document.body,"search_reset"):removeClass(document.body,"search_focused")},200):removeClass(document.body,"search_focused"),this.isAutoCompleteEnabled()&&!SuggesterComponent.SUGGEST_CLICKED&&this.toggleSuggester(SuggesterComponent.ACTIONS.CLEAN))},onReset:function(a){this.elements.input.value="",SearchBarComponent.homeLastQuery="",this.toggleResetButton(),this.toggleSuggester(SuggesterComponent.ACTIONS.CLEAN),this.elements.input.focus(),hasClass(document.body,"device")&&addClass(document.body,"search_reset")},onSuggesterCreated:function(a,b){this.suggester=b},onSuggesterDisplayed:function(){this.elements.input&&this.elements.placeholder&&(SuggesterComponent.CURRENT_SUGGESTS.unshift({type:SuggesterComponent.CATEGORIES.NORMAL,value:this.elements.input.value}),SuggesterComponent.CURRENT_SUGGESTS[1]&&this.fillPlaceholder(SuggesterComponent.CURRENT_SUGGESTS[1].value))},onSuggesterClicked:function(a,b){this.elements&&this.elements.input&&(b.type===SuggesterComponent.CATEGORIES.QWICK||b.type===SuggesterComponent.CATEGORIES.AV_QWICK?(SearchBarComponent.homeLastQuery=b.value+" ",this.elements.input.value=SearchBarComponent.homeLastQuery,b.value===SearchBarComponent.qwickPage?this.doSearch(b,SearchBarComponent.SUBMIT_TYPE.SUGGEST_CLICK):this.fillPlaceholder(b.value+" ...",!0)):SearchBarComponent.homeLastQuery=b.value)},fillPlaceholder:function(a,b){var b=b||!1;this.isAutoCompleteEnabled()&&this.elements&&this.elements.placeholder&&this.elements.input&&(!0===b?this.elements.placeholder.value=a:""===a||SearchBarComponent.inputHasQwick(this.elements.input.value)?this.elements.placeholder.value="":a.substr(0,this.elements.input.value.length).toLowerCase()===this.elements.input.value.toLowerCase()?this.elements.placeholder.value=this.elements.input.value+a.substr(this.elements.input.value.length):this.elements.placeholder.value="")},toggleResetButton:function(){this.elements&&this.elements.input&&this.elements.input.value.length>0?removeClass(this.elements.resetBtn,SearchBarComponent.resetBtnCls):addClass(this.elements.resetBtn,SearchBarComponent.resetBtnCls)},displayPreviousSuggest:function(){this.isAutoCompleteEnabled()&&SuggesterComponent.CURRENT_SUGGESTS&&(0!==SuggesterComponent.CURRENT_SUGGESTS_INDEX&&toggleClass($("."+SuggesterComponent.suggestCls)[SuggesterComponent.CURRENT_SUGGESTS_INDEX-1],SuggesterComponent.suggestActiveCls),0===SuggesterComponent.CURRENT_SUGGESTS_INDEX?SuggesterComponent.CURRENT_SUGGESTS_INDEX=SuggesterComponent.CURRENT_SUGGESTS.length-1:SuggesterComponent.CURRENT_SUGGESTS_INDEX--,SuggesterComponent.CURRENT_SUGGESTS[SuggesterComponent.CURRENT_SUGGESTS_INDEX]&&(this.elements.input.value=SuggesterComponent.CURRENT_SUGGESTS[SuggesterComponent.CURRENT_SUGGESTS_INDEX].value),0!==SuggesterComponent.CURRENT_SUGGESTS_INDEX&&toggleClass($("."+SuggesterComponent.suggestCls)[SuggesterComponent.CURRENT_SUGGESTS_INDEX-1],SuggesterComponent.suggestActiveCls))},displayNextSuggest:function(){this.isAutoCompleteEnabled()&&SuggesterComponent.CURRENT_SUGGESTS&&(0!==SuggesterComponent.CURRENT_SUGGESTS_INDEX&&toggleClass($("."+SuggesterComponent.suggestCls)[SuggesterComponent.CURRENT_SUGGESTS_INDEX-1],SuggesterComponent.suggestActiveCls),SuggesterComponent.CURRENT_SUGGESTS_INDEX===SuggesterComponent.CURRENT_SUGGESTS.length-1?SuggesterComponent.CURRENT_SUGGESTS_INDEX=0:SuggesterComponent.CURRENT_SUGGESTS_INDEX++,SuggesterComponent.CURRENT_SUGGESTS[SuggesterComponent.CURRENT_SUGGESTS_INDEX]&&(this.elements.input.value=SuggesterComponent.CURRENT_SUGGESTS[SuggesterComponent.CURRENT_SUGGESTS_INDEX].value),0!==SuggesterComponent.CURRENT_SUGGESTS_INDEX&&toggleClass($("."+SuggesterComponent.suggestCls)[SuggesterComponent.CURRENT_SUGGESTS_INDEX-1],SuggesterComponent.suggestActiveCls))}}),SuggesterComponent=Class(Component,{$statics:{suggestCls:"suggester__list__element",suggestActiveCls:"suggester__list__element--active",CATEGORIES:{NORMAL:"standard",QWICK:"qwick",AV_QWICK:"available_qwick",ARTIST:"artist",GAME:"game",GAME_EDITOR:"game_editor",TOP_QUERY:"topquery"},ICON:{artist:"music",game:"game",game_editor:"game"},SEARCH_SUGGEST_COUNT:0,LAST_SUGGEST:"",CACHE:{STANDARD:{},MUSIC:{},SHOPPING:{}},EMPTY_CACHE:{STANDARD:[],SHOPPING:[]},SUGGEST_CLICKED:!1,ACTIONS:{SUGGEST:0,CLEAN:1},CURRENT_SUGGESTS:[],CURRENT_SUGGESTS_INDEX:0},constructor:function(a){this.name="suggester",this.id=a+"_suggester",_super(this),actionManager.onCustomEvent(this,"rendered",this.init),LayoutComponent.registerBeforeAction(function(){SuggesterComponent.LAST_SUGGEST=""})},init:function(){var a=$(".suggester__list__element--standard"),b=$(".suggester__list__element--qwick"),c=$(".suggester__list__element--available-qwick"),d=$(".suggester__list__element--artist--small"),e=$(".suggester__list__element--game"),f=$(".suggester__list__element--special--small");this.initEvents(a),this.initEvents(b),this.initEvents(c),this.initEvents(d),this.initEvents(e),this.initEvents(f),actionManager.fireEvent(EventHelper.SUGGESTER_CREATED,this)},initEvents:function(a){var b=this;if(a&&a.length>0)for(var c=0;c<a.length;++c)a[c].onmousedown=function(a){a.stopImmediatePropagation(),a.preventDefault(),b.onMouseDown(a)}},initState:function(){return{data:null}},suggest:function(){if(""!==SearchBarComponent.homeLastQuery){var a=new promise.Promise;SuggesterComponent.SEARCH_SUGGEST_COUNT++,SuggesterComponent.LAST_SUGGEST=SearchBarComponent.homeLastQuery;var b=this,c=SuggesterComponent.LAST_SUGGEST,d=SuggesterComponent.SEARCH_SUGGEST_COUNT,e="",f=this.getFromCurrentCache(),g={q:c,lang:applicationState.user.getSettings().getLocalisedSearchRegionCode().toLowerCase()},h=!1;if("shopping"===QwantHomepageComponent.currentHomepage.name?SuggesterComponent.EMPTY_CACHE.SHOPPING.forEach(function(a){if(!h){var b=new RegExp("^"+a+".*");c.match(b)&&(h=!0)}}):SuggesterComponent.EMPTY_CACHE.STANDARD.forEach(function(a){if(!h){var b=new RegExp("^"+a+".*");c.match(b)&&(h=!0)}}),f&&d===SuggesterComponent.SEARCH_SUGGEST_COUNT||h)this.resetState(f),a.done(!1,null);else{switch(QwantHomepageComponent.currentHomepage.name){case"shopping":e=ajax.suggest.shopping();break;default:e=ajax.suggest.default()}AjaxManager.get(e,g).then(function(f,g){if(!f&&g&&"success"===g.status){var h=g.data&&g.data.items&&0===g.data.items.length;switch(e){case ajax.suggest.shopping():SuggesterComponent.CACHE.SHOPPING[c]=g.data,h&&SuggesterComponent.EMPTY_CACHE.SHOPPING.push(RegexHelper.escapeRegExp(c));break;default:SuggesterComponent.CACHE.STANDARD[c]=g.data,h&&SuggesterComponent.EMPTY_CACHE.STANDARD.push(RegexHelper.escapeRegExp(c))}""===SearchBarComponent.homeLastQuery?b.clean():d===SuggesterComponent.SEARCH_SUGGEST_COUNT&&(b.resetState(g.data),a.done(!1,null))}})}return a}},clean:function(){this.setState({data:null})},resetState:function(a){this.state.data=a,null!==a&&void 0!==a&&this.formatDisplayData(a),this.setState(this.state),void 0!==a&&this.formatCleanData(a)},formatCleanData:function(a){var b=[],c=0;if(a.special){var d=a.special;d.reverse(),d.forEach(function(a){var d={};switch(d.value=a.name,d.type=a.type,d.commonPartLength=SuggesterComponent.LAST_SUGGEST.length,d.rank=++c,d.type){case SuggesterComponent.CATEGORIES.GAME:case SuggesterComponent.CATEGORIES.GAME_EDITOR:case SuggesterComponent.CATEGORIES.ARTIST:d.slug=a.slug}b.unshift(d)})}if(a.items&&a.items.forEach(function(a){var d={};a.command?d.type=SuggesterComponent.CATEGORIES.QWICK:d.type=SuggesterComponent.CATEGORIES.NORMAL,d.suggestType=a.suggestType,d.value=a.value,d.rank=++c,d.commonPartLength=SuggesterComponent.LAST_SUGGEST.length,b.push(d)}),a.availableQwick){var e=a.availableQwick,f={};f.site_name=e.site_name,f.type=SuggesterComponent.CATEGORIES.AV_QWICK,f.command=f.value=e.command,f.icon=e.icon,f.command&&(a.availableQwick=f,b.unshift(f))}else delete a.availableQwick;SuggesterComponent.CURRENT_SUGGESTS=b,SuggesterComponent.CURRENT_SUGGESTS_INDEX=0},formatDisplayData:function(a){var b=0;if(a.special&&a.special.forEach(function(a){a.value=a.name,a.commonPartLength=SuggesterComponent.LAST_SUGGEST.length,a.rank=++b,SuggesterComponent.ICON.hasOwnProperty(a.type)?a.icon=SuggesterComponent.ICON[a.type]:a.icon=""}),a.items&&a.items.forEach(function(a){a.rank=++b,a.command?a.type=SuggesterComponent.CATEGORIES.QWICK:(a.commonPartLength=SuggesterComponent.LAST_SUGGEST.length,a.commonPart=a.value.substr(0,a.commonPartLength),a.type=SuggesterComponent.CATEGORIES.NORMAL)}),a.availableQwick&&a.availableQwick.hasOwnProperty("command")){var c=a.availableQwick,d={};d.site_name=c.site_name,d.type=SuggesterComponent.CATEGORIES.AV_QWICK,d.command=d.value=c.command,d.icon=c.icon,d.command&&(a.availableQwick=d)}else delete a.availableQwick},getFromCache:function(a,b){if(a.hasOwnProperty(b))return a[b]},getFromCurrentCache:function(){switch(QwantHomepageComponent.currentHomepage.name){case"shopping":return this.getFromCache(SuggesterComponent.CACHE.SHOPPING,SearchBarComponent.homeLastQuery);case"music":return this.getFromCache(SuggesterComponent.CACHE.MUSIC,SearchBarComponent.homeLastQuery);default:return this.getFromCache(SuggesterComponent.CACHE.STANDARD,SearchBarComponent.homeLastQuery)}},onMouseDown:function(a){SuggesterComponent.SUGGEST_CLICKED=!0,setTimeout(function(){SuggesterComponent.SUGGEST_CLICKED=!1},500)},onClick:function(a){SuggesterComponent.SUGGEST_CLICKED=!1,a.type===SuggesterComponent.CATEGORIES.QWICK||a.type===SuggesterComponent.CATEGORIES.AV_QWICK?actionManager.fireEvent(EventHelper.SUGGESTER_CLICKED,a):SearchBarComponent.doSearch(a,SearchBarComponent.SUBMIT_TYPE.SUGGEST_CLICK)}}),PanelFormUserRating=Class(Component,{constructor:function(a){this.name="panel_form_user_rating",this.ratingData=a,_super(this)},getReadyToRender:function(){var a=new promise.Promise;return a.done(!1),a},receiveData:function(a){return!0},submit:function(){if(!this.ratingData.isFormValid())return!1;PanelFormHelper.showLoadingOverlay();var a=PanelFormHelper.getServerTimeoutHandler();this.ratingData.submit().then(function(b){clearTimeout(a),PanelFormHelper.hideLoadingOverlay(),b?AlertComponent.error(_("An error has occurred while trying to submit your rating","user rating")):(AlertComponent.success(_("Your rating has been successfully submitted","user rating")),PanelFormHelper.close())})},updateFlags:function(a){var b=$i(a.key);if(!b||!a.ratingData||!a.flagName)return!1;b.checked?a.ratingData.addFlag(a.flagName):a.ratingData.removeFlag(a.flagName)}}),WebAddBlockComponent=Class(Component,{constructor:function(a,b,c,d){this.name="web_add_block",this.route=a,this.type=b,this.whichBlock=c,this.column={isSingleColumn:d},_super(this)},setAds:function(a,b,c){this.setState({ads:a,page:b,version:c})},initState:function(){return{ads:[],page:0}}}),HomeShoppingCategoryComponent=Class(Component,{constructor:function(a,b,c,d){this.name="home_shopping_category",this.category=b,this.isListForced=!1,this.ghost="shopping",this.data=a,this.query=d,this.page=1,this.nb_pages=window.innerWidth<1100?6:window.innerWidth>1489?3:4,this.items_per_page={3:4,4:3,6:2},this.fullPage=c,this.twoLinesCategory=["prix-baisse"],this.defaultClassName="result-fragment",this.randomItems={items:[]};var e=this.getTooltipMsg(this.category.keys);this.tooltipID=actionManager.addClickListener(this,this.openTooltip,{clickOutHandler:this.closeTooltip}),this.tooltip=new TooltipComponent(this,e),this.initCategory(),_super(this)},initState:function(){return{data:this.data,randomItems:this.randomItems,category:this.category,fullPage:this.fullPage,nb_pages:this.nb_pages,page:this.page,query:this.query,items_per_page:this.items_per_page[this.nb_pages],twoLinesCategory:this.twoLinesCategory}},initCategory:function(){var a=this;BrowserHelper.isTabletOrMobile?(removeClass(document.body,"shopping-mosaic"),addClass(document.body,"shopping-list")):hasClass(document.body,"shopping-list")||(addClass(document.body,"shopping-mosaic"),this.ghost="shopping_card");for(var b=this.getWeightedProducts(),c=b.length-1,d=this.fullPage?this.data.items.length:-1!==this.twoLinesCategory.indexOf(this.category.keys)?2*this.items_per_page[this.nb_pages]:this.items_per_page[this.nb_pages]*this.nb_pages,e=[],f=0;f<d;f++){for(var g=0,h=Math.floor(Math.random()*(c-0+1))+0;-1!==e.indexOf(b[h])&&g<10;)h=Math.floor(Math.random()*(c-0+1))+0,g++;g<10&&(a.randomItems.items.push(a.data.items[b[h]]),e.push(b[h]))}},navBack:function(a){a.category&&this.page&&(this.page=this.page-1<1?this.nb_pages:this.page-1,this.setNav(a.category))},navNext:function(a){a.category&&this.page&&(this.page=this.page+1>this.nb_pages?1:this.page+1,this.setNav(a.category))},bulletNav:function(a){a.category&&a.page&&this.page&&a.page!==this.page&&(this.page=a.page,this.setNav(a.category))},setNav:function(a){var b=1+this.items_per_page[this.nb_pages]*(this.page-1),c=$(".results--category-"+a)[0];if(c&&c.children)for(var d=c.children,e=0;e<d.length;e++){var f=e+1,g=d[e];if(f<b||f>=b+this.items_per_page[this.nb_pages]){var h=$(".results--category-pages.category-"+a+" span.results--category-page");if(h&&h.length)for(var i=0;i<h.length;i++)h[i]&&(hasClass(h[i],"active-page")&&removeClass(h[i],"active-page"),i===this.page-1&&addClass(h[i],"active-page"));addClass(g,"result--shopping--hidden-item")}else f>=b&&f<b+this.items_per_page[this.nb_pages]&&removeClass(g,"result--shopping--hidden-item")}},getWeightedProducts:function(){for(var a=[],b=0;b<this.data.items.length;b++){for(var c=this.data.items[b],d=!1,e=0;e<c.offers.length;e++)0!==c.offers[e].discount&&(d=!0);-1===a.indexOf(b)&&(a.push(b),d&&(a.push(b),a.push(b)))}return a},getTooltipMsg:function(a){return"top-vente"===a?_("The products correspond to a selection of the most popular products. For more offers, we invite you to specify your search in our dedicated shopping engine.","shopping"):"prix-baisse"===a?_("The products correspond to a selection of products whose price has recently fallen. For more offers, we invite you to specify your search in our dedicated shopping engine.","shopping"):_("The products correspond to a selection of the most popular products in the category. For more offers, we invite you to specify your search in our dedicated shopping engine.","shopping")},openTooltip:function(){TooltipComponent.changeContent({it:this.tooltip,message:this.getTooltipMsg(this.category.keys)}),TooltipComponent.placeTooltip({it:this.tooltip,componentId:this.tooltipID});var a=$i("tooltip--"+this.tooltip.id);addClass(a,"active")},closeTooltip:function(){var a=$i("tooltip--"+this.tooltip.id);removeClass(a,"active")}}),HomeShoppingPageComponent=Class(Component,{$statics:{currentWidth:window.innerWidth},constructor:function(a){this.route=a,this.name="home_shopping_page",this.defaultClassName="results-view results-view--shopping results-view--home-shopping",this.categories=[],this.fullPage=!1,this.highlightCatList=["prix-baisse","top-vente"],this.initHomeShopping(),this.initEvents(),_super(this)},initState:function(){return this.state={components:[],highlightCategory:[],keyPhrase:this.query,encodedKeyPhrase:this.query,rawKeyPhrase:this.query,searchType:constants.SearchTypes.SHOPPING,categories:this.categories,fullPage:this.fullPage,query:this.query,searchLanguage:this.searchLanguage,highlightCatList:this.highlightCatList},this.state},initEvents:function(){addClass(document.body,"scroll_on_results"),LayoutComponent.registerBeforeAction(function(){removeClass(document.body,"scroll_on_results"),SearchBarComponent.homeLastQuery=""}),hasClass(document.body,"device")&&$("footer")[0]&&($("footer")[0].style.display="none",LayoutComponent.registerBeforeAction(function(){$("footer")[0].style.display="block"}))},initHomeShopping:function(){this.searchLanguage=applicationState.user.userSetting.getSearchRegionCode().toLowerCase(),this.query=constants.HomeShoppingCurrentEvent[this.searchLanguage]||"shopping","fr"!==this.searchLanguage&&(window.location=config_get("qwantUrl")),Application.rootComponent.state.sideBar.changeSearch({item:constants.SearchTypes.SHOPPING,changePage:!1}),QwantHomepageComponent.currentHomepage=siteConfiguration.searchCategories.SHOPPING,this.webTagger=new WebTagger(this,{device:BrowserHelper.deviceType()}),this.autocomplete=null;var a=this.getOrRedirectCurrentCategory();this.load(a),this.tooltipID=actionManager.addClickListener(this,this.openTooltip,{clickOutHandler:this.closeTooltip}),this.tooltip=new TooltipComponent(this,_('The products and services listed on this results page match your query. Qwant is paid by advertisers according to a hybrid model of CPC ("cost per click") and CPA ("cost per acquisition"). On Qwant Shopping, the default ranking is based on criteria of relevance to your request and takes into account the quality of the advertiser\'s data as well as the price (the lowest prevails). As with all Qwant products and services, Qwant Shopping is guaranteed without cookies or any other form of tracking. On our platform, you search for products and services anonymously and with respect for your privacy. The merchants from whom you finalize your purchases have their own general terms and conditions of sale (RGPD, applicable taxes, shipping costs, delivery options...) and their own personal data protection policies. For more information on these terms and conditions, please visit the dedicated merchant sites page.',"result"))},getOrRedirectCurrentCategory:function(){var a=null;return this.route&&this.route.rawParams&&(this.route.rawParams.category&&(a=this.route.rawParams.category),this.route.rawParams.q||(a?page("/shopping/?q="+this.query+"&category="+a):page("/shopping/?q="+this.query))),a},load:function(a){var b=this;(new HomeShoppingPageModel).categories(b.searchLanguage).then(function(c,d){if(!c&&d&&d.result&&d.result.items){b.categories=d.result.items,b.state.categories=b.categories;var e=!1;if(a)for(var f=0;f<b.categories.length;f++){var g=b.categories[f];if(g.keys===a){a=g,e=!0,b.fullPage=!0;break}}a&&e?b.loadCategory(a):b.loadHomeShopping()}else c&&l.error(c),page("/"),AlertComponent.error(_("An error has occured","alert"))})},loadCategory:function(a){var b=this;(new HomeShoppingPageModel).homeshopping(a,b.fullPage,b.query,b.searchLanguage).then(function(c){if(c[0])return l.error(c[0]),page("/"),void AlertComponent.error(_("An error has occured","alert"));b.state.fullPage=b.fullPage,b.state.components.push(c[1]),b.setState(b.state),LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"userInteraction",event:"display",category:a.keys,domain:"homeShopping"})})},loadHomeShopping:function(){var a=this,b=new HomeShoppingPageModel;LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"userInteraction",event:"display",category:"home",domain:"homeShopping"});var c=[];this.highlightCatList.forEach(function(d){var e=a.categories.filter(function(a){return a.keys===d});if(e){var f=b.homeshopping(e[0],a.fullPage,a.query,a.searchLanguage);c.push(f)}});for(var d=[],e=0;e<2;e++){for(var f=Math.floor(Math.random()*a.categories.length);!a.categories[f]||-1!==d.indexOf(f)||-1!==a.highlightCatList.indexOf(a.categories[f].keys);)f=Math.floor(Math.random()*a.categories.length);d.push(f);var g=b.homeshopping(a.categories[f],a.fullPage,a.query,a.searchLanguage);c.push(g)}Promise.all(c).then(function(b){b.forEach(function(b){if(b&&b[0])return l.error(b[0]),page("/"),void AlertComponent.error(_("An error has occured","alert"));b[1]&&(b[1].category.keys&&-1!==a.highlightCatList.indexOf(b[1].category.keys)?a.state.highlightCategory.push(b[1]):a.state.components.push(b[1]))}),a.setState(a.state)})},openTooltip:function(){TooltipComponent.changeContent({it:this.tooltip,message:_('The results presented on this page do not necessarily represent all the products and services available on the Web. These are results for which Qwant is remunerated by advertisers according to a hybrid model with CPC ("cost per click") and CPA ("cost per acquisition"). The default ranking of Shopping offers is based on criteria of relevance to your request and takes into account the quality of the advertiser\'s data as well as the price of the product, excluding transport costs, insurance or additional services. The classification of merchants for the same product is carried out by default by ascending price. As with all Qwant products and services, Qwant Shopping is guaranteed to be cookie-free and free of any other form of tracking. On our platform, you search for products and services anonymously and with respect for your privacy. The merchants from whom you finalize your purchases have their own general terms and conditions of sale (applicable taxes, shipping costs, delivery options...) which you must read before purchase. Strikethrough prices are indicative information provided by the merchant when indexing its product data.<a href="{link}" {target}>{text}</a>',"result",{link:"https://about.qwant.com/fr/legal/modalites-de-referencement-dereferencement-et-de-classement/",text:_("Learn more","result"),target:SecurityHelper.targetBlank()})}),TooltipComponent.placeTooltip({it:this.tooltip,componentId:this.tooltipID});var a=$i("tooltip--"+this.tooltip.id);addClass(a,"active")},closeTooltip:function(){var a=$i("tooltip--"+this.tooltip.id);removeClass(a,"active")}}),SideBarComponent=Class(Component,{constructor:function(){this.name="side_bar",this.current=Dispatcher.getUrlParameter("t")||"web",this.defaultCategoryName="web",this.webTagger=new WebTagger(this,{device:BrowserHelper.deviceType()}),LayoutComponent.registerBeforeActionGlobal(function(){Application.rootComponent.state.sideBar.hideMobileSidebar()}),_super(this)},initState:function(){return{menuItems:this.getItems(siteConfiguration.defaultSearch.name,{q:""}),current:this.current}},setCurrentCursor:function(a){var b=$(".sidebar__item__bar_cursor")[0],c=$(".sidebar__item__arrow")[0],d=$(".sidebar__item--"+a)[0],e=$(".sidebar__item--"+this.current)[0],f=d?d.offsetTop:"160",g=e?e.offsetTop:"160";c&&(c.style.top=f+"px",setTimeout(function(){c.style.top=g+"px"},0)),b&&(removeClass(b,"sidebar__item__bar_cursor--"+a),addClass(b,"sidebar__item__bar_cursor--"+this.current),b.style.top=f+12+"px",setTimeout(function(){b.style.top=g+12+"px"},0))},changeSearch:function(a){var b=Dispatcher.getUrlParameter("q");a.changePage&&page("?q="+UrlHelper.fixedEncodeURIComponent(b)+"&t="+a.item),removeClass($(".sidebar__item--"+this.current)[0],"sidebar__item--current"),this.current=a.item,addClass($(".sidebar__item--"+a.item)[0],"sidebar__item--current"),this.setCurrentCursor(this.current)},toggleHomePage:function(a){a=a||siteConfiguration.defaultSearch.name;var b=this.current;this.setState(new State({menuItems:this.getItems(a,{q:""}),current:b})),this.setCurrentCursor(b)},getItems:function(a,b){var c,d=[],e=!1,f=0,g=0,h="";b.q&&"string"==typeof b.q&&(h=UrlHelper.htmlentitiesToEncodeURI(UrlHelper.formatUrl(b.q)));for(var i in siteConfiguration.searchCategories){var j=siteConfiguration.searchCategories[i];if(!SiteHelper.isHomepageRestricted(j)&&"all"!==j.name){var k=!1;a===j.name&&(this.current=a,k=!0,e=!0),j.name===this.defaultCategoryName&&(f=g),c=!h||k?"/"+j.url:b.f&&"string"==typeof b.f&&"h:"===b.f.substr(0,2)?"/?q="+h+"&f="+b.f+"&t="+j.name:"/?q="+h+"&t="+j.name;var l={i18n:j.i18n(),name:j.name,url:c,isCurrent:k};j.target&&(l.target=j.target),j.id&&(l.id=j.id),d.push(l)}g++}return e||(d[f].isCurrent=!0),d},toggleMobileSidebar:function(a){hasClass($(".sidebar__mobile"),"sidebar__mobile--visible")?setTimeout(function(){Application.rootComponent.state.sideBar.hideMobileSidebar()},100):Application.rootComponent.state.sideBar.showMobileSidebar()},showMobileSidebar:function(){addClass($(".sidebar__mask"),"sidebar__mask--visible"),addClass($(".sidebar__mobile"),"sidebar__mobile--visible"),addClass($(".home__logo__container"),"home__logo__container--invisible"),addClass(document.body,"sidebar_opened"),$("html")[0].style.overflow="hidden",$("html")[0].style.height="100%",AppComponent.isNativeApp()&&"undefined"!=typeof QwantDrawerMobile&&QwantDrawerMobile.trigger(!0)},hideMobileSidebar:function(){removeClass($(".sidebar__mask"),"sidebar__mask--visible"),removeClass($(".sidebar__mobile"),"sidebar__mobile--visible"),removeClass($(".home__logo__container"),"home__logo__container--invisible"),removeClass(document.body,"sidebar_opened"),$("html")[0].style.overflow="auto",$("html")[0].style.height="auto",AppComponent.isNativeApp()&&"undefined"!=typeof QwantDrawerMobile&&QwantDrawerMobile.trigger(!1)},refresh:function(){this.setState(new State({menuItems:this.state.menuItems,current:this.current}))}}),CampaignLandingPageComponent=Class(Component,{constructor:function(a){this.name="campaign_landing_page",this.hideTemplate(),a&&a.restParams&&a.restParams.length>2&&(this.route=a,this.restParams=a.restParams,this.lang=a.restParams[1]),LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"display",
element:"campaign_landing_page_"+this.lang+"_"+this.restParams[2]}),LayoutComponent.registerBeforeAction(function(){$("body")[0].removeAttribute("style"),$(".wrapper")[0].removeAttribute("style"),$(".header")&&$(".header")[0]&&$(".header")[0].removeAttribute("style"),$(".side_bar")[0].removeAttribute("style"),$(".footer")[0].removeAttribute("style"),$(".alert")[0].removeAttribute("style")}),window.scrollTo(0),_super(this)},hideTemplate:function(){$("body")[0].style.background="none",$("body")[0].style.paddingLeft=0,$(".header")&&$(".header")[0]&&($(".header")[0].style.display="none"),$(".side_bar")[0].style.display="none",$(".alert")[0].style.display="none",$(".wrapper")[0].style.marginTop=0,$(".wrapper")[0].style.paddingBottom=0,$(".footer")[0].style.display="none"},initState:function(){return{mediaOverlay:new MediaOverlayComponent(this.route),restParams:this.restParams,lang:this.lang,data:{header:{title:{it:"Prova Qwant, <br />il motore di ricerca che rispetta<br /> la tua privacy",fr:"Qwant, <br>le moteur de recherche<br> qui respecte votre vie privée"},description:{it:"Creato e gestito in Europa, Qwant è il primo motore di ricerca che <br />protegge la libertà dei suoi utenti e garantisce che l’ecosistema digitale <br />rimanga sano. Le nostre parole chiave: <strong >privacy e neutralità</strong>",fr:"Conçu et basé en France, Qwant est le premier moteur de recherche<br> qui protège les libertés de ses utilisateurs et veille à préserver <br>l'écosystème numérique. Nos mots clés: <strong>vie privée et neutralité.</strong>"}},buttons:{try:{it:"Prova Qwant",fr:"Essayez Qwant"},install:{it:"Installa Qwant",fr:"Installer Qwant"},description:{it:"Scarica l’estensione per il tuo browser",fr:"Téléchargez l'extension pour votre navigateur"}},array:{title:{it:"Un motore di ricerca differente",fr:"Un moteur de recherche différent"},description:{it:"Non tentiamo di sapere chi sei o cosa fai quando utilizzi il nostro motore di ricerca.",fr:"Nous n'essayons pas de savoir qui vous êtes et ce que vous faites lorsque vous utilisez notre moteur de recherche."},head:[{it:"Attività di tracciamento",fr:"Suivi de l'activité"},{it:"Gli altri motori",fr:"Autres moteurs de recherche"}],rows:[{it:"RACCOLTA DATI PERSONALI",fr:"COLLECTE DE DONNÉES PERSONNELLES"},{it:"INSTALLAZIONE COOKIES",fr:"INSTALLATION DES COOKIES"},{it:"VENDITA INFORMAZIONI A TERZE PARTI",fr:"VENTE D'INFORMATIONS À DES TIERS"},{it:"SALVATAGGIO CRONOLOGIA",fr:"HISTORIQUE CONSERVÉ"}]},video:{it:{media:"https://www.youtube-nocookie.com/embed/Oz4KAIHEGgI",title:"Le tue ricerche, al sicuro.",description:"Crediamo che questa promessa sia essenziale, perché le domande che digiti ogni giorno rivelano molte cose su di te: opinioni politiche, tendenze sessuali, salute, interessi, stile e standard di vita…<br /><br /><strong>Chi raccoglie queste informazioni può usarle per farsi un’idea di chi tu sia, o per adattarvi le pubblicità.</strong>",type:"video",url:"https://www.youtube.com/watch?v=Oz4KAIHEGgI"},fr:{media:"https://www.youtube-nocookie.com/embed/Evahh1PXJIg",title:"Vos recherches sont en sécurité.",description:"Cette promesse est essentielle, car les questions que vous tapez tous les jours révèlent beaucoup de choses sur vous: opinions politiques, sexualité, santé, intérêts et niveau de vie...<br><br><strong> Ceux qui recueillent ces informations peuvent les utiliser pour se faire une opinion de vous ou pour vous cibler avec des publicités.</strong>",type:"video",url:"https://www.youtube.com/watch?v=Evahh1PXJIg"}},download:{title:{it:"Cerca pure, non sono affari nostri.",fr:"Vos recherches ne nous regardent pas."},description:{it:"Qwant fornisce i migliori risultati disponibili per le vostre ricerche e non cerca mai di individuare chi siate o che cosa facciate. Noi crediamo che quello che cercate sul Web sia una parte fondamentale della vostra privacy.<br /><br /><strong>Pertanto Qwant non registra mai le vostre ricerche e non usa mai i vostri dati personali per pubblicità o altri scopi commerciali.</strong>",fr:"Qwant fournit les meilleurs résultats possibles pour vos recherches et ne cherche jamais à vous identifier ou a savoir ce que vous faites. Nous croyons que vos recherches sur Internet est un élément fondamental de votre vie privée.<br /><br /><strong>Par conséquent, Qwant n'enregistre jamais vos recherches et n'utilise jamais vos données personnelles à des fins publicitaires ou commerciales.</strong>"}}}}},getCampaignClient:function(){return this.route.params.client||"default"},getExtensionLink:function(){var a=BrowserHelper.getBrowserUri();-1!==a.indexOf("firefox")?ExtensionHelper.oneclick.firefox():-1!==a.indexOf("chrome")?ExtensionHelper.oneclick.chrome():-1!==a.indexOf("safari")&&ExtensionHelper.oneclick.safari()}}),ExtensionPagesComponent=Class(Component,{constructor:function(a){switch(this.page=a.canonicalPath.split("/")[3],this.name="extensions",this.page){case"first-run":LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"extensionInstalled",type:"firefox",browser:BrowserHelper.getBrowserUri(),os:BrowserHelper.getOS()}),MetaHelper.changeTitle(_("Thanks for installing Qwant for Firefox!","title"));break;default:MetaHelper.changeTitle(_("About Qwant for Firefox!","title"))}this.hideTemplate(),LayoutComponent.registerBeforeAction(function(){$("body")[0].removeAttribute("style"),$(".header")&&$(".header")[0]&&$(".header")[0].removeAttribute("style"),$(".side_bar")[0].removeAttribute("style"),$(".wrapper")[0].removeAttribute("style")}),window.scrollTo(0),_super(this)},initState:function(){var a={header:{title:_("For Firefox","extension-page"),main_text:_("Seamlessly enable Qwant as the default search engine and activate Firefox Tracking Protection features. Keep track of all your preferred content and organize your favorite websites with Qwant Boards and Qwant Favorites.","extension-page"),login_text:_("Already have an account?","extension-page"),login_link_text:_("Log in","extension-page")},content:[{align:"right",class:"privacy",title:_("Easy Tracking Protection","extension-page"),text:_("Qwant is now Firefox default search engine. Qwant ensures that none of your search queries will leak out: this is just your own business. What's more? Firefox Tracking Protection and Do Not Track are also activated to better protect your privacy as you browse the Web.","extension-page"),button:{link:"/extension/tracking-protection",text:_("How does it work?","extension-page"),spa:!0}},{align:"left",class:"example",title:_("Qwant in one button","extension-page"),text:_("Qwant for Firefox has created a new button that allows for quick access to main features such as <b>Qwant Boards</b>, <b>Favorites</b>, <b>Firefox Tracking Protection</b> and Qwant account settings.","extension-page")},{align:"right",class:"features",title:_("Main features","extension-page"),text:_("In a few clicks, keep track of your preferred content by adding them to <b>Qwant Boards</b>. <b>Qwant Favorites</b> also lets you create a list of shortcuts to your favorite websites. And finally, you can easily activate or deactivate <b>Firefox Tracking Protection</b> features.","extension-page")}]};return"first-run"===this.page&&(a.jumbotron={text:_("Welcome to the <br>Qwant for Firefox extension","extension-page"),link:!0}),a},hideTemplate:function(){$("body")[0].style.background="none",$("body")[0].style.paddingLeft=0,$(".header")&&$(".header")[0]&&($(".header")[0].style.display="none"),$(".side_bar")[0].style.display="none",$(".wrapper")[0].style.marginTop=0},openExtension:function(){document.dispatchEvent(new CustomEvent("qwant_website_open_extension"))},openLink:function(a){page(a.link)}}),ExtensionFeedbackSurveyComponent=Class(Component,{constructor:function(a){this.name="feedback",this.version=a.params.v,this.feedbackModel=new FeedbackModel,this.isAlertClosed=!1,this.noHomePageSelected=!1,LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"webExtUninstall",type:BrowserHelper.getBrowserUri(),browser:BrowserHelper.getBrowserUri(),os:BrowserHelper.getOS(),context:this.version||"undefined"}),this.hideTemplate(),LayoutComponent.registerBeforeAction(function(){$("body")[0].removeAttribute("style"),$(".wrapper")[0].removeAttribute("style"),$(".header")&&$(".header")[0]&&$(".header")[0].removeAttribute("style"),$(".side_bar")[0].removeAttribute("style"),$(".footer")[0].removeAttribute("style")}),window.scrollTo(0),_super(this)},initState:function(){for(var a=["The search results should be better","The extension is not working properly","Don't worry I'll install Qwant again","I prefer to use another search engine","I'm not sure I can trust Qwant","I don't like Qwant's interface or graphics","I want my old homepage back"],b=[_("The search results should<br />be better","extension_feedback"),_("The extension is not<br />working properly","extension_feedback"),_("Don't worry I'll install<br />Qwant again","extension_feedback"),_("I prefer to use another<br />search engine","extension_feedback"),_("I'm not sure I can<br />trust Qwant","extension_feedback"),_("I don't like Qwant's interface<br />or graphics","extension_feedback"),_("I want my old<br />homepage back","extension_feedback")],c=[],d=a.length;c.length<d;)for(var e=Math.random(),f=1,g=10,h=0;h<d;h++){var i=parseInt(e*g-10*parseInt(e*f));a[i]&&-1===c.indexOf(i)&&c.push(i),f=g,g*=10}return{answersKeys:a,answersLabels:b,answersCount:d,indexes:c,alertTriggerIndex:6}},hideTemplate:function(){var a=$("body")[0];a.style.background="none",a.style.paddingLeft=0;var b=$(".wrapper")[0];b.style.paddingBottom=0,b.style.marginTop=0,$(".header")&&$(".header")[0]&&($(".header")[0].style.display="none"),$(".footer")[0].style.display="none",$(".side_bar")[0].style.display="none"},submitStepOne:function(){LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"userInteraction",type:"submit_feedback",context:"feedback",zone:"step_one",browser:BrowserHelper.getBrowserUri(),os:BrowserHelper.getOS()});for(var a=document.querySelectorAll("input[id^=feedback]"),b=[],c=0;c<a.length;c++)a[c].checked&&b.push(a[c].value);b.length>0&&this.feedbackModel.sendFeedback(1,b,this.version)},submitStepTwo:function(){LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"userInteraction",type:"submit_feedback",context:"feedback",zone:"step_two",browser:BrowserHelper.getBrowserUri(),os:BrowserHelper.getOS()});var a=[$i("feedback_other_f").value];""!==a[0]&&this.feedbackModel.sendFeedback(2,a,this.version),page("/"),AlertComponent.success(_("Your comments have been successfully sent to us! Thank you for your feedback.","extension_feedback"))},jumpFromStep1to2:function(){$i("step-one").style.display="none",$i("step-two").style.display="block"},otherClickListener:function(){$i("step-two").style.display&&"none"!==$i("step-two").style.display?($i("step-two").style.display="none",$(".submit-step-one")[0].style.display="inline",$(".other-label")[0].style.background="#F1F3F5",$(".other-label")[0].style.color="#575757"):($(".other-label")[0].style.background="#1F98F6",$(".other-label")[0].style.color="#FFF",$(".submit-step-one")[0].style.display="none",$i("step-two").style.display="block",window.scrollTo(document.body.scrollHeight))},submitFeedback:function(){$i("step-two").style.display&&"none"!==$i("step-two").style.display?$i("step-one").style.display&&"none"===$i("step-one").style.display?this.submitStepTwo():(this.submitStepOne(),this.submitStepTwo()):(this.submitStepOne(),this.jumpFromStep1to2())},closeAlertClickListener:function(){$(".light__ext__alert")[0].style.bottom="-150px",this.isAlertClosed=!0},noHomepageClickListener:function(){this.noHomePageSelected?($(".light__ext__alert")[0].style.bottom="-150px",$(".no-homepage-checkbox")[0].checked=!1,$(".no-homepage")[0].style.background="#F1F3F5",$(".no-homepage")[0].style.color="#575757",this.noHomePageSelected=!1):($(".no-homepage-checkbox")[0].checked=!0,$(".no-homepage")[0].style.background="#1F98F6",$(".no-homepage")[0].style.color="#FFF",this.noHomePageSelected=!0,$(".light__ext__alert")[0].style.bottom&&"-150px"!==$(".light__ext__alert")[0].style.bottom||this.isAlertClosed||($(".light__ext__alert")[0].style.bottom="0"))}}),ExtensionTrackingProtectionComponent=Class(Component,{constructor:function(a){this.name="tracking-protection",a.params.referer&&"F4Q"===a.params.referer?this.lastPage="/firefoxqwant/download":this.lastPage="/",this.hideTemplate(),LayoutComponent.registerBeforeAction(function(){$("body")[0].removeAttribute("style"),$(".side_bar")[0].removeAttribute("style"),$(".wrapper")[0].removeAttribute("style"),removeClass($("body")[0],"f4q__header_qwant--visible"),removeClass($(".header__user_icon-settings")[0],"icon-settings")}),window.scrollTo(0),_super(this)},onMount:function(){addClass($("body")[0],"f4q__header_qwant--visible")},initState:function(){return{content:[{align:"right",class:"tracking-protection-1",title:_("You are being tracked","extension-page"),text:_("A lot of the sites you visit implement activity tracking techniques which are meant to understand your preferences and intentions.<br/><br/>The tracked data is mostly sold to and used by advertisers.","extension-page")},{align:"left",class:"tracking-protection-2",title:_("Protecting yourself","extension-page"),text:_("First of all, everything you search with Qwant remains strictly private: this is your own business. No tracking here !</br><br/>But to protect you even further, you can turn on the Firefox Tracking Protection and Do Not Track features <b>for every site you visit</b>.<br/><br/>The Qwant extension lets you do this very easily : <b>just click on the Qwant button and activate Firefox Tracking Protection.</b><br/><br/>You can learn more about Firefox Tracking Protection features by reading the <a href='{link}' {target}>Private Browsing with Tracking Protection</a> documentation pages on the Mozilla website.","extension-page",{link:FirefoxHelper.getFirefoxTpLink(),target:SecurityHelper.targetBlank()})},{align:"right",class:"tracking-protection-3",title:_("Turning off Firefox Tracking Protection","extension-page"),text:_("The Qwant extension lets you easily turn off Firefox Tracking Protection entirely by clicking the Qwant icon and deactivating Firefox Tracking Protection.<br/><br/>In addition, Firefox lets you turn off Tracking Protection for a single site by simply clicking on the Control Center (the shield) button.","extension-page")}]}},hideTemplate:function(){$("body")[0].style.background="none",$("body")[0].style.paddingLeft=0,$(".side_bar")[0].style.display="none",$(".wrapper")[0].style.marginTop=0}}),ExtensionThanksComponent=Class(Component,{constructor:function(){this.name="extension_thanks",addClass(document.body,"ext_thx"),LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"extensionInstalled",type:"others",browser:BrowserHelper.getBrowserUri(),os:BrowserHelper.getOS()}),this.hideTemplate();LayoutComponent.registerBeforeAction(function(){removeClass(document.body,"ext_thx"),$(".side_bar")[0].removeAttribute("style")}),window.scrollTo(0),_super(this)},hideTemplate:function(){$(".side_bar")[0].style.display="none"},initState:function(){return{elements:[{title:_("Qwant by default for all your queries","ext_thanks"),content:_("The Qwant extension allows you to easily install Qwant as your default search engine and open it at the start of your browser.","ext_thanks"),picture:"embedding"},{title:_("Available on most popular browsers","ext_thanks"),content:_('Enjoy the Qwant extension on most browsers! <a target="_blank" href="https://help.qwant.com/help/qwant-search/add-qwant-on-desktop/firefox/#extension">Mozilla Firefox</a>, <a target="_blank" href="https://help.qwant.com/help/qwant-search/add-qwant-on-desktop/on-chrome/#extension">Google Chrome</a>, <a target="_blank" href="https://help.qwant.com/help/qwant-search/add-qwant-on-desktop/on-opera/#extension">Opera</a> and <a target="_blank" href="https://help.qwant.com/help/qwant-search/add-qwant-on-desktop/on-safari/#extension">Safari</a> now allow you to install it easily.',"ext_thanks"),picture:"crossbrowser"},{title:_("Thousands of satisfied users","ext_thanks"),content:_("Many are using it and they love it. With already more than 500,000 downloads, the Qwant extension make users happy. Just try to adopt it!","ext_thanks"),picture:"users"}]}}}),FirefoxForQwantComponent=Class(Component,{constructor:function(a){if("ff_firstrun"===a.path)this.browserFirstRun();else if(BrowserHelper.isTabletOrMobile){var b=BrowserHelper.getOS();"ios"===b.toLowerCase()||"android"===b.toLowerCase()?this.name="f4q_"+a.canonicalPath.split("/")[2]+"_mobile":(page("/"),window.location.reload())}else this.name="f4q_"+a.canonicalPath.split("/")[2],this.getDownloadLinks();this.hideTemplate();var c=this;LayoutComponent.registerBeforeAction(function(){$("body")[0].removeAttribute("style"),"f4q_download"===c.name&&"f4q_download_mobile"===c.name||$(".header")[0].removeAttribute("style"),$(".side_bar")[0].removeAttribute("style"),$(".wrapper")[0].removeAttribute("style"),"f4q_download"===c.name&&(removeClass($("body")[0],"f4q__header_qwant--visible"),removeClass($(".header__user_icon-settings")[0],"icon-settings"),$(".header__add-qwant")[0].removeAttribute("style"))}),window.scrollTo(0),_super(this),LayoutComponent.registerComponent(this)},onMount:function(){"f4q_download"===this.name&&addClass($("body")[0],"f4q__header_qwant--visible")},notify:function(){$(".header__add-qwant")[0].style.display="none"},initState:function(){return this.state={content:BrowserHelper.isTabletOrMobile?this.getMobileContent():this.getDesktopContent()},"f4q_firstrun"===this.name&&(this.state.jumbotron={text:_("Welcome to Firefox for Qwant!","extension-page"),link:!1}),this.state.tpSwitchEnabled=_("Deactivate Firefox Tracking Protection and Do Not Track.","qwant_for_firefox"),this.state.tpSwitchDisabled=_("Activate Firefox Tracking Protection and Do Not Track.","qwant_for_firefox"),"f4q_download"===this.name&&(this.state.download=this.downloadInfo()),"f4q_download_mobile"===this.name&&(this.state.download=this.mobileDownloadInfo()),this.state},hideTemplate:function(){$("body")[0].style.background="none",$("body")[0].style.paddingLeft=0,"f4q_download"!==this.name&&($(".header")[0].style.display="none"),$(".side_bar")[0].style.display="none",$(".wrapper")[0].style.marginTop=0,$(".header__add-qwant")[0].style.display="none"},openLink:function(a){page(a.link)},getDownloadLinks:function(){var a=applicationState.user.getSettings().getSearchRegionCode(),b="en_US";constants.regionToFirefoxConversion[a]&&(b=constants.regionToFirefoxConversion[a]);var c=this;AjaxManager.get(ajax.downloadLinks()).then(function(a,d){if(!a)for(var e in d){for(var f in d[e]){for(var g in d[e][f])g===b&&(c.links=d[e][f][g],c.state.download=c.downloadInfo(),c.setState(c.state));break}break}})},downloadInfo:function(){var a=applicationState.user.getSettings().getSearchRegionCode(),b="en_US";constants.regionToFirefoxConversion[a]&&(b=constants.regionToFirefoxConversion[a]);var c={locale:b,is64:this.is64()};return-1!==navigator.appVersion.indexOf("Win")&&(c.icon="windows",c.os="win",c.name="Windows",c.extension="exe",this.links&&(c.links=[],this.links.win32&&c.links.push(this.links.win32),this.links.win64&&c.links.push(this.links.win64))),-1!==navigator.appVersion.indexOf("Mac")&&(c.icon="apple",c.os="macos",c.name="Mac OS",c.extension="dmg",this.links&&(c.links=[],this.links.osx&&c.links.push(this.links.osx))),-1===navigator.appVersion.indexOf("X11")&&-1===navigator.appVersion.indexOf("Linux")||(c.icon="linux",c.os="linux",c.name="Linux",c.extension="tar",this.links&&(c.links=[],this.links.linux32&&c.links.push(this.links.linux32),this.links.linux64&&c.links.push(this.links.linux64))),c},mobileDownloadInfo:function(){var a={ios:{name:"iOS",button_image:"img/buttons_mobile/btn-appstore.jpg",button_link:"https://itunes.apple.com/fr/app/apple-store/id989804926?mt=8"},android:{name:"Android",button_image:"img/buttons_mobile/btn-googleplay.jpg",button_link:"https://play.google.com/store/apps/details?id=org.mozilla.firefox"}};try{var b="iPhone"===Dispatcher.getUrlParameter("bd").split("_")[0]?"ios":Dispatcher.getUrlParameter("bd").split("_")[0].toLowerCase()}catch(a){b=BrowserHelper.getOS().toLowerCase()}return a[b]},scroll:function(){smoothScrollTo(window.innerHeight)},browserFirstRun:function(){this.name="f4q_firstrun",this.tpSwitch=!1;var a=this;document.dispatchEvent(new CustomEvent("qwant_website_is_tp_enabled")),document.addEventListener("qwant_extension_tp_enabled",function(){a.state.tpSwitch=!0,a.setState(a.state)}),document.addEventListener("qwant_extension_tp_disabled",function(){a.state.tpSwitch=!1,a.setState(a.state)})},toggleTrackingProtection:function(){var a=$(".f4q__switch__input")[0];!1===a.checked?a.checked=!0:a.checked=!1,document.dispatchEvent(new CustomEvent("qwant_website_tp_"+(a.checked?"on":"off"))),!1===a.checked?this.state.tpSwitch=!1:this.state.tpSwitch=!0,this.setState(this.state)},displayTPTutorial:function(){addClass($(".f4q__header__tp__container")[0],"f4q__header__tp__container--display"),setTimeout(function(){addClass($(".f4q__header__tp__close")[0],"f4q__header__tp__close--display")},300)},hideTPTutorial:function(){removeClass($(".f4q__header__tp__close")[0],"f4q__header__tp__close--display"),setTimeout(function(){removeClass($(".f4q__header__tp__container")[0],"f4q__header__tp__container--display")},150)},getDesktopContent:function(){return[{align:"right",class:"privacy",title:_("Easy Tracking Protection","extension-page"),text:_("Qwant is the default search engine for this version of Firefox. Qwant ensures that none of your search queries will leak out: this is just your own business.<br><br>Firefox for Qwant can enable <b>Firefox Tracking Protection</b> and <b>Do Not Track</b> to secure your privacy as you browse the Web.","extension-page"),button:{link:"/extension/tracking-protection?referer=F4Q",text:_("How does it work?","extension-page"),spa:!1}},{align:"left",class:"example",title:_("Qwant in one button","extension-page"),text:_("Qwant for Firefox has created a new button that allows for quick access to main features such as <b>Qwant Boards</b>, <b>Favorites</b>, <b>Firefox Tracking Protection</b> and Qwant account settings.","extension-page")},{align:"right",class:"features",title:_("Main features","extension-page"),text:_("In a few clicks, keep track of your preferred content by adding them to <b>Qwant Boards</b>. <b>Qwant Favorites</b> also lets you create a list of shortcuts to your favorite websites. And finally, you can easily activate or deactivate <b>Firefox Tracking Protection</b> features.","extension-page")}]},getMobileContent:function(){var a=this.mobileDownloadInfo();return{steps:[{title:_("Download Firefox","application-page"),image:{src:a.button_image,link:a.button_link}},{title:_("Add Qwant as your default search engine","application-page"),image:{src:"img/firefoxqwant/install_mobile_1.png"},paragraphs:[_('Once installed on your mobile, go to the web page: <a href="{searchUrl}" target="_blank"><span class="f4q_paragraph_emphasis">www.qwant.com</span></a>',"application-page",{searchUrl:"/"}),_("Tap and hold the Qwant search bar, then press on the magnifying glass on the upper right corner.","application-page"),_('Type "Qwant" in the text field and tap on OK.',"application-page")]},{image:{src:"img/firefoxqwant/install_mobile_2.png"},paragraphs:[_('Go to the "Settings" of the app by tapping on the three points on the upper right corner.',"application-page"),_('Tap on "Customize", then on "Search".',"application-page"),_('Select Qwant and tap "Define by default".',"application-page")]},{image:{src:"img/firefoxqwant/install_mobile_3.png"},paragraphs:[_("Qwant is now the default search engine of your phone.","application-page"),_('<span class="f4q_paragraph_emphasis">Congratulations !</span> You are now protected against tracking.',"application-page")]}]}},is64:function(){var a=["x86_64","x86-64","Win64","x64;","amd64","AMD64","WOW64","x64_64"],b=!1;return a.forEach(function(a){if(-1!=navigator.userAgent.indexOf(a))return void(b=!0)}),b}}),FirefoxForQwantOthersComponent=Class(Component,{constructor:function(a){a.path.indexOf("esr")>-1?(this.name="f4q_download_esr",this.jsonPath=ajax.downloadLinksEsr()):(this.name="f4q_download_others",this.jsonPath=ajax.downloadLinks()),a.params.referer&&"F4Q"===a.params.referer?this.lastPage="/firefoxqwant/download":this.lastPage="/",this.hideTemplate(),LayoutComponent.registerBeforeAction(function(){$("body")[0].removeAttribute("style"),$(".side_bar")[0].removeAttribute("style"),$(".wrapper")[0].removeAttribute("style"),removeClass($("body")[0],"f4q__header_qwant--visible"),removeClass($(".header__user_icon-settings")[0],"icon-settings")}),this.getDownloadLinks(),window.scrollTo(0),_super(this)},onMount:function(){addClass($("body")[0],"f4q__header_qwant--visible")},initState:function(){return this.state={data:constants.firefoxForQwant,currentVersion:Object.keys(constants.firefoxForQwant.versions)[0].key,currentLanguage:constants.interfaceToFirefoxConversion[applicationState.user.getSettings().getInterfaceLanguageCode()]||"en_US"},-1!==navigator.appVersion.indexOf("Win")?(this.state.currentOs="Windows (32bits)",this.state.currentOsCode="win32"):-1!==navigator.appVersion.indexOf("Mac")?(this.state.currentOs="Mac OSX",this.state.currentOsCode="osx"):-1===navigator.appVersion.indexOf("X11")&&-1===navigator.appVersion.indexOf("Linux")||(this.state.currentOs="Linux (32bits)",this.state.currentOsCode="linux32"),this.state},getDownloadLinks:function(){var a=this;AjaxManager.get(this.jsonPath).then(function(b,c){if(!b){a.state.data.versions=c,a.state.data.versionsDropdown=a.getVersions(c),a.state.currentVersion=a.state.data.versionsDropdown[0].key,a.buildLanguageDropdown(),a.buildOsDropdown();for(var d in a.state.data.versions[a.state.currentVersion]){a.state.data.versions[a.state.currentVersion][d][a.state.currentLanguage]||(a.state.currentLanguage="en_US",a.buildOsDropdown()),a.state.downloadUrl=a.state.data.versions[a.state.currentVersion][d][a.state.currentLanguage][a.state.currentOsCode];break}a.setState(a.state)}})},getVersions:function(a){var b=[];for(var c in a){var d={};d.key=c,d.value=c,d.label=c,b.push(d)}return b.sort(function(a,b){return b.key.localeCompare(a.key)}),b},buildLanguageDropdown:function(){for(var a in this.state.data.versions[this.state.currentVersion]){this.state.data.languageDropdown=this.getVersions(this.state.data.versions[this.state.currentVersion][a]);for(var b=0;b<this.state.data.languageDropdown.length;b++)this.state.data.languageDropdown[b].label=this.getLanguage(this.state.data.languageDropdown[b].label);this.state.data.languageDropdown.sort(function(a,b){return a.label.localeCompare(b.label)});break}},buildOsDropdown:function(){for(var a in this.state.data.versions[this.state.currentVersion]){this.state.data.osDropdown=this.getVersions(this.state.data.versions[this.state.currentVersion][a][this.state.currentLanguage]);for(var b=0;b<this.state.data.osDropdown.length;b++)this.state.data.osDropdown[b].label=this.getOs(this.state.data.osDropdown[b].label);this.state.data.osDropdown.sort(function(a,b){return a.label.localeCompare(b.label)});break}},updateCurrentLanguage:function(a){var b="en_US";for(var c in this.state.data.versions[this.state.currentVersion]){for(var d in this.state.data.versions[this.state.currentVersion][c])d==a&&(b=d);break}this.state.currentLanguage=b,this.buildOsDropdown(),this.getLatestVersion()},updateCurrentOs:function(a){this.state.currentOs=this.getOs(a),this.state.currentOsCode=a,this.getLatestVersion()},getLatestVersion:function(){for(var a in this.state.data.versions[this.state.data.versionsDropdown[0].value]){if(this.state.data.versions[this.state.data.versionsDropdown[0].value][a][this.state.currentLanguage]&&this.state.data.versions[this.state.data.versionsDropdown[0].value][a][this.state.currentLanguage][this.state.currentOsCode])return this.state.downloadUrl=this.state.data.versions[this.state.data.versionsDropdown[0].value][a][this.state.currentLanguage][this.state.currentOsCode],this.setState(this.state),!0;break}return!1},getOsIcon:function(a){var b="";switch(a){case"osx":case"Mac OSX":b="apple";break;case"win64":case"win32":case"Windows (32bits)":b="windows";break;case"linux64":case"linux32":case"Linux (32bits)":b="linux";break;default:b=""}return b},getOs:function(a){for(var b=0;b<constants.firefoxForQwant.oses.length;b++)if(constants.firefoxForQwant.oses[b].id===a)return constants.firefoxForQwant.oses[b].name;return a},getLanguage:function(a){a=a.replace("-","_");for(var b=0;b<constants.firefoxForQwant.languages.length;b++)if(constants.firefoxForQwant.languages[b].code===a)return constants.firefoxForQwant.languages[b].i18n();return a},getVersionsArray:function(a){var b=[];for(var c in this.state.data.versions[this.state.currentVersion][a]){var d={};d.key=c,d.i18n=this.getLanguage(c),b.push(d)}return b.sort(function(a,b){return a.i18n.localeCompare(b.i18n)}),b},hideTemplate:function(){$("body")[0].style.background="none",$("body")[0].style.paddingLeft=0,$(".side_bar")[0].style.display="none",$(".wrapper")[0].style.marginTop=0}}),LandingPageComponent=Class(Component,{constructor:function(a){!a.pathname||"/bienvenue"!==a.pathname&&"/bienvenue/"!==a.pathname?this.name="landing_page":this.name="welcome_page",this.version="DE",this.os=BrowserHelper.getOS(),this.browserUri=BrowserHelper.getBrowserUri(),this.route=a,!a.pathname||"/firefox"!==a.pathname&&"/firefox/"!==a.pathname||(this.version="firefox"),this.hideTemplate(),addClass(document.body,"scroll_on_landing_page"),LayoutComponent.registerBeforeAction(function(){removeClass(document.body,"scroll_on_landing_page")}),LayoutComponent.registerBeforeAction(function(){$("body")[0].removeAttribute("style"),$(".wrapper")[0].removeAttribute("style"),$(".header")[0].removeAttribute("style"),$(".side_bar")[0].removeAttribute("style"),$(".footer")[0].removeAttribute("style")}),window.scrollTo(0),_super(this)},hideTemplate:function(){var a=$("body")[0];a.style.background="none";var b=$(".wrapper")[0];b.style.paddingBottom=0,b.style.marginTop=0,$(".header")[0].style.display="none",$(".footer")[0].style.display="none",this.route.pathname&&"/bienvenue"!==this.route.pathname&&"/bienvenue/"!==this.route.pathname&&(a.style.paddingLeft=0,$(".side_bar")[0].style.display="none")},openExtensionOverlay:function(a){a=a||{},LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"homepage",t:"all",position:a.position,type:"landing_page_install_qwant"}),"iOS"===this.os?window.location.href="https://itunes.apple.com/de/app/qwant/id924470452?mt=8":"Android"===this.os?window.location.href="https://play.google.com/store/apps/details?id=com.qwant.liberty&hl=de":"opera"===this.browserUri||"chrome"===this.browserUri&&"windows"!==this.os?window.location.href="/add-qwant?ua&action=AsDefault":"safari"===this.browserUri?(window.location.href="https://www.qwant.com/qwant-safari.safariextz",ExtensionOverlayHelper.openBrowserOverlay("safari")):"firefox"===this.browserUri?(window.location.href="https://addons.mozilla.org/firefox/downloads/latest/qwantcom-for-firefox/platform:2/addon-544242-latest.xpi?src=dp-btn-primary",ExtensionOverlayHelper.openBrowserOverlay("firefox")):"chrome"===this.browserUri&&"windows"===this.os&&(ExtensionOverlayHelper.openBrowserOverlay("chrome"),chrome.webstore.install("https://chrome.google.com/webstore/detail/hnlkiofnhhoahaiimdicppgemmmomijo",function(){ExtensionOverlayHelper.closeBrowserOverlay({browser:"chrome"})},function(){ExtensionOverlayHelper.closeBrowserOverlay({browser:"chrome"})}))}}),LibertyPopupComponent=Class(Component,{$statics:{stepNumber:4},constructor:function(a){this.route=a,this.name="liberty_popup",this.delay=0,window.scrollTo(0),addClass(document.body,"lock_scroll"),_super(this)},selectStep:function(a){
for(var b=0;b<=LibertyPopupComponent.stepNumber;b++)b===a.index?document.getElementById("qwant-oldapp__popup-step"+b).style.display="block":document.getElementById("qwant-oldapp__popup-step"+b).style.display="none"},selectDelay:function(a){this.delay=a.delay,removeClass(document.getElementsByClassName("qwant-oldapp__popup-choice--active")[0],"qwant-oldapp__popup-choice--active"),addClass(document.getElementsByClassName("qwant-oldapp__popup-choice")[this.delay],"qwant-oldapp__popup-choice--active")},popupDelay:function(){try{if(3===this.delay)localStorage.setItem("OldAppPopupDelay",!0);else{var a=new Date;switch(this.delay){case 0:a.setDate(a.getDate()+1);break;case 1:a.setDate(a.getDate()+7);break;case 2:a.setDate(a.getDate()+30)}localStorage.setItem("OldAppPopupDelay",Date.parse(a))}document.getElementById("qwant-oldapp__popup-delayString").innerHTML=this.getDelay(),LinkHelper.logHandler(this,Event,{AjaxRoute:"userInteraction",event:"click",zone:"libertyPopup",element:"step_3_"+this.delay})}catch(a){l.error("local storage is not available")}this.selectStep({index:4})},getDelay:function(){var a="";switch(this.delay){case 0:a=_("tomorrow","popupLiberty");break;case 1:a=_("in 7 days","popupLiberty");break;case 2:a=_("in a month","popupLiberty");break;case 3:return _('We will <b class="qwant-oldapp__popup-blue">never</b> remind you to update Qwant Mobile.',"popupLiberty")}return _("We will remind you to update Qwant Mobile {date}","popupLiberty",{date:'<b class="qwant-oldapp__popup-blue">'+a+"."})}}),LiveStreamPageComponent=Class(Component,{constructor:function(a,b){this.name="livestream_page",this.enablePreroll=b.enablePreroll||!1,this.adContainerID="rmp-player",this.adVast=b.adsFlux||"https://ads.stickyadstv.com/www/delivery/swfIndex.php?reqType=AdsSetup&protocolVersion=2.0&zoneId=6193889",this.channelId=b.channelId||"oDguYK8Be2FexFO",this.placeholder=b.placeholder||"/img/player/placeholder.jpg",this.kmv_params=b.kmv_params||{},a&&(this.route=a),window.scrollTo(0),_super(this)},initState:function(){var a=this;!function(b){var c=a.loadLibrary("vast");c.onload=c.onreadystatechange=function(){if(c.readyState&&"loaded"!==c.readyState&&"complete"!==c.readyState||!0!==a.enablePreroll)a.startLive();else{var b=new RmpVast(a.adContainerID);b.loadAds(a.adVast);var d=document.getElementById(a.adContainerID);document.body.onfocus=function(){b.getAdPaused()&&b.play()},d.addEventListener("adcomplete",function(){a.startLive()}),d.addEventListener("adskipped",function(){a.startLive()}),d.addEventListener("aderror",function(){a.startLive()}),d.addEventListener("adclosed",function(){a.startLive()}),d.addEventListener("addestroyed",function(){a.startLive()})}}}(document)},loadLibrary:function(a){var b="kmv_player";"vast"===a&&(b="rmp-vast.min");var c=document.createElement("script"),d=document.getElementsByTagName("script")[0];return c.src="/js/partners/"+b+".js?1539938515",d.parentNode.insertBefore(c,d),c},startLive:function(){var a=document.getElementById(this.adContainerID+"_container");a&&(a.style.display="none");var b=this.loadLibrary("kmv"),c=this;b.onload=b.onreadystatechange=function(){b.readyState&&"loaded"!==b.readyState&&"complete"!==b.readyState||(c.kmv_params||(c.kmv_params={}),KMV.init({userId:c.channelId,innerMode:!c.kmv_params.innerMode||c.kmv_params.innerMode,noComments:!c.kmv_params.noComments||c.kmv_params.noComments,noErrorMsg:!c.kmv_params.noErrorMsg||c.kmv_params.noErrorMsg,noSocial:!c.kmv_params.noSocial||c.kmv_params.noSocial,interruptLive:!!c.kmv_params.interruptLive&&c.kmv_params.interruptLive,embedMode:!!c.kmv_params.embedMode&&c.kmv_params.embedMode,noFullscreen:!!c.kmv_params.noFullscreen&&c.kmv_params.noFullscreen,corpIcons:!!c.kmv_params.corpIcons&&c.kmv_params.corpIcons}),b.onload=b.onreadystatechange=null,$i("kmv_video-container_ratio").style.background="url("+c.placeholder+") no-repeat top center",$i("kmv_video-container_ratio").style.backgroundSize="contain","iOS"===BrowserHelper.getOS()&&($(".media_overlay--visible")[0].style.left="0",$i("kmv_fullscreen").addEventListener("click",function(){$(".vdocontain")[0]?$(".media_overlay--visible")[0].style.left="auto":$(".media_overlay--visible")[0].style.left="0"})))}}}),SwitchToQwantComponent=Class(Component,{constructor:function(a){this.route=a,this.name="switch_to_qwant",addClass(document.body,"scroll_on_homepage"),LayoutComponent.registerBeforeAction(function(){removeClass(document.body,"scroll_on_homepage")}),FloatingButtonHelper.hideButtons(),this.hideTemplate(),Application.rootComponent.state.sideBar.changeSearch({item:QwantHomepageComponent.currentHomepage.name,changePage:!1}),LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"display",element:"landing_switch_to_qwant_got"}),MetaHelper.set([{property:"twitter:image:src",content:"https://www.qwant.com/img/switch_to_qwant/META_switch.png?1539938515"},{property:"og:image",content:"https://www.qwant.com/img/switch_to_qwant/META_switch.png?1539938515"}]),window.scrollTo(0),_super(this)},hideTemplate:function(){var a=$(".header")[0],b=$(".header__add-qwant")[0];a&&(a.style.display="none"),b&&(b.style.display="none")},initState:function(){return{bannerUp:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,1],bannerDown:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,1,2]}},send:function(){var a=[];$i("#SwitchToQwant").checked&&a.push("switch"),$i("API Site Search").checked&&a.push("api"),$i("Formation").checked&&a.push("formation"),$i("Qwant Ads").checked&&a.push("ads");var b=$i("name").value,c=$i("email").value,d=$i("company").value,e=$i("switch_to_qwant__submit"),f=$i("form_valid");return e.disabled=!0,e.value="...",f.style.display="none",AjaxManager.post(ajax.switchtoqwant(),new AjaxParameters({locale:applicationState.user.getSettings().getInterfaceLanguage().code||"",interested_in:a,name:b,email:c,company:d}).getParameters()).then(function(a,b){a?AlertComponent.error(_("An error has occurred","alert")):"error"===b.status&&b.error?AlertComponent.error(_("An error has occurred","alert")):(e.style.display="none",f.style.display="block")})},openPopup:function(){var a="https://twitter.com/share?url=https://www.qwant.com/switchtoqwant?l="+applicationState.user.userSetting.getInterfaceLanguage().shorthand+"&text="+_("A wall that trackers won't be able to cross. Choose Qwant, the search engine that protects your personal data.","switch_to_qwant")+" %23SwitchToQwant";return window.open(a,"qwant.com","height=600,width=800"),!1}}),WelcomePageComponent=Class(Component,{constructor:function(a){this.route=a,this.name="welcome_page",addClass(document.body,"scroll_on_homepage"),LayoutComponent.registerBeforeAction(function(){removeClass(document.body,"scroll_on_homepage")}),FloatingButtonHelper.hideButtons(),Application.rootComponent.state.sideBar.changeSearch({item:QwantHomepageComponent.currentHomepage.name,changePage:!1}),LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"display",element:"landing_tv"}),window.scrollTo(0),_super(this)},initState:function(){return{appLocales:["fr","en","de","it","es","pt"]}},openPopup:function(a){var b=null;if(a.network&&("twitter"===a.network?b="https://twitter.com/share?url=https://www.qwant.com/tv?l="+applicationState.user.userSetting.getInterfaceLanguage().shorthand+"&amp;text="+_("Why allowing from a <b>search engine</b> something you won't in real life?","welcome_page").replace("<b>","").replace("</b>","")+"&amp;hashtags=switchToQwant":"facebook"===a.network&&(b="http://www.facebook.com/sharer.php?u=https://www.qwant.com/tv?l="+applicationState.user.userSetting.getInterfaceLanguage().shorthand),null!==b))return window.open(b,"qwant.com","height=600,width=800"),!1}}),SurveyComponent=Class(Component,{constructor:function(a){this.name="survey",this.route=a,this.model=new SurveyModel,this.hideTemplate(),LayoutComponent.registerBeforeAction(function(){$("body")[0].removeAttribute("style"),void 0!==$(".wrapper")[0]&&$(".wrapper")[0].removeAttribute("style"),void 0!==$(".header")[0]&&$(".header")[0].removeAttribute("style"),void 0!==$(".side_bar")[0]&&$(".side_bar")[0].removeAttribute("style"),void 0!==$(".footer")[0]&&$(".footer")[0].removeAttribute("style")}),this.getSurvey(),window.scrollTo(0),_super(this)},initState:function(){return{survey:null}},getSurvey:function(){var a=null;if(this.route&&this.route.restParams&&this.route.restParams instanceof Array){var b=JSON.parse(localStorage.getItem("ansSurvey"));if(null===b||b instanceof Array&&-1===b.indexOf(this.route.restParams[0])){a=this.route.restParams.length>0?this.model.getSurvey(this.route.restParams[0]):null;var c=this;null!==a&&a.then(function(a,b){if(!a&&"success"===b.status&&b.data&&b.data.survey){if(c.survey=b.data.survey,BrowserHelper.deviceType()===c.survey.device&&-1!==applicationState.user.userSetting.getLocalisedSearchRegionCode().toLowerCase().indexOf(c.survey.locale.toLowerCase().replace("*",""))&&-1!==c.survey.test_group.split(",").indexOf(String(testGroupPer))){LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"display",element:"survey_page_"+c.route.restParams[0]});var d=c.state;d.step=0,d.survey=c.survey,c.setState(d),c.compare()}}else window.location.href="/"})}}null===a&&(window.location.href="/")},hideTemplate:function(){var a=$("body")[0];a.style.background="none",a.style.paddingLeft=0;var b=$(".wrapper")[0];b.style.paddingBottom=0,b.style.marginTop=0,void 0!==$(".header")[0]&&($(".header")[0].style.display="none"),void 0!==$(".footer")[0]&&($(".footer")[0].style.display="none"),void 0!==$(".side_bar")[0]&&($(".side_bar")[0].style.display="none")},submitFeedback:function(a){var b=this.survey&&this.survey.questions&&this.survey.questions[a]?this.survey.questions[a].id:null;if(null!==b){for(var c=document.querySelectorAll("input[id^=feedback_"+b+"],textarea[id^=feedback_"+b+"]"),d=[],e=0;e<c.length;e++)("open"!==this.survey.questions[a].answer_type&&c[e].checked||"open"===this.survey.questions[a].answer_type&&""!==c[e].value)&&d.push(c[e].value);return"sus"===this.survey.questions[a].answer_type&&10===d.length||"sus"!==this.survey.questions[a].answer_type&&d.length>0?(this.model.sendFeedback(b,d),!0):1!=this.survey.questions[a].required}return!1},submitForm:function(){AlertComponent.clearAll();var a=!1,b=!1,c=null,d=!1;if(this.survey&&this.survey.questions&&this.survey.questions instanceof Object)for(var e in this.survey.questions)a=b,d=!this.submitFeedback(e),b=b||d,a!==b&&(c=this.survey.questions[e].id),document.querySelectorAll("#step_q_"+this.survey.questions[e].id+" > h3")[0].className=d?"required":"";if(b)AlertComponent.error(_("Please answer all required questions.","survey")),document.location.href="/survey/"+this.survey.id+"#step_q_"+c;else{var f=this.state;this.state.finished=!0,this.setState(f),this.timeout=setTimeout(this.goBackToSearch,8e3);var g=JSON.parse(localStorage.getItem("ansSurvey"));g instanceof Array?g.push(this.survey.id):g=[this.survey.id],localStorage.setItem("ansSurvey",JSON.stringify(g)),LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"userInteraction",event:"submit",zone:"survey_page",item:this.survey.id})}},compare:function(){document.body.setAttribute("data-toreach",0),this.toCompare=document.getElementsByClassName("ab_compare"),this.compareOffsets=[];for(var a=0;a<this.toCompare.length;a++){var b=this.toCompare[a].getElementsByTagName("div");b[0].className="beforeComp",b[1].className="afterComp",b=[document.getElementsByClassName("beforeComp")[0],document.getElementsByClassName("afterComp")[0]];var c=b[0].getAttribute("data-src"),d=b[0].getAttribute("data-label");b[0].innerHTML="",b[0].title=_("Click to zoom!","survey"),function(a,c){b[0].onclick=function(){c.openOverlay(a)}}(c,this);var e=document.createElement("div");e.className="headerComp",e.innerHTML='<span class="textComp">'+d+"</span>";var f=document.createElement("div");f.className="contentComp",f.style.backgroundImage="url("+c+")",b[0].appendChild(e),b[0].appendChild(f);var g=b[1].getAttribute("data-src"),h=b[1].getAttribute("data-label");b[1].innerHTML="",b[1].title=_("Click to zoom!","survey"),function(a,c){b[1].onclick=function(){c.openOverlay(a)}}(g,this);var i=document.createElement("div");i.className="headerComp",i.innerHTML='<span class="textComp">'+h+"</span>";var j=document.createElement("div");j.className="contentComp",j.style.backgroundImage="url("+g+")",b[1].appendChild(i),b[1].appendChild(j),this.toCompare[a].className+=" no-select",function(a,b){var c=new Image;c.onload=function(){var b=parseInt(this.height/this.width*(a.clientWidth-56))+60;a.style.height=String(b)+"px"},c.src=b}(this.toCompare[a],c);var k=document.createElement("nav");k.className="joystick",k.innerHTML='<span class="icon icon-nav-selector-icon-small"></span><span class="icon icon-nav-selector-icon-small-reverse"></span>',k.title=_("Drag me!","survey"),k.onmousedown=function(a){this.setAttribute("data-dragged",!0),this.setAttribute("data-mousex",a.layerX)},this.toCompare[a].onmousemove=function(a){var b=this.getElementsByClassName("joystick")[0];if(b.hasAttribute("data-dragged")&&b.hasAttribute("data-mousex")){var c=this.clientWidth,d=parseInt(b.getAttribute("data-mousex")),e=a.pageX-parseInt((document.body.clientWidth-c)/2),f=[document.getElementsByClassName("beforeComp")[0],document.getElementsByClassName("afterComp")[0]],g=parseInt(e+(20-d)-4);g>=0&&g<=842&&(f[0].style.width=String(g)+"px",f[1].style.width=String(c-g-6)+"px",b.style.left=String(e-d-1)+"px")}},this.toCompare[a].appendChild(k),this.toCompare[a].onmouseup=function(a){this.getElementsByClassName("joystick")[0].removeAttribute("data-dragged")};var l=this.toCompare[a].offsetTop+this.toCompare[a].clientHeight;this.compareOffsets.push([a,l])}this.compareOffsets=this.compareOffsets.sort(function(a,b){return b[1]<=a[1]}),function(a){document.body.onscroll=function(){var b=parseInt(document.body.getAttribute("data-toreach"));if(a.compareOffsets.length>b&&window.scrollY+window.innerHeight>=a.compareOffsets[b][1]){document.body.setAttribute("data-toreach",b+1);var c=a.toCompare[a.compareOffsets[b][0]].childNodes;c[0].removeAttribute("style"),c[2].removeAttribute("style"),c[1].removeAttribute("style"),setTimeout(function(){c[0].style.transitionDuration="1s",c[1].style.transitionDuration="1s",c[2].style.transitionDuration="1s",c[0].style.width=String(c[0].clientWidth-300)+"px",c[2].style.left=String(""!==c[2].style.left?parseInt(c[2].style.left.replace("px",""))-300:a.toCompare[a.compareOffsets[b][0]].clientWidth/2-20-300)+"px",c[1].style.width=String(c[1].clientWidth+300)+"px"},100),setTimeout(function(){c[1].style.width=String(c[1].clientWidth-600)+"px",c[2].style.left=String(parseInt(c[2].style.left.replace("px",""))+600)+"px",c[0].style.width=String(c[0].clientWidth+600)+"px"},1101),setTimeout(function(){c[0].style.width=String(c[0].clientWidth-300)+"px",c[2].style.left=String(parseInt(c[2].style.left.replace("px",""))-300)+"px",c[1].style.width=String(c[1].clientWidth+300)+"px"},2102),setTimeout(function(){c[0].style.transitionDuration="0s",c[1].style.transitionDuration="0s",c[2].style.transitionDuration="0s"},3103)}}}(this)},openOverlay:function(a){document.getElementsByClassName("zoomed_image")[0].src=a,document.getElementsByClassName("overlay")[0].style.display="block"},closeOverlay:function(){document.getElementsByClassName("overlay")[0].style.display="none"},goBackToSearch:function(){history.length>1?(history.go(-1),this.timeout&&clearTimeout(this.timeout)):document.location.href="/"},setNoteLabel:function(a){a.qid&&a.label&&($(".note_label--"+a.qid)[0].innerHTML=a.label)}}),TopStoriesComponent=Class(Component,{constructor:function(a){this.name="top_stories",this.storiesModel=new topStoriesModel;var b=this;this.storiesModel.getLocalizedNews().then(function(c,d){if(LoadBarComponent.step(),!c&&!d.error){var e=new NewsModel(d.data,"news_homepage"),f=e.getNews();if(!f||f.length<4)return!1;var g=null;g=a?[[[{type:"object",index:10,partial:"news_block"},{type:"object",index:11,partial:"news_block"},{type:"array",beginning:7,end:10,partial:"news_list",subPartial:"news_list_item"}],[{type:"object",index:12,partial:"news_block"},{type:"object",index:13,partial:"news_block"},{type:"array",beginning:4,end:7,partial:"news_list",subPartial:"news_list_item"}],[{type:"object",index:0,partial:"news_block"},{type:"object",index:1,partial:"news_block"},{type:"array",beginning:14,end:17,partial:"news_list",subPartial:"news_list_item"}],[{type:"object",index:2,partial:"news_block"},{type:"object",index:3,partial:"news_block"},{type:"array",beginning:17,end:20,partial:"news_list",subPartial:"news_list_item"}]],[[{type:"object",index:8,partial:"news_block"},{type:"object",index:9,partial:"news_block"}],[{type:"object",index:10,partial:"news_block"},{type:"object",index:11,partial:"news_block"}],[{type:"object",index:12,partial:"news_block"},{type:"object",index:13,partial:"news_block"}],[{type:"object",index:0,partial:"news_block"},{type:"object",index:1,partial:"news_block"}],[{type:"array",beginning:2,end:5,partial:"news_list",subPartial:"news_list_item"},{type:"array",beginning:5,end:8,partial:"news_list",subPartial:"news_list_item"}],[{type:"array",beginning:14,end:17,partial:"news_list",subPartial:"news_list_item"},{type:"array",beginning:17,end:20,partial:"news_list",subPartial:"news_list_item"}]],[[{type:"object",index:8,partial:"news_block"}],[{type:"object",index:9,partial:"news_block"}],[{type:"object",index:10,partial:"news_block"}],[{type:"object",index:11,partial:"news_block"}],[{type:"object",index:12,partial:"news_block"}],[{type:"object",index:13,partial:"news_block"}],[{type:"object",index:0,partial:"news_block"}],[{type:"object",index:1,partial:"news_block"}],[{type:"array",beginning:2,end:5,partial:"news_list",subPartial:"news_list_item"}],[{type:"array",beginning:5,end:8,partial:"news_list",subPartial:"news_list_item"}],[{type:"array",beginning:14,end:17,partial:"news_list",subPartial:"news_list_item"}],[{type:"array",beginning:17,end:20,partial:"news_list",subPartial:"news_list_item"}]]]:[[[{type:"object",index:0,partial:"news_block"},{type:"object",index:1,partial:"news_block"},{type:"array",beginning:4,end:7,partial:"news_list",subPartial:"news_list_item"}],[{type:"object",index:2,partial:"news_block"},{type:"object",index:3,partial:"news_block"},{type:"array",beginning:7,end:10,partial:"news_list",subPartial:"news_list_item"}],[{type:"object",index:10,partial:"news_block"},{type:"object",index:11,partial:"news_block"},{type:"array",beginning:14,end:17,partial:"news_list",subPartial:"news_list_item"}],[{type:"object",index:12,partial:"news_block"},{type:"object",index:13,partial:"news_block"},{type:"array",beginning:17,end:20,partial:"news_list",subPartial:"news_list_item"}]],[[{type:"object",index:0,partial:"news_block"},{type:"object",index:1,partial:"news_block"}],[{type:"object",index:2,partial:"news_block"},{type:"object",index:3,partial:"news_block"}],[{type:"object",index:4,partial:"news_block"},{type:"object",index:5,partial:"news_block"}],[{type:"object",index:6,partial:"news_block"},{type:"object",index:7,partial:"news_block"}],[{type:"array",beginning:8,end:11,partial:"news_list",subPartial:"news_list_item"},{type:"array",beginning:11,end:14,partial:"news_list",subPartial:"news_list_item"}],[{type:"array",beginning:14,end:17,partial:"news_list",subPartial:"news_list_item"},{type:"array",beginning:17,end:20,partial:"news_list",subPartial:"news_list_item"}]],[[{type:"object",index:0,partial:"news_block"}],[{type:"object",index:1,partial:"news_block"}],[{type:"object",index:2,partial:"news_block"}],[{type:"object",index:3,partial:"news_block"}],[{type:"object",index:4,partial:"news_block"}],[{type:"object",index:5,partial:"news_block"}],[{type:"object",index:6,partial:"news_block"}],[{type:"object",index:7,partial:"news_block"}],[{type:"array",beginning:8,end:11,partial:"news_list",subPartial:"news_list_item"}],[{type:"array",beginning:11,end:14,partial:"news_list",subPartial:"news_list_item"}],[{type:"array",beginning:14,end:17,partial:"news_list",subPartial:"news_list_item"}],[{type:"array",beginning:17,end:20,partial:"news_list",subPartial:"news_list_item"}]]];var h=new PartialMosaicComponent(f,g,"news__trends","homepage");b.setState({partialMosaic:h}),h.firstBuild();var i=$(".news_content");if(a&&i[0]){var j=getBoxPosition(i[0]).top,k=isMobile?j-20:j+50;smoothScrollTo(k,800)}}}),LoadBarComponent.step(),_super(this)}}),TrendsComponent=Class(Component,{$statics:{getPageUrl:function(){return"/all?tab=trends"},getInstance:function(){return TrendsComponent.instance?TrendsComponent.instance:new TrendsComponent},instance:null,openCustomVideo:function(a){var b=60,c=$(".custom_video_overlay")[0];c&&(c.style.display="block");var d=$(".custom_video")[0],e=applicationState.user.userSetting.getInterfaceLanguage().shorthand,f=["it","de"],g=a.src.replace(/\.(mp4|webm|ogv)$/,"");d&&(-1!==f.indexOf(e)?g+="-"+e:"fr"!==e&&(g+="-en"),d.canPlayType&&(d.canPlayType('video/mp4; codecs="mp4a.40.5"')?g+=".mp4":d.canPlayType('video/webm; codecs="vp8.0"')?g+=".webm":d.canPlayType('video/ogg; codecs="theora"')&&(g+=".ogv")),d.src=g,d.style.display="block",setTimeout(function(){var a=d.offsetHeight,c=window.innerHeight;b=(c-a)/2-50,d.style.top=b+"px",d.style.opacity=1;var e=$(".custom_video--close")[0];e&&(e.style.display="block",e.style.top=b-40+"px");var f=$(".custom_video__video__share")[0];f&&(f.style.display="block",f.style.top=b+a+20+"px"),d.play()},100))},closeCustomVideo:function(){var a=$(".custom_video_overlay")[0];a&&(a.style.display="none");var b=$(".custom_video--close")[0];b&&(b.style.display="none");var c=$(".custom_video__video__share")[0];c&&(c.style.display="none");var d=$(".custom_video")[0];d&&(d.pause(),d.style.display="none",d.style.opacity=0)}},constructor:function(){this.name="trends",this.tooltip=new TooltipComponent(this,"Tooltip"),_super(this)},updateContent:function(){var a=AjaxManager.get(ajax.getTrends(),new AjaxParameters({locale:applicationState.user.userSetting.getLocalisedSearchRegionCode(),device:SiteHelper.getDeviceName(),uiv:4}).getParameters()),b=this;PromiseHelper.joinWithPageRendered(a).then(function(a,c){if(LoadBarComponent.step(),a)addClass(document.body,"no-trends");else{c.error&&addClass(document.body,"no-trends");var d={status:"error"};try{d=c,removeClass(document.body,"no-trends")}catch(a){addClass(document.body,"no-trends")}d&&d.status&&"error"==d.status?addClass(document.body,"no-trends"):b.loaded(d)}}),LoadBarComponent.step()},isTrendDataValid:function(a){return!!(void 0!==a&&a&&a.headline_news&&a.headline_video&&a.headline_images)},loaded:function(a){var b=a.data;if(!this.isTrendDataValid(b))return!1;var c={},d=[],e=0;b&&b.headline_images&&(this.displayCulturalEvents(b.headline_images)?(e=(new Date).getDay()%b.headline_images.length,b.headline_images.forEach(function(a,b){var e=new Date(a.begin_date);d.push(e),c[e.getTime()+b]=[],c[e.getTime()+b].push(a)})):b.headline_images.forEach(function(a){var b=new Date(1e3*a.freshestdate);c[b.getDate()]||(d.push(b),c[b.getDate()]=[]),c[b.getDate()].push(a)})),LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"display",element:"display_trends",t:"web"}),this.setState(new State({data:b,popup_images:c,timestampArray:d,popup_days_counter:d.length,displayImageIndex:e})),window.addEventListener("resize",function(){var a=$i("people_carousel");a&&(a.style.left=0),addClass($(".trends--people__left")[0],"trends--people__button-disabled"),removeClass($(".trends--people__right")[0],"trends--people__button-disabled")}),window.removeEventListener("keydown",this.popupLeftrightEsc),window.addEventListener("keydown",this.popupLeftrightEsc),window.addEventListener("click",function(a){var b=$i("popup_image");if(b)for(var c=a.target,d=!0;c!=document.documentElement&&c;){if(hasClass(c,"trends--general__popup__content")||hasClass(c,"trends--general__trend--right")||hasClass(c,"trends--general__trend--right-v4")){d=!1;break}c=c.parentNode}d&&(b.style.display="none")})},peoples_right:function(){if(!hasClass($(".trends--people__right")[0],"trends--people__button-disabled")){var a,b=230,c=1;window.innerWidth>=1200?c=4:window.innerWidth>=680?c=2:(c=1,b=190),a=b*c;var d=$i("people_carousel");d&&(parseInt(d.style.left)<=12*-b+2*a?(d.style.left=parseInt(d.style.left)-a+"px",addClass($(".trends--people__right")[0],"trends--people__button-disabled")):d.style.left=parseInt(d.style.left)-a+"px"),removeClass($(".trends--people__left")[0],"trends--people__button-disabled")}},peoples_left:function(){if(!hasClass($(".trends--people__left")[0],"trends--people__button-disabled")){var a,b=230,c=1;window.innerWidth>=1200?c=4:window.innerWidth>=680?c=2:(c=1,b=190),a=b*c;var d=$i("people_carousel");d&&(parseInt(d.style.left)>-2*a?(d.style.left=parseInt(d.style.left)+a+"px",addClass($(".trends--people__left")[0],"trends--people__button-disabled")):d.style.left=parseInt(d.style.left)+a+"px"),removeClass($(".trends--people__right")[0],"trends--people__button-disabled")}},day_prev:function(){for(var a=$(".trends--general__popup__day"),b=$(".trends--general__popup__dot__line"),c=0,d=a.length-1,e=0;e<a.length;e++)hasClass(a[e],"trends--general__popup__day--hidden")||(c=e);addClass(a[c],"trends--general__popup__day--hidden"),removeClass(b[c],"trends--general__popup__dot__line--current");var f=c-1;f<0&&(f=d),removeClass(a[f],"trends--general__popup__day--hidden"),addClass(b[f],"trends--general__popup__dot__line--current")},day_next:function(){for(var a=$(".trends--general__popup__day"),b=$(".trends--general__popup__dot__line"),c=($(".trends--general__popup__content__img"),0),d=a.length-1,e=0;e<a.length;e++)hasClass(a[e],"trends--general__popup__day--hidden")||(c=e);addClass(a[c],"trends--general__popup__day--hidden"),removeClass(b[c],"trends--general__popup__dot__line--current");var f=c+1;f>d&&(f=0),removeClass(a[f],"trends--general__popup__day--hidden"),addClass(b[f],"trends--general__popup__dot__line--current")},show_day:function(a){for(var b=$(".trends--general__popup__day"),c=$(".trends--general__popup__dot__line"),d=0;d<b.length;d++)addClass(b[d],"trends--general__popup__day--hidden"),removeClass(c[d],"trends--general__popup__dot__line--current");removeClass(b[a],"trends--general__popup__day--hidden"),addClass(c[a],"trends--general__popup__dot__line--current")},popupLeftrightEsc:function(a){var b=$i("popup_image");b&&(27==a.keyCode&&(b.style.display="none"),37==a.keyCode&&TrendsComponent.getInstance().day_prev(),39==a.keyCode&&TrendsComponent.getInstance().day_next())},displayPopupImage:function(a){var b=$(".trends--general__popup__dots")[0].offsetWidth,c=$(".trends--general__popup__dot__image--container")[0];c.style.display="block";var d=parseInt(c.offsetWidth),e=$(".trends--general__popup__dot__image")[0],f=parseInt(b)/a.days_number,g=f/2;if(a.lines_number>1){var h=a.lines_number,i=f/h;g=(h-(a.current_line+1))*i+i/2}var j=f*(a.current_day+1)-g-d/2;a.image.hasOwnProperty("pict_desktop")?e.src=a.image.pict_desktop:a.image.hasOwnProperty("image")&&(e.src=a.image.image),e.style.opacity=1,c.style.left=j+"px"},hidePopupImage:function(a){var b=$(".trends--general__popup__dot__image--container")[0],c=$(".trends--general__popup__dot__image")[0];b.style.display="none",c.style.opacity=0},displayCulturalEvents:function(a){return void 0===a[0].freshestdate},displaySpecialVideoEvent:function(a){a&&a.data&&a.data.headline_video&&a.data.headline_video[0]&&(a.data.headline_video[0].type="video",a.data.headline_video[0].title=a.data.headline_video[0].name,a.data.headline_video[0].media=a.data.headline_video[0].embed_link,a.data.headline_video[0].url=a.data.headline_video[0].link,MediaOverlayComponent.setMedias(a.data.headline_video))},loadMoreLatestNews:function(){var a=$(".trends--big-text__more-news.button")[0],b=$(".trends--news--more");for(var c in b)"object"==typeof b[c]&&(hasClass(document.body,"theme-dark")?b[c].innerHTML='<img src="/img/loader-grey.gif" alt="'+_("Loading","trends")+'" />':b[c].innerHTML='<img src="/img/loader-white.gif" alt="'+_("Loading","trends")+'" />');var d=AjaxManager.get(ajax.topStories(),new AjaxParameters({locale:applicationState.user.userSetting.getLocalisedSearchRegionCode(),device:SiteHelper.getDeviceName(),category:"news"}).getParameters()),e=this;d.then(function(c,d){if(!c){var f=[];for(var g in e.state.data.latest_news)f.push(e.state.data.latest_news[g].id);var h=d.data;for(var g in h)f.indexOf(h[g].id)>-1&&h.splice(g,1);e.state.more_latest_news=h.slice(8,16);for(var g in b)"object"==typeof b[g]&&(b[g].innerHTML=e.renderPartial("desktop_more_latest_news",e.state));a.style.display="none",a.onclick=null}})}}),SelectRegionComponent=Class(Component,{constructor:function(a){this.name="select_region",_super(this),this.referer=a&&a.params&&a.params.referer?a.params.referer:null,window.location=this.referer?"settings?referer="+this.referer:"settings",FloatingButtonHelper.hideButtons()},initState:function(){var a={continents:constants.AvailableRegions.continents,currentContinentKey:applicationState.user.userSetting.getContinent().code,currentCountryKey:applicationState.user.userSetting.getSearchRegion().code,currentSearchLanguage:applicationState.user.userSetting.getSearchLanguage().code},b=LanguageHelper.getCountryLanguages(applicationState.user.userSetting.getSearchRegion().code);return 1!==b.length&&(a.languages=b),a},isSelectedContinent:function(a){return this.state.currentContinentKey===a},isSelectedCountry:function(a){return a===this.state.currentCountryKey},selectCountry:function(a){this.state.currentContinentKey=a.continentKey,this.state.currentCountryKey=a.countryKey;for(var b in constants.AvailableRegions.continents){var c=constants.AvailableRegions.continents[b];for(var d in c.countries)removeClass($(".country--key--"+d),"country--selected")}addClass($(".country--key--"+a.countryKey),"country--selected");var e=LanguageHelper.getCountryLanguages(a.countryKey);1===e.length?(delete this.state.languages,this.state.currentSearchLanguage=e[0].code):(this.state.languages=e,this.state.currentSearchLanguage=e[0].code),this.setState(this.state);var f=$(".country__language__block",$i(this.id)).item(0);f&&smoothScrollTo(getBoxPosition(f).top,800)},selectContinent:function(a){for(var b in constants.AvailableRegions.continents)removeClass($(".region__continents__continent--"+b),"region__continents__continent--selected"),removeClass($(".region__countries--"+b),"region__countries--selected");this.state.currentContinentKey=a.continentKey,addClass($(".region__countries--"+a.continentKey),"region__countries--selected"),addClass($(".region__continents__continent--"+a.continentKey),"region__continents__continent--selected");var c=$(".country__language__block",$i(this.id)).item(0);c&&(LanguageHelper.isCountryInContinent(this.state.currentCountryKey,this.state.currentContinentKey)?removeClass(c,"hidden"):addClass(c,"hidden")),smoothScrollTo(0)},selectSearchLanguage:function(a){var b=LanguageHelper.getCountryLanguages(this.state.currentCountryKey);for(var c in b)removeClass($(".country--"+b[c].code+"_"+this.state.currentCountryKey,$i(this.id)),"country--selected"),removeClass($(".region__countries--"+this.state.currentCountryKey),"region__continents__continent--selected"),removeClass($(".region__continents__continent--"+this.state.currentContinentKey),"region__countries--selected");this.state.currentSearchLanguage=a.searchLanguageKey,addClass($(".country--"+a.searchLanguageKey+"_"+this.state.currentCountryKey,$i(this.id)),"country--selected"),addClass($(".region__countries--"+this.state.currentCountryKey),"region__countries--selected"),addClass($(".region__continents__continent--"+this.state.currentContinentKey),"region__continents__continent--selected");var d=$(".country_thanks")[0];this.state.currentSearchLanguage===b[c].code&&b[c].thanks?(d.innerHTML=b[c].thanks,d.style.display="inherit"):d.style.display="none"},save:function(){LoadBarComponent.clear(),LoadBarComponent.init(2);var a=this,b=applicationState.user.userSetting.getLocalisedSearchRegionCode()
;applicationState.user.userSetting.setSearchLanguage(this.state.currentSearchLanguage),applicationState.user.userSetting.setSearchRegion(this.state.currentCountryKey),applicationState.user.userSetting.setContinent(LanguageHelper.getContinentFromCountry(this.state.currentCountryKey));var c=applicationState.user.userSetting.getSearchLanguageCode(),d=LanguageHelper.getCorrespondingInterfaceLanguage(c.toLowerCase()),e=a.state.currentSearchLanguage+"_"+a.state.currentCountryKey;applicationState.user.isLogged||"de_DE"!==e||isMobile||isTablet?applicationState.user.isLogged||"de_DE"!==b||"de_DE"===e||(applicationState.user.userSetting.searchMode=window.siteConfiguration.searchCategories.ALL.index):applicationState.user.userSetting.searchMode=window.siteConfiguration.searchCategories.WEB.index;var f=new promise.Promise;if(LoadBarComponent.step(),!1===d||AppComponent.isNativeApp())f.done();else{applicationState.user.changeLang(d).then(function(){f.done()})}f.then(function(){_initI18n({showMissingTranslation:config_get("isDevelopmentMode")&&"en"!==a.state.currentSearchLanguage}),applicationState.user.update().then(function(b){b?AlertComponent.error(_("an error occurred in updating your settings","user")):a.referer?window.location=config_get("qwantUrl")+a.referer:(Application.rootComponent.refresh(),Dispatcher.history.goTo(0),AlertComponent.success(_("Region successfully updated","alert")))}),LoadBarComponent.step()})},reset:function(){this.referer?window.location=config_get("qwantUrl")+this.referer:Dispatcher.history.goTo(0)}}),SettingsPageComponent=Class(Component,{constructor:function(){this.name="settings_page",this.referer=Dispatcher.getUrlParameter("referer"),isReachableStore||AlertComponent.error(_("Due to your browser's preferences, all saved settings will be lost when you refresh the page.","settings page"),{timeout:1e5}),actionManager.onCustomEvent(this,"pageRendered",this.checkDropDown),FloatingButtonHelper.hideButtons(),_super(this)},notify:function(){this.setState(this.state)},initState:function(){var a={};return jsface.extend(a,applicationState.user.userSetting),void 0===a.showSmartNews&&(a.showSmartNews=!0),void 0===a.showSmartSocial&&(a.showSmartSocial=!0),void 0===a.showSmartVideos&&(a.showSmartVideos=!0),{settingsUrl:new SettingsUrlComponent(a),settings:a}},updateField:function(a){var b=this.state.settings[a.settingKey];this.state.settings[a.settingKey]=b?0:1,$i("appmenu_settings_btns").style.display="flex",$i("appmenu_settings_header--content").style.display="none",this.state.settingsUrl.updateSettingsUrl()},checkDropDown:function(){if(!(0===applicationState.user.userSetting.searchMode||1===applicationState.user.userSetting.searchMode&&"de_DE"===applicationState.user.userSetting.getLocalisedSearchRegionCode()&&BrowserHelper.isMobile)){var a=$(".settings__form__option--showTrends")[0];a&&(a.style.display="none")}},updateDropDown:function(a,b){if("searchMode"===b.key){var c=$(".settings__form__option--showTrends")[0];c&&(c.style.display=0===a||1===a&&"de_DE"===applicationState.user.userSetting.getLocalisedSearchRegionCode()&&BrowserHelper.isMobile?"block":"none")}this.state.settings[b.key]=a,$i("appmenu_settings_btns").style.display="flex",$i("appmenu_settings_header--content").style.display="none",this.state.settingsUrl.updateSettingsUrl()},update:function(){LoadBarComponent.clear(),LoadBarComponent.init(1),FormHelper.disableSubmitButton(),applicationState.user.userSetting=this.state.settings;var a=this;applicationState.user.userSetting.update().then(function(b){if(b)if(101==b){var c=UserModel.logout();c.then(function(){AlertComponent.error(_('Your session has expired, <a href="{HREF}">please reconnect</a>',"login",{HREF:"/login"}))})}else AlertComponent.error(_("an error occurred in updating your settings","user"));else a.referer&&a.referer.match(AppMenuComponent.trustedReferer)?window.location=config_get("qwantUrl")+a.referer:(Application.rootComponent.refresh(),Dispatcher.history.goTo(0),AlertComponent.success(_("Settings successfully updated","user"),{timeout:3e3}))}),FormHelper.enableSubmitButton(),LoadBarComponent.step()}}),SettingsUrlComponent=Class(Component,{constructor:function(a){this.name="settings_url",this.settings=a,_super(this)},initState:function(){return{url:this.generateUrl()}},copyLinkToClipboard:function(){var a=$i("settings_url"),b=a.value;if("iOS"===BrowserHelper.getOS()){var c=a.contentEditable,d=a.readOnly;a.contentEditable=!0,a.readOnly=!1;var e=document.createRange();e.selectNodeContents(a);var f=window.getSelection();f.removeAllRanges(),f.addRange(e),a.select(),a.setSelectionRange(0,b.length),a.contentEditable=c,a.readOnly=d}else{a.select();try{document.execCommand("copy"),AlertComponent.success(_("The URL was copied to your clipboard.","alert"))}catch(a){AlertComponent.error(_("The URL could not be copied to your clipboard. Your browser might not allow it.","alert"))}}},updateSettingsUrl:function(){this.setState(new State({url:this.generateUrl()}))},generateUrl:function(){var a=[];for(var b in userFields)userFields.hasOwnProperty(b)&&userFields[b].getValue(this.settings).toString()&&a.push(userFields[b].getParam+"="+userFields[b].getValue(this.settings));return applicationState.rootUrl+"/?"+a.join("&amp;")}}),CustomPageHelper=Class({$statics:{BACKGROUND_HEADER:{game:["/img/game/background-game-default.jpg"],default:["/img/game/background-game-default.jpg"]},DEFAULT_PICTURE:{game:"/img/error/game_error.jpg",default:"/img/error/people_error.png"},slugalize:function(a){return a.replace(/\s/g,"-")},logalize:function(a){return a.replace(/\s/g,"_").replace("(","").replace(")","")},unslugalize:function(a){return a.replace(/-/g," ")},getOverviewRoute:function(a,b){return"/"+a+"/"+encodeURIComponent(b)},getScoreColorClass:function(a){return a>90?"score--excellent":a>80?"score--very-good":a>70?"score--good":a>60?"score--not-bad":a>50?"score--fair":a>40?"score--poor":a>20?"score--bad":"score--very-bad"},getRatings:function(a){var b={score:{positive:0,medium:0,negative:0}};if(a&&a.getCritics().length>0){a.getCritics().forEach(function(a){var c=a.getScore();c>70?b.score.positive++:c>40?b.score.medium++:b.score.negative++});var c=a.getCritics().length;return b.percentage={positive:Math.round(b.score.positive/c*100)+"%",medium:Math.round(b.score.medium/c*100)+"%",negative:Math.round(b.score.negative/c*100)+"%"},b}return null},getRandomBackground:function(a,b){b=b||"default";var c=CustomPageHelper.BACKGROUND_HEADER[a]?CustomPageHelper.BACKGROUND_HEADER[a]:CustomPageHelper.BACKGROUND_HEADER.default;return c[b.charCodeAt(0)%c.length]},getDefaultPicture:function(a){return CustomPageHelper.DEFAULT_PICTURE[a]?CustomPageHelper.DEFAULT_PICTURE[a]:CustomPageHelper.DEFAULT_PICTURE.default},buildCanvas:function(a,b,c){var d=$i(a);if(""!==b&&d){var e=d.getContext("2d");e.beginPath(),e.moveTo(90.108,.648),e.bezierCurveTo(40.752,.648,.72,40.644,.72,90),e.bezierCurveTo(.72,139.356,40.752,179.352,90.072,179.352),e.bezierCurveTo(91.836,179.352,93.78,179.352,96.084,179.172),e.lineTo(96.084,152.75),e.bezierCurveTo(93.96,153.144,92.016,153.144,90.072,153.144),e.bezierCurveTo(54.72,153.144,25.956,124.38,25.956,89.028),e.bezierCurveTo(25.956,53.676,54.756,24.912,90.108,24.912),e.bezierCurveTo(125.46,24.912,154.224,53.676,154.224,89.028),e.bezierCurveTo(154.224,111.384,142.956,131.58,123.912,143.424),e.lineTo(123.516,143.604),e.lineTo(163.908,179.352),e.lineTo(179.244,161.496),e.lineTo(160.416,144.972),e.lineTo(161.208,143.82),e.bezierCurveTo(173.052,128.268,179.28,109.62,179.28,90),e.bezierCurveTo(179.46,40.644,139.428,.648,90.108,.648),e.fillStyle="rgba(130,132,134, 0.3)",e.fill(),e.clip(),e.lineWidth=90,e.save();var f,g=CustomPageHelper.getScoreColorClass(b);switch(g){case"score--excellent":f="#00ab56";break;case"score--very-good":f="#68cb30";break;case"score--good":f="#acdd57";break;case"score--not-bad":f="#dfe439";break;case"score--fair":f="#fcd410";break;case"score--poor":f="#fea100";break;case"score--bad":f="#f06f59";break;case"score--very-bad":f="#cc3346"}var h=CustomPageHelper.generateColor(f,"#cc3346",b);if(c){CustomPageHelper.drawCircle(e,1,h),CustomPageHelper.animate(d,e,1,b,h)}else CustomPageHelper.drawCircle(e,b,h)}},drawCircle:function(a,b,c){a.strokeStyle=c[b-1],a.beginPath(),a.arc(97.2,90,72,.5*Math.PI,(.5+1.84*b/100)*Math.PI,!1),a.stroke()},animate:function(a,b,c,d,e){b.restore(),c++,CustomPageHelper.drawCircle(b,c,e),c<=d&&setTimeout(function(){CustomPageHelper.animate(a,b,c,d,e)},7+20*(c/d-.1))},buildV4Canvas:function(a,b,c,d,e){var f=$i(a);if(""!==b&&f){var g=f.getContext("2d");g.beginPath(),g.arc(d/2,d/2,(d-e)/2,1.5*Math.PI,3.5*Math.PI,!1),g.lineWidth=e,g.strokeStyle="rgba(130,132,134, 0.1)",g.stroke(),g.closePath();var h,i=CustomPageHelper.getScoreColorClass(b);switch(i){case"score--excellent":h="#00ab56";break;case"score--very-good":h="#68cb30";break;case"score--good":h="#acdd57";break;case"score--not-bad":h="#dfe439";break;case"score--fair":h="#fcd410";break;case"score--poor":h="#fea100";break;case"score--bad":h="#f06f59";break;case"score--very-bad":h="#cc3346"}var j=CustomPageHelper.generateColor(h,"#cc3346",b);if(c){CustomPageHelper.drawV4Circle(g,1,j,d,e),CustomPageHelper.animateV4(f,g,1,b,j,d,e)}else CustomPageHelper.drawV4Circle(g,b,j,d,e)}},drawV4Circle:function(a,b,c,d,e){a.beginPath(),a.arc(d/2,d/2,(d-e)/2,1.5*Math.PI,(1.5+2*b/100)*Math.PI,!1),a.strokeStyle=c[b-1],a.stroke(),a.closePath()},animateV4:function(a,b,c,d,e,f,g){b.clearRect(0,0,f,f),b.beginPath(),b.arc(f/2,f/2,(f-g)/2,1.5*Math.PI,3.5*Math.PI,!1),b.lineWidth=g,b.strokeStyle="rgba(130,132,134, 0.1)",b.stroke(),b.closePath(),CustomPageHelper.drawV4Circle(b,c,e,f,g),++c<=d&&setTimeout(function(){CustomPageHelper.animateV4(a,b,c,d,e,f,g)},7+20*(c/d-.1))},hex:function(a){var b="0123456789abcdef",c=parseInt(a);return 0==c||isNaN(a)?"00":(c=Math.round(Math.min(Math.max(0,c),255)),b.charAt((c-c%16)/16)+b.charAt(c%16))},convertToHex:function(a){return"#"+CustomPageHelper.hex(a[0])+CustomPageHelper.hex(a[1])+CustomPageHelper.hex(a[2])},trim:function(a){return"#"==a.charAt(0)?a.substring(1,7):a},convertToRGB:function(a){var b=[];return b[0]=parseInt(CustomPageHelper.trim(a).substring(0,2),16),b[1]=parseInt(CustomPageHelper.trim(a).substring(2,4),16),b[2]=parseInt(CustomPageHelper.trim(a).substring(4,6),16),b},generateColor:function(a,b,c){for(var d=CustomPageHelper.convertToRGB(a),e=CustomPageHelper.convertToRGB(b),f=c,g=0,h=[],i=[],j=0;j<f;j++)g+=1/f,i[0]=d[0]*g+(1-g)*e[0],i[1]=d[1]*g+(1-g)*e[1],i[2]=d[2]*g+(1-g)*e[2],h.push(CustomPageHelper.convertToHex(i));return h},changeOfferTab:function(a){var b,c=a.tab||"All";if(b=$("All"===c?".offers_item":".offers_item--"+c),removeClass($(".offers_menu--selected")[0],"offers_menu--selected"),addClass($(".offers_menu--"+c),"offers_menu--selected"),b){for(var d=$(".offers_item"),e=0,f=d.length;e<f;e++)removeClass(d[e],"offers_item--first"),d[e].style.display="none";for(e=0,f=b.length;e<f;e++)0===e&&addClass(b[e],"offers_item--first"),e<5&&(b[e].style.display="table-row")}}}}),ExtensionHelper=Class({$statics:{oneclick:{firefox:function(){ExtensionHelper.isntFirefoxQuantum()?window.location.href="https://addons.mozilla.org/firefox/downloads/file/586729/qwant_for_firefox-3.1.4-fx.xpi?src=btn-primary":window.location.href="https://addons.mozilla.org/firefox/downloads/latest/qwantcom-for-firefox/platform:2/addon-544242-latest.xpi?src=dp-btn-primary",ExtensionOverlayHelper.openBrowserOverlay("firefox")},firefoxLite:function(){window.location.href="https://addons.mozilla.org/firefox/downloads/file/786860/qwantcom-1.0.2-an+fx.xpi?src=dp-btn-primary"},chrome:function(){var a="https://chrome.google.com/webstore/detail/hnlkiofnhhoahaiimdicppgemmmomijo";applicationState.user.userSetting.targetBlank?window.open(a):location.href=a},safari:function(){window.location.href="https://www.qwant.com/qwant-safari.safariextz",ExtensionOverlayHelper.openBrowserOverlay("safari")},vivaldi:function(){ExtensionOverlayHelper.openBrowserOverlay("vivaldi")}},displayPopin:function(){var a=ExtensionPopinComponent.WEEK_IN_MS+1;try{a=localStorage.getItem("closedExtPanel")}catch(a){l.error("local storage is not available")}return null===a||Date.now()-parseInt(a)>ExtensionPopinComponent.WEEK_IN_MS},closePopin:function(){var a=$(".home__snippet__extension");a&&addClass(a,"home__snippet__extension--closed");try{localStorage.setItem("closedExtPanel",Date.now())}catch(a){l.error("local storage is not available")}},displayButton:function(){return!ExtensionHelper.displayPopin()},openExtensionOverlay:function(a){var b=BrowserHelper.getBrowserUri(),c=applicationState.user.userSetting.getInterfaceLanguage().shorthand,d=AppComponent.getAppDownloadLink(),e=!1;if(d)window.location=d;else switch(b){case"chrome":ExtensionHelper.oneclick.chrome();break;case"firefox":e=a&&a.type&&"lite"===a.type?ExtensionHelper.oneclick.firefoxLite():ExtensionHelper.oneclick.firefox;break;case"opera":window.open("https://addons.opera.com/fr/extensions/details/qwant-for-opera/");break;case"safari":e=ExtensionHelper.oneclick.safari;break;case"edge":"fr"===c?window.open("https://help.qwant.com/fr/aide/qwant-com/add-qwant-on-desktop/sur-microsoft-edge/"):"de"===c?window.open("https://help.qwant.com/de/help/qwant-search/fugen-sie-qwant-auf-dem-desktop-hinzu/in-microsoft-edge/"):window.open("https://help.qwant.com/help/qwant-search/add-qwant-on-desktop/on-microsoft-edge/");break;case"ie":"fr"===c?window.open("https://help.qwant.com/fr/aide/qwant-com/add-qwant-on-desktop/sur-internet-explorer/"):"de"===c?window.open("https://help.qwant.com/de/help/qwant-search/fugen-sie-qwant-auf-dem-desktop-hinzu/im-internet-explorer/"):window.open("https://help.qwant.com/help/qwant-search/add-qwant-on-desktop/on-internet-explorer/");break;case"vivaldi":ExtensionHelper.oneclick.vivaldi();break;default:"fr"===c?window.open("https://help.qwant.com/fr/aide/qwant-com/add-qwant-on-desktop/"):"de"===c?window.open("https://help.qwant.com/de/help/qwant-search/fugen-sie-qwant-auf-dem-desktop-hinzu/"):window.open("https://help.qwant.com/help/qwant-search/add-qwant-on-desktop/")}LinkHelper.logHandler({target:"_blank"},{which:1},{AjaxRoute:"extensionHomepagePopin",type:"open",element:a&&a.element?a.element:"button",browser:b,os:BrowserHelper.getOS()},e)},isntFirefoxQuantum:function(){var a=/^.*Firefox\/([0-9]+\.[0-9]+)$/,b=navigator.userAgent.match(a),c=0;return b&&b[1]&&(c=parseFloat(b[1])),c<57}}}),ExtensionOverlayHelper=Class({$statics:{openBrowserOverlay:function(a){var b=$("html")[0];b.style.overflow="hidden",b.style.height="100%";var c=$(".extension__"+a+"__overlay")[0];c&&(c.style.display="safari"===a?"flex":"block",setTimeout(function(){c.style.opacity=1,$(".wrapper")[0].style.WebkitFilter="blur(5px)"},100))},closeBrowserOverlay:function(a){if(!a||!a.browser)return!1;window.confettiful&&ConfettiComponent.stopConfettis();var b=$("html")[0];b.style.overflow="auto",b.style.height="auto";var c=$(".extension__"+a.browser+"__overlay")[0];c&&(c.style.opacity=0,$(".wrapper")[0].style.WebkitFilter="",setTimeout(function(){c.style.display="none"},400))}}}),FirefoxHelper=Class({$statics:{getFirefoxAddonLink:function(){return"https://addons.mozilla.org/"+LanguageHelper.getFirefoxConversion()+"/firefox/addon/qwantcom-for-firefox/"},getFirefoxTpLink:function(){return"https://www.mozilla.org/"+LanguageHelper.getFirefoxConversion()+"/firefox/private-browsing/"}}}),IAHelper=Class({$statics:{capitalizeFirstLetter:function(a){return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()},chunk:function(a,b){var c,d,e=[];for(c=0,d=a.length;c<d;c+=b)e.push(a.substr(c,b));return e},listScroll:function(a){var b=a.type,c=a.component,d=a.footstep||1,e=a.position,f=a.numberOfItems,g=$(c.listItemReference[b].container)[0],h=$(c.listItemReference[b].arrowRight)[0],i=$(c.listItemReference[b].arrowLeft)[0],j=$(c.listItemReference[b].item)[0],k=c.listItemReference[b].lastOffset,l=j.clientWidth,m=l*d+c.listItemReference[b].margin*d,n=parseInt(window.getComputedStyle(g).marginLeft),o=$(c.listItemReference[b].list)[0].offsetWidth;i.disabled=!1,h.disabled=!1;var p;if("left"===e)(p=n+m)>=0&&(p=0,i.disabled=!0);else{p=n-m;var q=f*l+f*c.listItemReference[b].margin+k,r=q-o+p;r<=0&&(p+=-r,h.disabled=!0)}g.style.marginLeft=p+"px"},setSwipableList:function(a,b,c){var d=$(c.listItemReference[a].list)[0],e=$(c.listItemReference[a].container)[0],f=null,g=null,h=$(c.listItemReference[a].item)[0];if(h){var i=h.clientHeight+parseInt(window.getComputedStyle(h).marginTop.replace("px",""))+parseInt(window.getComputedStyle(h).marginBottom.replace("px",""));e.style.setProperty("width",b+"px","important"),e.style.overflowY="hidden",d.style.overflowX="scroll",c.listItemReference[a].arrowRight&&(f=$(c.listItemReference[a].arrowRight)[0]),c.listItemReference[a].arrowLeft&&(g=$(c.listItemReference[a].arrowLeft)[0]),f&&g&&(d.style.height=i+"px"),f&&(f.style.display="none"),g&&(g.style.display="none")}},getImagesWidth:function(a,b){var c=0,d=$(b.listItemReference[a].item);if(d){var e=d[0].offsetWidth;return d.forEach(function(d){c+=e+b.listItemReference[a].margin}),c}return 0}}});!function(a,b){"object"==typeof exports?module.exports=b(a):"function"==typeof define&&define.amd?define([],b(a)):a.LazyLoad=b(a)}("undefined"!=typeof global?global:this.window||this.global,function(a){function b(a,b){this.settings=d(c,b||{}),this.observer=null,this.init()}var c={src:"data-src",srcset:"data-srcset"},d=function(){var a={},b=!1,c=0,e=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(b=arguments[0],c++);for(;c<e;c++){var f=arguments[c];!function(c){for(var e in c)Object.prototype.hasOwnProperty.call(c,e)&&(b&&"[object Object]"===Object.prototype.toString.call(c[e])?a[e]=d(!0,a[e],c[e]):a[e]=c[e])}(f)}return a};return b.prototype={init:function(){if(a.IntersectionObserver){var b=this,c={root:null,rootMargin:"0px",threshold:[.01]};this.observer=new IntersectionObserver(function(a){a.forEach(function(a){if(a.intersectionRatio>0){b.observer.unobserve(a.target);var c=a.target.getAttribute(b.settings.src),d=a.target.getAttribute(b.settings.srcset);"img"===a.target.tagName.toLowerCase()?(c&&(a.target.src=c),d&&(a.target.srcset=d)):a.target.style.backgroundImage="url("+c+")"}})},c)}},destroy:function(){this.settings&&(this.observer.disconnect(),this.settings=null)}},a.lazyload=function(a,c){return new b(a,c)},b});var LinkHelper=Class({$statics:{logHandler:function(a,b,c,d){if(!c&&!c.AjaxRoute)return null;var e=ajax.action[c.AjaxRoute](),f=applicationState.user.getSettings().getLocalisedSearchRegionCode(),g=Dispatcher.history&&Dispatcher.history.get(0)?Dispatcher.history.get(0).params:{},h=g&&g.q?UrlHelper.fixedEncodeURIComponent(g.q):null,i=SiteHelper.getDeviceName(),j="locale="+f+"&device="+i;c.query&&(h=c.query,delete c.query),h&&(j+="&query="+h),c.t&&"default"===c.t&&(c.t=g&&g.t?g.t:QwantHomepageComponent.currentHomepage&&QwantHomepageComponent.currentHomepage.url?QwantHomepageComponent.currentHomepage.url:null),!c.context||"true"!==c.context&&!0!==c.context||(c.context=LayoutComponent.currentPage.name);for(var k in c)c.hasOwnProperty(k)&&"AjaxRoute"!==k&&c[k]&&"null"!==c[k]&&(j+="&"+k+"="+encodeURIComponent(c[k]));AjaxParameters.prefixes.client&&(j+="&client="+AjaxParameters.prefixes.client.toLowerCase());var l=new XMLHttpRequest;return l.open("POST",e),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.send(j),l.onreadystatechange=function(){2===l.readyState&&1===b.which&&"_blank"!==a.target&&(window.location=a.href),l.readyState===XMLHttpRequest.DONE&&200===l.status&&d&&d(l.responseText)},"_blank"===a.target&&void 0},clickHandler:function(a,b){if("_blank"!==a.target)return b.preventDefault&&b.preventDefault(),!1},mouseUpHandler:function(a,b){if("_blank"!==a.target)return b.preventDefault&&b.preventDefault(),!1},openAffiliate:function(a,b,c){return c?("_blank"!==a.target?window.location=c:window.open(c),b.preventDefault&&b.preventDefault(),!1):null},slugalize:function(a){a=a.trim().toLowerCase();for(var b="àáäâèéëêìíïîòóöôùúüûñç&·/,:;",c="aaaaeeeeiiiioooouuuunc------",d=0,e=b.length;d<e;d++)a=a.replace(new RegExp(b.charAt(d),"g"),c.charAt(d));return a=a.replace(/[^a-z0-9 -_]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}}}),LocalHelper=Class({$statics:{queryLocal:function(a){var b=new promise.Promise;return(new LocalPageModel).local(a).then(function(a,c){a&&(l.error(a),page("/"),AlertComponent.error(_("An error has occurred","alert"))),c&&c.items&&b.done(c),b.done(c)}),b},getMorePlaces:function(a){var b=new promise.Promise;return(new LocalPageModel).getMorePlaces(a).then(function(a,c){a&&(l.error(a),page("/"),AlertComponent.error(_("An error has occured","alert"))),c&&c.items&&b.done(c),b.done(c)}),b},getSelectedFilters:function(){var a=Dispatcher.getUrlParameter("category");return{price:Dispatcher.getUrlParameter("price"),category:a,reviews:Dispatcher.getUrlParameter("reviews"),rooms:Dispatcher.getUrlParameter("rooms"),checkin:Dispatcher.getUrlParameter("checkin"),checkout:Dispatcher.getUrlParameter("checkout"),openingHours:Dispatcher.getUrlParameter("openingHours")}},closeFilters:function(){var a=$(".local__filters--shrinked"),b=$(".result_page_local__filters")[0],c=$(".search_bar")[0];a&&a[0]&&hasClass(a,"filters-visible")&&b&&(a=a[0],removeClass(b,"result_page_local__filters--mobile"),removeClass(a,"filters-visible"),c&&(c.style.display="block"));var d=$i("result_page_local_mobile_container");d&&(addClass(d,"list-visible"),removeClass(d,"detail-visible"))},openFilters:function(){var a=$(".local__filters--shrinked"),b=$(".result_page_local__filters")[0],c=$(".search_bar")[0];a&&a[0]&&b&&(a=a[0],toggleClass(b,"result_page_local__filters--mobile"),toggleClass(a,"filters-visible"),c&&("none"===c.style.display?c.style.display="block":c.style.display="none"));var d=$i("result_page_local_mobile_container");d&&(removeClass(d,"list-visible"),addClass(d,"detail-visible"))},closeAllDropDowns:function(a){if(this.filters){var b=this.filters;a.forEach(function(a){b[a]&&b[a].close()})}},getLabel:function(a,b,c){var d="";return Object.keys(a).forEach(function(c){a[c].value===b&&(d=a[c].label)}),""!==d?d:c},formatDisplayCategory:function(a){var b="";return a.forEach(function(c,d){var e=c;0===d?e=LocalHelper.capitalizeFirstLetter(e):d!==a.length&&(e=", "+e),b+=e}),b},capitalizeFirstLetter:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},chunk:function(a,b){var c,d,e=[];for(c=0,d=a.length;c<d;c+=b)e.push(a.substr(c,b));return e},showPhoneNumbers:function(a,b,c){var d=a.caller||a.event.target||a.event.srcElement,e=a.phoneNumber;if(hasClass(d,b)||null!=a.caller||(d=d.parentElement),d&&e&&!hasClass(d,"result-local__phone-numbers")){var f=e.replace("+33 ","0");f=this.chunk(f,2).join(" "),d.parentElement.removeAttribute("id"),d.parentElement.removeAttribute("onmousedown"),d.parentElement.removeAttribute("onclick"),d.parentElement.removeAttribute("onmouseup"),d.removeAttribute("id"),d.removeAttribute("onmousedown"),d.removeAttribute("onclick"),d.removeAttribute("onmouseup"),d.innerHTML='<a class="'+c+'" href="tel:'+e.replace(" ","")+'" '+SecurityHelper.targetBlank()+">"+f+"</a>"}},isDevice:function(){return hasClass(document.body,"device")},updateUrlParameters:function(a,b){if(UrlHelper.removeGETParam([a]),UrlHelper.addGETParam(a,encodeURIComponent(b)),"q"===a){var c="local/?q="+b;history.pushState({path:c},document.title,c)}},getPlaceStreetItinerary:function(a){var b="";return(a.street||a.place)&&(b="|TO+",a.street&&(b+=a.street+" "),a.place&&(b+=a.place)),b},categorySearchNearbyIsActive:function(a){return"FRA"===a},checkListScrollable:function(a,b,c){var d=0,e=$(a)[0],f=$(b)[0];e&&(d=e.offsetWidth),d>=c&&f&&(f.style.display="none")},listScroll:function(a){var b=a.type,c=a.component,d=$(c.listItemReference[b].container)[0],e=$(c.listItemReference[b].arrowRight)[0],f=$(c.listItemReference[b].arrowLeft)[0],g=$(c.listItemReference[b].item)[0];e.style.display="block",f.style.display="block";var h,i=g.clientWidth+c.listItemReference[b].margin,j=a.position,k=parseInt(window.getComputedStyle(d).marginLeft),l=a.totalWidth,m=a.totalItems;if("left"===j)(h=k+i)>=0&&(h=10,f.style.display="none");else{h=k-i;l<=-h+m*c.listItemReference[b].margin+326&&(e.style.display="none")}d.style.marginLeft=h+"px"},setSwipableList:function(a,b,c){var d=$(c.listItemReference[a].list)[0],e=$(c.listItemReference[a].container)[0],f=$(c.listItemReference[a].arrowRight)[0],g=$(c.listItemReference[a].arrowLeft)[0],h=$(c.listItemReference[a].item)[0];if(h){var i=h.clientHeight+parseInt(window.getComputedStyle(h).marginTop.replace("px",""))+parseInt(window.getComputedStyle(h).marginBottom.replace("px",""));e.style.width=b+"px",e.style.overflowY="hidden",d.style.overflowX="scroll",f&&g&&(d.style.height=i+"px"),f&&(f.style.display="none"),g&&(g.style.display="none")}},getLocalUrlString:function(a){return"/local/?"+Object.entries(a).filter(function(a){return a[1]&&""!==a[1]}).map(function(a){return a[0]+"="+a[1]}).join("&")},formatDisplayOpeningHours:function(a){return a.replace(/-/g,"&nbsp;-&nbsp;").replace(/,/g,"<br/>")},getCurrentDayName:function(){return i18n.date.dayNames[(new Date).getDay()]},encodeQuery:function(a){return UrlHelper.fixedEncodeURIComponent(a).replace(/"/g,"&quot;")}}}),MusicHelper=Class({$statics:{getDuration:function(a){if(isNaN(a))return"00:00";a=Math.floor(a/1e3);var b=Math.floor(a/3600);a%=3600;var c=Math.floor(a/60);a%=60;var d=a;b<10&&(b="0"+b),c<10&&(c="0"+c),d<10&&(d="0"+d);var e="";return"00"!==b&&(e+=b+":"),e+=c+":",e+=d},getArtistRoute:function(a){return encodeURI("/music/artist/"+a)},getDiscographyRoute:function(a){return encodeURI("/music/"+a+"/discography")},getNewsRoute:function(a){return encodeURI("/music/"+a+"/news")},getSocialRoute:function(a){return encodeURI("/music/"+a+"/social")},getClipsRoute:function(a){return encodeURI("/music/"+a+"/clips")},getImagesRoute:function(a){return encodeURI("/music/"+a+"/images")},getAlbumRoute:function(a,b){return encodeURI("/music/album/"+a+"-"+b)},redirectAlbumRoute:function(a){window.location=config_get("qwantUrl")+"/music/album/"+a.artistSlug+"-"+a.albumSlug},redirectArtistRoute:function(a){window.location=config_get("qwantUrl")+"/music/artist/"+a.artistSlug},redirectMusicRoute:function(){window.location=config_get("qwantUrl")+"/music"}}}),SiteHelper=Class({$statics:{autoCompleteActive:function(){return applicationState.user.userSetting.enableSuggest},updateOgMeta:function(){$i("meta_og_url")&&$i("meta_og_url").setAttribute("content",location),$i("meta_og_title")&&$i("meta_og_title").setAttribute("content",document.title),$i("meta_og_description")&&$i("meta_og_description").setAttribute("content",_("Qwant is a search engine that respects your privacy and eases discovering and sharing via a social approach.","meta")),$i("meta_description")&&$i("meta_description").setAttribute("content",_("Qwant is a search engine that respects your privacy and eases discovering and sharing via a social approach.","meta")),$i("meta_keywords")&&$i("meta_keywords").setAttribute("content",appTitle.toLowerCase()+" "+_("search engine privacy","meta"))},getDeviceName:function(){var a="desktop";return innerWidth<siteConfiguration.searchCategories.WEB.minWidth?a="smartphone":siteConfiguration.searchCategories.ALL&&innerWidth<siteConfiguration.searchCategories.ALL.minWidth&&(a="tablet"),a},isHomepageRestricted:function(a){return void 0!==a&&a.restricted&&a.restricted.toRegions&&a.restricted.toRegions.length>0&&-1==a.restricted.toRegions.indexOf(applicationState.user.userSetting.getSearchRegionCode())},getVerticalProductsUrls:function(){return["https://www.qwant.com/music","https://www.qwant.com/maps/"]}}});LayoutComponent.registerBeforeAction(SiteHelper.updateOgMeta,[]);var WebTagger=Class({constructor:function(a,b){this.component=a,this.fields=b},tag:function(a){return'tag="'+actionManager.registerTag(this,a)+'"'},log:function(a){var b=this,c={};if("home_page"===LayoutComponent.currentPage.name)var d=QwantHomepageComponent.currentHomepage.name;else var d=Dispatcher.getUrlParameter("t");if(!d)for(var e in siteConfiguration.searchCategories)if(applicationState.user.userSetting.searchMode===siteConfiguration.searchCategories[e].index){d=siteConfiguration.searchCategories[e].name;break}c.t=d,c.component=this.component.name,c.context=LayoutComponent.currentPage.name,c.locale=applicationState.user.getSettings().getLocalisedSearchRegionCode(),Object.keys(this.fields).forEach(function(a){c[a]=b.fields[a]}),Object.keys(a).forEach(function(b){c[b]=a[b]}),AjaxManager.post(ajax.action.tag(),c)}}),AbstractAudioModel={current:null,getPlayer:function(a,b,c){AbstractAudioModel.current&&AbstractAudioModel.current.stop();var d=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;switch("dailymotion"===a.affiliate||"vimeo"===a.affiliate||"youtube"===a.affiliate?(addClass($i("music_player__video_container"),"music_player__video_container--visible"),addClass($(".feedback"),"with__video_player"),removeClass($(".music-player__video_toggle-icon"),"music-player__video_toggle-icon--hidden")):(removeClass($i("music_player__video_container"),"music_player__video_container--visible"),addClass($(".music-player__video_toggle-icon"),"music-player__video_toggle-icon--hidden")),a.affiliate){case"dailymotion":AbstractAudioModel.current=new Dailymotion(a,b,c);break;case"vimeo":AbstractAudioModel.current=new Vimeo(a,b,c);break;case"youtube":AbstractAudioModel.current=new Youtube(a,b,c);break;case"radio":AbstractAudioModel.current=new HTML5(a,b);break;case"itune":default:AbstractAudioModel.current=d?new Flash(a,b):new HTML5(a,b)}return AbstractAudioModel.current}},MobileAppModel=Class(Model,{applications:function(a){return AjaxManager.get(ajax.mobileApp(),new AjaxParameters({platform:a}).getParameters())}}),Dailymotion=function(a,b,c){function d(c){Dailymotion.player?(Dailymotion.player.load(a.url),MusicPlayerComponent.musicPlayer.isPlay?Dailymotion.player.play():Dailymotion.player.pause()):($i("music_player__video_iframe").innerHTML='<div id="dm_iframe_container"></div>',Dailymotion.player=DM.player($i("dm_iframe_container"),{width:460,height:230,video:a.url,api:1,params:{controls:!1,quality:"240",info:!1,"endscreen-enable":!1,"sharing-enable":!1,autoplay:!0}}),Dailymotion.player.addEventListener("video_end",b),Dailymotion.player.addEventListener("pause",MusicPlayerComponent.playerEvents.pause),Dailymotion.player.addEventListener("play",function(){Dailymotion.player.setVolume(MusicPlayerComponent.musicPlayer.volume),MusicPlayerComponent.playerEvents.play()})),c.done()}return{close:function(){Dailymotion.player.pause(),Dailymotion.audio=null},play:function(){Dailymotion.player.play()},stop:function(){Dailymotion.player&&(Dailymotion.player.pause(),Dailymotion.player.seek(0))},fullScreen:function(){Dailymotion.player.setFullscreen(!0)},seek:function(a){Dailymotion.player.seek(a)},pause:function(){Dailymotion.player.pause()},hasFullScreenHandling:function(){return!1},volume:function(a){Dailymotion.player.setVolume(a),Dailymotion.volume=a},getCurrentTime:function(){return Dailymotion.player?Dailymotion.player.currentTime:0},getDuration:function(){return Dailymotion.player?Dailymotion.player.duration:1},getSongData:function(){return a},load:function(){var a=new promise.Promise;if(Dailymotion.hasLibrary)d(a);else{getScript("/js/music/dm-all.js").then(function(b){if(b)return void a.done(b);d(a),Dailymotion.hasLibrary=!0})}return a}}};Dailymotion.hasLibrary=!1;var Flash=function(a,b){function c(c){soundManager.setup({url:"/swf",onready:function(){Flash.audio=soundManager.createSound({url:a.url,autoLoad:!0,autoPlay:!0,volume:100*MusicPlayerComponent.musicPlayer.volume,onfinish:function(){b()},onplay:function(){MusicPlayerComponent.playerEvents.play()},onresume:function(){MusicPlayerComponent.playerEvents.pause()},onerror:function(a){console.error("err",a)}}),c.done(null,Flash)}})}return{close:function(){Flash.audio.pause(),Flash.audio.destruct(),Flash.audio=null},play:function(){Flash.audio.play()},stop:function(){
Flash.audio&&(Flash.audio.pause(),Flash.audio.setPosition(0))},seek:function(a){Flash.audio.setPosition(1e3*a)},pause:function(){Flash.audio&&Flash.audio.pause()},volume:function(a){Flash.volume=a,Flash.audio.setVolume(100*a)},getCurrentTime:function(){return Flash.audio.position/1e3},getDuration:function(){return Flash.audio.duration/1e3},getSongData:function(){return a},hasFullScreenHandling:function(){return!1},load:function(){var a=new promise.Promise;if("undefined"==typeof soundManager){getScript("/js/music/soundmanager2.js").then(function(b,d){b?a.done(b):c(a)})}else c(a);return a}}},HTML5=function(a,b){return HTML5.audio=new Audio(a.url),HTML5.audio.play(),HTML5.audio.volume=MusicPlayerComponent.musicPlayer.volume,HTML5.audio.onended=function(){b()},HTML5.audio.onplaying=function(){MusicPlayerComponent.playerEvents.play()},HTML5.audio.onpause=function(){MusicPlayerComponent.playerEvents.pause()},{close:function(){this.stop()},play:function(){HTML5.audio.play()},stop:function(){HTML5.audio.pause(),HTML5.audio.currentTime=0},seek:function(a){a&&a!==1/0&&!isNaN(HTML5.audio.duration)&&(HTML5.audio.currentTime=a)},pause:function(){HTML5.audio.pause()},volume:function(a){HTML5.audio.volume=a,HTML5.volume=a},getCurrentTime:function(){return HTML5.audio.currentTime},hasFullScreenHandling:function(){return!1},getDuration:function(){return HTML5.audio.duration},getSongData:function(){return a},load:function(){return{then:function(a){a()}}}}},Vimeo=function(a,b,c){function d(){var a=new promise.Promise;if(Vimeo.hasFroogaloop)a.done(null);else{getScript("/js/music/froogaloop.js").then(function(b){if(b)return l.info(b),void a.done(b);a.done(null)})}return a}function e(){var b=new promise.Promise;$i("music_player__video_iframe").innerHTML='<div id="vimeo_iframe_container"></div>';var c="https://player.vimeo.com/video/"+a.url+"/?api=1&autoplay=1",d=document.createElement("iframe");return d.setAttribute("src",c),$i("vimeo_iframe_container").appendChild(d),Vimeo.player=$f(d),Vimeo.player.addEvent("ready",function(){b.done()}),b}return{close:function(){Vimeo.player.api("unload"),Vimeo.player=null},play:function(){Vimeo.player.api("play")},stop:function(){Vimeo.player&&(Vimeo.player.api("pause"),Vimeo.player.api("seekTo",0))},seek:function(a){Vimeo.player.api("seekTo",a)},pause:function(){Vimeo.player&&Vimeo.player.api("pause")},volume:function(a){Vimeo.volume=a,Vimeo.player.api("setVolume",a)},getCurrentTime:function(){return Vimeo.player?(Vimeo.player.api("getCurrentTime",function(a){Vimeo.currentTime=a}),Vimeo.currentTime):0},fullScreen:function(){},getDuration:function(){return Vimeo.player?(Vimeo.player.api("getDuration",function(a){Vimeo.duration=a}),Vimeo.duration):0},getSongData:function(){return a},hasFullScreenHandling:function(){return!1},load:function(){var a=new promise.Promise;return d().then(function(c){if(c)return void a(c);e().then(function(c){if(c||!Vimeo.player)return void a.done(c);Vimeo.player.addEvent("finish",function(){b.call(MusicPlayerComponent.musicPlayer)}),Vimeo.player.addEvent("play",function(){MusicPlayerComponent.playerEvents.play()}),Vimeo.player.addEvent("pause",function(){MusicPlayerComponent.playerEvents.pause()}),a.done()})}),a}}};Vimeo.duration=0,Vimeo.currentTime=0,Vimeo.hasFroogaloop=!1;var Youtube=function(a,b,c){function d(a){window.onYouTubeIframeAPIReady=function(b){f=!0,e(a)}}function e(c){Youtube.player?(Youtube.player.loadVideoById(a.id),Youtube.player.playVideo(),Youtube.player.setVolume(100*MusicPlayerComponent.musicPlayer.volume),c.done(null)):($i("music_player__video_iframe").innerHTML='<div id="yt_iframe_container"></div>',Youtube.player=new YT.Player("yt_iframe_container",{width:460,height:230,nocookie:1,playerVars:{fs:0,enablejsapi:1,controls:2,autoplay:1,iv_load_policy:3},videoId:a.id,events:{onError:function(){MusicPlayerComponent.musicPlayer.showError()},onReady:function(){c.done(null),Youtube.player.setVolume(100*MusicPlayerComponent.musicPlayer.volume)},onStateChange:function(a){a.data==YT.PlayerState.ENDED&&b(),a.data==YT.PlayerState.PAUSED&&MusicPlayerComponent.playerEvents.pause(),a.data==YT.PlayerState.PLAYING&&MusicPlayerComponent.playerEvents.play(),a.data,YT.PlayerState.BUFFERING,a.data==YT.PlayerState.CUED||(a.data,YT.PlayerState.PLAYING)}}}))}var f=!1;return{close:function(){this.stop(),Youtube.player.destroy(),Youtube.player=null},play:function(){Youtube.player.playVideo()},stop:function(){Youtube.player&&(Youtube.player.seekTo(0),Youtube.player.pauseVideo())},seek:function(a){Youtube.player.seekTo(a)},pause:function(){Youtube.player.pauseVideo()},volume:function(a){Youtube.player.setVolume(100*a),Youtube.volume=a},getCurrentTime:function(){return Youtube.player&&void 0!==Youtube.player.getCurrentTime?Youtube.player.getCurrentTime():0},hasFullScreenHandling:function(){return!0},getDuration:function(){return Youtube.player&&void 0!==Youtube.player.getDuration?Youtube.player.getDuration():0},fullScreen:function(){var a=$i("yt_iframe_container"),b=a.requestFullScreen||a.mozRequestFullScreen||a.webkitRequestFullScreen;b&&(b.bind(a)(),Youtube.player.setControls(1))},getSongData:function(){return a},load:function(){var a=new promise.Promise;if(window.YT={loading:0,loaded:0},window.YTConfig={host:"https://www.youtube.com"},f)e(a);else{var b=getScript("js/music/www-widgetapi.js",{id:"www-widgetapi-script"});d(a),b.then(function(b){if(YT.loaded=1,YT.loading=0,b)return void a.done(b)})}return a}}},Confettiful=Class(Model,{constructor:function(a){this.el=a,this.containerEl=null,this.confettiColors=["#FF2B2A","#FAFB3E","#2EC75B","#0A92EF"],this.confettiAnimations=["slow","medium","fast"],this.confettiInterval=null,this._setupElements(),this._renderConfetti(),_super(this)},_setupElements:function(){var a=document.createElement("div"),b=this.el.style.position;"relative"===b&&"absolute"===b||(this.el.style.position="relative"),a.classList.add("confetti-container"),this.el.appendChild(a),this.containerEl=a},_renderConfetti:function(){var a=this;this.confettiInterval=setInterval(function(){a._atInterval(a)},25)},_atInterval:function(a){var b=document.createElement("div"),c=Math.floor(3*Math.random())+7+"px",d=a.confettiColors[Math.floor(Math.random()*a.confettiColors.length)],e=Math.floor(Math.random()*a.el.offsetWidth)+"px",f=a.confettiAnimations[Math.floor(Math.random()*a.confettiAnimations.length)];b.classList.add("confetti","confetti--animation-"+f),b.style.left=e,b.style.width=c,b.style.height=c,b.style.backgroundColor=d,b.removeTimeout=setTimeout(function(){b.parentNode.removeChild(b)},3e3),a.containerEl.appendChild(b)}}),CustomPageModel=Class(Model,function(){return{game:function(a){var b=new promise.Promise,c=applicationState.user.token||null,d={slug:a,lang:applicationState.user.getSettings().getInterfaceLanguageCode(),locale:applicationState.user.userSetting.getLocalisedSearchRegionCode()};return c&&(d.session_token=c),AjaxManager.get(ajax.game(),new AjaxParameters(d).getParameters()).then(function(c,d){if(c)b.done(c);else if(d.data&&d.data.main)try{var e=new CustomPageDataModel(d.data),f=new OverviewPageComponent(e,"game",a),g=CustomPageHeaderComponent.SECTION_GAME;b.done(!1,f,e,g)}catch(a){b.done(a)}else{var h=new NotFoundComponent;b.done(!1,h,null,null)}}),b},"game-editor":function(a){var b=new promise.Promise,c=applicationState.user.token||null,d={slug:a,lang:applicationState.user.getSettings().getInterfaceLanguageCode(),locale:applicationState.user.userSetting.getLocalisedSearchRegionCode()};return c&&(d.session_token=c),AjaxManager.get(ajax.game_editor(),new AjaxParameters(d).getParameters()).then(function(c,d){if(c)b.done(c);else if(d.data&&d.data.main)try{var e=new CustomPageDataModel(d.data),f=new OverviewPageComponent(e,"game-editor",a),g=CustomPageHeaderComponent.SECTION_GAME_EDITOR;b.done(!1,f,e,g)}catch(a){b.done(a)}else{var h=new NotFoundComponent;b.done(!1,h,null,null)}}),b},metropolis:function(a){var b=new promise.Promise,c=applicationState.user.token||null,d={slug:a,lang:applicationState.user.getSettings().getInterfaceLanguageCode(),locale:applicationState.user.userSetting.getLocalisedSearchRegionCode()};return c&&(d.session_token=c),AjaxManager.get(ajax.metropolis(),new AjaxParameters(d).getParameters()).then(function(c,d){if(c)b.done(c);else if(d.data&&d.data.main)try{var e=new CustomPageDataModel(d.data),f=new OverviewPageComponent(e,"metropolis",a),g=CustomPageHeaderComponent.SECTION_METROPOLIS;b.done(!1,f,e,g)}catch(a){b.done(a)}else{var h=new NotFoundComponent;b.done(!1,h,null,null)}}),b}}}),CustomPageDataModel=Class(Model,{constructor:function(a){if(!a.main)throw"Missing main object";this.main=a.main,this.biography=a.biography,this.gameList=a.gameList,this.products=a.products,this.media=a.media,this.offers=a.offers,this.discography=a.discography,this.events=a.events,this.news=a.news,this.social=a.social,this.credits=a.credits,this.reviews=a.reviews,this.similars=a.similars,this.magazines=a.magazines,this.velobleu=a.velobleu,this.civocracy=a.civocracy,this.webcams=a.webcams,this.ads=a.ads,this.newsSources=a.newsSources,_super(this)},getMain:function(){var a=this.main?this.main:{};return{getName:function(){return a.name?a.name:""},getSlug:function(){return a.slug?a.slug:""},getPicture:function(){var b=a.picture?a.picture:{};return{getUrl:function(){return b.url?b.url:""},isCover:function(){return!!b.isCover&&b.isCover},getUrlRetina:function(){return b.url?b.url.split(".").join("-x2."):""}}},getBanner:function(){return a.banner?a.banner:""},getAlbumsCount:function(){return a.albumsCount?a.albumsCount:0},getEventsCount:function(){return a.eventsCount?a.eventsCount:0},getTracksCount:function(){return a.tracksCount?a.tracksCount:0},getGenre:function(){return a.genre?a.genre:""},getScore:function(){return a.score&&a.score>0?a.score:""},getRestriction:function(){return a.restriction?a.restriction:""},getYear:function(){return a.year?a.year:""},getDate:function(){return a.date?strftime(i18n.date.longFormat,new Date(1e3*a.date)):""},getSocialLinks:function(){return(a.socialLinks?a.socialLinks:[]).map(function(a){return{getUrl:function(){return a.url?a.url:""},getType:function(){return a.type?a.type:""},getDisplayName:function(){return a.displayName?a.displayName:""}}})},getReversedPlatforms:function(){return a.reversedPlatforms?a.reversedPlatforms:[]},getAirQuality:function(){if(a.air_quality&&"number"==typeof a.air_quality){var b={10:_("very good","metropolis"),20:_("very good","metropolis"),30:_("good","metropolis"),40:_("good","metropolis"),50:_("good","metropolis"),60:_("medium","metropolis"),70:_("poor","metropolis"),80:_("poor","metropolis"),90:_("bad","metropolis"),100:_("very bad","metropolis")};return{score:a.air_quality,label:b[10*Math.floor(a.air_quality/10)],class:10*Math.floor(a.air_quality/10)}}return""}}},getBiography:function(){var a=this.biography;return a&&a.content?{getContent:function(b){var c=a.content?a.content:"";if(c.length>b){for(;b!==c.length&&" "!==c[b]&&b<b+50;)b++;b!==c.length&&(c=c.slice(0,b)+"...")}return c},getWikipediaUrl:function(){return a.wikipediaUrl?a.wikipediaUrl:""},getOfficialUrl:function(){return a.officialUrl?a.officialUrl:""},getStats:function(){return[a.population&&"number"==typeof a.population?{label:_("Inhabitants","statistics"),value:NumberHelper.simplifyNumber(a.population)}:null,a.surface_area&&"number"==typeof a.surface_area?{label:_("KM²","statistics"),value:Math.round(a.surface_area)}:null,a.cities&&"number"==typeof a.cities?{label:_("Townships","statistics"),value:NumberHelper.simplifyNumber(a.cities)}:null,a.gameCount&&"number"==typeof a.gameCount?{label:_n("Game","Games",a.gameCount,"overview"),value:a.gameCount}:null].filter(function(a){return null!==a})},getEditor:function(){var b=a.editor?a.editor:[];return{getName:function(){return b.name?b.name:""},getLogo:function(){return b.logo?b.logo:""},getSlug:function(){return b.slug?b.slug:""}}}}:null},getProducts:function(){return(this.products?this.products:[]).map(function(a){return{getUrl:function(){return a.url?a.url:""},getTitle:function(){return a.title?a.title:""},getPicture:function(){return a.picture?a.picture:""},getPrice:function(){return a.price?a.price:""},getPriceCurrency:function(){return a.priceCurrency?a.priceCurrency:""},getBrand:function(){return a.brand?a.brand:""}}})},getMedia:function(){var a=this.media?this.media:{};return{getVideos:function(){var b=a.videos?a.videos:[];return b.length>5?b.splice(0,5):b},getPictures:function(){var b=a.pictures?a.pictures:[];return b.length>5?b.splice(0,5):b},getTwitch:function(){var b=a.twitch?a.twitch:[];return b.length>3?b.splice(0,3):b},getWebcams:function(){return a.webcams?a.webcams:[]},getVideoAds:function(){return a.videoAds?a.videoAds:[]}}},getOffers:function(){var a=this.offers?this.offers:{};return{getList:function(){return(a.list?a.list:[]).map(function(a){return{getPrice:function(){return a.price?a.price:""},getCurrency:function(){return a.currency?a.currency:""},getShop:function(){return a.shop?a.shop:""},getUrl:function(){return a.url?a.url:""},getPlatform:function(){return a.platform?a.platform:""}}})},getShops:function(){return(a.shops?a.shops:[]).map(function(a){return{getSortName:function(){return a.sortName?a.sortName:""},getDisplayName:function(){return a.displayName?a.displayName:""}}})},getUrl:function(){return a.url?a.url:""}}},getDiscography:function(){return(this.discography?this.discography:[]).map(function(a){return{getName:function(){return a.name?a.name:""},getReleaseDate:function(){return a.releaseDate?a.releaseDate:""},getSlug:function(){return a.slug?a.slug:""},getTracksCount:function(){return a.tracksCount?a.tracksCount:0},getPicture:function(){return a.picture?a.picture:""},getItunesUrl:function(){return a.itunesUrl?a.itunesUrl:""}}})},getEvents:function(){return(this.events?this.events:[]).sort(function(a,b){return b.startDate-a.startDate}).slice(0,7).map(function(a){return{getId:function(){return a.id?a.id:""},getName:function(){return a.title?a.title:""},getTitle:function(){return a.title?a.title.replace(/ ([?!:])/,"&nbsp;$1"):""},getCity:function(){return a.location&&a.location.city?a.location.city:""},getCountry:function(){return a.location&&a.location.country?a.location.country:""},getVenue:function(){return a.location&&a.location.venue?a.location.venue:""},getStartDate:function(){return a.startDate?strftime(i18n.date.dateFormat,new Date(1e3*a.startDate)):""},getEndDate:function(){return a.endDate?strftime(i18n.date.dateFormat,new Date(1e3*a.endDate)):""},getUrl:function(){return a.url?a.url:"/?q="+encodeURIComponent(event.getTitle()+" "+event.getCountry()+" "+event.getCity())+"&t=all"}}})},getNews:function(){var a=this.news?this.news:null;return a?new NewsModel(a,"overview").getNews():a},getSocial:function(a){if(a){var b=!(!this.social||!this.social[a])&&this.social[a];return!!b&&this.constructSocialObject(b,a)}var c=[],d=this.social?this.social:[];for(var e in d)d.hasOwnProperty(e)&&c.push(this.constructSocialObject(d[e],e));return c},constructSocialObject:function(a,b){return{getStats:function(){return a.usersCount?a.usersCount:0},getUrl:function(){return a.url?a.url:""},getType:function(){return b},getPosts:function(){return(a.posts?a.posts:[]).map(function(a){return{getResource:function(){return a.resource?a.resource:""},getType:function(){return a.type?a.type:""},getContent:function(){return a.text?a.text:""},getTimestamp:function(){return a.timestamp?DateHelper.formatDate(a.timestamp,i18n.date.dateFormat):""},getUrl:function(){return a.url?a.url:""}}})}}},getCredits:function(){return(this.credits?this.credits:[]).map(function(a){return{getType:function(){return a.type?a.type:""},getName:function(){return a.name?a.name:""},getValue:function(){return a.value?a.value:""}}})},getReviews:function(){var a=this.reviews;return a?{getOverall:function(){var b=a.overall;return b?{getScore:function(){return b.score&&b.score>0?b.score:""},getNbCritics:function(){return b.nbCritics&&b.nbCritics>0?b.nbCritics:""}}:null},getOfficialWebsite:function(){return a.official_website?a.official_website:""},getCritics:function(){return(a.critics?a.critics:[]).map(function(a){return{getScore:function(){return a.score&&a.score>0?a.score:""},getUrl:function(){return a.url?a.url:""},getDomain:function(){return a.domain?a.domain:""},getTitle:function(){return a.title?a.title:""}}})},getHighestScore:function(){var b=a.critics?a.critics:[],c=null,d=0;return b.forEach(function(a){a.score&&a.score>d&&(d=a.score,c=a)}),c?{getScore:function(){return c.score&&c.score>0?c.score:""},getUrl:function(){return c.url?c.url:""},getDomain:function(){return c.domain?c.domain:""},getTitle:function(){return c.title?c.title:""}}:c},getLowestScore:function(){var b=a.critics?a.critics:[],c=null,d=100;return b.forEach(function(a){a.score&&a.score<d&&(d=a.score,c=a)}),c?{getScore:function(){return c.score&&c.score>0?c.score:""},getUrl:function(){return c.url?c.url:""},getDomain:function(){return c.domain?c.domain:""},getTitle:function(){return c.title?c.title:""}}:c},getAverageScore:function(){var b=a.critics?a.critics:[],c=null,d=100,e=0,f=0,g=0;return b.forEach(function(a){g+=a.score}),f=g/b.length,b.forEach(function(a){(e=a.score-f>0?a.score-f:f-a.score)<d&&(d=e,c=a)}),c?{getScore:function(){return c.score&&c.score>0?c.score:""},getUrl:function(){return c.url?c.url:""},getDomain:function(){return c.domain?c.domain:""},getTitle:function(){return c.title?c.title:""}}:c}}:null},getSimilars:function(){return(this.similars?this.similars:[]).map(function(a){return{getName:function(){return a.name?a.name:""},getSlug:function(){return a.slug?a.slug:""},getCover:function(){return a.cover?a.cover:""},getGrade:function(){return a.grade&&a.grade>0?a.grade:""},getEventElement:function(){return"suggestion"},getLink:function(b){return CustomPageHelper.getOverviewRoute(b,a.slug)}}})},getGameList:function(){return(this.gameList?this.gameList:[]).map(function(a){return{getName:function(){return a.name?a.name:""},getSlug:function(){return a.slug?a.slug:""},getCover:function(){return a.cover?a.cover:""},getGrade:function(){return a.grade&&a.grade>0?a.grade:""},getEventElement:function(){return"gamelist"},getLink:function(){return CustomPageHelper.getOverviewRoute("game",a.slug)}}})},getMagazines:function(){return(this.magazines?this.magazines:[]).map(function(a){return{getName:function(){return(a.title?a.title:"")+(a.number?" #"+a.number:"")},getSlug:function(){return a.slug?a.slug:""},getCover:function(){return a.thumbnail?a.thumbnail:""},getGrade:function(){return""},getEventElement:function(){return"magazine"},getLink:function(){return a.url?a.url:""}}})},getBikeStations:function(){return(this.velobleu?this.velobleu:[]).slice(0,6).map(function(a){return{getId:function(){return a.id?a.id:""},getCapacity:function(){return a.capacity?a.capacity:""},getNbBikes:function(){return a.nb_bikes?a.nb_bikes+"":""},getCoordinates:function(){return a.loc&&2===a.loc.coordinates.length?a.loc.coordinates:[]},getStreet:function(){return a.street?a.street:""},getStation:function(){return a.station?a.station:""},getAdditionalInformations:function(){return a.additional?a.additional:""},getSpot:function(){return a.additional_spot?a.additional_spot:""},getWebsiteLabel:function(){return _("See Velo Bleu website","velobleu")},getWebsiteLogo:function(){return"/img/metropolis/veloBleu-"+(BrowserHelper.isRetina()?"x2":"x1")+".png"},getWebsiteUrl:function(){return"https://www.velobleu.org/carto/"},getType:function(){return"velo-bleu"}}})},getFeedback:function(){return(this.civocracy?this.civocracy:[]).filter(function(a){return a.summary&&a.title}).sort(function(a,b){return b.date-a.date}).slice(0,5).map(function(a){return{getId:function(){return a.id?a.id:""},getUrl:function(){return a.id?"https://www.civocracy.org/discussions/%id%/learn".replace("%id%",a.id):"https://www.civocracy.org"},getTitle:function(){return a.title?a.title.replace(/ ([?!:])/,"&nbsp;$1"):""},getSummary:function(){return a.summary?a.summary.replace(/ ([?!:])/,"&nbsp;$1"):""},getContent:function(){return a.description?a.description:""},getDate:function(){return a.timestamp?DateHelper.formatDate(a.timestamp,i18n.date.dateFormat):""},getPoints:function(){return a.points?NumberHelper.simplifyNumber(a.points):""},getWebsiteLabel:function(){return _("See all discussions","civocracy")},getWebsiteLogo:function(){return"/img/metropolis/civocracy-logo-"+(BrowserHelper.isRetina()?"x2":"x1")+".png"},getWebsiteUrl:function(){return"https://www.civocracy.org/nicecotedazur"},getContributors:function(){return a.contributors?NumberHelper.formatNumber(a.contributors):""}}})},getAds:function(a){return void 0===a?[]:(this.ads?this.ads:[]).filter(function(b){return b.type==a}).map(function(a){return{getImage:function(){return a.image!=={}&&a.image.portrait?a.image.portrait:""},getImageMobile:function(){return a.image!=={}&&a.image.landscape?a.image.landscape:""},getUrl:function(){return a.url?a.url:""},getTitle:function(){return a.title?a.title:""},getSlug:function(){return a.slug?a.slug:""}}}).filter(function(b){return b.type!==a})},getNewsSources:function(){var a=this.newsSources?this.newsSources:"";return a.sources?a.sources:""}}),FavoriteModel=Class(Model,{$statics:{ERROR_INTERNAL:1,ERROR_FAVORITE_ALREADY_EXISTS:401,ERROR_FAVORITE_URL_NOT_ACCESSIBLE:402,STATUS_ENABLED:1,STATUS_DISABLED:2,DEFAULT_SOURCE:"results",areFavoritesStoredLocally:function(){return!!applicationState.user.favorites}},get:function(a){if(applicationState.user.isLogged){var b=new promise.Promise;if(FavoriteModel.areFavoritesStoredLocally()&&!a)applicationState.user&&applicationState.user.favorites?b.done(!1,{data:applicationState.user.favorites}):b.done(FavoriteModel.ERROR_INTERNAL);else{var c=new AjaxParameters({session_token:applicationState.user.token,device:SiteHelper.getDeviceName(),locale:applicationState.user.userSetting.getLocalisedSearchRegionCode()}).getParameters();AjaxManager.get(ajax.user.favorites.get(),c).then(function(a,c){a?b.done(a):(applicationState.user.favorites=c.data,Model.store("user",applicationState.user),b.done(!1,{data:applicationState.user.favorites}))})}return b}return AjaxManager.get(ajax.user.favorites.get(),{})},create:function(a,b,c,d){void 0===d&&(d=FavoriteModel.DEFAULT_SOURCE);var e=new promise.Promise;if(!applicationState.user.isLogged)return e.done(FavoriteModel.ERROR_INTERNAL),e;if(!1!==applicationState.user.favoriteIndexOf(b,a))return e.done(FavoriteModel.ERROR_FAVORITE_ALREADY_EXISTS),e;var f=this,g=SiteHelper.getDeviceName(),h=applicationState.user.userSetting.getLocalisedSearchRegionCode();return AjaxManager.post(ajax.user.favorites.create(),new AjaxParameters({session_token:applicationState.user.token,name:a,url:b,page:d,device:g,locale:h,status:c}).getParameters()).then(function(a,b){a||b.error?(a||(a=b.error),e.done(a)):FavoriteModel.areFavoritesStoredLocally()?(applicationState.user.favorites.push(b.data),Model.store("user",applicationState.user),e.done(!1,{data:{index:applicationState.user.favorites.length-1}})):f.get().then(function(a,b){e.done(a,b)})}),e},update:function(a,b,c,d){var e=new promise.Promise;if(void 0===d||!applicationState.user.isLogged)return e.done(FavoriteModel.ERROR_INTERNAL),e;var f=this;return AjaxManager.post(ajax.user.favorites.update(),new AjaxParameters({session_token:applicationState.user.token,name:a,url:b,status:c,id:FavoriteModel.areFavoritesStoredLocally()?applicationState.user.favorites[d].id:d}).getParameters()).then(function(a,b){a||b.error?(a||(a=b.error),e.done(a)):FavoriteModel.areFavoritesStoredLocally()?(applicationState.user.favorites[d]=b.data,Model.store("user",applicationState.user),e.done(!1)):f.get().then(function(a,b){e.done(a,b)})}),e},delete:function(a){var b=new promise.Promise;if(!applicationState.user.isLogged)return b.done(!0),b;var c=this;return AjaxManager.post(ajax.user.favorites.delete(),new AjaxParameters({session_token:applicationState.user.token,id:FavoriteModel.areFavoritesStoredLocally()?applicationState.user.favorites[a].id:a}).getParameters()).then(function(d){d?b.done(!0):FavoriteModel.areFavoritesStoredLocally()?(applicationState.user.favorites.splice(a,1),Model.store("user",applicationState.user),b.done(!1)):c.get().then(function(a){b.done(a)})}),b},order:function(a){var b=new promise.Promise;return applicationState.user.isLogged?(this.get().then(function(b,c){var d=c.data,e=new promise.Promise;return e.done(a.map(function(a){return d[a].id})),e}).then(function(a){return AjaxManager.post(ajax.user.favorites.order(),new AjaxParameters({session_token:applicationState.user.token,order:a}).getParameters())}).then(function(c){c?b.done(!0):(applicationState.user.favorites=a.map(function(a){return applicationState.user.favorites[a]}),Model.store("user",applicationState.user),b.done(!1))}),b):(b.done(!0),b)}}),FeedbackModel=Class(Model,{sendFeedback:function(a,b,c){for(var d=applicationState.user.userSetting.getInterfaceLanguage().shorthand,e=BrowserHelper.getBrowserInformations().name+" - "+BrowserHelper.getOS(),f=a-1,g={type:f,lang:d,browser:e,extension_version:c},h=0;h<b.length;h++)g["feedback["+h+"]"]=b[h];AjaxManager.post(ajax.extension.feedback(),g)}}),HotelModel=Class(Model,{$statics:{search:function(a){var b={checkin:strftime("%Y-%m-%d",a.checkIn),checkout:strftime("%Y-%m-%d",a.checkOut),rooms:a.roomType,q:a.query,locale:applicationState.user.userSetting.getLocalisedSearchRegionCode(),lang:applicationState.user.userSetting.getInterfaceLanguage().shorthand,sid:a.sessionId},c=new promise.Promise;return Ajax.get(ajax.hotel.search(),new AjaxParameters(b).getParameters()).then(function(a,b){!a&&b&&b.data&&b.data.result&&b.data.result.hotels?c.done(a,b.data.result):c.done(a,[])}),c}}}),LocalPageModel=Class(Model,function(){return{local:function(a){var b=new promise.Promise,c=a;c.locale=applicationState.user.userSetting.getLocalisedSearchRegionCode(),c.lang=applicationState.user.userSetting.getInterfaceLanguage().shorthand;var d=applicationState.user.token||null;return d&&(c.session_token=d),AjaxManager.get(ajax.local.search(),new AjaxParameters(c).getParameters()).then(function(a,c){a&&b.done(a),c.data&&c.data.result&&b.done(!1,c.data.result),b.done(!1,null)}),b},getMorePlaces:function(a){var b=new promise.Promise,c=a,d=applicationState.user.token||null;return d&&(c.session_token=d),AjaxManager.get(ajax.local.places(),new AjaxParameters(c).getParameters()).then(function(a,c){a&&b.done(a),c.data&&c.data.result&&b.done(!1,c.data.result),b.done(!1,null)}),b}}}),MovieModel=Class(Model,{sessions:function(a,b){return AjaxManager.get(ajax.movie.sessions(),new AjaxParameters({theaterId:a,movieId:b}).getParameters())}}),NewsModel=Class(Model,{constructor:function(a,b){if(!a)throw"Missing data object";if(!b)throw"Missing type object";this.news=a,this.type=b,_super(this)},getNews:function(){var a=this.news?this.news:[],b=this.type?this.type:"";return a.map(function(a){return{getTarget:function(){return"overview"===b?SecurityHelper.targetBlank():'target="_self"'},getShortTitle:function(){return"overview"===b&&a.title?a.title:""},getBigTitle:function(){return"overview"===b&&a.title?a.title:""},getShortDesc:function(){return"overview"===b&&a.desc_short?a.desc_short:""},getBigDesc:function(){return"overview"===b&&a.desc?a.desc:""},getDate:function(){return"overview"===b&&a.date?DateHelper.formatDate(a.date,i18n.date.dateFormat):""},getUrl:function(){return"overview"===b&&a.url?a.url:""},getDomain:function(){return"overview"===b&&a.domain?a.domain:""},getCategory:function(){return"news_homepage"===b&&a.category?a.category:""},getMedia:function(){if("overview"===b){var c=a.media[0]?a.media[0]:[];return{getBig:function(){return c.pict_big&&c.pict_big.url?c.pict_big.url:""},getShort:function(){return c.pict&&c.pict.url?c.pict.url:""}}}return""}}})}}),NewsletterModel=Class(Model,{getByToken:function(a){return AjaxManager.get(ajax.user.newsletter()+"/"+a)},unsubscribeByToken:function(a){return AjaxManager.get(ajax.user.unsubscribe()+"/"+a)}}),RankingsModel=Class(Model,{constructor:function(a){if(!a)throw"Missing data object";this.rankings=a,_super(this)},getLocalSingles:function(){return(this.rankings?this.rankings:{}).local_singles},getWeeklySingles:function(){return(this.rankings?this.rankings:{}).global_singles},getTopAlbums:function(){return(this.rankings?this.rankings:{}).top_albums}}),ReportContentModel=Class(Model,{constructor:function(a,b,c,d){this.url=a,this.urlId=b,this.index=c,this.searchDomain=d,_super(this)},send:function(a){return AjaxManager.post(ajax.reportContent(),new AjaxParameters({url:this.url,url_id:this.urlId,url_type:this.searchDomain,url_indice:this.index,query:applicationState.searchQuery,comment:a,locale:applicationState.user.getSettings().getInterfaceLanguage().code||"",session_token:applicationState.user.token||""}).getParameters())}}),ResultActionsModel=Class(Model,{constructor:function(){this.favoriteModel=new FavoriteModel,_super(this)},addFavorite:function(a,b){return this.favoriteModel.create(b,a,1)},removeFavorite:function(a){return this.favoriteModel.delete(a)},isURLInBoards:function(a){var b=new promise.Promise;return applicationState.user.isLogged?b=AjaxManager.get(ajax.boards.isInBoards(),new AjaxParameters({session_token:applicationState.user.token||"",url:a}).getParameters()):(b.done(!1,{data:{isInBoards:!1}}),b)}}),RibbonModel=Class({$statics:{RUNTIME_PHP:"php",RUNTIME_NODEJS:"nodejs",SPECIAL_RIBBONS:["movie","local","knowledge","causes"],iaClientRuntime:null,toggleHelpTooltip:function(a){RibbonModel.isHelpTooltipOpened()?RibbonModel.hideHelpTooltip():RibbonModel.displayHelpTooltip(a)},displayHelpTooltip:function(a){if(addClass($(".ribbon__additional_links_tooltip"),"ribbon__additional_links_tooltip--visible"),addClass($(".ribbon__additional_links"),"ribbon__additional_links--visible"),"undefined"!=$i("ribbon_additional_links_caller")){var b=a.event.target.parentElement||$i("ribbon_additional_links_caller"),c="left";"undefined"!=b.getAttribute("data-placement")&&null!=b.getAttribute("data-placement")&&(c=b.getAttribute("data-placement"));var d=a.runtime||RibbonModel.RUNTIME_NODEJS,e="";if(b.parentElement&&(e=b.parentElement.querySelector(".ribbon__additional_links_tooltip")),""!=e){var f={left:0,top:0};f=d==RibbonModel.RUNTIME_PHP?RibbonModel.getPHPTooltipPosition(b,e,c):RibbonModel.getNodejsTooltipPosition(b,e,c);var g="translate("+f.left+"px, "+f.top+"px)";e.style.webkitTransform=g,e.style.MozTransform=g,e.style.transform=g,addClass(e,"ribbon__additional_links_tooltip--"+c)}}},getPHPTooltipPosition:function(a,b,c){var d=0,e=0,f=0,g=0;return"top"===c?(d=-30,e=7,f=a.offsetTop-b.clientHeight+d,g=a.offsetLeft-b.clientWidth/2,g+=e):"left"===c&&(d=-2,e=-15,f=a.offsetTop+d,g=a.offsetLeft-b.clientWidth+e),{left:g,top:f}},getNodejsTooltipPosition:function(a,b,c){var d=0,e=0,f=0,g=0;return"top"===c?(d=-15,e=7,f=a.offsetTop-b.clientHeight+d,g=a.offsetLeft<b.clientWidth?a.offsetLeft+b.clientWidth/2+10:a.offsetLeft-b.clientWidth/2,g+=e):"left"===c&&(d=-2,e=-15,f=a.offsetTop+d,g=a.offsetLeft-b.clientWidth+e),{left:g,top:f}},hideHelpTooltip:function(a){removeClass($(".ribbon__additional_links_tooltip"),"ribbon__additional_links_tooltip--visible"),removeClass($(".ribbon__additional_links"),"ribbon__additional_links--visible")},isHelpTooltipOpened:function(a){return hasClass($(".ribbon__additional_links_tooltip"),"ribbon__additional_links_tooltip--visible")}},constructor:function(a){if(!a.runtime)throw'Missing "runtime" attribute';if(this.runtime=a.runtime,!a.template_name)throw'Missing "template_name" attribute';if(this.templateName=a.hasOwnProperty("ABGroup")?a.template_name+a.ABGroup:a.template_name,constants.IANames[a.template_name]?this.displayName=constants.IANames[a.template_name]():this.displayName=a.display_name,!a.query)throw'Missing "query" attribute';if(this.query=a.query,this.runtime===this.RUNTIME_PHP){if(!a.endpoint_suffix)throw'Missing "endpoint_suffix" attribute';this.endpointSuffix=a.endpoint_suffix,this.encodedKeyPhrase=a.query
}else if(this.runtime===this.RUNTIME_NODEJS){if(!a.files)throw'Missing "files" attribute';if(!a.images_path)throw'Missing "images_path" attribute';this.images_path=a.images_path,this.files=a.files;var b=this;this.files.forEach(function(a){"template"===a.type&&(b.templateUrl=a.url),"script"===a.type&&(b.scriptUrl=a.url)})}this.loaded=!1,(a.data||0===a.data)&&(this.data=a.data,"nodejs"!==a.runtime&&(this.loaded=!0)),LayoutComponent.registerBeforeAction(this.removeIaRuntimeAction)},getTemplateName:function(){return this.templateName},getLastUpdate:function(){return!!("currency_converter"===this.templateName&&this.data&&this.data[0]&&this.data[0].lastUpdate)&&this.data[0].lastUpdate},getPartnerName:function(){var a={weather:{name:"openweathermap.org",link:"https://www.openweathermap.org/",placement:"left"},movie:{name:'<span class="movie__vod--cnc--brand--img"></span>',link:"http://www.cnc.fr",placement:"top"},map:{name:'<span class="mappy-helplink-logo"></span>',link:"https://corporate.mappy.com/conditions-dutilisation/copyright/",placement:"top"},hotel:{name:'<span class="hotel-ribbon--hotels--brand--img"></span>',link:"https://www.hotelscombined.com/",placement:"left"}},b=this.getQuery().replace(/ /g,"");return("hotel"!==this.templateName||"hotel"!==b)&&(a[this.templateName]||!1)},isCNCService:function(){return!("movie"!==this.templateName||!this.data||!(this.data.length>1||this.data[0]&&void 0!==this.data[0].vod&&null!=this.data[0].vod&&this.data[0].vod.length>0))},getHelpLink:function(){return{calculator:_("https://help.qwant.com/help/qwant-search/instant-answers/calculator/","ia_nodejs"),encryption:_("https://help.qwant.com/help/qwant-search/instant-answers/cryptography/","ia_nodejs"),npm:_("https://help.qwant.com/help/qwant-search/instant-answers/npm-packages/","ia_nodejs"),weather:_("https://help.qwant.com/help/qwant-search/instant-answers/weather/","ia_nodejs"),unit_converter:_("https://help.qwant.com/help/qwant-search/instant-answers/unit-conversion/","ia_nodejs"),currency_converter:_("https://help.qwant.com/help/qwant-search/instant-answers/currency-converter/","ia_nodejs")}[this.templateName]||!1},getDisplayName:function(){return this.displayName},getRuntime:function(){return this.runtime},loadTemplate:function(){return getScript(this.templateUrl,{noCache:!0})},loadScript:function(a){var b=new promise.Promise,c=this;if(c.scriptUrl){getScript(c.scriptUrl,{noCache:!0}).then(function(){RibbonModel.iaClientRuntime=new IARuntime(c.data,{tab:a}),RibbonModel.iaClientRuntime.run(),b.done(null)})}else b.done(null);return b},removeIaRuntimeAction:function(){RibbonModel.iaClientRuntime&&RibbonModel.iaClientRuntime.stop()},getEndpointSuffix:function(){return this.endpointSuffix||null},getQuery:function(){return this.query||""},getDataToDisplay:function(){var a=new promise.Promise,b=this;if(this.getRuntime()===RibbonModel.RUNTIME_NODEJS){b.loadTemplate().then(function(){a.done(!1,tmpl_ia[b.getTemplateName()](b)),b.loaded=!0})}else if(this.getRuntime()===RibbonModel.RUNTIME_PHP){var c={};switch(this.endpointSuffix){case"videos":c.count=30;break;case"images":c.count=25;break;default:case"shopping":c.count=10}void 0!==applicationState.user.userSetting.safeSearch&&(c.safesearch=applicationState.user.userSetting.safeSearch),c.locale=applicationState.user.userSetting.getLocalisedSearchRegionCode(),c.q=this.getQuery(),c.t="all",c.lang=applicationState.user.userSetting.getInterfaceLanguageCode();var d=new AjaxParameters(c),e=SearchAjaxManager.get(ajax.search(this.getEndpointSuffix()),d,configuration.AJAX_TIMEOUTS.SEARCH);e.then(function(c){c.status===AJAX_STATUS.SUCCESS?(b.loaded=!0,c.status===AJAX_STATUS.EMPTY_RESULT&&a.done(!0),a.done(!1,c.items)):a.done(!0)})}return a},alreadyLoaded:function(){return this.loaded}}),RibbonSearchModel=Class({constructor:function(a){var b="all";for(var c in window.siteConfiguration.searchCategories)window.siteConfiguration.searchCategories[c].index==applicationState.user.userSetting.searchMode&&(b=window.siteConfiguration.searchCategories[c].name);this.query=a.rawParams.q||"",this.tab=a.params.t||b,this.count=a.params.count||""},search:function(){var a={};""!==this.count&&(a.count=this.count),void 0!==applicationState.user.userSetting.safeSearch&&(a.safesearch=applicationState.user.userSetting.safeSearch),a.locale=applicationState.user.getSettings().getLocalisedSearchRegionCode(),a.q=this.query,a.t=this.tab,a.lang=applicationState.user.getSettings().getInterfaceLanguageCode(),a.device=SiteHelper.getDeviceName();var b=applicationState.user.token||null;b&&(a.session_token=b),AppComponent.isShoppingDisabled()&&(a.shoppingDisabled=!0);var c=Dispatcher.history.get(0).params;return c&&c.client&&(a.client=c.client),a.uiv=uxVersions.indexOf("v4")>-1?4:3,SearchAjaxManager.get(ajax.ribbon(),new AjaxParameters(a),configuration.AJAX_TIMEOUTS.SEARCH)}}),SearchModel=Class(function(){function a(){var a={};if(this.count&&(a.count=this.count),0===this.page&&0===this.truePage||(a.offset=0!==this.truePage?(this.truePage-1)*this.count:this.page*this.count),this.filters)if("object"==typeof this.filters)for(var b in this.filters)this.filters.hasOwnProperty(b)&&(a[b]=this.filters[b]);else a.f=this.filters;else a.f="";this.nocache&&(a.nc=1),a.locale=applicationState.user.userSetting.getLocalisedSearchRegionCode(),a.q=this.keyPhrase;var c="all",d=Dispatcher.history.get(0).params;if(d&&d.t)c=d.t;else for(var e in window.siteConfiguration.searchCategories)window.siteConfiguration.searchCategories[e].index==applicationState.user.userSetting.searchMode&&(c=window.siteConfiguration.searchCategories[e].name);a.t=c,d&&d.client&&(a.client=d.client),this.device&&(a.device=this.device),this.extensionDisabled&&(a.extensionDisabled=!0),this.shoppingDisabled&&(a.shoppingDisabled=!0),a.uiv=uxVersions.indexOf("v4")>-1?4:3,delete a.page;var f=new promise.Promise,g=new AjaxParameters(a),h=SearchAjaxManager.get(ajax.search(this.type),g,configuration.AJAX_TIMEOUTS.SEARCH),i=this;return h.then(function(a){a.error?i.errorCount+=1:i.errorCount=0,applicationState.searchQuery=i.keyPhrase,i.dataTransport=a,f.done(a)}),f}return{constructor:function(a,b,c){c=c||{},this.page=c.page||0,this.truePage=c.truePage||0,this.errorCount=0,this.isLocked=!1,this.type=a,this.keyPhrase=b,this.filters=c.filters||{},this.filterNames=c.filterNames,this.nocache=c.nocache||null,this.count=c.count||10,this.device=c.device||null,this.extensionDisabled=c.extensionDisabled||null,this.shoppingDisabled=c.shoppingDisabled||null,this.searchPromise=!1,this.dataTransport=null},search:function(){return void 0===applicationState.user.userSetting.safeSearch||this.filters.hasOwnProperty("safesearch")||(this.filters.safesearch=applicationState.user.userSetting.safeSearch),this.searchPromise=a.call(this),this.searchPromise},add:function(){return this.page+=1,this.searchPromise=a.call(this),this.searchPromise},affine:function(b){return this.isLocked=!1,this.keyPhrase=this.keyPhrase+"+"+b,this.searchPromise=a.call(this),this.searchPromise}}}),SearchAjaxManager=function(){function a(a,e,f,g,h){var i,g=g||30;i="get"===a?AjaxManager.get(e,f.getParameters(),h):AjaxManager.post(e,f.getParameters(),h);var j=new promise.Promise,k={ajax:i,promiseBox:j},l=d++;c[l]=k;var m=setTimeout(function(){return delete c[l],j.done(new b(AJAX_STATUS.TIMEOUT)),j},1e3*g);return i.then(function(a,d){clearTimeout(m),delete c[l],j.done(new b(a,d))}),j}function b(a,b){if(a)return b&&b.error?{status:AJAX_STATUS.ERROR,error:b.error}:{status:AJAX_STATUS.ERROR,error:a};if(b){if(b.error==constants.ADULT_CONTENT_STATUS)return{status:constants.ADULT_CONTENT_STATUS,items:[]};if(b.error==AJAX_STATUS.API_ERROR)return{status:AJAX_STATUS.API_ERROR,items:[]};var c={status:AJAX_STATUS.SUCCESS};if(b.data){b.data.query&&b.data.query.query&&(c.query=b.data.query.query);var d=b.data.result;d&&(d.items&&(c.items=d.items),b.data.query&&b.data.query.queryContext&&(c.queryContext=b.data.query.queryContext),d.filters&&(c.filters=d.filters),d.ads&&(c.ads=d.ads),d.total&&(c.total=d.total),d.last&&(c.last=d.last),d.version&&(c.version=d.version))}return(!c.items||c.items&&0===c.items.length)&&(c.status=AJAX_STATUS.EMPTY_RESULT,c.last=!0),c}}var c={},d=0;return{get:function(b,c,d,e){return a("get",b,c,d,e)},post:function(b,c,d,e){return a("post",b,c,d,e)},abort:function(){for(var a in c){var b=c[a];b.promiseBox.done({status:AJAX_STATUS.USER_INTERRUPT}),b.ajax.abort()}c=[]}}}();LayoutComponent.registerBeforeAction(SearchAjaxManager.abort,[]);var SearchManagerModel=Class({constructor:function(){this.searchColumns=[]},addSearch:function(a){this.searchColumns.push(a)},requestPromiseStatus:function(){for(var a=[],b=0;b<this.searchColumns.length;b+=1){var c=this.searchColumns[b].searchModel.searchPromise;a.push(c)}var d=promise.join(a),e=new promise.Promise;return d.then(function(a){for(var b=!0,c=0;c<a.length;c+=1)a[c][0].status===AJAX_STATUS.ERROR&&(b=!1);e.done({success:b})}),e},getCategorizedColumns:function(){for(var a={success:[],error:[]},b=0;b<this.searchColumns.length;b+=1){var c=this.searchColumns[b];0==c.searchModel.errorCount?a.success.push(c):a.error.push(c)}return a},launchSearch:function(a){for(var b=0;b<this.searchColumns.length;b+=1)this.searchColumns[b].search(a)}}),HomeShoppingPageModel=Class(Model,function(){return{homeshopping:function(a,b,c,d){var e=new promise.Promise,f=applicationState.user.token||null,g={category:a.keys,count:50,locale:d+"_"+d.toUpperCase()};return f&&(g.session_token=f),AjaxManager.get(ajax.homeshopping(),new AjaxParameters(g).getParameters()).then(function(d,f){if(d)e.done([d]);else if(f.data&&f.data.result)try{var g=f.data.result,h=new HomeShoppingCategoryComponent(g,a,b,c);e.done([!1,h])}catch(a){e.done([a])}else e.done([!1,null])}),e},categories:function(a){var b=new promise.Promise,c=applicationState.user.token||null,d={locale:a+"_"+a.toUpperCase()};return c&&(d.session_token=c),AjaxManager.get(ajax.shopping_categories(),new AjaxParameters(d).getParameters()).then(function(a,c){if(a)b.done(a);else if(c.data&&c.data.result)try{var d=c.data;b.done(!1,d)}catch(a){b.done(a)}else b.done("Not found",null)}),b}}}),ShoppingSearchResultModel=Class({$statics:{IMG_SMALL:"small",IMG_MEDIUM:"medium",IMG_LARGE:"large"},constructor:function(a){if(void 0===a.product)throw"Missing product information in shopping result data";if(void 0===a.offers)throw"Missing offers information in shopping result data";this.title=a.product.title,this.description=a.product.description,this.categories=Array.isArray(a.product.categories)?a.product.categories:[],this.images=[],a.product.image&&(this.mainImage=a.product.image),this.offers=a.offers.map(function(a){return new ShoppingSearchResultOfferModel(a)})},processImages:function(a){var b=this;this.images=a,a.forEach(function(a){!0===a.main&&(b.mainImage=a)})},getTitle:function(){return this.title},getDescription:function(){return this.description&&"null"!==this.description&&null!==this.description?this.description:""},getMainImageUrl:function(){return this.mainImage.urlMedium},getMainOffer:function(){return this.offers[0]},getOffers:function(){return this.offers},getOtherOffers:function(){return this.offers.slice(1,8)},getCategories:function(){return this.categories.map(function(a){return a.replace(/'/g,"\\'")}).slice(0,4)},getProperties:function(){return this.properties}}),ShoppingSearchResultOfferModel=Class({constructor:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},isOnSale:function(){return null!==this.discount&&parseInt(this.discount)>0},getPrice:function(a){return NumberHelper.formatPrice(this.finalPrice,this.priceCurrency,a)},getRawPrice:function(){return this.finalPrice},getName:function(){return this.name.charAt(0).toUpperCase()+this.name.slice(1)},getUrl:function(){return this.url},getDiscountValue:function(){return"-"+this.discount+"%"},getBasePrice:function(a){var b=(this.finalPrice,Math.ceil(this.finalPrice/(1-this.discount/100)));return NumberHelper.formatPrice(b,this.priceCurrency,a)},getPartnerName:function(){return this.partnerName?this.partnerName:""},getGTIN:function(){return this.gtin&&""!==this.gtin?this.gtin:null}}),SurveyModel=Class(Model,{getSurvey:function(a){return AjaxManager.get(ajax.survey.get(a))},sendFeedback:function(a,b){for(var c=BrowserHelper.getBrowserInformations().name,d={qid:a,browser:c},e=0;e<b.length;e++)d["feedback["+e+"]"]=b[e];AjaxManager.post(ajax.survey.feedback(a),d)},active:function(){return AjaxManager.get(ajax.survey.active())}}),topStoriesModel=Class(Model,{getLocalizedNews:function(){return AjaxManager.get(ajax.topStories(),new AjaxParameters({locale:applicationState.user.userSetting.getLocalisedSearchRegionCode(),device:SiteHelper.getDeviceName(),category:"news"}).getParameters())}}),UserRatingModel=Class(Model,{constructor:function(a,b){this.result=a,this.rating=6,this.flags=[],this.languageRating=4,this.searchQuery=b.searchQuery||"",b.user&&(this.user=b.user,this.user.lang=b.user.getSettings().getInterfaceLanguageCode(),this.user.region=b.user.getSettings().getLocalisedSearchRegionCode()),_super(this)},getRatingScale:function(){return[{value:7,label:_("Vital","user rating")},{value:6,label:_("Useful","user rating")},{value:5,label:_("Relevant","user rating")},{value:4,label:_("Slightly relevant","user rating")},{value:3,label:_("Off-topic","user rating")},{value:2,label:_("Useless","user rating")},{value:1,label:_("Unratable: foreign language","user rating")},{value:0,label:_("Unratable: didn't load","user rating")}]},getFlags:function(){return[{fieldName:"flagSpam",label:_("Spam","user rating"),flagName:"spam"},{fieldName:"flagPorn",label:_("Pornography","user rating"),flagName:"porn"},{fieldName:"flagViolence",label:_("Violence","user rating"),flagName:"violence"},{fieldName:"flagMalicious",label:_("Malicious","user rating"),flagName:"malicious"}]},getLanguageRatingScale:function(){return[{value:4,label:_("Task language","user rating")},{value:3,label:_("Acceptable language","user rating")},{value:2,label:_("English","user rating")},{value:1,label:_("Foreign language","user rating")},{value:0,label:_("None of the above","user rating")}]},prepareJSON:function(){return{session_token:this.user.token,rating:parseInt(this.rating),language_rating:parseInt(this.languageRating),flags:this.flags,query:this.searchQuery||"",lang:this.user.lang||"",region:this.user.region||"",comment:this.comment||"",result_url:this.result.url||"",result_position:this.result.position||1}},submit:function(){return AjaxManager.post(ajax.rate(),new AjaxParameters(this.prepareJSON()).getParameters())},addFlag:function(a){-1===this.flags.indexOf(a)&&this.flags.push(a)},removeFlag:function(a){for(var b=this.flags.indexOf(a);-1!==b;)this.flags.splice(b,1),b=this.flags.indexOf(a)}});